{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"CodeTether Server","text":"<p>Turn AI Agents Into Production Systems.</p> <p>v1.4.0 Production Release</p> <p>CodeTether is battle-tested and running in production at api.codetether.run. Now with Ralph autonomous development, RLM infinite context, and Zapier integration.</p> <p>CodeTether Server is a production-ready implementation of the A2A (Agent-to-Agent) Protocol, the open standard from the Linux Foundation that enables AI agents to communicate, collaborate, and solve complex problems together.</p> <ul> <li> <p> Get Started in 5 Minutes</p> <p>Install CodeTether and run your first multi-agent workflow</p> <p> Quick Start</p> </li> <li> <p> Full A2A Protocol Support</p> <p>Complete implementation of the A2A specification with extensions</p> <p> A2A Protocol</p> </li> <li> <p> Deploy Anywhere</p> <p>Docker, Kubernetes, or bare metal with Helm charts included</p> <p> Deployment</p> </li> <li> <p> OpenCode Integration</p> <p>Bridge AI coding agents to your codebase with session management</p> <p> OpenCode</p> </li> </ul>"},{"location":"#what-is-codetether","title":"What is CodeTether?","text":"<p>CodeTether Server provides the infrastructure layer for running AI agents in production:</p> <ul> <li>Ralph Autonomous Development \u2014 Implement entire PRDs autonomously with zero human intervention</li> <li>RLM (Recursive Language Models) \u2014 Process arbitrarily large codebases without context limits</li> <li>Zapier Integration \u2014 Connect to 5,000+ apps with no-code automation</li> <li>A2A Protocol Native \u2014 Full implementation of the A2A specification for agent-to-agent communication</li> <li>Distributed Workers \u2014 Run agents across multiple machines with automatic task routing</li> <li>Real-time Streaming \u2014 SSE-based live output streaming for long-running agent tasks</li> <li>Session Management \u2014 Resume conversations, sync across devices, maintain context</li> <li>Enterprise Security \u2014 Keycloak OIDC, API tokens, audit logging</li> <li>OpenCode Bridge \u2014 Native integration with OpenCode AI coding agents</li> <li>Deploy Anywhere \u2014 Run on Docker, Kubernetes, or bare metal with ease</li> <li>Email Reply Continuation \u2014 Reply to task notification emails to continue conversations with agents</li> </ul>"},{"location":"#a2a-protocol-implementation","title":"A2A Protocol Implementation","text":"<p>CodeTether implements the complete A2A Protocol specification:</p> A2A Feature CodeTether Support Reference Agent Discovery \u2705 <code>/.well-known/agent-card.json</code> Spec \u00a75 JSON-RPC 2.0 \u2705 Full support Spec \u00a76 Task Management \u2705 Create, cancel, status Spec \u00a77 Streaming (SSE) \u2705 Real-time artifacts Spec \u00a78 Push Notifications \u2705 Webhook callbacks Topics Multi-turn Conversations \u2705 Session continuity Topics <p>Plus CodeTether extensions:</p> <ul> <li>Ralph \u2014 Autonomous development loop that implements PRDs with self-healing retry</li> <li>RLM \u2014 Recursive Language Models for infinite context processing</li> <li>Zapier \u2014 Native OAuth2 integration with triggers, actions, and searches</li> <li>Distributed task coordination \u2014 Redis-backed task/state coordination (workers poll the server over HTTP)</li> <li>OpenCode Integration \u2014 AI coding agent bridge with codebase registration</li> <li>Monitor UI \u2014 Web dashboard for real-time agent observation</li> <li>MCP Tools \u2014 Model Context Protocol tool server</li> <li>Email Reply to Continue \u2014 Reply directly to task notification emails to keep working with an agent</li> <li>Task Reaper \u2014 Automatic stuck task recovery with retry and notification</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># Install\npip install codetether\n\n# Run server\ncodetether serve --port 8000\n\n# In another terminal, send a task\ncurl -X POST http://localhost:8000/v1/a2a \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n        \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n                \"parts\": [{\"type\": \"text\", \"content\": \"Analyze this codebase\"}]\n      }\n    },\n    \"id\": \"1\"\n  }'\n</code></pre>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<p>At a high level:</p> <ul> <li>Clients talk to the API (<code>:8000</code>) for A2A JSON-RPC (<code>/v1/a2a</code>) and REST (<code>/v1/opencode/*</code>, <code>/v1/monitor/*</code>).</li> <li>Workers run OpenCode and poll the server for pending tasks over HTTP.</li> <li>Redis provides pub/sub plus shared task/state coordination.</li> <li>The MCP server (<code>:9000</code>) exposes CodeTether capabilities as MCP tools.</li> </ul> <p>For diagrams and deeper detail, see Architecture.</p>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li> <p> Installation</p> <p> Install Guide</p> </li> <li> <p> Configuration</p> <p> Config Reference</p> </li> <li> <p> API Reference</p> <p> API Docs</p> </li> <li> <p> Source Code</p> <p> GitHub</p> </li> </ul>"},{"location":"api/jsonrpc/","title":"JSON-RPC Methods","text":"<p>CodeTether implements the A2A Protocol JSON-RPC methods.</p>"},{"location":"api/jsonrpc/#endpoint","title":"Endpoint","text":"<pre><code>POST /v1/a2a\nPOST /  (alias)\nContent-Type: application/json\n</code></pre>"},{"location":"api/jsonrpc/#methods","title":"Methods","text":""},{"location":"api/jsonrpc/#messagesend","title":"message/send","text":"<p>Send a message to the agent.</p>"},{"location":"api/jsonrpc/#messagestream","title":"message/stream","text":"<p>Send a message and receive streaming updates (SSE-style payloads).</p>"},{"location":"api/jsonrpc/#tasksget","title":"tasks/get","text":"<p>Get task status.</p>"},{"location":"api/jsonrpc/#taskscancel","title":"tasks/cancel","text":"<p>Cancel a running task.</p>"},{"location":"api/jsonrpc/#tasksresubscribe","title":"tasks/resubscribe","text":"<p>Resubscribe to updates for an existing task.</p> <p>See A2A Protocol Specification for full details.</p>"},{"location":"api/opencode/","title":"OpenCode API","text":"<p>The OpenCode API provides integration with AI coding agents. It manages codebases, sessions, tasks, and real-time agent interactions.</p> <p>Base URL</p> <p>All OpenCode endpoints are prefixed with <code>/v1/opencode</code> <pre><code>https://codetether.example.com/v1/opencode/...\n</code></pre></p>"},{"location":"api/opencode/#status","title":"Status","text":""},{"location":"api/opencode/#check-opencode-status","title":"Check OpenCode Status","text":"<p>Check if the OpenCode bridge is available and initialized. Includes local runtime session information.</p> <pre><code>GET /v1/opencode/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"available\": true,\n  \"message\": \"OpenCode integration ready\",\n  \"opencode_binary\": \"/usr/local/bin/opencode\",\n  \"registered_codebases\": 3,\n  \"auto_start\": true,\n  \"runtime\": {\n    \"available\": true,\n    \"storage_path\": \"/home/user/.local/share/opencode/storage\",\n    \"projects\": 3,\n    \"sessions\": 247\n  }\n}\n</code></pre> Field Type Description <code>available</code> boolean Whether OpenCode bridge is initialized <code>message</code> string Human-readable status message <code>opencode_binary</code> string Path to OpenCode executable <code>registered_codebases</code> integer Number of registered codebases <code>auto_start</code> boolean Whether agents auto-start on trigger <code>runtime</code> object Local runtime session information (if available) <code>runtime.available</code> boolean Whether local OpenCode storage is detected <code>runtime.storage_path</code> string Path to OpenCode storage directory <code>runtime.projects</code> integer Number of local projects <code>runtime.sessions</code> integer Total number of local sessions"},{"location":"api/opencode/#models","title":"Models","text":""},{"location":"api/opencode/#list-available-models","title":"List Available Models","text":"<p>Get a list of AI models available for agent tasks.</p> <pre><code>GET /v1/opencode/models\n</code></pre> <p>Response</p> <pre><code>[\n  {\n    \"id\": \"anthropic/claude-sonnet-4-20250514\",\n    \"name\": \"Claude Sonnet 4\",\n    \"provider\": \"Anthropic\"\n  },\n  {\n    \"id\": \"openai/gpt-4o\",\n    \"name\": \"GPT-4o\",\n    \"provider\": \"OpenAI\"\n  },\n  {\n    \"id\": \"google/gemini-2.0-flash\",\n    \"name\": \"Gemini 2.0 Flash\",\n    \"provider\": \"Google\"\n  }\n]\n</code></pre> <p>Available Providers</p> <ul> <li>Anthropic: Claude Opus, Sonnet, Haiku models</li> <li>OpenAI: GPT-4o, o1, o3-mini models</li> <li>Google: Gemini 2.0/2.5 models</li> <li>DeepSeek: DeepSeek Chat, Reasoner</li> <li>xAI: Grok 2, Grok 3</li> <li>Azure AI Foundry: Custom Azure-hosted models</li> </ul>"},{"location":"api/opencode/#codebases","title":"Codebases","text":""},{"location":"api/opencode/#list-codebases","title":"List Codebases","text":"<p>Get all registered codebases.</p> <pre><code>GET /v1/opencode/codebases\n</code></pre> <p>Response</p> <pre><code>[\n  {\n    \"id\": \"cb_abc123\",\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"Main application codebase\",\n    \"worker_id\": \"worker-1\",\n    \"created_at\": \"2025-12-10T10:00:00Z\"\n  }\n]\n</code></pre>"},{"location":"api/opencode/#register-codebase","title":"Register Codebase","text":"<p>Register a new codebase for agent work.</p> <pre><code>POST /v1/opencode/codebases\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"name\": \"my-project\",\n  \"path\": \"/home/user/projects/my-project\",\n  \"description\": \"Main application codebase\",\n  \"agent_config\": {\n    \"default_model\": \"anthropic/claude-sonnet-4-20250514\",\n    \"auto_approve\": false\n  },\n  \"worker_id\": \"worker-1\"\n}\n</code></pre> Field Type Required Description <code>name</code> string \u2705 Display name for the codebase <code>path</code> string \u2705 Absolute path to the codebase directory <code>description</code> string \u274c Description of the codebase <code>agent_config</code> object \u274c Agent configuration overrides <code>worker_id</code> string \u274c Associate with specific worker <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"codebase\": {\n    \"id\": \"cb_abc123\",\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"Main application codebase\",\n    \"created_at\": \"2025-12-10T10:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"api/opencode/#get-codebase","title":"Get Codebase","text":"<p>Get details of a specific codebase.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"id\": \"cb_abc123\",\n  \"name\": \"my-project\",\n  \"path\": \"/home/user/projects/my-project\",\n  \"description\": \"Main application codebase\",\n  \"worker_id\": \"worker-1\",\n  \"agent_config\": {\n    \"default_model\": \"anthropic/claude-sonnet-4-20250514\"\n  },\n  \"created_at\": \"2025-12-10T10:00:00Z\",\n  \"last_activity\": \"2025-12-10T15:30:00Z\"\n}\n</code></pre>"},{"location":"api/opencode/#delete-codebase","title":"Delete Codebase","text":"<p>Unregister a codebase.</p> <pre><code>DELETE /v1/opencode/codebases/{codebase_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Codebase cb_abc123 deleted\"\n}\n</code></pre>"},{"location":"api/opencode/#agent-actions","title":"Agent Actions","text":""},{"location":"api/opencode/#trigger-agent","title":"Trigger Agent","text":"<p>Start an AI agent on a codebase with a prompt.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/trigger\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"prompt\": \"Add comprehensive unit tests for the authentication module\",\n  \"agent\": \"build\",\n  \"model\": \"anthropic/claude-sonnet-4-20250514\",\n  \"files\": [\"src/auth/login.py\", \"src/auth/oauth.py\"],\n  \"metadata\": {\n    \"priority\": \"high\",\n    \"ticket\": \"JIRA-123\"\n  }\n}\n</code></pre> Field Type Required Description <code>prompt</code> string \u2705 The task instruction for the agent <code>agent</code> string \u274c Agent type: <code>build</code>, <code>plan</code>, <code>explore</code>, <code>general</code> (default: <code>build</code>) <code>model</code> string \u274c Model to use (default: codebase config or Claude Sonnet) <code>files</code> array \u274c Specific files to focus on <code>metadata</code> object \u274c Custom metadata to attach to the task <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"session_id\": \"sess_xyz789\",\n  \"task_id\": \"task_abc123\",\n  \"status\": \"running\",\n  \"message\": \"Agent started on codebase my-project\"\n}\n</code></pre>"},{"location":"api/opencode/#send-message","title":"Send Message","text":"<p>Send a follow-up message to a running agent session.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/message\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"message\": \"Also add integration tests for the OAuth flow\",\n  \"agent\": \"build\"\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Message sent to agent\"\n}\n</code></pre>"},{"location":"api/opencode/#interrupt-agent","title":"Interrupt Agent","text":"<p>Send an interrupt signal to pause the agent.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/interrupt\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Interrupt signal sent\"\n}\n</code></pre>"},{"location":"api/opencode/#stop-agent","title":"Stop Agent","text":"<p>Stop the running agent completely.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/stop\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Agent stopped\"\n}\n</code></pre>"},{"location":"api/opencode/#get-agent-status","title":"Get Agent Status","text":"<p>Check the current status of an agent on a codebase.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"codebase_id\": \"cb_abc123\",\n  \"status\": \"running\",\n  \"session_id\": \"sess_xyz789\",\n  \"current_task\": \"Adding unit tests\",\n  \"started_at\": \"2025-12-10T15:30:00Z\",\n  \"model\": \"anthropic/claude-sonnet-4-20250514\"\n}\n</code></pre>"},{"location":"api/opencode/#sessions","title":"Sessions","text":""},{"location":"api/opencode/#list-sessions","title":"List Sessions","text":"<p>Get session history for a codebase.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/sessions\n</code></pre> <p>Query Parameters</p> Parameter Type Description <code>limit</code> integer Maximum sessions to return (default: 50) <code>offset</code> integer Pagination offset <p>Response</p> <pre><code>{\n  \"sessions\": [\n    {\n      \"id\": \"sess_xyz789\",\n      \"codebase_id\": \"cb_abc123\",\n      \"started_at\": \"2025-12-10T15:30:00Z\",\n      \"ended_at\": \"2025-12-10T16:45:00Z\",\n      \"status\": \"completed\",\n      \"model\": \"anthropic/claude-sonnet-4-20250514\",\n      \"prompt\": \"Add unit tests for authentication\",\n      \"messages_count\": 24\n    }\n  ],\n  \"total\": 15,\n  \"limit\": 50,\n  \"offset\": 0\n}\n</code></pre>"},{"location":"api/opencode/#sync-sessions","title":"Sync Sessions","text":"<p>Sync sessions from OpenCode to the server database.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/sessions/sync\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"synced\": 5,\n  \"message\": \"Synced 5 sessions from OpenCode\"\n}\n</code></pre>"},{"location":"api/opencode/#get-session-messages","title":"Get Session Messages","text":"<p>Get all messages from a specific session.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/messages?session_id={session_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"messages\": [\n    {\n      \"id\": \"msg_001\",\n      \"role\": \"user\",\n      \"content\": \"Add unit tests for authentication\",\n      \"timestamp\": \"2025-12-10T15:30:00Z\"\n    },\n    {\n      \"id\": \"msg_002\",\n      \"role\": \"assistant\",\n      \"content\": \"I'll analyze the authentication module and create comprehensive tests...\",\n      \"timestamp\": \"2025-12-10T15:30:05Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/opencode/#tasks","title":"Tasks","text":""},{"location":"api/opencode/#create-task","title":"Create Task","text":"<p>Create a queued task for an agent to pick up.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/tasks\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"title\": \"Add unit tests\",\n  \"prompt\": \"Add comprehensive unit tests for the authentication module\",\n  \"agent_type\": \"build\",\n  \"priority\": 1,\n  \"metadata\": {\n    \"ticket\": \"JIRA-123\"\n  }\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"task\": {\n    \"id\": \"task_abc123\",\n    \"codebase_id\": \"cb_abc123\",\n    \"title\": \"Add unit tests\",\n    \"status\": \"pending\",\n    \"priority\": 1,\n    \"created_at\": \"2025-12-10T15:30:00Z\"\n  }\n}\n</code></pre>"},{"location":"api/opencode/#list-tasks","title":"List Tasks","text":"<p>Get all tasks, optionally filtered.</p> <pre><code>GET /v1/opencode/tasks\nGET /v1/opencode/codebases/{codebase_id}/tasks\n</code></pre> <p>Query Parameters</p> Parameter Type Description <code>status</code> string Filter by status: <code>pending</code>, <code>running</code>, <code>completed</code>, <code>failed</code> <code>limit</code> integer Maximum tasks to return <p>Response</p> <pre><code>{\n  \"tasks\": [\n    {\n      \"id\": \"task_abc123\",\n      \"codebase_id\": \"cb_abc123\",\n      \"title\": \"Add unit tests\",\n      \"status\": \"completed\",\n      \"created_at\": \"2025-12-10T15:30:00Z\",\n      \"completed_at\": \"2025-12-10T16:45:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/opencode/#get-task","title":"Get Task","text":"<p>Get details of a specific task.</p> <pre><code>GET /v1/opencode/tasks/{task_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"id\": \"task_abc123\",\n  \"codebase_id\": \"cb_abc123\",\n  \"title\": \"Add unit tests\",\n  \"prompt\": \"Add comprehensive unit tests...\",\n  \"agent_type\": \"build\",\n  \"status\": \"running\",\n  \"priority\": 1,\n  \"session_id\": \"sess_xyz789\",\n  \"created_at\": \"2025-12-10T15:30:00Z\",\n  \"started_at\": \"2025-12-10T15:30:05Z\"\n}\n</code></pre>"},{"location":"api/opencode/#cancel-task","title":"Cancel Task","text":"<p>Cancel a pending or running task.</p> <pre><code>POST /v1/opencode/tasks/{task_id}/cancel\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Task cancelled\"\n}\n</code></pre>"},{"location":"api/opencode/#real-time-events","title":"Real-time Events","text":""},{"location":"api/opencode/#stream-agent-events","title":"Stream Agent Events","text":"<p>Subscribe to real-time events from an agent session via Server-Sent Events (SSE).</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/events\nAccept: text/event-stream\n</code></pre> <p>Event Types</p> <pre><code>event: status\ndata: {\"status\": \"running\", \"message\": \"Agent started\"}\n\nevent: output\ndata: {\"type\": \"text\", \"content\": \"Analyzing codebase structure...\"}\n\nevent: tool_use\ndata: {\"tool\": \"read_file\", \"args\": {\"path\": \"src/auth/login.py\"}}\n\nevent: file_change\ndata: {\"action\": \"create\", \"path\": \"tests/test_auth.py\"}\n\nevent: complete\ndata: {\"status\": \"completed\", \"summary\": \"Added 15 unit tests\"}\n\nevent: error\ndata: {\"error\": \"Model rate limit exceeded\", \"code\": \"RATE_LIMITED\"}\n</code></pre> <p>Example Client (JavaScript)</p> <pre><code>const events = new EventSource('/v1/opencode/codebases/cb_abc123/events');\n\nevents.addEventListener('output', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(data.content);\n});\n\nevents.addEventListener('complete', (e) =&gt; {\n  console.log('Agent completed!');\n  events.close();\n});\n\nevents.addEventListener('error', (e) =&gt; {\n  console.error('Stream error:', e);\n});\n</code></pre>"},{"location":"api/opencode/#runtime-sessions","title":"Runtime Sessions","text":"<p>The Runtime API provides immediate access to OpenCode sessions stored locally on the system. Unlike the codebase-based session APIs which require registration, these endpoints read directly from the OpenCode storage directory (<code>~/.local/share/opencode/storage/</code>).</p> <p>Zero Configuration</p> <p>When OpenCode is detected on a system, users can immediately browse and resume their existing sessions without registering codebases first.</p>"},{"location":"api/opencode/#check-runtime-status","title":"Check Runtime Status","text":"<p>Check if OpenCode runtime storage is available on the local system.</p> <pre><code>GET /v1/opencode/runtime/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"available\": true,\n  \"message\": \"OpenCode runtime detected\",\n  \"storage_path\": \"/home/user/.local/share/opencode/storage\",\n  \"projects\": 3,\n  \"sessions\": 247\n}\n</code></pre> Field Type Description <code>available</code> boolean Whether local OpenCode storage is detected <code>message</code> string Human-readable status <code>storage_path</code> string Path to OpenCode storage directory <code>projects</code> integer Number of projects found <code>sessions</code> integer Total number of sessions across all projects"},{"location":"api/opencode/#list-runtime-projects","title":"List Runtime Projects","text":"<p>Get all OpenCode projects detected on the local system.</p> <pre><code>GET /v1/opencode/runtime/projects\n</code></pre> <p>Response</p> <pre><code>{\n  \"projects\": [\n    {\n      \"id\": \"2e35f00d-abc123\",\n      \"worktree\": \"/home/user/my-project\",\n      \"vcs\": \"git\",\n      \"vcs_dir\": \"/home/user/my-project/.git\",\n      \"created_at\": 1733859600,\n      \"updated_at\": 1733918400,\n      \"session_count\": 45\n    },\n    {\n      \"id\": \"global\",\n      \"worktree\": \"/\",\n      \"vcs\": null,\n      \"vcs_dir\": null,\n      \"created_at\": 1733800000,\n      \"updated_at\": 1733910000,\n      \"session_count\": 5\n    }\n  ]\n}\n</code></pre> Field Type Description <code>id</code> string Unique project identifier (git commit hash or \"global\") <code>worktree</code> string Path to the project directory <code>vcs</code> string Version control system (e.g., \"git\") <code>vcs_dir</code> string Path to VCS directory <code>created_at</code> number Unix timestamp when project was first seen <code>updated_at</code> number Unix timestamp of last activity <code>session_count</code> integer Number of sessions for this project"},{"location":"api/opencode/#list-runtime-sessions","title":"List Runtime Sessions","text":"<p>Get all sessions with pagination, optionally filtered by project.</p> <pre><code>GET /v1/opencode/runtime/sessions\nGET /v1/opencode/runtime/sessions?project_id={project_id}\nGET /v1/opencode/runtime/sessions?limit=20&amp;offset=0\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>project_id</code> string - Filter sessions by project ID <code>limit</code> integer 50 Maximum sessions to return <code>offset</code> integer 0 Pagination offset <p>Response</p> <pre><code>{\n  \"sessions\": [\n    {\n      \"id\": \"sess_abc123\",\n      \"project_id\": \"2e35f00d-abc123\",\n      \"directory\": \"/home/user/my-project\",\n      \"title\": \"Implementing OAuth2 authentication flow\",\n      \"version\": \"1.0.0\",\n      \"created_at\": 1733859600,\n      \"updated_at\": 1733918400,\n      \"summary\": {\n        \"total_messages\": 24,\n        \"model\": \"claude-sonnet-4-20250514\"\n      }\n    }\n  ],\n  \"total\": 247,\n  \"limit\": 50,\n  \"offset\": 0\n}\n</code></pre> Field Type Description <code>id</code> string Unique session identifier <code>project_id</code> string Associated project ID <code>directory</code> string Working directory for the session <code>title</code> string Session title/description <code>version</code> string OpenCode version used <code>created_at</code> number Unix timestamp when session started <code>updated_at</code> number Unix timestamp of last activity <code>summary</code> object Session statistics"},{"location":"api/opencode/#get-runtime-session","title":"Get Runtime Session","text":"<p>Get details for a specific session by ID.</p> <pre><code>GET /v1/opencode/runtime/sessions/{session_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"session\": {\n    \"id\": \"sess_abc123\",\n    \"project_id\": \"2e35f00d-abc123\",\n    \"directory\": \"/home/user/my-project\",\n    \"title\": \"Implementing OAuth2 authentication flow\",\n    \"version\": \"1.0.0\",\n    \"created_at\": 1733859600,\n    \"updated_at\": 1733918400,\n    \"summary\": {\n      \"total_messages\": 24,\n      \"model\": \"claude-sonnet-4-20250514\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/opencode/#get-session-messages_1","title":"Get Session Messages","text":"<p>Get the conversation history for a session.</p> <pre><code>GET /v1/opencode/runtime/sessions/{session_id}/messages\nGET /v1/opencode/runtime/sessions/{session_id}/messages?limit=20&amp;offset=0\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>limit</code> integer 50 Maximum messages to return <code>offset</code> integer 0 Pagination offset <p>Response</p> <pre><code>{\n  \"messages\": [\n    {\n      \"id\": \"msg_001\",\n      \"session_id\": \"sess_abc123\",\n      \"role\": \"user\",\n      \"created_at\": 1733859600,\n      \"model\": null,\n      \"cost\": null,\n      \"tokens\": null,\n      \"tool_calls\": []\n    },\n    {\n      \"id\": \"msg_002\",\n      \"session_id\": \"sess_abc123\",\n      \"role\": \"assistant\",\n      \"created_at\": 1733859605,\n      \"model\": \"claude-sonnet-4-20250514\",\n      \"cost\": 0.0015,\n      \"tokens\": {\"input\": 150, \"output\": 423},\n      \"tool_calls\": [\"read_file\", \"write_file\"]\n    }\n  ],\n  \"total\": 24,\n  \"limit\": 50,\n  \"offset\": 0,\n  \"session_id\": \"sess_abc123\"\n}\n</code></pre>"},{"location":"api/opencode/#get-session-parts","title":"Get Session Parts","text":"<p>Get message parts (content chunks) for a session.</p> <pre><code>GET /v1/opencode/runtime/sessions/{session_id}/parts\nGET /v1/opencode/runtime/sessions/{session_id}/parts?message_id={message_id}\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>message_id</code> string - Filter parts by specific message <code>limit</code> integer 100 Maximum parts to return <p>Response</p> <pre><code>{\n  \"parts\": [\n    {\n      \"id\": \"part_001\",\n      \"message_id\": \"msg_001\",\n      \"type\": \"text\",\n      \"content\": \"Please implement OAuth2 authentication...\",\n      \"created_at\": 1733859600\n    },\n    {\n      \"id\": \"part_002\",\n      \"message_id\": \"msg_002\",\n      \"type\": \"tool_use\",\n      \"tool_name\": \"read_file\",\n      \"arguments\": {\"path\": \"src/auth/oauth.py\"},\n      \"created_at\": 1733859605\n    }\n  ],\n  \"session_id\": \"sess_abc123\",\n  \"message_id\": null\n}\n</code></pre>"},{"location":"api/opencode/#database-api","title":"Database API","text":"<p>The Database API provides access to PostgreSQL-persisted data for workers, codebases, and sessions. These endpoints return data that survives server restarts and works across multiple replicas.</p> <p>PostgreSQL Required</p> <p>These endpoints require <code>DATABASE_URL</code> to be configured. Without PostgreSQL, they return empty results.</p>"},{"location":"api/opencode/#database-status","title":"Database Status","text":"<p>Check PostgreSQL connection status and statistics.</p> <pre><code>GET /v1/opencode/database/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"available\": true,\n  \"message\": \"PostgreSQL connected\",\n  \"stats\": {\n    \"workers\": 3,\n    \"codebases\": 12,\n    \"tasks\": 45,\n    \"sessions\": 156\n  },\n  \"pool_size\": 10,\n  \"pool_idle\": 8\n}\n</code></pre> Field Type Description <code>available</code> boolean Whether PostgreSQL is connected <code>message</code> string Connection status message <code>stats.workers</code> integer Total registered workers <code>stats.codebases</code> integer Total registered codebases <code>stats.tasks</code> integer Total tasks in database <code>stats.sessions</code> integer Total sessions synced <code>pool_size</code> integer Connection pool size <code>pool_idle</code> integer Idle connections available"},{"location":"api/opencode/#list-all-sessions-database","title":"List All Sessions (Database)","text":"<p>Get all sessions across all codebases from PostgreSQL.</p> <pre><code>GET /v1/opencode/database/sessions\nGET /v1/opencode/database/sessions?limit=50&amp;offset=0\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>limit</code> integer 100 Maximum sessions to return <code>offset</code> integer 0 Pagination offset <p>Response</p> <pre><code>{\n  \"sessions\": [\n    {\n      \"id\": \"sess_xyz789\",\n      \"codebase_id\": \"cb_abc123\",\n      \"codebase_name\": \"my-project\",\n      \"codebase_path\": \"/home/user/my-project\",\n      \"title\": \"Implementing OAuth2 authentication\",\n      \"created_at\": \"2025-12-10T15:00:00Z\",\n      \"updated_at\": \"2025-12-10T16:30:00Z\",\n      \"summary\": {\n        \"total_messages\": 24,\n        \"model\": \"claude-sonnet-4-20250514\"\n      }\n    }\n  ],\n  \"total\": 156,\n  \"limit\": 100,\n  \"offset\": 0,\n  \"source\": \"postgresql\"\n}\n</code></pre>"},{"location":"api/opencode/#list-all-codebases-database","title":"List All Codebases (Database)","text":"<p>Get all registered codebases from PostgreSQL.</p> <pre><code>GET /v1/opencode/database/codebases\n</code></pre> <p>Response</p> <pre><code>{\n  \"codebases\": [\n    {\n      \"id\": \"cb_abc123\",\n      \"name\": \"my-project\",\n      \"path\": \"/home/user/my-project\",\n      \"description\": \"Main application\",\n      \"worker_id\": \"worker-1\",\n      \"status\": \"idle\",\n      \"created_at\": \"2025-12-10T10:00:00Z\",\n      \"updated_at\": \"2025-12-10T15:30:00Z\"\n    }\n  ],\n  \"total\": 12,\n  \"source\": \"postgresql\"\n}\n</code></pre>"},{"location":"api/opencode/#list-all-workers-database","title":"List All Workers (Database)","text":"<p>Get all registered workers from PostgreSQL.</p> <pre><code>GET /v1/opencode/database/workers\n</code></pre> <p>Response</p> <pre><code>{\n  \"workers\": [\n    {\n      \"worker_id\": \"abc123\",\n      \"name\": \"dev-vm-worker\",\n      \"hostname\": \"dev-vm.internal\",\n      \"capabilities\": [\"opencode\", \"build\", \"deploy\", \"test\"],\n      \"status\": \"active\",\n      \"registered_at\": \"2025-12-10T09:00:00Z\",\n      \"last_seen\": \"2025-12-10T15:30:00Z\"\n    }\n  ],\n  \"total\": 3,\n  \"source\": \"postgresql\"\n}\n</code></pre>"},{"location":"api/opencode/#workers","title":"Workers","text":"<p>The Worker API enables Agent Workers to connect, register codebases, and execute tasks.</p>"},{"location":"api/opencode/#register-worker","title":"Register Worker","text":"<p>Register a worker with the server.</p> <pre><code>POST /v1/opencode/workers/register\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"name\": \"dev-vm-worker\",\n  \"capabilities\": [\"opencode\", \"build\", \"deploy\", \"test\"],\n  \"hostname\": \"dev-vm.internal\"\n}\n</code></pre> Field Type Required Description <code>worker_id</code> string \u2705 Unique worker identifier <code>name</code> string \u2705 Human-readable worker name <code>capabilities</code> array \u274c List of worker capabilities <code>hostname</code> string \u274c Machine hostname <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"worker_id\": \"abc123\",\n  \"message\": \"Worker registered\"\n}\n</code></pre>"},{"location":"api/opencode/#unregister-worker","title":"Unregister Worker","text":"<p>Unregister a worker from the server.</p> <pre><code>POST /v1/opencode/workers/{worker_id}/unregister\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Worker unregistered\"\n}\n</code></pre>"},{"location":"api/opencode/#stream-task-output","title":"Stream Task Output","text":"<p>Stream real-time output from a task execution.</p> <pre><code>POST /v1/opencode/tasks/{task_id}/output\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"output\": \"Analyzing codebase structure...\",\n  \"timestamp\": \"2025-12-10T15:30:05Z\"\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true\n}\n</code></pre>"},{"location":"api/opencode/#update-task-status","title":"Update Task Status","text":"<p>Update the status of a task (used by workers).</p> <pre><code>PUT /v1/opencode/tasks/{task_id}/status\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"status\": \"completed\",\n  \"worker_id\": \"abc123\",\n  \"result\": \"Added 15 unit tests to the authentication module\"\n}\n</code></pre> Field Type Required Description <code>status</code> string \u2705 New status: <code>running</code>, <code>completed</code>, <code>failed</code> <code>worker_id</code> string \u2705 Worker identifier <code>result</code> string \u274c Task result (for completed) <code>error</code> string \u274c Error message (for failed) <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"task_id\": \"task_abc123\",\n  \"status\": \"completed\"\n}\n</code></pre>"},{"location":"api/opencode/#sync-sessions_1","title":"Sync Sessions","text":"<p>Sync OpenCode sessions from a worker to the server.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/sessions/sync\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"sessions\": [\n    {\n      \"id\": \"sess_xyz789\",\n      \"title\": \"Implementing OAuth2 flow\",\n      \"project_id\": \"2e35f00d\",\n      \"created_at\": \"2025-12-10T15:00:00Z\",\n      \"updated_at\": \"2025-12-10T16:30:00Z\",\n      \"summary\": {\n        \"total_messages\": 24,\n        \"model\": \"claude-sonnet-4-20250514\"\n      }\n    }\n  ]\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"synced\": 5,\n  \"message\": \"Synced 5 sessions\"\n}\n</code></pre>"},{"location":"api/opencode/#error-responses","title":"Error Responses","text":"<p>All endpoints return errors in a consistent format:</p> <pre><code>{\n  \"detail\": \"Codebase not found\"\n}\n</code></pre> Status Code Description <code>400</code> Bad request - invalid parameters <code>404</code> Resource not found <code>409</code> Conflict - e.g., agent already running <code>503</code> OpenCode bridge not available"},{"location":"api/opencode/#examples","title":"Examples","text":""},{"location":"api/opencode/#complete-workflow","title":"Complete Workflow","text":"<pre><code># 1. Check status\ncurl https://codetether.run/v1/opencode/status\n\n# 2. Register a codebase\ncurl -X POST https://codetether.run/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-app\",\n    \"path\": \"/home/user/my-app\",\n    \"description\": \"My application\"\n  }'\n\n# 3. List available models\ncurl https://codetether.run/v1/opencode/models\n\n# 4. Trigger an agent\ncurl -X POST https://codetether.run/v1/opencode/codebases/cb_abc123/trigger \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"prompt\": \"Refactor the database module to use async/await\",\n    \"agent\": \"build\",\n    \"model\": \"anthropic/claude-sonnet-4-20250514\"\n  }'\n\n# 5. Watch events (in another terminal)\ncurl -N https://codetether.run/v1/opencode/codebases/cb_abc123/events\n\n# 6. Send follow-up message\ncurl -X POST https://codetether.run/v1/opencode/codebases/cb_abc123/message \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\": \"Also add type hints\"}'\n\n# 7. Stop the agent\ncurl -X POST https://codetether.run/v1/opencode/codebases/cb_abc123/stop\n</code></pre>"},{"location":"api/overview/","title":"API Overview","text":"<p>CodeTether Server exposes multiple API endpoints for different purposes.</p>"},{"location":"api/overview/#endpoint-summary","title":"Endpoint Summary","text":"Endpoint Port Protocol Description <code>/v1/a2a</code> 8000 JSON-RPC 2.0 A2A Protocol - agent-to-agent communication (alias: <code>POST /</code>) <code>/v1/opencode/*</code> 8000 REST OpenCode integration - codebase &amp; session management <code>/v1/monitor/*</code> 8000 REST Monitoring - agents, messages, stats <code>/v1/auth/*</code> 8000 REST Authentication - tokens, sessions <code>/mcp/v1/*</code> 9000 JSON-RPC MCP Protocol - tool integration <code>/.well-known/agent-card.json</code> 8000 REST A2A agent discovery <code>/health</code> 8000 REST Health check"},{"location":"api/overview/#base-urls","title":"Base URLs","text":"<pre><code># A2A Protocol (JSON-RPC)\nPOST https://codetether.example.com/v1/a2a\n\n# REST APIs\nGET/POST https://codetether.example.com/v1/opencode/...\nGET/POST https://codetether.example.com/v1/monitor/...\n\n# MCP Protocol\nPOST https://codetether.example.com:9000/mcp/v1/rpc\n\n# MCP Protocol (when exposed via ingress)\nPOST https://codetether.example.com/mcp/v1/rpc\n</code></pre>"},{"location":"api/overview/#authentication","title":"Authentication","text":""},{"location":"api/overview/#bearer-token","title":"Bearer Token","text":"<pre><code>curl -X POST https://codetether.example.com/v1/a2a \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"jsonrpc\": \"2.0\", ...}'\n</code></pre>"},{"location":"api/overview/#keycloak-oidc","title":"Keycloak OIDC","text":"<p>If Keycloak is configured, obtain a token first:</p> <pre><code># Get access token\nTOKEN=$(curl -s -X POST \"https://auth.example.com/realms/myrealm/protocol/openid-connect/token\" \\\n  -d \"client_id=codetether\" \\\n  -d \"client_secret=your-secret\" \\\n  -d \"grant_type=client_credentials\" | jq -r '.access_token')\n\n# Use token\ncurl -X POST https://codetether.example.com/v1/a2a \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"jsonrpc\": \"2.0\", ...}'\n</code></pre>"},{"location":"api/overview/#common-response-codes","title":"Common Response Codes","text":"Code Description <code>200</code> Success <code>400</code> Bad request - invalid parameters <code>401</code> Unauthorized - missing or invalid token <code>403</code> Forbidden - insufficient permissions <code>404</code> Not found - resource doesn't exist <code>500</code> Server error <code>503</code> Service unavailable - dependency not ready"},{"location":"api/overview/#api-sections","title":"API Sections","text":"<ul> <li> <p> JSON-RPC Methods</p> <p>A2A Protocol JSON-RPC methods for agent communication</p> <p> JSON-RPC Reference</p> </li> <li> <p> REST Endpoints</p> <p>REST API for monitoring, health, and management</p> <p> REST Reference</p> </li> <li> <p> OpenCode API</p> <p>Codebase registration, sessions, and AI coding agents</p> <p> OpenCode Reference</p> </li> <li> <p> SSE Events</p> <p>Server-Sent Events for real-time streaming</p> <p> SSE Reference</p> </li> </ul>"},{"location":"api/overview/#a2a-protocol-api","title":"A2A Protocol API","text":"<p>CodeTether v1.2.0 is fully compliant with the A2A Protocol v0.3 specification.</p>"},{"location":"api/overview/#discovery","title":"Discovery","text":"Endpoint Method Description <code>/.well-known/agent-card.json</code> GET Agent card for discovery <p>Example:</p> <pre><code>curl https://codetether.example.com/.well-known/agent-card.json\n</code></pre>"},{"location":"api/overview/#json-rpc-20-binding","title":"JSON-RPC 2.0 Binding","text":"Endpoint Method Description <code>/a2a/jsonrpc</code> POST JSON-RPC 2.0 endpoint for all A2A operations <p>Supported Methods:</p> <ul> <li><code>message/send</code> - Send a message to the agent</li> <li><code>message/stream</code> - Stream a message with SSE responses</li> <li><code>tasks/get</code> - Get task status</li> <li><code>tasks/cancel</code> - Cancel a running task</li> <li><code>tasks/subscribe</code> - Subscribe to task updates</li> </ul> <p>Examples:</p> <pre><code># message/send\ncurl -X POST https://codetether.example.com/a2a/jsonrpc \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"1\",\n    \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [{\"text\": \"Hello, agent!\"}]\n      }\n    }\n  }'\n\n# tasks/get\ncurl -X POST https://codetether.example.com/a2a/jsonrpc \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"2\",\n    \"method\": \"tasks/get\",\n    \"params\": {\n      \"id\": \"task-123\"\n    }\n  }'\n\n# tasks/cancel\ncurl -X POST https://codetether.example.com/a2a/jsonrpc \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"3\",\n    \"method\": \"tasks/cancel\",\n    \"params\": {\n      \"id\": \"task-123\"\n    }\n  }'\n</code></pre>"},{"location":"api/overview/#rest-binding-httpjson","title":"REST Binding (HTTP+JSON)","text":"Endpoint Method Description <code>/a2a/rest/message:send</code> POST Send message <code>/a2a/rest/message:stream</code> POST Stream message (SSE) <code>/a2a/rest/tasks/{id}</code> GET Get task <code>/a2a/rest/tasks/{id}:cancel</code> POST Cancel task <p>Examples:</p> <pre><code># Send message\ncurl -X POST https://codetether.example.com/a2a/rest/message:send \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"message\": {\n      \"role\": \"user\",\n      \"parts\": [{\"text\": \"Hello, agent!\"}]\n    }\n  }'\n\n# Stream message (SSE)\ncurl -X POST https://codetether.example.com/a2a/rest/message:stream \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: text/event-stream\" \\\n  -d '{\n    \"message\": {\n      \"role\": \"user\",\n      \"parts\": [{\"text\": \"Tell me a story\"}]\n    }\n  }'\n\n# Get task\ncurl https://codetether.example.com/a2a/rest/tasks/task-123 \\\n  -H \"Authorization: Bearer your-api-token\"\n\n# Cancel task\ncurl -X POST https://codetether.example.com/a2a/rest/tasks/task-123:cancel \\\n  -H \"Authorization: Bearer your-api-token\"\n</code></pre>"},{"location":"api/rest/","title":"REST Endpoints","text":"<p>CodeTether exposes REST APIs for management and monitoring.</p>"},{"location":"api/rest/#monitor-api","title":"Monitor API","text":"Method Endpoint Description GET /v1/monitor/agents List agents GET /v1/monitor/messages Get messages GET /v1/monitor/stats Get statistics GET /v1/monitor/workers List connected workers"},{"location":"api/rest/#opencode-api","title":"OpenCode API","text":"Method Endpoint Description GET /v1/opencode/status Check OpenCode status (includes runtime info) GET /v1/opencode/codebases List registered codebases POST /v1/opencode/codebases Register a codebase GET /v1/opencode/models List available AI models GET /v1/opencode/tasks List all tasks POST /v1/opencode/codebases/{id}/tasks Create a task for a codebase GET /v1/opencode/tasks/{id} Get task details PUT /v1/opencode/tasks/{id}/status Update task status POST /v1/opencode/tasks/{id}/output Stream task output POST /v1/opencode/tasks/{id}/cancel Cancel a task"},{"location":"api/rest/#worker-api","title":"Worker API","text":"<p>Endpoints used by Agent Workers.</p> Method Endpoint Description POST /v1/opencode/workers/register Register a worker POST /v1/opencode/workers/{id}/unregister Unregister a worker POST /v1/opencode/codebases/{id}/sessions/sync Sync sessions from worker"},{"location":"api/rest/#opencode-runtime-api","title":"OpenCode Runtime API","text":"<p>Direct access to local OpenCode sessions without codebase registration.</p> Method Endpoint Description GET /v1/opencode/runtime/status Check if OpenCode is available locally GET /v1/opencode/runtime/projects List all local projects GET /v1/opencode/runtime/sessions List all sessions (paginated) GET /v1/opencode/runtime/sessions/{id} Get session details GET /v1/opencode/runtime/sessions/{id}/messages Get session messages GET /v1/opencode/runtime/sessions/{id}/parts Get message content parts"},{"location":"api/rest/#health","title":"Health","text":"Method Endpoint Description GET /health Health check <p>See also: OpenCode API | Agent Worker</p>"},{"location":"api/sse/","title":"SSE Events","text":"<p>CodeTether uses Server-Sent Events for real-time task distribution to workers.</p>"},{"location":"api/sse/#worker-task-stream","title":"Worker Task Stream","text":"<p>Workers connect to the task stream endpoint to receive task assignments in real-time:</p> <pre><code>GET /v1/worker/tasks/stream\n</code></pre>"},{"location":"api/sse/#request-headers","title":"Request Headers","text":"Header Required Description <code>X-Codebases</code> Yes Comma-separated list of registered codebase IDs <code>X-Capabilities</code> Yes Comma-separated list of worker capabilities <code>worker_id</code> Yes Worker identifier <code>Authorization</code> No Bearer token for authentication <code>Accept</code> Yes Must be <code>text/event-stream</code>"},{"location":"api/sse/#example-request","title":"Example Request","text":"<pre><code>GET /v1/worker/tasks/stream?worker_id=worker-123 HTTP/1.1\nHost: api.codetether.run\nAccept: text/event-stream\nX-Codebases: my-project,api,backend\nX-Capabilities: opencode,build,deploy,test\nAuthorization: Bearer &lt;token&gt;\n</code></pre>"},{"location":"api/sse/#event-types","title":"Event Types","text":"Event Description Payload <code>connected</code> SSE connection established <code>{\"message\": \"...\"}</code> <code>task_available</code> New task available for worker <code>{\"task_id\": \"...\", \"title\": \"...\", \"codebase_id\": \"...\", ...}</code> <code>task</code> Full task object pushed Full task JSON <code>keepalive</code> Connection keepalive (every 30s) <code>{}</code> <code>error</code> Error occurred <code>{\"message\": \"...\"}</code>"},{"location":"api/sse/#example-stream","title":"Example Stream","text":"<pre><code>event: connected\ndata: {\"message\":\"SSE connection established\"}\n\nevent: task_available\ndata: {\"task_id\":\"task-abc-123\",\"title\":\"Add unit tests\",\"codebase_id\":\"my-project\",\"priority\":0}\n\nevent: keepalive\ndata: {}\n\nevent: task\ndata: {\"id\":\"task-abc-123\",\"title\":\"Add unit tests\",\"codebase_id\":\"my-project\",...}\n</code></pre>"},{"location":"api/sse/#routing","title":"Routing","text":"<p>Tasks are routed to workers based on:</p> <ol> <li>Codebase matching: Tasks with matching <code>codebase_id</code> are sent to workers with that codebase</li> <li>Global tasks: Tasks with <code>codebase_id: \"global\"</code> are sent to all workers with global codebase registered</li> <li>Pending tasks: Tasks with <code>codebase_id: \"__pending__\"</code> can be claimed by any worker</li> </ol>"},{"location":"auth/keycloak/","title":"Keycloak Setup","text":"<p>Integrate CodeTether with Keycloak for enterprise SSO.</p>"},{"location":"auth/keycloak/#prerequisites","title":"Prerequisites","text":"<ul> <li>Keycloak server</li> <li>Admin access to create clients</li> </ul>"},{"location":"auth/keycloak/#configuration","title":"Configuration","text":""},{"location":"auth/keycloak/#option-a-use-the-keycloak-ui","title":"Option A: Use the Keycloak UI","text":"<ol> <li>Create a client in Keycloak</li> <li>Set environment variables:</li> </ol> <pre><code>export KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=codetether\nexport KEYCLOAK_CLIENT_SECRET=your-secret\n</code></pre> <ol> <li>Restart CodeTether</li> </ol>"},{"location":"auth/keycloak/#option-b-createupdate-the-client-via-cli-recommended","title":"Option B: Create/update the client via CLI (recommended)","text":"<p>This repo includes a helper script that uses the Keycloak Admin CLI (<code>kcadm.sh</code>) to upsert an OIDC client with:</p> <ul> <li>Authorization Code flow enabled (works with browser session + PKCE)</li> <li>Direct Access Grants enabled (used by <code>/v1/auth/login</code> password flow)</li> <li>Redirect URIs for the local session test script</li> </ul>"},{"location":"auth/keycloak/#run-it","title":"Run it","text":"<p>Set the required environment variables and run:</p> <pre><code>make keycloak-client\n</code></pre>"},{"location":"auth/keycloak/#required-environment-variables","title":"Required environment variables","text":"<pre><code>export KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=a2a-monitor\n\n# Keycloak admin creds (used only for provisioning)\nexport KEYCLOAK_ADMIN_USERNAME=admin\nexport KEYCLOAK_ADMIN_PASSWORD=your-admin-password\n</code></pre>"},{"location":"auth/keycloak/#optional-knobs","title":"Optional knobs","text":"<pre><code># Defaults are suitable for scripts/test_api_keycloak_session.py\nexport KEYCLOAK_REDIRECT_URIS=\"http://127.0.0.1:8765/*,http://localhost:8765/*\"\nexport KEYCLOAK_WEB_ORIGINS=\"http://127.0.0.1:8765,http://localhost:8765\"\n\n# Set to true if you want a public client (no client secret)\nexport KEYCLOAK_PUBLIC_CLIENT=false\n</code></pre> <p>After the script runs, it prints <code>KEYCLOAK_CLIENT_SECRET=...</code> (for confidential clients). Copy that into your environment / <code>.env</code> / Helm values.</p> <p>See Configuration for all options.</p>"},{"location":"auth/overview/","title":"Authentication","text":"<p>CodeTether supports multiple authentication methods.</p>"},{"location":"auth/overview/#options","title":"Options","text":"<ol> <li>API Tokens - Simple bearer token authentication</li> <li>Keycloak OIDC - Enterprise SSO integration</li> </ol>"},{"location":"auth/overview/#quick-setup","title":"Quick Setup","text":""},{"location":"auth/overview/#api-tokens","title":"API Tokens","text":"<pre><code>export A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:your-secret-token\"\n</code></pre>"},{"location":"auth/overview/#keycloak","title":"Keycloak","text":"<pre><code>export KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=codetether\n</code></pre> <p>See Keycloak Setup for full configuration.</p>"},{"location":"auth/tokens/","title":"API Tokens","text":"<p>Simple bearer token authentication for CodeTether.</p>"},{"location":"auth/tokens/#setup","title":"Setup","text":"<pre><code>export A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:token1,worker:token2\"\n</code></pre>"},{"location":"auth/tokens/#usage","title":"Usage","text":"<pre><code>curl -X POST https://codetether.example.com/v1/a2a \\\n  -H \"Authorization: Bearer token1\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n        \"parts\": [{\"type\": \"text\", \"content\": \"Hello\"}]\n      }\n    },\n    \"id\": \"1\"\n  }'\n</code></pre>"},{"location":"auth/tokens/#multiple-tokens","title":"Multiple Tokens","text":"<p>Define multiple named tokens:</p> <pre><code>A2A_AUTH_TOKENS=\"admin:super-secret,readonly:read-only-token,worker:worker-token\"\n</code></pre>"},{"location":"concepts/a2a-protocol/","title":"A2A Protocol","text":"<p>CodeTether Server is a production implementation of the A2A (Agent-to-Agent) Protocol, an open standard from the Linux Foundation.</p>"},{"location":"concepts/a2a-protocol/#what-is-a2a","title":"What is A2A?","text":"<p>The Agent-to-Agent Protocol defines how AI agents communicate, collaborate, and solve problems together. It provides:</p> <ul> <li>Standardized discovery via Agent Cards</li> <li>Task-based communication with JSON-RPC 2.0</li> <li>Real-time streaming via Server-Sent Events</li> <li>Multi-turn conversations with session state</li> </ul>"},{"location":"concepts/a2a-protocol/#official-sdk-integration","title":"Official SDK Integration","text":"<p>CodeTether now uses the official A2A Python SDK (<code>a2a-sdk&gt;=0.3.22</code>) from the A2A Project. This provides:</p> <ul> <li>Protocol compliance - All data structures and methods match the official specification</li> <li>Battle-tested streaming - Robust SSE implementation with proper backpressure handling</li> <li>Standard error codes - Consistent error handling across all A2A implementations</li> <li>Type safety - Full Pydantic models for request/response validation</li> </ul> <p>Our previous custom implementation has been replaced with thin wrappers around the SDK, ensuring interoperability with any A2A-compliant agent.</p>"},{"location":"concepts/a2a-protocol/#specification-compliance","title":"Specification Compliance","text":"<p>CodeTether aims to be A2A-compliant and implements the core pieces used by this project:</p> Section Feature Status \u00a75 Agent Discovery (Agent Card) \u2705 Full \u00a76 Protocol Data Objects \u2705 Full \u00a77 JSON-RPC Methods \u2705 Full \u00a78 Streaming (SSE) \u2705 Full \u00a79 Common Workflows \u2705 Full"},{"location":"concepts/a2a-protocol/#agent-card","title":"Agent Card","text":"<p>Every CodeTether server exposes an Agent Card at <code>/.well-known/agent-card.json</code>:</p> <pre><code>curl https://api.codetether.run/.well-known/agent-card.json\n</code></pre> <pre><code>{\n  \"name\": \"CodeTether Server\",\n  \"description\": \"Production A2A coordination server\",\n  \"url\": \"https://api.codetether.run\",\n  \"version\": \"1.0.0\",\n  \"provider\": {\n    \"organization\": \"CodeTether\",\n    \"url\": \"https://codetether.run\"\n  },\n  \"capabilities\": {\n    \"streaming\": true,\n    \"push_notifications\": true,\n    \"state_transition_history\": true\n  },\n  \"skills\": [\n    {\n      \"id\": \"task-coordination\",\n      \"name\": \"Task Coordination\",\n      \"description\": \"Coordinate tasks between multiple agents\"\n    },\n    {\n      \"id\": \"code-assistance\",\n      \"name\": \"Code Assistance\",\n      \"description\": \"AI-powered coding assistance via OpenCode\"\n    }\n  ],\n  \"authentication\": [\n    {\"scheme\": \"bearer\"}\n  ]\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#json-rpc-methods","title":"JSON-RPC Methods","text":"<p>CodeTether supports the following JSON-RPC methods:</p>"},{"location":"concepts/a2a-protocol/#messagesend","title":"message/send","text":"<p>Send a task to the agent.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"message/send\",\n  \"params\": {\n    \"message\": {\n      \"parts\": [{\"type\": \"text\", \"content\": \"Analyze this code\"}]\n    }\n  },\n  \"id\": \"1\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#messagestream","title":"message/stream","text":"<p>Send a task and subscribe to streaming updates.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"message/stream\",\n  \"params\": {\n    \"message\": {\n      \"parts\": [{\"type\": \"text\", \"content\": \"Generate a report\"}]\n    }\n  },\n  \"id\": \"1\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#tasksget","title":"tasks/get","text":"<p>Get the current state of a task.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/get\",\n  \"params\": {\n    \"task_id\": \"task-123\"\n  },\n  \"id\": \"2\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#taskscancel","title":"tasks/cancel","text":"<p>Cancel a running task.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/cancel\",\n  \"params\": {\n    \"task_id\": \"task-123\"\n  },\n  \"id\": \"3\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#standard-endpoints","title":"Standard Endpoints","text":"<p>CodeTether exposes the following A2A-compliant endpoints:</p> Endpoint Method Description <code>/.well-known/agent-card.json</code> GET Agent discovery (A2A spec) <code>/a2a/jsonrpc</code> POST JSON-RPC 2.0 endpoint <code>/a2a/rest/message:send</code> POST REST binding for message/send <code>/a2a/rest/message:stream</code> POST SSE streaming endpoint <code>/a2a/rest/tasks/{id}</code> GET Get task status <code>/a2a/rest/tasks/{id}:cancel</code> POST Cancel a task <p>The JSON-RPC endpoint accepts all methods (<code>message/send</code>, <code>message/stream</code>, <code>tasks/get</code>, <code>tasks/cancel</code>) via a single URL, while the REST bindings provide more traditional HTTP semantics.</p>"},{"location":"concepts/a2a-protocol/#task-states","title":"Task States","text":"<p>Tasks in A2A follow a defined state machine:</p> <pre><code>                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502  submitted  \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                           \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u25bc            \u25bc            \u25bc\n        \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n        \u2502 rejected \u2502 \u2502 working  \u2502 \u2502auth-req'd\u2502\n        \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n           \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n           \u25bc              \u25bc              \u25bc\n     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n     \u2502 completed \u2502  \u2502  failed   \u2502  \u2502input-req'd\u2502\n     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                          \u2502\n                          \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502 cancelled \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> State Description Terminal? <code>submitted</code> Task received, awaiting processing No <code>working</code> Agent is actively processing No <code>input-required</code> Agent needs additional input No <code>auth-required</code> Authentication/authorization needed No <code>completed</code> Task finished successfully Yes <code>failed</code> Task encountered an error Yes <code>cancelled</code> Task was cancelled by client Yes <code>rejected</code> Task was rejected by agent Yes"},{"location":"concepts/a2a-protocol/#error-codes","title":"Error Codes","text":"<p>The A2A protocol defines standard JSON-RPC error codes:</p> Code Name Description <code>-32001</code> <code>TaskNotFound</code> The specified task does not exist <code>-32002</code> <code>TaskNotCancellable</code> Task is in a terminal state <code>-32003</code> <code>PushNotificationNotSupported</code> Agent doesn't support push notifications <code>-32004</code> <code>UnsupportedOperation</code> Requested operation not supported <code>-32005</code> <code>ContentTypeNotSupported</code> Unsupported content type in message <code>-32006</code> <code>InvalidAgentResponse</code> Agent returned malformed response <code>-32007</code> <code>AgentUnavailable</code> Target agent is not reachable <code>-32008</code> <code>AuthenticationRequired</code> Request requires authentication <code>-32009</code> <code>AuthorizationFailed</code> Insufficient permissions <p>Standard JSON-RPC errors (<code>-32600</code> to <code>-32700</code>) also apply for malformed requests.</p>"},{"location":"concepts/a2a-protocol/#agent-discovery-with-roleinstance-pattern","title":"Agent Discovery with Role:Instance Pattern","text":"<p>CodeTether v1.2.2 introduces production-grade agent discovery with unique identities and TTL-based liveness.</p>"},{"location":"concepts/a2a-protocol/#how-it-works","title":"How It Works","text":"<p>When a worker registers as an agent, it gets two identities:</p> Field Purpose Example <code>name</code> Unique discovery identity <code>code-reviewer:dev-vm:abc123</code> <code>role</code> Routing identity for <code>send_to_agent</code> <code>code-reviewer</code> <p>Important: Use <code>role</code> with <code>send_to_agent</code> for routing. The <code>name</code> field is unique per-instance and will NOT route tasks.</p>"},{"location":"concepts/a2a-protocol/#discovery-response","title":"Discovery Response","text":"<pre><code>{\n  \"agents\": [\n    {\n      \"name\": \"code-reviewer:dev-vm:abc123\",\n      \"role\": \"code-reviewer\",\n      \"instance_id\": \"dev-vm:abc123\",\n      \"description\": \"OpenCode worker agent...\",\n      \"url\": \"https://api.codetether.run\",\n      \"capabilities\": {\"streaming\": true, \"push_notifications\": true},\n      \"last_seen\": \"2026-01-15T12:00:00\"\n    }\n  ],\n  \"routing_note\": \"Use 'role' with send_to_agent for routing.\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#ttl-based-liveness","title":"TTL-Based Liveness","text":"<ul> <li>Workers must call <code>refresh_agent_heartbeat</code> every 45s</li> <li>Agents not seen within 120s are filtered from discovery</li> <li>Configurable via <code>A2A_AGENT_DISCOVERY_MAX_AGE</code> environment variable</li> <li>Stale agents are lazily cleaned up from all indexes</li> </ul>"},{"location":"concepts/a2a-protocol/#worker-configuration","title":"Worker Configuration","text":"<pre><code># Register worker as a discoverable agent\npython -m agent_worker.worker \\\n  --agent-name code-reviewer \\\n  --agent-description \"Python code review specialist\" \\\n  --server https://api.codetether.run\n</code></pre>"},{"location":"concepts/a2a-protocol/#routing-example","title":"Routing Example","text":"<pre><code># Discover available agents\nagents = await discover_agents()\n# Returns: [{\"name\": \"code-reviewer:host-a:1\", \"role\": \"code-reviewer\", ...}]\n\n# Route to agent by ROLE (not name!)\nawait send_to_agent(\n    agent_name=\"code-reviewer\",  # Uses role\n    message=\"Review auth.py for security issues\"\n)\n</code></pre>"},{"location":"concepts/a2a-protocol/#learn-more","title":"Learn More","text":"<ul> <li>A2A Protocol Specification</li> <li>A2A Key Concepts</li> <li>A2A and MCP</li> </ul>"},{"location":"concepts/a2a-sdk-migration/","title":"A2A SDK Migration Guide","text":""},{"location":"concepts/a2a-sdk-migration/#overview","title":"Overview","text":"<p>CodeTether v1.2.0 introduces full compliance with the A2A Protocol v0.3 specification using the official <code>a2a-sdk</code> from Google. This migration ensures that CodeTether can interoperate with any A2A-compliant agent or client while preserving all existing functionality.</p>"},{"location":"concepts/a2a-sdk-migration/#what-changed","title":"What Changed","text":""},{"location":"concepts/a2a-sdk-migration/#new-dependencies","title":"New Dependencies","text":"<p>The following dependency was added to <code>pyproject.toml</code>:</p> <pre><code>\"a2a-sdk[http-server,postgresql]&gt;=0.3.22\"\n</code></pre> <p>This brings in: - Core A2A protocol types and validation - HTTP server utilities for JSON-RPC endpoints - PostgreSQL storage adapter for task persistence</p>"},{"location":"concepts/a2a-sdk-migration/#new-files","title":"New Files","text":"File Purpose <code>a2a_server/a2a_executor.py</code> Bridges A2A SDK to our task queue, translating between A2A requests and internal task operations <code>a2a_server/a2a_agent_card.py</code> Standard agent card endpoint serving <code>/.well-known/agent-card.json</code> <code>a2a_server/a2a_router.py</code> A2A protocol router handling JSON-RPC and REST endpoints <code>a2a_server/a2a_types.py</code> Task state mapping between internal states and A2A protocol states <code>a2a_server/a2a_errors.py</code> A2A error codes and exception handling"},{"location":"concepts/a2a-sdk-migration/#new-endpoints","title":"New Endpoints","text":"Endpoint Description <code>/.well-known/agent-card.json</code> Agent discovery endpoint per A2A spec <code>/a2a/jsonrpc</code> JSON-RPC 2.0 endpoint for A2A protocol methods <code>/a2a/rest/*</code> RESTful endpoints for task operations"},{"location":"concepts/a2a-sdk-migration/#task-state-alignment","title":"Task State Alignment","text":"<p>The internal task states have been mapped to A2A protocol states:</p> Internal State A2A State Description <code>pending</code> <code>submitted</code> Task created, awaiting processing <code>working</code> <code>working</code> Task actively being processed <code>completed</code> <code>completed</code> Task finished successfully <code>failed</code> <code>failed</code> Task encountered an error <code>cancelled</code> <code>canceled</code> Task was cancelled by user"},{"location":"concepts/a2a-sdk-migration/#backward-compatibility","title":"Backward Compatibility","text":"<p>All existing functionality remains fully operational:</p> <ul> <li>MCP Tools: Existing MCP tools at <code>/mcp</code> continue to work unchanged</li> <li>Worker SSE Push: The Server-Sent Events push system for workers is unchanged</li> <li>Custom Extensions: CodeTether-specific extensions are preserved:</li> <li><code>send_to_agent</code> for targeted agent messaging</li> <li>Capability-based routing</li> <li>Priority queuing</li> <li>Conversation threading</li> </ul>"},{"location":"concepts/a2a-sdk-migration/#using-the-a2a-endpoints","title":"Using the A2A Endpoints","text":""},{"location":"concepts/a2a-sdk-migration/#1-discovering-the-agent-card","title":"1. Discovering the Agent Card","text":"<pre><code>curl https://your-codetether-server/.well-known/agent-card.json\n</code></pre> <p>Response: <pre><code>{\n  \"name\": \"CodeTether\",\n  \"description\": \"A2A-compliant task queue and agent coordination server\",\n  \"url\": \"https://your-codetether-server\",\n  \"capabilities\": {\n    \"streaming\": true,\n    \"pushNotifications\": true\n  },\n  \"skills\": [\n    {\n      \"id\": \"task-management\",\n      \"name\": \"Task Management\",\n      \"description\": \"Create, monitor, and manage async tasks\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"concepts/a2a-sdk-migration/#2-sending-a-message-via-json-rpc","title":"2. Sending a Message via JSON-RPC","text":"<pre><code>curl -X POST https://your-codetether-server/a2a/jsonrpc \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"1\",\n    \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [\n          {\"text\": \"Analyze the codebase structure\"}\n        ]\n      }\n    }\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": \"1\",\n  \"result\": {\n    \"id\": \"task-abc123\",\n    \"status\": {\n      \"state\": \"submitted\"\n    }\n  }\n}\n</code></pre></p>"},{"location":"concepts/a2a-sdk-migration/#3-streaming-responses","title":"3. Streaming Responses","text":"<p>For streaming responses, use the <code>message/stream</code> method:</p> <pre><code>curl -X POST https://your-codetether-server/a2a/jsonrpc \\\n  -H \"Content-Type: application/json\" \\\n  -H \"Accept: text/event-stream\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"1\",\n    \"method\": \"message/stream\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [\n          {\"text\": \"Generate a detailed report\"}\n        ]\n      }\n    }\n  }'\n</code></pre>"},{"location":"concepts/a2a-sdk-migration/#4-getting-task-status","title":"4. Getting Task Status","text":"<pre><code>curl -X POST https://your-codetether-server/a2a/jsonrpc \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": \"1\",\n    \"method\": \"tasks/get\",\n    \"params\": {\n      \"id\": \"task-abc123\"\n    }\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"id\": \"1\",\n  \"result\": {\n    \"id\": \"task-abc123\",\n    \"status\": {\n      \"state\": \"completed\",\n      \"message\": {\n        \"role\": \"agent\",\n        \"parts\": [\n          {\"text\": \"Analysis complete. The codebase contains...\"}\n        ]\n      }\n    }\n  }\n}\n</code></pre></p>"},{"location":"concepts/a2a-sdk-migration/#interoperability","title":"Interoperability","text":"<p>With A2A SDK integration, CodeTether is now fully interoperable with the A2A ecosystem:</p>"},{"location":"concepts/a2a-sdk-migration/#compatible-clients","title":"Compatible Clients","text":"<p>Any A2A-compliant client can connect to CodeTether, including: - Google's A2A reference clients - Other A2A-enabled agent frameworks - Custom clients implementing the A2A protocol</p>"},{"location":"concepts/a2a-sdk-migration/#agent-discovery","title":"Agent Discovery","text":"<p>Other agents can discover CodeTether through: 1. The standard <code>/.well-known/agent-card.json</code> endpoint 2. Manual registration in agent directories 3. DNS-based discovery (if configured)</p>"},{"location":"concepts/a2a-sdk-migration/#multi-agent-workflows","title":"Multi-Agent Workflows","text":"<p>CodeTether can participate in multi-agent workflows:</p> <pre><code>from a2a_sdk import A2AClient\n\n# Connect to CodeTether\nclient = A2AClient(\"https://your-codetether-server\")\n\n# Discover capabilities\ncard = await client.get_agent_card()\nprint(f\"Connected to {card.name} with skills: {card.skills}\")\n\n# Send a task\nresult = await client.send_message(\"Process this data\")\nprint(f\"Task {result.id} status: {result.status.state}\")\n</code></pre>"},{"location":"concepts/a2a-sdk-migration/#protocol-compliance","title":"Protocol Compliance","text":"<p>CodeTether implements the following A2A protocol methods: - <code>message/send</code> - Send a message and create a task - <code>message/stream</code> - Stream task responses - <code>tasks/get</code> - Get task status - <code>tasks/cancel</code> - Cancel a running task - <code>tasks/list</code> - List tasks (CodeTether extension)</p>"},{"location":"concepts/a2a-sdk-migration/#migration-checklist","title":"Migration Checklist","text":"<p>If you're upgrading from a previous version:</p> <ul> <li> Update dependencies: <code>pip install -U codetether</code></li> <li> Run database migrations: <code>alembic upgrade head</code></li> <li> Verify agent card is accessible at <code>/.well-known/agent-card.json</code></li> <li> Test existing MCP integrations still work</li> <li> Update any hardcoded endpoint URLs if needed</li> <li> Review and update CORS settings for new endpoints</li> </ul>"},{"location":"concepts/a2a-sdk-migration/#further-reading","title":"Further Reading","text":"<ul> <li>A2A Protocol Specification</li> <li>CodeTether Architecture</li> <li>Task Queue Documentation</li> </ul>"},{"location":"concepts/architecture/","title":"Architecture","text":"<p>CodeTether Server is designed as a modular, scalable system for running AI agents in production.</p>"},{"location":"concepts/architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TB\n    subgraph Clients\n        Web[Web Dashboard]\n        CLI[CLI / SDK]\n        Agents[External Agents]\n    end\n\n    subgraph Edge[Ingress / DNS]\n        MKT[codetether.run]\n        DOCS[docs.codetether.run]\n        APIHOST[api.codetether.run]\n    end\n\n    subgraph \"Cluster / Services\"\n        Marketing[\"Marketing Site&lt;br/&gt;(Next.js)&lt;br/&gt;Port 3000\"]\n        DocsSite[\"Docs Site&lt;br/&gt;(MkDocs)&lt;br/&gt;Port 80\"]\n\n        subgraph \"CodeTether API\"\n            API[\"FastAPI App&lt;br/&gt;Port 8000\"]\n            A2A[\"A2A JSON-RPC Handler&lt;br/&gt;POST /v1/a2a (alias: /)\"]\n            Monitor[\"Monitor API&lt;br/&gt;/v1/monitor/*\"]\n            OpenCode[\"OpenCode Bridge&lt;br/&gt;/v1/opencode/*\"]\n        end\n\n        MCP[\"MCP HTTP Server&lt;br/&gt;Port 9000&lt;br/&gt;/mcp/v1/*\"]\n\n        Redis[(\"Redis&lt;br/&gt;Pub/Sub + task/state\")]\n    end\n\n    subgraph \"Workers (systemd / containers)\"\n        W1[\"Worker 1&lt;br/&gt;+ OpenCode\"]\n        W2[\"Worker 2&lt;br/&gt;+ OpenCode\"]\n        WN[\"Worker N&lt;br/&gt;+ OpenCode\"]\n    end\n\n    subgraph \"External / Optional\"\n        DB[(\"PostgreSQL&lt;br/&gt;optional persistence\")]\n        S3[(\"S3/MinIO&lt;br/&gt;optional artifacts/state\")]\n        Auth[\"Keycloak / OIDC&lt;br/&gt;optional auth\"]\n        SQLite[(\"SQLite (local)&lt;br/&gt;OpenCode session cache\")]\n    end\n\n    Web --&gt; DOCS\n    CLI --&gt; APIHOST\n    Agents --&gt; APIHOST\n\n    MKT --&gt; Marketing\n    DOCS --&gt; DocsSite\n    APIHOST --&gt; API\n    APIHOST --&gt; MCP\n\n    API --&gt; A2A\n    API --&gt; Monitor\n    API --&gt; OpenCode\n\n    API --&gt; Redis\n    Redis --&gt; API\n    API --&gt; DB\n    DB --&gt; API\n    API --&gt; S3\n    S3 --&gt; API\n    API -. optional .-&gt; Auth\n    OpenCode --&gt; SQLite\n\n    W1 --&gt;|SSE /v1/worker/tasks/stream| API\n    W2 --&gt;|SSE /v1/worker/tasks/stream| API\n    WN --&gt;|SSE /v1/worker/tasks/stream| API\n    W1 --&gt;|PUT status / POST output| API\n    W2 --&gt;|PUT status / POST output| API\n    WN --&gt;|PUT status / POST output| API</code></pre>"},{"location":"concepts/architecture/#components","title":"Components","text":""},{"location":"concepts/architecture/#fastapi-server-port-8000","title":"FastAPI Server (Port 8000)","text":"<p>The main HTTP server handling:</p> <ul> <li>A2A Protocol (<code>POST /v1/a2a</code>, alias: <code>POST /</code>) - JSON-RPC 2.0 agent communication</li> <li>REST APIs (<code>/v1/monitor/*</code>, <code>/v1/opencode/*</code>) - Management and monitoring</li> <li>Agent Card (<code>/.well-known/agent-card.json</code>) - A2A discovery</li> <li>Health Check (<code>/health</code>) - Liveness/readiness probes</li> </ul>"},{"location":"concepts/architecture/#mcp-server-port-9000","title":"MCP Server (Port 9000)","text":"<p>Model Context Protocol server for tool integration:</p> <ul> <li>Expose CodeTether capabilities as MCP tools</li> <li>Allow external agents to use CodeTether tools</li> <li>Bridge between A2A and MCP protocols</li> </ul> <p>In Kubernetes deployments, the MCP server is typically exposed through the same host as the API using a path prefix (e.g. <code>https://api.&lt;domain&gt;/mcp/v1/rpc</code>).</p>"},{"location":"concepts/architecture/#message-broker-redis","title":"Message Broker (Redis)","text":"<p>Handles distributed communication and coordination:</p> <ul> <li>Task state - Persist and coordinate tasks across replicas</li> <li>Pub/Sub - Agent discovery and inter-agent messaging</li> <li>Shared state - Optional durability and cross-replica rehydration</li> </ul> <p>Note: Workers receive task notifications via SSE (Server-Sent Events) for real-time task distribution, with HTTP polling as a fallback.</p>"},{"location":"concepts/architecture/#opencode-bridge","title":"OpenCode Bridge","text":"<p>Integrates AI coding agents:</p> <ul> <li>Register and manage codebases</li> <li>Trigger and control OpenCode agents</li> <li>Stream real-time agent output</li> <li>Manage session history</li> </ul>"},{"location":"concepts/architecture/#monitor-api","title":"Monitor API","text":"<p>Observability and management:</p> <ul> <li>Agent status and health</li> <li>Message history</li> <li>Real-time SSE streams</li> <li>Statistics and metrics</li> </ul>"},{"location":"concepts/architecture/#data-flow","title":"Data Flow","text":""},{"location":"concepts/architecture/#task-execution-flow","title":"Task Execution Flow","text":"<pre><code>sequenceDiagram\n    participant C as Client\n    participant S as CodeTether Server\n    participant R as Redis\n    participant W as Worker\n    participant O as OpenCode\n\n    C-&gt;&gt;S: POST /v1/opencode/codebases/{codebase_id}/tasks\n    S-&gt;&gt;R: Persist task (pending)\n    S-&gt;&gt;R: Publish task_available event\n\n    Note over W,S: Worker connects via SSE with X-Codebases, X-Capabilities headers\n    W-&gt;&gt;S: GET /v1/worker/tasks/stream (SSE)\n    S--&gt;&gt;W: event: task_available\n\n    W-&gt;&gt;S: PUT /v1/opencode/tasks/{task_id}/status (running)\n    W-&gt;&gt;O: Execute (OpenCode / echo / noop)\n\n    loop streaming output\n        W-&gt;&gt;S: POST /v1/opencode/tasks/{task_id}/output\n        S--&gt;&gt;C: SSE event (/v1/opencode/codebases/{codebase_id}/events)\n    end\n\n    W-&gt;&gt;S: PUT /v1/opencode/tasks/{task_id}/status (completed + result)\n    S--&gt;&gt;C: SSE event: complete</code></pre>"},{"location":"concepts/architecture/#real-time-streaming-flow","title":"Real-time Streaming Flow","text":"<pre><code>sequenceDiagram\n    participant C as Client\n    participant S as Server\n    participant W as Worker\n    participant O as OpenCode\n\n    C-&gt;&gt;S: GET /v1/opencode/codebases/{id}/events\n    Note over C,S: SSE Connection Established\n\n    W-&gt;&gt;O: Run agent\n    O-&gt;&gt;W: Output/tool updates\n    W-&gt;&gt;S: POST /v1/opencode/tasks/{task_id}/output\n    S-&gt;&gt;C: event: output\n    W-&gt;&gt;S: PUT /v1/opencode/tasks/{task_id}/status\n    S-&gt;&gt;C: event: complete\n\n    Note over W,S: In single-instance mode, the worker may be co-located with the server.</code></pre>"},{"location":"concepts/architecture/#deployment-models","title":"Deployment Models","text":""},{"location":"concepts/architecture/#single-instance","title":"Single Instance","text":"<p>Simplest deployment - everything in one process:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     CodeTether Server        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 API     \u2502 \u2502 OpenCode  \u2502  \u2502\n\u2502  \u2502 Server  \u2502 \u2502 Bridge    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 MCP     \u2502 \u2502 SQLite    \u2502  \u2502\n\u2502  \u2502 Server  \u2502 \u2502 DB        \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#distributed-with-workers","title":"Distributed with Workers","text":"<p>Scale horizontally with dedicated workers:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 CodeTether API   \u2502     \u2502 CodeTether API   \u2502\n\u2502 (Instance 1)    \u2502     \u2502 (Instance 2)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                       \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502   Redis     \u2502\n              \u2502   Cluster   \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502                \u2502                \u2502\n\u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n\u2502Worker \u2502       \u2502 Worker  \u2502      \u2502 Worker  \u2502\n\u2502   1   \u2502       \u2502    2    \u2502      \u2502    N    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#kubernetes","title":"Kubernetes","text":"<p>Full production deployment:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Kubernetes                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502              Ingress                     \u2502    \u2502\n\u2502  \u2502   codetether.run \u2192 Marketing             \u2502    \u2502\n\u2502  \u2502   docs.codetether.run \u2192 Docs             \u2502    \u2502\n\u2502  \u2502   api.codetether.run \u2192 API (8000)        \u2502    \u2502\n\u2502  \u2502   api.codetether.run/mcp \u2192 MCP (9000)    \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510              \u2502\n\u2502  \u2502 API Deploy (blue/green)      \u2502              \u2502\n\u2502  \u2502 - codetether-a2a-server-blue \u2502              \u2502\n\u2502  \u2502 - codetether-a2a-server-green\u2502              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518              \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 Marketing     \u2502  \u2502 Docs         \u2502            \u2502\n\u2502  \u2502 (Deployment)  \u2502  \u2502 (Deployment) \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510                              \u2502\n\u2502  \u2502    Redis     \u2502                              \u2502\n\u2502  \u2502 (Deployment) \u2502                              \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518                              \u2502\n\u2502                                                  \u2502\n\u2502  External (optional): PostgreSQL, S3/MinIO, Keycloak\u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#security-model","title":"Security Model","text":""},{"location":"concepts/architecture/#authentication-layers","title":"Authentication Layers","text":"<ol> <li>Ingress - TLS termination, rate limiting</li> <li>API Gateway - Token validation, OIDC</li> <li>Service - Role-based access control</li> <li>Data - Encryption at rest</li> </ol>"},{"location":"concepts/architecture/#network-security","title":"Network Security","text":"<ul> <li>Internal services communicate via ClusterIP</li> <li>External access only through Ingress</li> <li>Redis protected by NetworkPolicy</li> <li>Secrets managed via Kubernetes Secrets or Vault</li> </ul>"},{"location":"concepts/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Installation</li> <li>Kubernetes Deployment</li> <li>Distributed Workers</li> </ul>"},{"location":"concepts/message-broker/","title":"Message Broker","text":"<p>CodeTether uses Redis as a message broker for distributed agent communication and task queuing.</p>"},{"location":"concepts/message-broker/#overview","title":"Overview","text":"<p>The message broker enables:</p> <ul> <li>Task Distribution - Route tasks to appropriate workers</li> <li>Pub/Sub Messaging - Real-time event distribution</li> <li>State Synchronization - Share state across instances</li> </ul>"},{"location":"concepts/message-broker/#configuration","title":"Configuration","text":"<pre><code>export A2A_REDIS_URL=redis://localhost:6379\n</code></pre>"},{"location":"concepts/message-broker/#redis-requirements","title":"Redis Requirements","text":"<ul> <li>Redis 6.0 or later</li> <li>Recommended: Redis Cluster for high availability</li> </ul>"},{"location":"concepts/message-broker/#message-channels","title":"Message Channels","text":"Channel Purpose <code>a2a:tasks</code> Task queue <code>a2a:events</code> Real-time events <code>a2a:agents</code> Agent status updates"},{"location":"concepts/message-broker/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture</li> <li>Distributed Workers</li> </ul>"},{"location":"concepts/task-management/","title":"Task Management","text":"<p>CodeTether provides comprehensive task management for AI agent workflows.</p>"},{"location":"concepts/task-management/#task-lifecycle","title":"Task Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Pending: Create\n    Pending --&gt; Running: Assigned\n    Running --&gt; Completed: Success\n    Running --&gt; Failed: Error\n    Pending --&gt; Cancelled: Cancel\n    Running --&gt; Cancelled: Cancel\n    Completed --&gt; [*]\n    Failed --&gt; [*]\n    Cancelled --&gt; [*]</code></pre>"},{"location":"concepts/task-management/#task-states","title":"Task States","text":"State Description <code>pending</code> Task created, waiting for worker <code>running</code> Worker is executing the task <code>completed</code> Task finished successfully <code>failed</code> Task encountered an error <code>cancelled</code> Task was cancelled"},{"location":"concepts/task-management/#creating-tasks","title":"Creating Tasks","text":""},{"location":"concepts/task-management/#via-a2a-protocol","title":"Via A2A Protocol","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"message/send\",\n  \"params\": {\n    \"message\": {\n      \"parts\": [{\"type\": \"text\", \"content\": \"Analyze this codebase\"}]\n    }\n  },\n  \"id\": \"1\"\n}\n</code></pre>"},{"location":"concepts/task-management/#via-opencode-api","title":"Via OpenCode API","text":"<pre><code>curl -X POST /v1/opencode/codebases/{id}/tasks \\\n  -d '{\"title\": \"Add tests\", \"prompt\": \"Add unit tests\"}'\n</code></pre>"},{"location":"concepts/task-management/#task-priority","title":"Task Priority","text":"<p>Tasks can be prioritized (higher number = higher priority):</p> <pre><code>{\n  \"title\": \"Urgent fix\",\n  \"prompt\": \"Fix the authentication bug\",\n  \"priority\": 10\n}\n</code></pre>"},{"location":"concepts/task-management/#task-routing","title":"Task Routing","text":"<p>Tasks are routed to workers based on <code>codebase_id</code>:</p> Codebase ID Routing Behavior <code>{specific_id}</code> Routed only to workers with that codebase registered <code>global</code> Routed to all workers with a global codebase <code>__pending__</code> Registration tasks that any worker can claim"},{"location":"concepts/task-management/#global-tasks","title":"Global Tasks","text":"<p>Tasks with <code>codebase_id: \"global\"</code> are sent to all workers that have registered a global codebase. This is useful for:</p> <ul> <li>Cross-codebase operations</li> <li>Administrative tasks</li> <li>Tasks that don't belong to a specific project</li> </ul> <pre><code># Create a global task via MCP\ncurl -X POST /v1/opencode/tasks \\\n  -d '{\n    \"title\": \"System maintenance\",\n    \"prompt\": \"Run system health checks\",\n    \"codebase_id\": \"global\"\n  }'\n</code></pre>"},{"location":"concepts/task-management/#next-steps","title":"Next Steps","text":"<ul> <li>API Reference</li> <li>Distributed Workers</li> </ul>"},{"location":"deployment/docker/","title":"Docker Deployment","text":"<p>Deploy CodeTether Server using Docker.</p>"},{"location":"deployment/docker/#quick-start","title":"Quick Start","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#connecting-to-host-opencode","title":"Connecting to Host OpenCode","text":"<p>When running CodeTether in Docker and you want to connect to OpenCode running on your host machine:</p>"},{"location":"deployment/docker/#docker-desktop-macwindows","title":"Docker Desktop (Mac/Windows)","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e OPENCODE_HOST=host.docker.internal \\\n  -e OPENCODE_PORT=9777 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#linux","title":"Linux","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  --add-host=host.docker.internal:host-gateway \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e OPENCODE_HOST=host.docker.internal \\\n  -e OPENCODE_PORT=9777 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#using-host-ip","title":"Using Host IP","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e OPENCODE_HOST=192.168.1.100 \\\n  -e OPENCODE_PORT=9777 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#docker-compose","title":"Docker Compose","text":"<pre><code>version: '3.8'\nservices:\n  codetether:\n    image: ghcr.io/rileyseaburg/codetether-server:latest\n    ports:\n      - \"8000:8000\"\n      - \"9000:9000\"\n    environment:\n      - A2A_REDIS_URL=redis://redis:6379\n      - OPENCODE_HOST=host.docker.internal\n      - OPENCODE_PORT=9777\n    extra_hosts:\n      - \"host.docker.internal:host-gateway\"  # For Linux\n    depends_on:\n      - redis\n  redis:\n    image: redis:7-alpine\n</code></pre> <p>See Installation for more options.</p>"},{"location":"deployment/helm/","title":"Helm Charts","text":"<p>CodeTether provides official Helm charts for Kubernetes deployment.</p>"},{"location":"deployment/helm/#installation","title":"Installation","text":"<pre><code>helm repo add codetether https://charts.codetether.run\nhelm install codetether codetether/a2a-server\n</code></pre>"},{"location":"deployment/helm/#configuration","title":"Configuration","text":"<p>See <code>values.yaml</code> for all configuration options.</p>"},{"location":"deployment/helm/#postgresql-configuration","title":"PostgreSQL Configuration","text":"<p>For durable persistence across restarts and replicas, configure an external PostgreSQL database:</p> <pre><code># values.yaml\nexternalPostgresql:\n  enabled: true\n  url: \"postgresql://postgres:password@db.example.com:5432/codetether\"\n</code></pre> <p>Or use a Kubernetes secret:</p> <pre><code>externalPostgresql:\n  enabled: true\n  existingSecret: \"codetether-db-secret\"\n  secretKey: \"DATABASE_URL\"\n</code></pre>"},{"location":"deployment/helm/#redis-configuration","title":"Redis Configuration","text":"<pre><code>redis:\n  enabled: true  # Deploy Redis alongside the server\n  # Or use external Redis:\n  # url: \"redis://:password@redis.example.com:6379\"\n</code></pre>"},{"location":"deployment/helm/#upgrading","title":"Upgrading","text":"<pre><code>helm upgrade codetether codetether/a2a-server\n</code></pre>"},{"location":"deployment/helm/#values-reference","title":"Values Reference","text":"Key Default Description <code>externalPostgresql.enabled</code> <code>false</code> Enable external PostgreSQL <code>externalPostgresql.url</code> \u2014 PostgreSQL connection URL <code>externalPostgresql.existingSecret</code> \u2014 Use existing secret for DATABASE_URL <code>redis.enabled</code> <code>true</code> Deploy Redis <code>redis.url</code> \u2014 External Redis URL <code>blueGreen.enabled</code> <code>false</code> Enable blue-green deployment <code>replicaCount</code> <code>1</code> Number of replicas"},{"location":"deployment/kubernetes/","title":"Kubernetes Deployment","text":"<p>Deploy CodeTether Server on Kubernetes using Helm.</p>"},{"location":"deployment/kubernetes/#quick-start","title":"Quick Start","text":"<pre><code>helm repo add codetether https://charts.codetether.run\nhelm install codetether codetether/a2a-server \\\n  --namespace codetether \\\n  --create-namespace\n</code></pre>"},{"location":"deployment/kubernetes/#values","title":"Values","text":"<pre><code>replicaCount: 2\n\ningress:\n  enabled: true\n  hosts:\n    - host: codetether.example.com\n      paths:\n        - path: /\n          pathType: Prefix\n\nredis:\n  enabled: true\n</code></pre> <p>See Helm Charts for full configuration.</p>"},{"location":"deployment/production/","title":"Production Checklist","text":"<p>Before deploying CodeTether to production:</p>"},{"location":"deployment/production/#security","title":"Security","text":"<ul> <li> Enable authentication (Keycloak or API tokens)</li> <li> Configure TLS certificates</li> <li> Set secure Redis password</li> <li> Set secure PostgreSQL password</li> <li> Review network policies</li> </ul>"},{"location":"deployment/production/#reliability","title":"Reliability","text":"<ul> <li> Configure health checks</li> <li> Set up monitoring/alerting</li> <li> Configure backups for PostgreSQL and Redis</li> <li> Test failover scenarios</li> <li> Configure PostgreSQL for durable persistence (<code>DATABASE_URL</code>)</li> </ul>"},{"location":"deployment/production/#performance","title":"Performance","text":"<ul> <li> Configure resource limits</li> <li> Enable horizontal pod autoscaling</li> <li> Configure Redis persistence</li> <li> Configure PostgreSQL connection pooling</li> <li> Review connection pooling</li> </ul>"},{"location":"deployment/production/#operations","title":"Operations","text":"<ul> <li> Set up logging aggregation</li> <li> Configure log retention</li> <li> Document runbooks</li> <li> Test disaster recovery</li> </ul>"},{"location":"features/agent-messaging/","title":"Agent Messaging","text":"<p>CodeTether enables agents to communicate and collaborate using the A2A Protocol.</p>"},{"location":"features/agent-messaging/#overview","title":"Overview","text":"<p>Agents can:</p> <ul> <li>Discover other agents via Agent Cards</li> <li>Send tasks to other agents</li> <li>Receive results via streaming or polling</li> <li>Collaborate on complex workflows</li> </ul> <p>See A2A Protocol for details.</p>"},{"location":"features/agent-worker/","title":"Agent Worker","text":"<p>The Agent Worker is a standalone daemon that runs on machines with codebases, connecting to a CodeTether server to receive and execute AI agent tasks. It enables distributed, autonomous code execution across your infrastructure.</p> <p>Zero-Touch Automation</p> <p>Once configured, the Agent Worker autonomously pulls tasks from the server, executes them using OpenCode, and reports results\u2014all without human intervention.</p> <p>Reactive Execution</p> <p>Workers now support real-time task execution via Redis MessageBroker events. Tasks start within milliseconds of creation instead of waiting for the next poll cycle.</p>"},{"location":"features/agent-worker/#overview","title":"Overview","text":"<p>The Agent Worker provides:</p> <ul> <li>Remote Task Execution: Run AI agents on machines where codebases live</li> <li>Reactive Task Execution: Near-instant task start via Redis pub/sub events</li> <li>Agent Discovery: Workers auto-register as discoverable agents (v1.2.2+)</li> <li>Codebase Registration: Automatically register local codebases with the server</li> <li>Session Sync: Report OpenCode session history to the central server</li> <li>Output Streaming: Real-time task output streaming to the server</li> <li>Graceful Lifecycle: Proper shutdown handling and resource cleanup</li> <li>Systemd Integration: Run as a production-grade Linux service</li> </ul> <p>v1.2.2: Agent Discovery</p> <p>Workers now automatically register as discoverable agents with role:instance identity pattern. Other agents can find and route tasks to specific workers using <code>discover_agents</code> and <code>send_to_agent</code>.</p> <pre><code>sequenceDiagram\n    participant Server as CodeTether Server\n    participant Redis as Redis (MessageBroker)\n    participant Worker as Agent Worker\n    participant OpenCode as OpenCode CLI\n    participant Codebase as Local Codebase\n\n    Worker-&gt;&gt;Server: Register worker\n    Worker-&gt;&gt;Server: Register codebases\n    Worker-&gt;&gt;Redis: Subscribe to task events\n\n    par Reactive Path (instant)\n    Server-&gt;&gt;Redis: Publish task_available event\n    Redis-&gt;&gt;Worker: Notify via SSE\n    Worker-&gt;&gt;Worker: GET /v1/worker/tasks/stream with X-Codebases, X-Capabilities headers\n    Worker-&gt;&gt;OpenCode: Execute task</code></pre> <p>Headers sent by worker:</p> Header Description <code>X-Codebases</code> Comma-separated list of registered codebase IDs <code>X-Capabilities</code> Comma-separated list of worker capabilities <code>worker_id</code> Worker identifier <code>Authorization</code> Bearer token if configured <p>Benefits: - Near-instant task start: Tasks begin within milliseconds of creation - Header-based routing: Server routes tasks based on codebase/capability headers - Reduced latency: No waiting for poll interval - Battery efficient: No periodic polling overhead</p> <p>Configuration: <pre><code>{\n    \"redis_url\": \"redis://localhost:6379\"\n}\n</code></pre></p> <p>Or via environment: <pre><code>A2A_REDIS_URL=redis://localhost:6379\n</code></pre></p> <p>The worker automatically detects the server's Redis URL if configured. If Redis is unavailable, the worker seamlessly falls back to polling.</p> <p>How It Works</p> <p>When a task is created, the server publishes a <code>task_available</code> event to Redis and broadcasts via SSE. Workers subscribed to events for their registered codebases (matching <code>X-Codebases</code> header) receive the event immediately, fetch the full task details, and start execution.</p>"},{"location":"features/agent-worker/#4-task-polling","title":"4. Task Polling","text":"<p>The worker polls for pending tasks:</p> <pre><code>GET /v1/opencode/tasks?status=pending&amp;worker_id=abc123\n</code></pre> <p>Only tasks assigned to this worker's codebases are returned.</p>"},{"location":"features/agent-worker/#5-task-execution","title":"5. Task Execution","text":"<p>When a task is received:</p> <ol> <li>Claim: Worker marks task as <code>running</code></li> <li>Execute: Runs OpenCode with the task prompt</li> <li>Stream: Output is streamed to the server in real-time</li> <li>Report: Final status (<code>completed</code> or <code>failed</code>) is reported</li> </ol> <pre><code># Equivalent OpenCode command\nopencode run --agent build --format json \"Add unit tests for auth module\"\n</code></pre>"},{"location":"features/agent-worker/#6-session-sync","title":"6. Session Sync","text":"<p>Every ~60 seconds, the worker syncs OpenCode session history:</p> <pre><code>POST /v1/opencode/codebases/{id}/sessions/sync\n{\n    \"worker_id\": \"abc123\",\n    \"sessions\": [\n        {\n            \"id\": \"sess_xyz\",\n            \"title\": \"Added unit tests\",\n            \"created\": \"2025-12-10T15:00:00Z\",\n            \"updated\": \"2025-12-10T15:05:00Z\",\n            \"messageCount\": 12\n        }\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#task-workflow","title":"Task Workflow","text":""},{"location":"features/agent-worker/#creating-a-task","title":"Creating a Task","text":"<p>Tasks can be created via the API:</p> <pre><code>curl -X POST https://api.codetether.run/v1/opencode/codebases/cb_abc/tasks \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Add authentication\",\n    \"prompt\": \"Implement JWT authentication for the API endpoints\",\n    \"agent_type\": \"build\",\n    \"metadata\": {\n        \"model\": \"anthropic/claude-sonnet-4-20250514\"\n    }\n}'\n</code></pre>"},{"location":"features/agent-worker/#task-lifecycle","title":"Task Lifecycle","text":"<pre><code>pending \u2192 running \u2192 completed\n              \u2193\n            failed\n</code></pre> Status Description <code>pending</code> Waiting for a worker to pick up <code>running</code> Currently being executed <code>completed</code> Successfully finished <code>failed</code> Execution error occurred"},{"location":"features/agent-worker/#resuming-sessions","title":"Resuming Sessions","text":"<p>Tasks can resume existing OpenCode sessions:</p> <pre><code>{\n    \"title\": \"Continue refactoring\",\n    \"prompt\": \"Continue the database refactoring from where we left off\",\n    \"metadata\": {\n        \"resume_session_id\": \"sess_xyz789\"\n    }\n}\n</code></pre>"},{"location":"features/agent-worker/#security","title":"Security","text":""},{"location":"features/agent-worker/#systemd-hardening","title":"Systemd Hardening","text":"<p>The provided service unit includes security hardening:</p> <pre><code>[Service]\n# Run as dedicated user\nUser=a2a-worker\nGroup=a2a-worker\n\n# Security restrictions\nNoNewPrivileges=true\nProtectSystem=full\nProtectHome=read-only\nReadWritePaths=/home /opt/a2a-worker\nPrivateTmp=true\n\n# Resource limits\nMemoryMax=2G\nCPUQuota=200%\n</code></pre>"},{"location":"features/agent-worker/#file-permissions","title":"File Permissions","text":"<pre><code># Configuration is readable only by root/worker\nsudo chmod 600 /etc/a2a-worker/config.json\nsudo chown a2a-worker:a2a-worker /etc/a2a-worker/config.json\n</code></pre>"},{"location":"features/agent-worker/#network-security","title":"Network Security","text":"<ul> <li>Use HTTPS for all server communication</li> <li>Consider VPN or private network for internal deployments</li> <li>Use authentication tokens when available</li> </ul>"},{"location":"features/agent-worker/#monitoring","title":"Monitoring","text":""},{"location":"features/agent-worker/#logs","title":"Logs","text":"<pre><code># Live logs\nsudo journalctl -u a2a-agent-worker -f\n\n# Recent logs\nsudo journalctl -u a2a-agent-worker -n 100\n\n# Since last boot\nsudo journalctl -u a2a-agent-worker -b\n</code></pre>"},{"location":"features/agent-worker/#health-checks","title":"Health Checks","text":"<pre><code># Service status\nsudo systemctl status a2a-agent-worker\n\n# Process check\npgrep -f \"worker.py\" &amp;&amp; echo \"Running\" || echo \"Not running\"\n</code></pre>"},{"location":"features/agent-worker/#server-side-monitoring","title":"Server-Side Monitoring","text":"<p>Check worker status from the server:</p> <pre><code>curl https://api.codetether.run/v1/monitor/workers\n</code></pre> <pre><code>{\n    \"workers\": [\n        {\n            \"id\": \"abc123\",\n            \"name\": \"dev-vm-worker\",\n            \"status\": \"active\",\n            \"last_heartbeat\": \"2025-12-10T15:30:00Z\",\n            \"codebases\": 2,\n            \"tasks_completed\": 42\n        }\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/agent-worker/#uiapi-says-no-workers-available","title":"UI/API says \u201cNo workers available\u201d","text":"<p>This error happens when you try to register a codebase by path (from the UI or API) but the server currently has zero registered workers.</p> <p>Fix checklist:</p> <ol> <li> <p>Start the worker on the machine that has the codebase path</p> <ul> <li><code>sudo systemctl start a2a-agent-worker</code></li> <li><code>sudo systemctl status a2a-agent-worker</code></li> </ul> </li> <li> <p>Make sure the worker points at the same server URL your UI/API is using</p> <ul> <li>Inspect what systemd is passing:</li> <li><code>sudo systemctl cat a2a-agent-worker | grep A2A_SERVER_URL</code></li> <li>If needed, override via <code>/etc/a2a-worker/env</code>:</li> <li><code>A2A_SERVER_URL=https://api.codetether.run</code></li> <li>Then restart:</li> <li><code>sudo systemctl restart a2a-agent-worker</code></li> </ul> </li> <li> <p>Verify the server sees at least one worker</p> <ul> <li><code>curl https://api.codetether.run/v1/opencode/workers</code></li> </ul> </li> </ol> <p>If <code>/v1/opencode/workers</code> returns an empty list, the server will reject path-based registration requests.</p>"},{"location":"features/agent-worker/#worker-is-running-but-v1opencodeworkers-or-v1opencodecodebases-is-empty","title":"Worker is running, but <code>/v1/opencode/workers</code> or <code>/v1/opencode/codebases</code> is empty","text":"<p>If the worker logs show successful registration (e.g. <code>Worker registered successfully</code> / <code>Registered codebase ...</code>) but the API still reports zero workers/codebases, this is almost always one of these:</p> <ol> <li>You\u2019re behind a load balancer / multiple API replicas without shared state</li> <li>The API pod/container restarted and lost in-memory state</li> <li>The OpenCode registry database is not persisted (no volume / wrong <code>OPENCODE_DB_PATH</code>)</li> </ol> <p>Fix checklist:</p> <ul> <li> <p>Enable Redis-backed OpenCode state on the server (recommended for Kubernetes and any multi-replica deployment):</p> <ul> <li>Set <code>A2A_REDIS_URL</code> on the server (not the worker), e.g.:<ul> <li><code>A2A_REDIS_URL=redis://redis:6379</code></li> </ul> </li> <li>This lets workers/codebases/sessions be visible consistently across API replicas.</li> </ul> </li> <li> <p>Persist the OpenCode DB if you rely on SQLite:</p> <ul> <li>Set <code>OPENCODE_DB_PATH</code> to a path on a persistent volume (e.g. <code>/data/opencode.db</code>).</li> </ul> </li> <li> <p>Force a fresh re-registration:</p> <ul> <li>Restart the worker: <code>sudo systemctl restart a2a-agent-worker</code></li> <li>Then re-check:<ul> <li><code>curl https://api.codetether.run/v1/opencode/workers</code></li> <li><code>curl https://api.codetether.run/v1/opencode/codebases</code></li> </ul> </li> </ul> </li> </ul> <p>If the lists \u201cflap\u201d (sometimes empty, sometimes populated), it\u2019s a strong signal that your load balancer is routing reads/writes to different replicas without a shared backing store.</p>"},{"location":"features/agent-worker/#registration-task-stuck-in-pending","title":"Registration task stuck in \u201cpending\u201d","text":"<p>When you register a codebase from the UI without providing a <code>worker_id</code>, the server creates a special registration task with:</p> <ul> <li><code>agent_type = \"register_codebase\"</code></li> <li><code>codebase_id = \"__pending__\"</code></li> </ul> <p>Any worker can claim these tasks, validate the path exists locally, and then confirm registration.</p> <p>How to debug:</p> <ol> <li> <p>Check pending tasks:</p> <ul> <li><code>curl https://api.codetether.run/v1/opencode/tasks?status=pending</code></li> </ul> </li> <li> <p>Watch worker logs for the claim:</p> <ul> <li><code>sudo journalctl -u a2a-agent-worker -f</code></li> <li>You should see something like: <code>Handling registration task ...</code></li> </ul> </li> <li> <p>Ensure the worker user can read the path:</p> <ul> <li><code>sudo -u a2a-worker ls -la /path/to/your/codebase</code></li> </ul> </li> </ol> <p>If the task remains pending and the worker never logs that it handled it, confirm the worker is polling and is connected to the correct server.</p>"},{"location":"features/agent-worker/#worker-not-starting","title":"Worker Not Starting","text":"<pre><code># Check logs\nsudo journalctl -u a2a-agent-worker -n 50\n\n# Common issues:\n# - Python environment not created\n# - aiohttp not installed\n# - Config file missing or invalid\n</code></pre>"},{"location":"features/agent-worker/#cannot-connect-to-server","title":"Cannot Connect to Server","text":"<pre><code># Test connectivity\ncurl -I https://api.codetether.run/v1/opencode/status\n\n# Check DNS resolution\nnslookup api.codetether.run\n\n# Check firewall\nsudo iptables -L -n | grep 443\n</code></pre>"},{"location":"features/agent-worker/#opencode-not-found","title":"OpenCode Not Found","text":"<pre><code># Check OpenCode location\nwhich opencode\nls -la ~/.local/bin/opencode\n\n# Verify it works\nopencode --version\n\n# Set explicit path in config\n{\n    \"opencode_bin\": \"/home/user/.local/bin/opencode\"\n}\n</code></pre>"},{"location":"features/agent-worker/#codebase-not-registering","title":"Codebase Not Registering","text":"<pre><code># Verify path exists\nls -la /home/user/my-project\n\n# Check worker user has access\nsudo -u a2a-worker ls /home/user/my-project\n\n# Add worker to user's group\nsudo usermod -a -G $USER a2a-worker\n</code></pre>"},{"location":"features/agent-worker/#tasks-not-executing","title":"Tasks Not Executing","text":"<pre><code># Check task queue on server\ncurl https://api.codetether.run/v1/opencode/tasks?status=pending\n\n# Verify codebase is registered with worker_id\ncurl https://api.codetether.run/v1/opencode/codebases\n\n# Check worker is polling (in logs)\nsudo journalctl -u a2a-agent-worker | grep \"poll\"\n</code></pre>"},{"location":"features/agent-worker/#email-notifications","title":"Email Notifications","text":"<p>The Agent Worker can send email notifications when tasks complete or fail. More importantly, users can reply directly to these emails to continue the conversation with the worker.</p>"},{"location":"features/agent-worker/#configuration","title":"Configuration","text":"<p>Add SendGrid credentials to your worker config:</p> <pre><code>{\n    \"sendgrid_api_key\": \"SG.xxxxx\",\n    \"sendgrid_from_email\": \"worker@yourdomain.com\",\n    \"notification_email\": \"team@yourdomain.com\",\n    \"email_inbound_domain\": \"inbound.yourdomain.com\",\n    \"email_reply_prefix\": \"task\"\n}\n</code></pre> <p>Or via environment variables:</p> <pre><code>SENDGRID_API_KEY=SG.xxxxx\nSENDGRID_FROM_EMAIL=worker@yourdomain.com\nNOTIFICATION_EMAIL=team@yourdomain.com\nEMAIL_INBOUND_DOMAIN=inbound.yourdomain.com\nEMAIL_REPLY_PREFIX=task\n</code></pre>"},{"location":"features/agent-worker/#email-reply-flow","title":"Email Reply Flow","text":"<p>When <code>email_inbound_domain</code> is configured, notification emails include a special reply-to address:</p> <pre><code>task+{session_id}@inbound.yourdomain.com\n</code></pre> <p>Flow:</p> <pre><code>sequenceDiagram\n    participant Worker as Agent Worker\n    participant SendGrid as SendGrid\n    participant User as User\n    participant Server as CodeTether Server\n\n    Worker-&gt;&gt;SendGrid: Send task report email\n    Note right of Worker: reply-to: task+session123@inbound.yourdomain.com\n    SendGrid-&gt;&gt;User: Email delivered\n    User-&gt;&gt;SendGrid: Reply to email\n    SendGrid-&gt;&gt;Server: POST /v1/email/inbound (Inbound Parse)\n    Server-&gt;&gt;Server: Extract session_id from address\n    Server-&gt;&gt;Server: Create continuation task\n    Worker-&gt;&gt;Server: Pick up new task\n    Worker-&gt;&gt;Worker: Resume OpenCode session</code></pre>"},{"location":"features/agent-worker/#setting-up-sendgrid-inbound-parse","title":"Setting Up SendGrid Inbound Parse","text":"<ol> <li> <p>Configure your domain's MX records:</p> <p>Point your inbound subdomain to SendGrid: <pre><code>inbound.yourdomain.com. MX 10 mx.sendgrid.net.\n</code></pre></p> </li> <li> <p>Set up Inbound Parse in SendGrid:</p> <ul> <li>Go to Settings &gt; Inbound Parse</li> <li>Click Add Host &amp; URL</li> <li>Enter your subdomain: <code>inbound.yourdomain.com</code></li> <li>Set destination URL: <code>https://api.codetether.run/v1/email/inbound</code></li> <li>Check \"POST the raw, full MIME message\" (optional)</li> <li>Save</li> </ul> </li> <li> <p>Test the setup:</p> <p>Send a test email to <code>test@inbound.yourdomain.com</code> and check your server logs.</p> </li> </ol>"},{"location":"features/agent-worker/#email-content","title":"Email Content","text":"<p>Notification emails include:</p> <ul> <li>Task status (completed/failed)</li> <li>Task ID and title</li> <li>Session ID (for reply threading)</li> <li>Worker name</li> <li>Duration</li> <li>Output (truncated) or error message</li> <li>Reply instructions (when inbound is configured)</li> </ul>"},{"location":"features/agent-worker/#troubleshooting_1","title":"Troubleshooting","text":"<p>Emails not sending: <pre><code># Check worker logs\nsudo journalctl -u a2a-agent-worker | grep -i email\n</code></pre></p> <p>Replies not creating tasks: <pre><code># Check server logs for inbound webhook\ncurl https://api.codetether.run/v1/email/test-inbound\n</code></pre></p> <p>Test reply-to address parsing: <pre><code>curl \"https://api.codetether.run/v1/email/test-reply-address?session_id=test123\"\n</code></pre></p>"},{"location":"features/agent-worker/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"features/agent-worker/#multiple-workers","title":"Multiple Workers","text":"<p>Run multiple workers for different codebase sets:</p> <pre><code># Worker 1 - Production codebases\npython3 worker.py --name prod-worker --config /etc/a2a-worker/prod.json\n\n# Worker 2 - Development codebases\npython3 worker.py --name dev-worker --config /etc/a2a-worker/dev.json\n</code></pre>"},{"location":"features/agent-worker/#agent-discovery-registration","title":"Agent Discovery Registration","text":"<p>Workers automatically register as discoverable agents on startup. Configure the agent identity:</p> <pre><code>python3 worker.py \\\n  --agent-name code-reviewer \\\n  --agent-description \"Python code review specialist\" \\\n  --server https://api.codetether.run\n</code></pre> <p>Or via config:</p> <pre><code>{\n    \"agent_name\": \"code-reviewer\",\n    \"agent_description\": \"Python code review specialist\",\n    \"register_as_agent\": true\n}\n</code></pre> <p>Role:Instance Pattern:</p> Field Purpose Example <code>name</code> Unique discovery identity <code>code-reviewer:dev-vm:abc123</code> <code>role</code> Routing identity for <code>send_to_agent</code> <code>code-reviewer</code> <p>Important: Use <code>role</code> with <code>send_to_agent</code> for routing. The <code>name</code> field is unique per-instance.</p> <p>Environment Variables:</p> Variable Description <code>A2A_AGENT_NAME</code> Agent routing role <code>A2A_AGENT_DESCRIPTION</code> Agent description <code>A2A_AGENT_URL</code> Direct URL (optional) <p>Disable registration if you don't want the worker to be discoverable:</p> <pre><code>python3 worker.py --no-agent-registration\n</code></pre>"},{"location":"features/agent-worker/#custom-capabilities","title":"Custom Capabilities","text":"<p>Advertise specific capabilities:</p> <pre><code>{\n    \"capabilities\": [\n        \"opencode\",\n        \"python\",\n        \"typescript\",\n        \"docker\",\n        \"kubernetes\"\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#opencode-model-selection","title":"OpenCode Model Selection","text":"<p>Tasks can specify which model to use:</p> <pre><code>{\n    \"prompt\": \"Refactor the database module\",\n    \"metadata\": {\n        \"model\": \"anthropic/claude-sonnet-4-20250514\"\n    }\n}\n</code></pre> <p>Supported models:</p> <ul> <li><code>anthropic/claude-sonnet-4-20250514</code></li> <li><code>anthropic/claude-opus-4-20250514</code></li> <li><code>openai/gpt-4o</code></li> <li><code>google/gemini-2.0-flash</code></li> <li>And many more (see Models API)</li> </ul>"},{"location":"features/agent-worker/#file-reference","title":"File Reference","text":""},{"location":"features/agent-worker/#workerpy","title":"worker.py","text":"<p>Location: <code>/opt/a2a-worker/worker.py</code> (installed) or <code>agent_worker/worker.py</code> (source)</p> <p>Main worker script containing:</p> <ul> <li><code>WorkerConfig</code> - Configuration dataclass</li> <li><code>LocalCodebase</code> - Registered codebase dataclass</li> <li><code>AgentWorker</code> - Main worker class</li> <li>Task polling, execution, and reporting logic</li> <li>OpenCode session discovery and sync</li> </ul>"},{"location":"features/agent-worker/#configexamplejson","title":"config.example.json","text":"<p>Location: <code>agent_worker/config.example.json</code></p> <p>Example configuration file to copy and customize.</p>"},{"location":"features/agent-worker/#installsh","title":"install.sh","text":"<p>Location: <code>agent_worker/install.sh</code></p> <p>Installation script that sets up the worker as a systemd service.</p>"},{"location":"features/agent-worker/#a2a-agent-workerservice","title":"a2a-agent-worker.service","text":"<p>Location: <code>agent_worker/systemd/a2a-agent-worker.service</code></p> <p>Systemd service unit with security hardening and resource limits.</p>"},{"location":"features/agent-worker/#next-steps","title":"Next Steps","text":"<ul> <li>OpenCode Integration - Learn about OpenCode features</li> <li>Distributed Workers - Scale workers horizontally</li> <li>OpenCode API - Full API reference</li> <li>Production Deployment - Production checklist</li> </ul>"},{"location":"features/distributed-workers/","title":"Distributed Workers","text":"<p>CodeTether supports distributed workers, allowing you to scale AI agent execution across multiple machines.</p>"},{"location":"features/distributed-workers/#overview","title":"Overview","text":"<p>Workers are separate processes that:</p> <ul> <li>Connect to the CodeTether server</li> <li>Poll for assigned tasks</li> <li>Execute tasks using the local OpenCode fork (from <code>opencode/</code> directory)</li> <li>Report results back to the server</li> <li>Sync session history to the central server</li> </ul> <p>Agent Worker Documentation</p> <p>For complete installation and configuration details, see the Agent Worker guide.</p>"},{"location":"features/distributed-workers/#quick-start","title":"Quick Start","text":""},{"location":"features/distributed-workers/#1-install-worker","title":"1. Install Worker","text":"<pre><code># Clone repository\ngit clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n\n# Run installer as root\nsudo ./agent_worker/install.sh\n</code></pre>"},{"location":"features/distributed-workers/#2-configure-worker","title":"2. Configure Worker","text":"<p>Edit <code>/etc/a2a-worker/config.json</code>:</p> <pre><code>{\n  \"server_url\": \"https://api.codetether.run\",\n  \"worker_name\": \"worker-1\",\n  \"poll_interval\": 5,\n  \"codebases\": [\n    {\n      \"name\": \"my-project\",\n      \"path\": \"/home/user/my-project\",\n      \"description\": \"Main application\"\n    }\n  ],\n  \"capabilities\": [\"opencode\", \"build\", \"deploy\", \"test\"]\n}\n</code></pre>"},{"location":"features/distributed-workers/#3-start-worker","title":"3. Start Worker","text":"<pre><code>sudo systemctl start a2a-agent-worker\nsudo systemctl enable a2a-agent-worker\n</code></pre>"},{"location":"features/distributed-workers/#4-verify-the-worker-is-registered","title":"4. Verify the Worker is Registered","text":"<p>Once started, the server should show at least one registered worker:</p> <pre><code>curl https://api.codetether.run/v1/opencode/workers\n</code></pre> <p>On the worker machine, you can also confirm it is polling:</p> <pre><code>sudo systemctl status a2a-agent-worker\nsudo journalctl -u a2a-agent-worker -n 100 --no-pager\n</code></pre> <p>If you see \u201cNo workers available\u201d</p> <p>That message is returned when the server has no registered workers at the moment a codebase registration-by-path request is made.</p> <p>Make sure the worker service is running on the machine that can access the path, and that <code>A2A_SERVER_URL</code> points at the same server your UI/API is using.</p>"},{"location":"features/distributed-workers/#worker-architecture","title":"Worker Architecture","text":"<pre><code>graph LR\n    S[CodeTether Server] --&gt; PG[(PostgreSQL)]\n    S --&gt; R[(Redis)]\n\n    subgraph Workers\n        R --&gt; W1[Worker 1]\n        R --&gt; W2[Worker 2]\n        R --&gt; W3[Worker N]\n    end\n\n    W1 --&gt; OC1[OpenCode]\n    W2 --&gt; OC2[OpenCode]\n    W3 --&gt; OC3[OpenCode]\n\n    W1 -.-&gt; R[Redis Events]\n    W2 -.-&gt; R\n    W3 -.-&gt; R</code></pre> <p>Durable Persistence with PostgreSQL</p> <p>When <code>DATABASE_URL</code> is configured, workers, codebases, and sessions persist across server restarts and work correctly with multiple replicas. Without PostgreSQL, data is stored in Redis (shared) or in-memory (single instance only).</p> <p>Reactive Task Execution</p> <p>Workers subscribe to Redis MessageBroker events for near-instant task execution. Configure <code>A2A_REDIS_URL</code> on workers to enable real-time task delivery.</p>"},{"location":"features/distributed-workers/#configuration-options","title":"Configuration Options","text":"Option Default Description <code>server_url</code> \u2014 CodeTether server URL (required) <code>worker_name</code> hostname Unique worker identifier <code>poll_interval</code> 5 Seconds between task polls (fallback when reactive mode is unavailable) <code>codebases</code> [] Array of codebase objects to register <code>opencode_bin</code> auto-detect Path to OpenCode binary <code>capabilities</code> [\"opencode\", \"build\", \"deploy\"] Advertised capabilities <code>redis_url</code> <code>redis://localhost:6379</code> Redis URL for MessageBroker reactive task execution"},{"location":"features/distributed-workers/#environment-variables","title":"Environment Variables","text":"<pre><code>export A2A_SERVER_URL=https://api.codetether.run\nexport A2A_WORKER_NAME=worker-1\nexport A2A_POLL_INTERVAL=5\n\n# Enable reactive task execution via Redis MessageBroker\nexport A2A_REDIS_URL=redis://localhost:6379\n</code></pre> Variable Description <code>A2A_SERVER_URL</code> CodeTether server URL <code>A2A_WORKER_NAME</code> Worker identifier <code>A2A_POLL_INTERVAL</code> Poll interval in seconds (fallback for reactive mode) <code>A2A_REDIS_URL</code> Redis URL for real-time task events (optional, enables reactive execution)"},{"location":"features/distributed-workers/#systemd-service","title":"Systemd Service","text":"<p>The installer creates <code>/etc/systemd/system/a2a-agent-worker.service</code>:</p> <pre><code>[Unit]\nDescription=A2A Agent Worker - OpenCode task executor\nAfter=network-online.target\n\n[Service]\nType=simple\nUser=a2a-worker\nExecStart=/opt/a2a-worker/venv/bin/python /opt/a2a-worker/worker.py --config /etc/a2a-worker/config.json\nRestart=always\nRestartSec=10\n\n# Security hardening\nNoNewPrivileges=true\nProtectSystem=full\nProtectHome=read-only\nReadWritePaths=/home /opt/a2a-worker\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Manage the service:</p> <pre><code>sudo systemctl start a2a-agent-worker\nsudo systemctl stop a2a-agent-worker\nsudo systemctl status a2a-agent-worker\nsudo journalctl -u a2a-agent-worker -f\n</code></pre>"},{"location":"features/distributed-workers/#codebase-registration","title":"Codebase Registration","text":""},{"location":"features/distributed-workers/#regular-codebases","title":"Regular Codebases","text":"<p>Register codebases with worker affinity:</p> <pre><code>curl -X POST https://api.codetether.run/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/my-project\",\n    \"description\": \"Main application\",\n    \"worker_id\": \"worker-1\"\n  }'\n</code></pre> <p>Tasks for this codebase will only be assigned to <code>worker-1</code>.</p> <p>Worker Affinity</p> <p>When a codebase is registered with a <code>worker_id</code>, only that worker will receive tasks for it. This ensures tasks execute where the code actually lives.</p>"},{"location":"features/distributed-workers/#global-codebase","title":"Global Codebase","text":"<p>Workers can also register a special \"global\" codebase that can receive tasks with <code>codebase_id: \"global\"</code>:</p> <pre><code># Register as global codebase\ncurl -X POST https://api.codetether.run/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"global-tasks\",\n    \"path\": \"/home/user/shared\",\n    \"description\": \"Global tasks directory\",\n    \"worker_id\": \"worker-1\",\n    \"codebase_id\": \"global\"\n  }'\n</code></pre> <p>Workers with a global codebase will receive tasks created with <code>codebase_id: \"global\"</code> in addition to their regular codebases.</p> <p>Global Tasks</p> <p>Global tasks are useful for: - Cross-codebase operations - Administrative tasks - Tasks that don't belong to a specific project</p>"},{"location":"features/distributed-workers/#scaling","title":"Scaling","text":""},{"location":"features/distributed-workers/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>Add more workers to handle more concurrent tasks:</p> <pre><code># Worker 1 - Production\npython3 worker.py --name prod-worker-1 --config /etc/a2a-worker/prod.json\n\n# Worker 2 - Production\npython3 worker.py --name prod-worker-2 --config /etc/a2a-worker/prod.json\n\n# Worker 3 - Development\npython3 worker.py --name dev-worker --config /etc/a2a-worker/dev.json\n</code></pre>"},{"location":"features/distributed-workers/#command-line-usage","title":"Command Line Usage","text":"<pre><code># Basic usage\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --name my-worker\n\n# With inline codebases\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --codebase my-project:/home/user/my-project \\\n    --codebase api:/home/user/api\n</code></pre>"},{"location":"features/distributed-workers/#kubernetes-deployment","title":"Kubernetes Deployment","text":"<pre><code>apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: codetether-worker\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: codetether-worker\n  template:\n    spec:\n      containers:\n      - name: worker\n        image: registry.quantum-forge.net/library/a2a-worker:latest\n        env:\n        - name: A2A_SERVER_URL\n          value: \"http://a2a-server:8000\"\n        - name: A2A_WORKER_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        volumeMounts:\n        - name: codebases\n          mountPath: /codebases\n      volumes:\n      - name: codebases\n        persistentVolumeClaim:\n          claimName: codebases-pvc\n</code></pre>"},{"location":"features/distributed-workers/#monitoring","title":"Monitoring","text":"<p>Check worker status:</p> <pre><code>curl https://api.codetether.run/v1/monitor/workers\n</code></pre> <pre><code>{\n  \"workers\": [\n    {\n      \"id\": \"worker-1\",\n      \"name\": \"dev-vm-worker\",\n      \"status\": \"active\",\n      \"last_heartbeat\": \"2025-12-10T15:30:00Z\",\n      \"codebases\": 3,\n      \"tasks_completed\": 42\n    }\n  ]\n}\n</code></pre>"},{"location":"features/distributed-workers/#logs","title":"Logs","text":"<pre><code># View worker logs\nsudo journalctl -u a2a-agent-worker -f\n\n# Recent logs\nsudo journalctl -u a2a-agent-worker -n 100\n</code></pre>"},{"location":"features/distributed-workers/#session-sync","title":"Session Sync","text":"<p>Workers automatically sync OpenCode session history to the server every ~60 seconds. This enables:</p> <ul> <li>Centralized session visibility</li> <li>Session resumption from the web UI</li> <li>Historical task tracking</li> </ul> <p>The sync includes:</p> <ul> <li>Session metadata (title, timestamps)</li> <li>Message summaries</li> <li>Tool usage statistics</li> </ul>"},{"location":"features/distributed-workers/#next-steps","title":"Next Steps","text":"<ul> <li>Agent Worker - Complete installation and configuration guide</li> <li>Architecture - System architecture overview</li> <li>Kubernetes Deployment - Production k8s deployment</li> <li>OpenCode API - Full API reference</li> </ul>"},{"location":"features/marketing-coordinator/","title":"Marketing Coordinator Agent","text":"<p>The Marketing Coordinator Agent orchestrates marketing initiatives by planning strategies and creating tasks for worker agents to execute.</p>"},{"location":"features/marketing-coordinator/#overview","title":"Overview","text":"<p>The Marketing Coordinator is a specialized agent that: - Plans marketing initiatives using AI (Claude Opus 4.5 via Azure AI Foundry) - Creates tasks for workers to execute marketing operations - Manages initiative lifecycle: draft \u2192 planning \u2192 executing \u2192 monitoring - Coordinates across creative, campaigns, automations, audiences, and analytics</p>"},{"location":"features/marketing-coordinator/#architecture","title":"Architecture","text":"<pre><code>Marketing Coordinator (Planner)\n    \u2193 (Creates Tasks)\nA2A Task Queue\n    \u2193 (Workers Pick Up)\nWorker Agents\n    \u2193 (MCP Tools Call)\nMarketing APIs (Creative, Campaigns, Analytics, etc.)\n</code></pre>"},{"location":"features/marketing-coordinator/#task-based-orchestration","title":"Task-Based Orchestration","text":"<p>The coordinator uses a task-based architecture for distributed execution:</p> <ol> <li>Coordinator receives request \u2192 \"Launch Q1 email campaign\"</li> <li>Plans initiative \u2192 Creates 5 tasks (design, copy, list building, automation, analytics)</li> <li>Workers pick up tasks \u2192 Each task handled by specialized worker</li> <li>MCP tools execute \u2192 Workers call marketing APIs via MCP</li> <li>Coordinator monitors \u2192 Tracks task completion and initiative progress</li> </ol>"},{"location":"features/marketing-coordinator/#installation","title":"Installation","text":""},{"location":"features/marketing-coordinator/#from-source","title":"From Source","text":"<pre><code>cd agents/marketing_coordinator\npip install -r requirements.txt\n</code></pre>"},{"location":"features/marketing-coordinator/#running-the-coordinator","title":"Running the Coordinator","text":"<pre><code>python agent.py --model claude-opus\n</code></pre>"},{"location":"features/marketing-coordinator/#configuration","title":"Configuration","text":"<p>Environment variables:</p> Variable Description Default <code>AZURE_OPENAI_ENDPOINT</code> Azure AI Foundry endpoint - <code>AZURE_OPENAI_API_KEY</code> Azure API key - <code>AZURE_DEPLOYMENT_NAME</code> Model deployment name <code>claude-opus-4.5</code> <code>A2A_SERVER_URL</code> A2A server URL <code>http://localhost:8000</code>"},{"location":"features/marketing-coordinator/#initiative-management","title":"Initiative Management","text":""},{"location":"features/marketing-coordinator/#create-initiative","title":"Create Initiative","text":"<pre><code>from agents.marketing_coordinator import create_initiative\n\ninitiative = await create_initiative(\n    title=\"Q1 Email Campaign\",\n    description=\"Launch Q1 promotional email campaign to existing customers\",\n    budget=10000,\n    status=\"draft\"\n)\n</code></pre>"},{"location":"features/marketing-coordinator/#plan-tasks-for-initiative","title":"Plan Tasks for Initiative","text":"<pre><code>from agents.marketing_coordinator import plan_initiative_tasks\n\ntasks = await plan_initiative_tasks(\n    initiative_id=initiative.id,\n    a2a_server_url=\"http://localhost:8000\"\n)\n\n# Creates tasks like:\n# - \"Design email creative\"\n# - \"Write email copy\"\n# - \"Build customer audience\"\n# - \"Set up automation\"\n# - \"Configure analytics tracking\"\n</code></pre>"},{"location":"features/marketing-coordinator/#supported-marketing-skills","title":"Supported Marketing Skills","text":""},{"location":"features/marketing-coordinator/#creative-generation","title":"Creative Generation","text":"<ul> <li>Generate ad creatives from copy</li> <li>Batch generate multiple creatives</li> <li>Analyze creative performance</li> <li>Get top-performing creatives</li> </ul>"},{"location":"features/marketing-coordinator/#campaigns","title":"Campaigns","text":"<ul> <li>Create marketing campaigns</li> <li>Update campaign status and budget</li> <li>Get campaign metrics</li> <li>List all campaigns</li> </ul>"},{"location":"features/marketing-coordinator/#automations","title":"Automations","text":"<ul> <li>Create marketing automations</li> <li>Trigger automations manually</li> <li>List automations</li> <li>Update automation status</li> </ul>"},{"location":"features/marketing-coordinator/#audiences","title":"Audiences","text":"<ul> <li>Create geo-based audiences</li> <li>Create lookalike audiences</li> <li>Create custom audiences</li> <li>Get targeting data (zip codes, etc.)</li> </ul>"},{"location":"features/marketing-coordinator/#analytics","title":"Analytics","text":"<ul> <li>Get unified metrics across channels</li> <li>Calculate ROI metrics</li> <li>Analyze channel performance</li> <li>Thompson sampling for budget allocation</li> <li>Get conversion attribution</li> </ul>"},{"location":"features/marketing-coordinator/#mcp-tool-integration","title":"MCP Tool Integration","text":"<p>The coordinator exposes 27 marketing MCP tools for agents to use:</p> <pre><code># Example: Generate creative\n{\n    \"name\": \"generate_creative\",\n    \"description\": \"Generate ad creative from winning copy using Gemini Imagen\",\n    \"params\": {\n        \"concept\": \"Product launch\",\n        \"brand_guidelines\": \"Bold, modern, tech-focused\"\n    }\n}\n\n# Example: Create campaign\n{\n    \"name\": \"create_campaign\",\n    \"description\": \"Create a new marketing campaign\",\n    \"params\": {\n        \"name\": \"Q1 Promotion\",\n        \"budget\": 5000,\n        \"channels\": [\"email\", \"facebook\", \"tiktok\"]\n    }\n}\n</code></pre>"},{"location":"features/marketing-coordinator/#worker-task-execution","title":"Worker Task Execution","text":"<p>Workers execute tasks created by the coordinator:</p> <pre><code># Worker picks up task\ntask = await get_next_task()\n\n# Execute using MCP tools\nif task.type == \"generate_creative\":\n    result = await call_mcp_tool(\n        \"generate_creative\",\n        task.params\n    )\n\n# Mark complete\nawait complete_task(task.id, result)\n</code></pre>"},{"location":"features/marketing-coordinator/#api-endpoints","title":"API Endpoints","text":"Endpoint Method Description <code>/v1/marketing/initiatives</code> POST Create marketing initiative <code>/v1/marketing/initiatives/{id}</code> GET Get initiative details <code>/v1/marketing/initiatives/{id}/plan</code> POST Generate task plan for initiative <code>/v1/marketing/initiatives/{id}/status</code> PUT Update initiative status <code>/v1/marketing/initiatives</code> GET List all initiatives"},{"location":"features/marketing-coordinator/#example-workflow","title":"Example Workflow","text":""},{"location":"features/marketing-coordinator/#launch-a-campaign","title":"Launch a Campaign","text":"<pre><code># 1. Create initiative\ncurl -X POST http://localhost:8000/v1/marketing/initiatives \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Q1 Product Launch\",\n    \"description\": \"Launch new product with multi-channel campaign\",\n    \"budget\": 25000\n  }'\n\n# 2. Plan tasks (coordinator creates worker tasks)\ncurl -X POST http://localhost:8000/v1/marketing/initiatives/123/plan\n\n# 3. Workers pick up and execute tasks automatically\n# Monitor progress:\ncurl http://localhost:8000/v1/marketing/initiatives/123\n</code></pre>"},{"location":"features/marketing-coordinator/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/marketing-coordinator/#tasks-not-being-created","title":"Tasks not being created?","text":"<p>Check coordinator logs: <pre><code>kubectl logs deployment/marketing-coordinator | grep \"task\"\n</code></pre></p>"},{"location":"features/marketing-coordinator/#workers-not-picking-up-tasks","title":"Workers not picking up tasks?","text":"<p>Verify worker connection: <pre><code>curl http://localhost:8000/v1/workers\n</code></pre></p>"},{"location":"features/marketing-coordinator/#initiative-stuck-in-draft","title":"Initiative stuck in \"draft\"?","text":"<p>Manually trigger planning: <pre><code>curl -X POST http://localhost:8000/v1/marketing/initiatives/123/plan\n</code></pre></p>"},{"location":"features/marketing-coordinator/#see-also","title":"See Also","text":"<ul> <li>Marketing Tools</li> <li>Distributed Workers</li> <li>Agent Worker</li> </ul>"},{"location":"features/marketing-tools/","title":"Marketing Tools","text":"<p>CodeTether provides 27 MCP tools for marketing operations, enabling agents to manage campaigns, create content, build audiences, and analyze performance.</p>"},{"location":"features/marketing-tools/#overview","title":"Overview","text":"<p>Marketing tools are organized into 5 categories:</p> <ul> <li>Creative - Generate and analyze ad creatives</li> <li>Campaigns - Manage marketing campaigns</li> <li>Automations - Set up marketing automations</li> <li>Audiences - Build and manage target audiences</li> <li>Analytics - Track performance and ROI</li> </ul>"},{"location":"features/marketing-tools/#configuration","title":"Configuration","text":"<p>Marketing tools require configuration of API endpoints:</p> Variable Description Default <code>MARKETING_API_URL</code> Marketing API server URL <code>http://localhost:8081</code> <code>MARKETING_RUST_URL</code> Marketing Rust backend URL <code>http://localhost:8080</code>"},{"location":"features/marketing-tools/#tool-categories","title":"Tool Categories","text":""},{"location":"features/marketing-tools/#creative-tools","title":"Creative Tools","text":""},{"location":"features/marketing-tools/#generate_creative","title":"<code>generate_creative</code>","text":"<p>Generate an ad creative image from winning ad copy using Gemini Imagen.</p> <p>Parameters: - <code>concept</code> (string): Creative concept/description - <code>brand_guidelines</code> (string): Brand style guidelines (optional)</p> <p>Returns: - <code>asset_id</code>: Generated creative ID - <code>image_url</code>: URL to generated image - <code>enhanced_prompt</code>: The visual prompt used</p> <p>Example: <pre><code>{\n  \"concept\": \"Product launch for new AI platform\",\n  \"brand_guidelines\": \"Bold, modern, tech-focused\"\n}\n</code></pre></p>"},{"location":"features/marketing-tools/#batch_generate_creatives","title":"<code>batch_generate_creatives</code>","text":"<p>Generate multiple creatives from a list of concepts.</p> <p>Parameters: - <code>concepts</code> (array): List of creative concepts - <code>brand_guidelines</code> (string): Brand style guidelines (optional)</p> <p>Returns: - <code>creatives</code>: Array of generated creatives</p>"},{"location":"features/marketing-tools/#get_top_creatives","title":"<code>get_top_creatives</code>","text":"<p>Retrieve the best-performing creatives.</p> <p>Parameters: - <code>limit</code> (integer): Number of top creatives to return (default: 10)</p> <p>Returns: - <code>creatives</code>: Array of top-performing creatives with metrics</p>"},{"location":"features/marketing-tools/#analyze_creative_performance","title":"<code>analyze_creative_performance</code>","text":"<p>Analyze performance metrics for a creative.</p> <p>Parameters: - <code>asset_id</code> (string): Creative asset ID</p> <p>Returns: - <code>metrics</code>: Click-through rate, conversions, cost, ROI</p>"},{"location":"features/marketing-tools/#campaign-tools","title":"Campaign Tools","text":""},{"location":"features/marketing-tools/#create_campaign","title":"<code>create_campaign</code>","text":"<p>Create a new marketing campaign.</p> <p>Parameters: - <code>name</code> (string): Campaign name - <code>budget</code> (number): Campaign budget - <code>channels</code> (array): Target channels (facebook, tiktok, google, email)</p> <p>Returns: - <code>campaign_id</code>: New campaign ID - <code>status</code>: Campaign status</p>"},{"location":"features/marketing-tools/#update_campaign_status","title":"<code>update_campaign_status</code>","text":"<p>Update campaign status.</p> <p>Parameters: - <code>campaign_id</code> (string): Campaign ID - <code>status</code> (string): New status (draft, active, paused, completed)</p>"},{"location":"features/marketing-tools/#update_campaign_budget","title":"<code>update_campaign_budget</code>","text":"<p>Update campaign budget.</p> <p>Parameters: - <code>campaign_id</code> (string): Campaign ID - <code>budget</code> (number): New budget amount</p>"},{"location":"features/marketing-tools/#get_campaign_metrics","title":"<code>get_campaign_metrics</code>","text":"<p>Get performance metrics for a campaign.</p> <p>Parameters: - <code>campaign_id</code> (string): Campaign ID</p> <p>Returns: - <code>metrics</code>: Impressions, clicks, conversions, spend, ROI</p>"},{"location":"features/marketing-tools/#list_campaigns","title":"<code>list_campaigns</code>","text":"<p>List all campaigns.</p> <p>Parameters: - <code>status</code> (string): Filter by status (optional)</p> <p>Returns: - <code>campaigns</code>: Array of campaigns</p>"},{"location":"features/marketing-tools/#automation-tools","title":"Automation Tools","text":""},{"location":"features/marketing-tools/#create_automation","title":"<code>create_automation</code>","text":"<p>Create a marketing automation workflow.</p> <p>Parameters: - <code>name</code> (string): Automation name - <code>trigger</code> (object): Trigger conditions - <code>actions</code> (array): Actions to execute</p> <p>Example: <pre><code>{\n  \"name\": \"Welcome email series\",\n  \"trigger\": {\n    \"event\": \"user_signup\",\n    \"delay_hours\": 0\n  },\n  \"actions\": [\n    {\n      \"type\": \"send_email\",\n      \"template\": \"welcome\"\n    },\n    {\n      \"type\": \"wait\",\n      \"days\": 3\n    },\n    {\n      \"type\": \"send_email\",\n      \"template\": \"followup\"\n    }\n  ]\n}\n</code></pre></p>"},{"location":"features/marketing-tools/#trigger_automation","title":"<code>trigger_automation</code>","text":"<p>Manually trigger an automation.</p> <p>Parameters: - <code>automation_id</code> (string): Automation ID - <code>context</code> (object): Trigger context data</p>"},{"location":"features/marketing-tools/#list_automations","title":"<code>list_automations</code>","text":"<p>List all automations.</p> <p>Returns: - <code>automations</code>: Array of automations</p>"},{"location":"features/marketing-tools/#update_automation_status","title":"<code>update_automation_status</code>","text":"<p>Update automation status.</p> <p>Parameters: - <code>automation_id</code> (string): Automation ID - <code>status</code> (string): New status (active, paused, disabled)</p>"},{"location":"features/marketing-tools/#audience-tools","title":"Audience Tools","text":""},{"location":"features/marketing-tools/#create_geo_audience","title":"<code>create_geo_audience</code>","text":"<p>Create a geographic audience based on zip codes.</p> <p>Parameters: - <code>name</code> (string): Audience name - <code>zip_codes</code> (array): List of zip codes</p> <p>Returns: - <code>audience_id</code>: New audience ID</p>"},{"location":"features/marketing-tools/#create_lookalike_audience","title":"<code>create_lookalike_audience</code>","text":"<p>Create a lookalike audience based on source audience.</p> <p>Parameters: - <code>source_audience_id</code> (string): Source audience ID - <code>name</code> (string): Lookalike audience name - <code>size</code> (string): Audience size (1%, 5%, 10%)</p>"},{"location":"features/marketing-tools/#create_custom_audience","title":"<code>create_custom_audience</code>","text":"<p>Create a custom audience from customer data.</p> <p>Parameters: - <code>name</code> (string): Audience name - <code>emails</code> (array): Customer email addresses (optional) - <code>phone_numbers</code> (array): Customer phone numbers (optional)</p>"},{"location":"features/marketing-tools/#get_trash_zone_zips","title":"<code>get_trash_zone_zips</code>","text":"<p>Get zip codes for trash zone targeting.</p> <p>Returns: - <code>zip_codes</code>: Array of zip codes</p>"},{"location":"features/marketing-tools/#analytics-tools","title":"Analytics Tools","text":""},{"location":"features/marketing-tools/#get_unified_metrics","title":"<code>get_unified_metrics</code>","text":"<p>Get unified metrics across all marketing channels.</p> <p>Parameters: - <code>date_range</code> (object): Date range (start, end)</p> <p>Returns: - <code>metrics</code>: Total impressions, clicks, conversions, spend, CTR, CPA, ROAS</p>"},{"location":"features/marketing-tools/#get_roi_metrics","title":"<code>get_roi_metrics</code>","text":"<p>Calculate ROI metrics for campaigns.</p> <p>Parameters: - <code>campaign_ids</code> (array): List of campaign IDs (optional)</p> <p>Returns: - <code>metrics</code>: ROI, ROAS, LTV:CAC ratio</p>"},{"location":"features/marketing-tools/#get_channel_performance","title":"<code>get_channel_performance</code>","text":"<p>Get performance breakdown by channel.</p> <p>Parameters: - <code>date_range</code> (object): Date range</p> <p>Returns: - <code>channels</code>: Performance by channel (facebook, tiktok, google, email)</p>"},{"location":"features/marketing-tools/#thompson_sample_budget","title":"<code>thompson_sample_budget</code>","text":"<p>Optimize budget allocation using Thompson sampling.</p> <p>Parameters: - <code>total_budget</code> (number): Total budget to allocate - <code>channels</code> (array): Available channels</p> <p>Returns: - <code>allocation</code>: Recommended budget per channel</p>"},{"location":"features/marketing-tools/#get_conversion_attribution","title":"<code>get_conversion_attribution</code>","text":"<p>Get conversion attribution data.</p> <p>Parameters: - <code>date_range</code> (object): Date range</p> <p>Returns: - <code>attribution</code>: Last-click, first-click, and multi-touch attribution</p>"},{"location":"features/marketing-tools/#platform-sync-tools","title":"Platform Sync Tools","text":""},{"location":"features/marketing-tools/#sync_facebook_metrics","title":"<code>sync_facebook_metrics</code>","text":"<p>Sync metrics from Facebook Ads API.</p>"},{"location":"features/marketing-tools/#sync_tiktok_metrics","title":"<code>sync_tiktok_metrics</code>","text":"<p>Sync metrics from TikTok Ads API.</p>"},{"location":"features/marketing-tools/#sync_google_metrics","title":"<code>sync_google_metrics</code>","text":"<p>Sync metrics from Google Ads API.</p>"},{"location":"features/marketing-tools/#send_facebook_conversion","title":"<code>send_facebook_conversion</code>","text":"<p>Send conversion event to Facebook.</p> <p>Parameters: - <code>event_name</code> (string): Event type (purchase, lead, signup) - <code>email</code> (string): Customer email - <code>phone</code> (string): Customer phone - <code>value</code> (number): Conversion value - <code>event_id</code> (string): Event ID</p>"},{"location":"features/marketing-tools/#send_tiktok_event","title":"<code>send_tiktok_event</code>","text":"<p>Send conversion event to TikTok.</p> <p>Parameters: - Same as Facebook conversion</p>"},{"location":"features/marketing-tools/#using-tools-via-mcp","title":"Using Tools via MCP","text":""},{"location":"features/marketing-tools/#discovery","title":"Discovery","text":"<pre><code># List all marketing tools\ncurl -X POST http://localhost:8000/mcp/tools/list\n\n# Search for creative tools\ncurl -X POST http://localhost:8000/mcp/tools/search \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"query\": \"creative\"}'\n</code></pre>"},{"location":"features/marketing-tools/#execution","title":"Execution","text":"<pre><code># Generate a creative\ncurl -X POST http://localhost:8000/mcp/tools/call \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"generate_creative\",\n    \"arguments\": {\n      \"concept\": \"Summer sale promotion\",\n      \"brand_guidelines\": \"Vibrant, summer colors, fun\"\n    }\n  }'\n</code></pre>"},{"location":"features/marketing-tools/#integration-with-agents","title":"Integration with Agents","text":""},{"location":"features/marketing-tools/#from-agent-worker","title":"From Agent Worker","text":"<pre><code>from a2a_server.mcp_http_server import call_mcp_tool\n\n# Generate creative\nresult = await call_mcp_tool(\n    \"generate_creative\",\n    {\n        \"concept\": \"Product launch\",\n        \"brand_guidelines\": \"Tech-focused, minimal\"\n    }\n)\n\n# Create campaign\ncampaign = await call_mcp_tool(\n    \"create_campaign\",\n    {\n        \"name\": \"Q1 Promotion\",\n        \"budget\": 5000,\n        \"channels\": [\"facebook\", \"tiktok\"]\n    }\n)\n</code></pre>"},{"location":"features/marketing-tools/#from-marketing-coordinator","title":"From Marketing Coordinator","text":"<p>The Marketing Coordinator automatically uses these tools when planning initiatives.</p>"},{"location":"features/marketing-tools/#api-endpoints","title":"API Endpoints","text":"Endpoint Method Description <code>/mcp/tools/list</code> GET List available marketing tools <code>/mcp/tools/search</code> POST Search tools by keyword <code>/mcp/tools/call</code> POST Execute a marketing tool <code>/mcp/tools/schema</code> GET Get tool schema"},{"location":"features/marketing-tools/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/marketing-tools/#tools-not-available","title":"Tools not available?","text":"<p>Check API connection: <pre><code>curl http://localhost:8081/health\n</code></pre></p>"},{"location":"features/marketing-tools/#creative-generation-failing","title":"Creative generation failing?","text":"<p>Verify Gemini Imagen API is configured: <pre><code>kubectl logs deployment/marketing-api | grep \"imagen\"\n</code></pre></p>"},{"location":"features/marketing-tools/#metrics-not-syncing","title":"Metrics not syncing?","text":"<p>Trigger manual sync: <pre><code>curl -X POST http://localhost:8000/v1/marketing/sync/facebook\n</code></pre></p>"},{"location":"features/marketing-tools/#see-also","title":"See Also","text":"<ul> <li>Marketing Coordinator</li> <li>MCP Tools</li> <li>Agent Worker</li> </ul>"},{"location":"features/mcp-tools/","title":"MCP Tools","text":"<p>CodeTether includes an MCP (Model Context Protocol) server for tool integration.</p>"},{"location":"features/mcp-tools/#overview","title":"Overview","text":"<p>The MCP server (port 9000) exposes CodeTether capabilities as tools that AI models can use.</p>"},{"location":"features/mcp-tools/#configuration","title":"Configuration","text":"<pre><code>export MCP_HTTP_ENABLED=true\nexport MCP_HTTP_PORT=9000\n</code></pre>"},{"location":"features/mcp-tools/#available-tools","title":"Available Tools","text":"<ul> <li>Task management</li> <li>Agent discovery</li> <li>Codebase operations</li> <li>Session management</li> </ul> <p>See the MCP documentation for integration details.</p>"},{"location":"features/monitor-ui/","title":"Monitor UI","text":"<p>CodeTether includes a web-based monitoring dashboard.</p>"},{"location":"features/monitor-ui/#access","title":"Access","text":"<p>Open in your browser:</p> <pre><code>http://localhost:8000/v1/monitor/\n\n# Or, if you run the MCP HTTP server separately:\nhttp://localhost:9000/v1/monitor/\n</code></pre>"},{"location":"features/monitor-ui/#features","title":"Features","text":"<ul> <li>Agent Status - View connected agents</li> <li>Live Messages - Real-time message stream</li> <li>Task Queue - Pending and running tasks</li> <li>Statistics - Usage metrics</li> </ul>"},{"location":"features/monitor-ui/#authentication","title":"Authentication","text":"<p>When Keycloak is enabled, the dashboard requires authentication.</p>"},{"location":"features/opencode/","title":"OpenCode Integration","text":"<p>CodeTether Server includes a maintained fork of OpenCode in the <code>opencode/</code> directory, enabling AI coding agents to work on your codebase with full session management, task queuing, and real-time streaming.</p>"},{"location":"features/opencode/#overview","title":"Overview","text":"<p>The OpenCode Bridge connects CodeTether to the OpenCode CLI, allowing you to:</p> <ul> <li>Register codebases for agents to work on</li> <li>Trigger AI agents with natural language prompts</li> <li>Stream real-time output as agents work</li> <li>Manage sessions with history and resumption</li> <li>Queue tasks for distributed workers</li> </ul> <pre><code>graph LR\n    UI[Web Dashboard] --&gt; API[CodeTether API]\n    API --&gt; Bridge[OpenCode Bridge]\n    Bridge --&gt; OC[OpenCode CLI]\n    OC --&gt; LLM[AI Model]\n    OC --&gt; FS[File System]</code></pre>"},{"location":"features/opencode/#prerequisites","title":"Prerequisites","text":"<ol> <li> <p>OpenCode built from the local fork (included in <code>opencode/</code> directory)</p> <pre><code># Navigate to the OpenCode directory\ncd opencode\n\n# Install dependencies and build\nbun install\nbun run build\n\n# Verify installation\nopencode --version\n</code></pre> </li> <li> <p>AI API keys configured in OpenCode</p> <pre><code># Configure your preferred model provider\nexport ANTHROPIC_API_KEY=sk-ant-...\n# or\nexport OPENAI_API_KEY=sk-...\n</code></pre> </li> </ol>"},{"location":"features/opencode/#quick-start","title":"Quick Start","text":""},{"location":"features/opencode/#1-start-codetether-with-opencode","title":"1. Start CodeTether with OpenCode","text":"<pre><code>codetether serve --port 8000\n</code></pre> <p>Check that OpenCode is detected:</p> <pre><code>curl http://localhost:8000/v1/opencode/status\n</code></pre> <pre><code>{\n  \"available\": true,\n  \"opencode_binary\": \"/usr/local/bin/opencode\",\n  \"registered_codebases\": 0\n}\n</code></pre>"},{"location":"features/opencode/#2-register-a-codebase","title":"2. Register a Codebase","text":"<pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"My awesome project\"\n  }'\n</code></pre>"},{"location":"features/opencode/#3-trigger-an-agent","title":"3. Trigger an Agent","text":"<pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases/{id}/trigger \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"prompt\": \"Add comprehensive error handling to the API routes\",\n    \"agent\": \"build\",\n    \"model\": \"anthropic/claude-sonnet-4-20250514\"\n  }'\n</code></pre>"},{"location":"features/opencode/#4-watch-real-time-output","title":"4. Watch Real-time Output","text":"<pre><code>curl -N http://localhost:8000/v1/opencode/codebases/{id}/events\n</code></pre>"},{"location":"features/opencode/#agent-types","title":"Agent Types","text":"Agent Description Use Case <code>build</code> Implementation agent Writing code, fixing bugs, adding features <code>plan</code> Planning agent Architecture, design, breaking down tasks <code>explore</code> Exploration agent Understanding codebase, answering questions <code>general</code> General purpose Flexible, multi-purpose tasks"},{"location":"features/opencode/#available-models","title":"Available Models","text":"<p>CodeTether supports multiple AI model providers:</p> <pre><code>curl http://localhost:8000/v1/opencode/models\n</code></pre> <p>Anthropic - <code>anthropic/claude-opus-4</code> - Most capable - <code>anthropic/claude-sonnet-4-20250514</code> - Best balance (recommended) - <code>anthropic/claude-3-5-haiku-20241022</code> - Fast and affordable</p> <p>OpenAI - <code>openai/gpt-4o</code> - GPT-4 Omni - <code>openai/o1</code> - Reasoning model - <code>openai/o3-mini</code> - Latest mini model</p> <p>Google - <code>google/gemini-2.0-flash</code> - Fast - <code>google/gemini-2.5-pro</code> - Most capable</p> <p>Others - <code>deepseek/deepseek-chat</code> - DeepSeek - <code>xai/grok-2</code> - xAI Grok</p>"},{"location":"features/opencode/#session-management","title":"Session Management","text":""},{"location":"features/opencode/#view-sessions","title":"View Sessions","text":"<pre><code>curl http://localhost:8000/v1/opencode/codebases/{id}/sessions\n</code></pre>"},{"location":"features/opencode/#resume-a-session","title":"Resume a Session","text":"<p>Sessions are automatically resumed when you trigger an agent on a codebase that has an active session.</p>"},{"location":"features/opencode/#sync-sessions-from-opencode","title":"Sync Sessions from OpenCode","text":"<p>If you've used OpenCode directly (outside CodeTether), sync the sessions:</p> <pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases/{id}/sessions/sync\n</code></pre>"},{"location":"features/opencode/#task-queue","title":"Task Queue","text":"<p>For distributed setups, create tasks that workers pick up:</p>"},{"location":"features/opencode/#create-a-task","title":"Create a Task","text":"<pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases/{id}/tasks \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Add unit tests\",\n    \"prompt\": \"Add unit tests for the authentication module\",\n    \"agent_type\": \"build\",\n    \"priority\": 1\n  }'\n</code></pre>"},{"location":"features/opencode/#list-pending-tasks","title":"List Pending Tasks","text":"<pre><code>curl http://localhost:8000/v1/opencode/tasks?status=pending\n</code></pre>"},{"location":"features/opencode/#real-time-streaming","title":"Real-time Streaming","text":"<p>Subscribe to agent events via SSE:</p> <pre><code>const events = new EventSource('/v1/opencode/codebases/{id}/events');\n\nevents.addEventListener('output', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  process.stdout.write(data.content);\n});\n\nevents.addEventListener('tool_use', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(`\\n\ud83d\udd27 Using tool: ${data.tool}`);\n});\n\nevents.addEventListener('file_change', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(`\\n\ud83d\udcc1 ${data.action}: ${data.path}`);\n});\n\nevents.addEventListener('complete', () =&gt; {\n  console.log('\\n\u2705 Agent completed!');\n  events.close();\n});\n</code></pre>"},{"location":"features/opencode/#configuration","title":"Configuration","text":""},{"location":"features/opencode/#environment-variables","title":"Environment Variables","text":"Variable Default Description <code>OPENCODE_HOST</code> <code>localhost</code> Host where OpenCode API is running <code>OPENCODE_PORT</code> <code>9777</code> OpenCode API port <code>OPENCODE_DB_PATH</code> <code>./data/opencode.db</code> SQLite database for sessions <code>OPENCODE_AUTO_START</code> <code>true</code> Auto-start agents on trigger <p>!!! tip \\\"Docker Container Configuration\\\"\\n    When running CodeTether in Docker and connecting to OpenCode on your host:\\n    \\n    <code>bash\\n    # Docker Desktop (Mac/Windows)\\n    docker run -e OPENCODE_HOST=host.docker.internal ...\\n    \\n    # Linux\\n    docker run --add-host=host.docker.internal:host-gateway \\\\\\n      -e OPENCODE_HOST=host.docker.internal ...\\n</code></p>"},{"location":"features/opencode/#codebase-configuration","title":"Codebase Configuration","text":"<p>Each codebase can have custom agent config:</p> <pre><code>{\n  \"name\": \"my-project\",\n  \"path\": \"/path/to/project\",\n  \"agent_config\": {\n    \"default_model\": \"anthropic/claude-sonnet-4-20250514\",\n    \"auto_approve\": false,\n    \"max_iterations\": 50,\n    \"working_directory\": \"/path/to/project\"\n  }\n}\n</code></pre>"},{"location":"features/opencode/#distributed-workers","title":"Distributed Workers","text":"<p>For scaling, run OpenCode agents on dedicated worker machines:</p>"},{"location":"features/opencode/#on-worker-machine","title":"On Worker Machine","text":"<pre><code># Install CodeTether (includes the worker CLI)\npip install codetether\n\n# Run the worker (manual mode)\n# Note: you can pass --codebase multiple times. Format: name:path (or just a path).\ncodetether-worker \\\n  --server https://codetether.example.com \\\n  --name worker-1 \\\n  --codebase app1:/projects/app1 \\\n  --codebase app2:/projects/app2\n</code></pre>"},{"location":"features/opencode/#register-worker-codebases","title":"Register Worker Codebases","text":"<pre><code>curl -X POST https://codetether.example.com/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"app1\",\n    \"path\": \"/projects/app1\",\n    \"worker_id\": \"worker-1\"\n  }'\n</code></pre> <p>Tasks for <code>app1</code> will be routed to <code>worker-1</code>.</p>"},{"location":"features/opencode/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/opencode/#opencode-not-available","title":"OpenCode Not Available","text":"<pre><code>{\"available\": false, \"message\": \"OpenCode bridge not available\"}\n</code></pre> <p>Solutions: 1. Ensure OpenCode is built from the local fork: <code>which opencode</code> 2. If built but not in PATH, add it: <code>export PATH=$PATH:/path/to/opencode/packages/cli/dist</code> 3. Verify OpenCode works: <code>opencode --version</code> 4. Rebuild if needed: <code>cd opencode &amp;&amp; bun run build</code></p>"},{"location":"features/opencode/#no-models-returned","title":"No Models Returned","text":"<p>The <code>/v1/opencode/models</code> endpoint returns a static list. If empty: 1. Check server logs for errors 2. Verify the server started correctly</p>"},{"location":"features/opencode/#session-not-found","title":"Session Not Found","text":"<pre><code>{\"detail\": \"Session not found\"}\n</code></pre> <p>Solutions: 1. Sync sessions: <code>POST /v1/opencode/codebases/{id}/sessions/sync</code> 2. Check the OpenCode database exists at <code>OPENCODE_DB_PATH</code></p>"},{"location":"features/opencode/#api-reference","title":"API Reference","text":"<p>See the full OpenCode API Reference for all endpoints.</p>"},{"location":"features/ralph/","title":"Ralph: Autonomous Development Loop","text":"<p>Ralph is CodeTether's fully autonomous development agent that implements entire PRDs (Product Requirements Documents) with zero human intervention. Define your user stories, and Ralph writes the code, runs tests, and commits\u2014iterating until all acceptance criteria pass.</p> <p>Zero-Touch Development</p> <p>Ralph autonomously implements features, handles failures through iterative learning, and produces production-ready code with atomic commits per user story.</p>"},{"location":"features/ralph/#overview","title":"Overview","text":"<p>Ralph provides:</p> <ul> <li>PRD-Driven Development: Define user stories with acceptance criteria</li> <li>Fresh Context Per Story: Each story spawns a new OpenCode instance</li> <li>Iterative Learning: Failed stories trigger re-analysis with accumulated context</li> <li>Self-Healing: Automatic retry with learnings when acceptance criteria fail</li> <li>Git Integration: Atomic commits per user story with meaningful messages</li> <li>RLM Support: Handles large codebases via Recursive Language Models</li> </ul>"},{"location":"features/ralph/#how-ralph-works","title":"How Ralph Works","text":"<pre><code>flowchart TD\n    A[PRD Input] --&gt; B[Parse User Stories]\n    B --&gt; C{For Each Story}\n    C --&gt; D[Spawn OpenCode]\n    D --&gt; E[Implement Story]\n    E --&gt; F{Check Criteria}\n    F --&gt;|Pass| G[Commit Changes]\n    F --&gt;|Fail| H[Update progress.txt]\n    H --&gt; I[Increment Iteration]\n    I --&gt; D\n    G --&gt; J{More Stories?}\n    J --&gt;|Yes| C\n    J --&gt;|No| K[Complete]</code></pre>"},{"location":"features/ralph/#the-ralph-loop","title":"The Ralph Loop","text":"<ol> <li>PRD Parsing: Ralph reads your PRD (YAML format) and extracts user stories</li> <li>Story Iteration: For each user story:</li> <li>Spawns a fresh OpenCode instance (clean context)</li> <li>Loads the story requirements and acceptance criteria</li> <li>Implements the feature</li> <li>Runs acceptance criteria checks</li> <li>Self-Healing: If criteria fail:</li> <li>Updates <code>progress.txt</code> with learnings</li> <li>Increments iteration counter</li> <li>Retries with accumulated context</li> <li>Commit: On success, creates atomic commit for the story</li> <li>Next Story: Moves to the next user story</li> </ol>"},{"location":"features/ralph/#prd-format","title":"PRD Format","text":"<p>Ralph uses YAML-formatted PRDs:</p> <pre><code>project: MyApp\nbranchName: ralph/add-user-auth\ndescription: Implement user authentication system\nuserStories:\n  - id: US-001\n    title: Add user model to database\n    description: As a developer, I need a User model with email and password\n    acceptanceCriteria:\n      - User model exists with email and hashed_password fields\n      - Migration file creates users table\n      - Model has password hashing method\n\n  - id: US-002\n    title: Create login endpoint\n    description: As a user, I can login with email and password\n    acceptanceCriteria:\n      - POST /api/auth/login accepts email and password\n      - Returns JWT token on success\n      - Returns 401 on invalid credentials\n\n  - id: US-003\n    title: Add authentication middleware\n    description: As a developer, I can protect routes with auth middleware\n    acceptanceCriteria:\n      - Middleware validates JWT tokens\n      - Protected routes return 401 without valid token\n      - User context available in request\n</code></pre>"},{"location":"features/ralph/#prd-fields","title":"PRD Fields","text":"Field Required Description <code>project</code> Yes Project name <code>branchName</code> Yes Git branch for changes <code>description</code> Yes Overall feature description <code>userStories</code> Yes Array of user stories"},{"location":"features/ralph/#user-story-fields","title":"User Story Fields","text":"Field Required Description <code>id</code> Yes Unique identifier (e.g., US-001) <code>title</code> Yes Short title <code>description</code> Yes User story description <code>acceptanceCriteria</code> Yes List of criteria that must pass"},{"location":"features/ralph/#dashboard","title":"Dashboard","text":"<p>Access Ralph at <code>/dashboard/ralph</code>:</p>"},{"location":"features/ralph/#prd-builder","title":"PRD Builder","text":"<ul> <li>Visual Editor: Create PRDs interactively</li> <li>YAML Import/Export: Import existing PRDs or export for version control</li> <li>Syntax Validation: Real-time validation of PRD format</li> <li>Templates: Start from common patterns</li> </ul>"},{"location":"features/ralph/#execution-monitor","title":"Execution Monitor","text":"<ul> <li>Live Logs: Real-time output from Ralph's execution</li> <li>Story Status: Visual indicators for pending/running/passed/failed</li> <li>Iteration Count: Track retry attempts per story</li> <li>Context Usage: Monitor token usage per story</li> </ul>"},{"location":"features/ralph/#agent-overview","title":"Agent Overview","text":"<ul> <li>Active Agents: See which OpenCode instances are running</li> <li>Task Queue: View pending stories</li> <li>Progress Metrics: Pass rate, average iterations, time per story</li> </ul>"},{"location":"features/ralph/#rlm-integration","title":"RLM Integration","text":"<p>Ralph leverages RLM (Recursive Language Models) for large codebase analysis:</p>"},{"location":"features/ralph/#when-rlm-activates","title":"When RLM Activates","text":"<ul> <li>Context exceeds configurable threshold (default: 80K tokens)</li> <li>Analyzing complex multi-file changes</li> <li>Understanding large dependency graphs</li> </ul>"},{"location":"features/ralph/#benefits","title":"Benefits","text":"<ul> <li>No Context Limits: Process arbitrarily large codebases</li> <li>Preserved Progress: Context from <code>progress.txt</code> carries across iterations</li> <li>Intelligent Chunking: Automatically breaks down complex analysis</li> </ul>"},{"location":"features/ralph/#configuration","title":"Configuration","text":"<pre><code># Enable RLM for Ralph\nexport OPENCODE_RLM_ENABLED=1\n\n# Model for subcalls\nexport A2A_RLM_DEFAULT_SUBCALL_MODEL_REF=\"zai:glm-4.7\"\n\n# Guardrails\nexport A2A_RLM_MAX_SUBCALLS_PER_ITERATION=5\nexport A2A_RLM_MAX_TOTAL_SUBCALLS=100\n</code></pre>"},{"location":"features/ralph/#configuration_1","title":"Configuration","text":""},{"location":"features/ralph/#environment-variables","title":"Environment Variables","text":"Variable Default Description <code>RALPH_ENABLED</code> <code>1</code> Enable Ralph in dashboard <code>RALPH_MAX_ITERATIONS</code> <code>5</code> Max retries per story <code>RALPH_COMMIT_ON_PASS</code> <code>1</code> Auto-commit on success <code>RALPH_BRANCH_PREFIX</code> <code>ralph/</code> Branch name prefix"},{"location":"features/ralph/#dashboard-settings","title":"Dashboard Settings","text":"<p>Configure in <code>/dashboard/ralph</code>:</p> <ul> <li>Model Selection: Choose which LLM powers Ralph</li> <li>Auto-commit: Toggle automatic commits</li> <li>Branch Strategy: Configure branch naming</li> <li>Notification Settings: Email on completion/failure</li> </ul>"},{"location":"features/ralph/#best-practices","title":"Best Practices","text":""},{"location":"features/ralph/#writing-effective-prds","title":"Writing Effective PRDs","text":"<ol> <li>Specific Acceptance Criteria: Be precise about what \"done\" looks like</li> <li>Testable Conditions: Criteria should be verifiable by Ralph</li> <li>Incremental Stories: Build complexity gradually</li> <li>Clear Dependencies: Order stories logically</li> </ol>"},{"location":"features/ralph/#good-example","title":"Good Example","text":"<pre><code>userStories:\n  - id: US-001\n    title: Add email validation\n    acceptanceCriteria:\n      - Function validates email format using regex\n      - Returns true for valid emails like user@example.com\n      - Returns false for invalid emails like \"not-an-email\"\n      - Unit test exists and passes\n</code></pre>"},{"location":"features/ralph/#poor-example","title":"Poor Example","text":"<pre><code>userStories:\n  - id: US-001\n    title: Make it work\n    acceptanceCriteria:\n      - Feature is complete\n      - No bugs\n</code></pre>"},{"location":"features/ralph/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/ralph/#story-keeps-failing","title":"Story Keeps Failing","text":"<ol> <li>Check criteria specificity: Are criteria testable?</li> <li>Review progress.txt: What is Ralph learning?</li> <li>Lower max iterations: Fail fast to diagnose issues</li> </ol>"},{"location":"features/ralph/#context-overflow","title":"Context Overflow","text":"<ol> <li>Enable RLM: Set <code>OPENCODE_RLM_ENABLED=1</code></li> <li>Split large stories: Break into smaller units</li> <li>Increase threshold: Adjust RLM trigger threshold</li> </ol>"},{"location":"features/ralph/#git-conflicts","title":"Git Conflicts","text":"<ol> <li>Clean working directory: Ensure no uncommitted changes</li> <li>Fresh branch: Use unique branch names</li> <li>Review commits: Check Ralph's commit messages</li> </ol>"},{"location":"features/ralph/#api-reference","title":"API Reference","text":""},{"location":"features/ralph/#start-ralph-run","title":"Start Ralph Run","text":"<pre><code>POST /v1/ralph/runs\nContent-Type: application/json\n\n{\n  \"codebase_id\": \"cb_abc123\",\n  \"prd\": \"...(YAML string)...\",\n  \"config\": {\n    \"max_iterations\": 5,\n    \"auto_commit\": true\n  }\n}\n</code></pre>"},{"location":"features/ralph/#get-run-status","title":"Get Run Status","text":"<pre><code>GET /v1/ralph/runs/{run_id}\n</code></pre>"},{"location":"features/ralph/#list-runs","title":"List Runs","text":"<pre><code>GET /v1/ralph/runs?codebase_id=cb_abc123\n</code></pre>"},{"location":"features/ralph/#cancel-run","title":"Cancel Run","text":"<pre><code>POST /v1/ralph/runs/{run_id}/cancel\n</code></pre>"},{"location":"features/ralph/#next-steps","title":"Next Steps","text":"<ul> <li>OpenCode Integration - Learn about OpenCode features</li> <li>RLM Guide - Deep dive into RLM</li> <li>Agent Worker - Deploy workers for Ralph</li> </ul>"},{"location":"features/sessions/","title":"Session Management","text":"<p>CodeTether provides comprehensive session management for AI agent conversations.</p>"},{"location":"features/sessions/#features","title":"Features","text":"<ul> <li>Session History - View past conversations</li> <li>Session Resumption - Continue where you left off</li> <li>Cross-device Sync - Access sessions from anywhere</li> </ul>"},{"location":"features/sessions/#api","title":"API","text":"<pre><code># List sessions\nGET /v1/opencode/codebases/{id}/sessions\n\n# Sync from OpenCode\nPOST /v1/opencode/codebases/{id}/sessions/sync\n</code></pre> <p>See OpenCode API for details.</p>"},{"location":"features/streaming/","title":"Real-time Streaming","text":"<p>CodeTether provides real-time streaming of agent output via Server-Sent Events (SSE).</p>"},{"location":"features/streaming/#connecting","title":"Connecting","text":"<pre><code>const events = new EventSource('/v1/opencode/codebases/{id}/events');\n\nevents.onmessage = (e) =&gt; {\n  console.log(JSON.parse(e.data));\n};\n</code></pre>"},{"location":"features/streaming/#event-types","title":"Event Types","text":"<ul> <li><code>output</code> - Agent text output</li> <li><code>tool_use</code> - Tool invocation</li> <li><code>file_change</code> - File modifications</li> <li><code>complete</code> - Task completed</li> <li><code>error</code> - Error occurred</li> </ul> <p>See SSE Events for details.</p>"},{"location":"features/voice-agent/","title":"Voice Agent","text":"<p>The CodeTether Voice Agent enables real-time voice interactions with AI agents through LiveKit integration.</p>"},{"location":"features/voice-agent/#overview","title":"Overview","text":"<p>The voice agent provides: - Real-time voice streaming via LiveKit - Session playback for reviewing conversations - Multi-model support (Claude, GPT-4, Gemini, Grok) - Voice selector for choosing different AI voice models - Playback controls (pause, resume, speed adjustment)</p>"},{"location":"features/voice-agent/#installation","title":"Installation","text":""},{"location":"features/voice-agent/#via-helm-chart","title":"Via Helm Chart","text":"<pre><code>helm install codetether-voice-agent oci://registry.quantum-forge.net/library/codetether-voice-agent \\\n  --namespace codetether --create-namespace\n</code></pre>"},{"location":"features/voice-agent/#from-source","title":"From Source","text":"<pre><code>cd codetether_voice_agent\npip install -r requirements.txt\n</code></pre>"},{"location":"features/voice-agent/#configuration","title":"Configuration","text":"<p>Environment variables:</p> Variable Description Default <code>LIVEKIT_URL</code> LiveKit server URL <code>wss://livekit.codetether.run</code> <code>LIVEKIT_API_KEY</code> LiveKit API key - <code>LIVEKIT_API_SECRET</code> LiveKit API secret - <code>VOICE_MODEL</code> Default AI voice model <code>claude-opus</code>"},{"location":"features/voice-agent/#usage","title":"Usage","text":""},{"location":"features/voice-agent/#web-ui-integration","title":"Web UI Integration","text":"<p>The voice agent integrates with the CodeTether dashboard:</p> <pre><code>import { VoiceAssistantUI } from '@/components/voice/VoiceAssistantUI';\n\n&lt;VoiceAssistantUI sessionId={session.id} /&gt;\n</code></pre>"},{"location":"features/voice-agent/#swift-iosmacos-app","title":"Swift iOS/macOS App","text":"<pre><code>import A2AMonitor\n\nlet voiceManager = VoiceSessionManager()\nawait voiceManager.connect(sessionId: \"session-123\")\n</code></pre>"},{"location":"features/voice-agent/#supported-voice-models","title":"Supported Voice Models","text":"<ul> <li>Claude (Opus, Sonnet, Haiku)</li> <li>GPT-4, GPT-4 Turbo</li> <li>Gemini Pro, Gemini Flash</li> <li>Grok 3</li> </ul>"},{"location":"features/voice-agent/#session-playback","title":"Session Playback","text":"<p>Review past voice conversations:</p> <pre><code>GET /v1/voice/sessions/{id}/playback\n</code></pre> <p>Returns: - Audio recordings - Transcript - Agent responses - Timestamps</p>"},{"location":"features/voice-agent/#architecture","title":"Architecture","text":"<pre><code>Client (Web/Mobile)\n    \u2193 (WebSocket)\nLiveKit Server\n    \u2193\nVoice Agent (Python)\n    \u2193 (MCP)\nA2A Server \u2192 Agent LLM\n</code></pre>"},{"location":"features/voice-agent/#api-endpoints","title":"API Endpoints","text":"Endpoint Method Description <code>/v1/voice/sessions</code> POST Create voice session <code>/v1/voice/sessions/{id}</code> GET Get session details <code>/v1/voice/sessions/{id}/playback</code> GET Get playback data <code>/v1/voice/models</code> GET List available models"},{"location":"features/voice-agent/#fine-tuning","title":"Fine-Tuning","text":"<p>The voice agent includes fine-tuning capabilities:</p> <pre><code>cd codetether_voice_agent/finetuning\npip install -r requirements.txt\npython finetune.py --data training_examples.jsonl\n</code></pre> <p>See finetuning/README.md for details.</p>"},{"location":"features/voice-agent/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/voice-agent/#audio-not-playing","title":"Audio not playing?","text":"<p>Check LiveKit connectivity: <pre><code>curl https://livekit.codetether.run/health\n</code></pre></p>"},{"location":"features/voice-agent/#no-voice-response","title":"No voice response?","text":"<p>Verify model credentials: <pre><code>cat ~/.local/share/opencode/auth.json\n</code></pre></p>"},{"location":"features/voice-agent/#session-sync-issues","title":"Session sync issues?","text":"<p>Restart the voice agent: <pre><code>kubectl rollout restart deployment/codetether-voice-agent\n</code></pre></p>"},{"location":"features/voice-agent/#see-also","title":"See Also","text":"<ul> <li>Session Management</li> <li>Real-time Streaming</li> <li>OpenCode Integration</li> </ul>"},{"location":"features/worker-sse/","title":"Worker SSE Push Notifications","text":"<p>Worker SSE (Server-Sent Events) enables push-based task distribution, allowing workers to receive tasks in real-time without polling.</p>"},{"location":"features/worker-sse/#overview","title":"Overview","text":"<p>Traditional workers poll the server for new tasks at intervals. SSE push notifications:</p> <ul> <li>Instant task delivery when tasks are created</li> <li>Reduced server load - no polling overhead</li> <li>Lower latency - workers start tasks immediately</li> <li>Connection management - automatic reconnection on failure</li> </ul>"},{"location":"features/worker-sse/#architecture","title":"Architecture","text":"<pre><code>A2A Server\n    \u2193 (SSE Push)\nWorker 1 (connected)\nWorker 2 (connected)\nWorker 3 (connected)\n</code></pre>"},{"location":"features/worker-sse/#how-it-works","title":"How It Works","text":"<ol> <li>Worker connects to SSE endpoint: <code>GET /v1/worker/tasks/stream</code></li> <li>Server keeps connection open indefinitely</li> <li>When task created \u2192 Server pushes event to all connected workers</li> <li>Workers receive <code>{ \"type\": \"task_available\", \"task_id\": \"...\" }</code></li> <li>First worker to claim task gets it (race condition handled)</li> </ol>"},{"location":"features/worker-sse/#worker-sse-client","title":"Worker SSE Client","text":""},{"location":"features/worker-sse/#python-implementation","title":"Python Implementation","text":"<pre><code>import requests\n\ndef connect_sse_worker(worker_id: str, server_url: str = \"http://localhost:8000\"):\n    \"\"\"Connect to SSE endpoint and listen for task notifications.\"\"\"\n    url = f\"{server_url}/v1/worker/tasks/stream\"\n    headers = {\n        \"X-Codebases\": \"my-project,api\",\n        \"X-Capabilities\": \"opencode,build,deploy,test\"\n    }\n\n    with requests.get(url, headers=headers, params={\"worker_id\": worker_id}, stream=True) as response:\n        for line in response.iter_lines():\n            if line:\n                event = parse_sse_event(line)\n                handle_event(event)\n\ndef parse_sse_event(line: bytes) -&gt; dict:\n    \"\"\"Parse SSE event line.\"\"\"\n    if line.startswith(b\"event: \"):\n        event_type = line[7:].decode().strip()\n        return {\"event\": event_type}\n    if line.startswith(b\"data: \"):\n        return json.loads(line[6:])\n    return {}\n\ndef handle_event(event: dict):\n    \"\"\"Handle incoming SSE event.\"\"\"\n    event_type = event.get(\"event\")\n    data = event.get(\"data\", {})\n\n    if event_type == \"task_available\":\n        task_id = data.get(\"task_id\")\n        print(f\"New task available: {task_id}\")\n        claim_and_execute_task(task_id)\n</code></pre> <p>See examples/worker_sse_client.py for a complete example.</p>"},{"location":"features/worker-sse/#sse-event-types","title":"SSE Event Types","text":"Event Type Description Payload <code>task_available</code> New task available for assignment <code>{ \"task_id\": \"uuid\", \"title\": \"...\", \"priority\": 0, \"codebase_id\": \"...\" }</code> <code>task</code> Task details pushed to worker Full task object <code>connected</code> Connection established <code>{ \"message\": \"...\" }</code> <code>keepalive</code> Connection keepalive <code>{}</code> (sent every 30s) <code>error</code> Error occurred <code>{ \"message\": \"...\" }</code>"},{"location":"features/worker-sse/#server-configuration","title":"Server Configuration","text":""},{"location":"features/worker-sse/#enable-sse","title":"Enable SSE","text":"<p>SSE is enabled by default. Configure via environment variables:</p> Variable Description Default <code>WORKER_SSE_ENABLED</code> Enable SSE endpoint <code>true</code> <code>WORKER_SSE_KEEPALIVE</code> Keepalive interval (seconds) <code>30</code> <code>WORKER_SSE_TIMEOUT</code> Worker idle timeout (seconds) <code>300</code>"},{"location":"features/worker-sse/#task-creation-hook","title":"Task Creation Hook","text":"<p>When SSE is enabled, tasks are automatically pushed to workers:</p> <pre><code>from a2a_server.worker_sse import setup_task_creation_hook\n\n# Hook is automatically called when task is created\nsetup_task_creation_hook(task_manager, notify_workers_of_new_task)\n</code></pre>"},{"location":"features/worker-sse/#connecting-workers","title":"Connecting Workers","text":""},{"location":"features/worker-sse/#registration","title":"Registration","text":"<p>Workers register to receive SSE notifications:</p> <pre><code># Register worker and get worker ID\ncurl -X POST http://localhost:8000/v1/opencode/workers/register \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"worker-123\",\n    \"capabilities\": [\"opencode\", \"build\", \"test\"],\n    \"hostname\": \"dev-vm.internal\"\n  }'\n</code></pre> <p>Response: <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"name\": \"worker-123\",\n  \"registered\": true\n}\n</code></pre></p>"},{"location":"features/worker-sse/#event-stream","title":"Event Stream","text":"<pre><code># Connect to SSE stream with headers for routing\ncurl -N \"http://localhost:8000/v1/worker/tasks/stream\" \\\n  -H \"X-Codebases: my-project,api\" \\\n  -H \"X-Capabilities: opencode,build,deploy,test\" \\\n  -H \"worker_id: worker-123\"\n</code></pre> <p>Output: <pre><code>event: connected\ndata: {\"message\":\"SSE connection established\"}\n\nevent: task_available\ndata: {\"task_id\":\"task-abc\",\"title\":\"Build component\",\"codebase_id\":\"my-project\",\"priority\":0}\n\nevent: task\ndata: {\"id\":\"task-abc\",\"title\":\"Build component\",...}\n\nevent: keepalive\ndata: {}\n</code></pre></p>"},{"location":"features/worker-sse/#automatic-reconnection","title":"Automatic Reconnection","text":"<p>Workers should implement exponential backoff reconnection:</p> <pre><code>import time\nimport requests\n\ndef connect_with_retry(worker_id: str, max_retries: int = 10):\n    retry_count = 0\n\n    while retry_count &lt; max_retries:\n        try:\n            return connect_sse_worker(worker_id)\n        except requests.exceptions.ConnectionError:\n            retry_count += 1\n            wait_time = min(2 ** retry_count, 60)  # Max 60s\n            print(f\"Connection lost, retrying in {wait_time}s...\")\n            time.sleep(wait_time)\n\n    raise Exception(\"Max retries exceeded\")\n</code></pre>"},{"location":"features/worker-sse/#task-routing","title":"Task Routing","text":"<p>Workers receive tasks based on:</p> <ol> <li>Codebase Matching: Tasks are routed to workers with matching <code>codebase_id</code></li> <li>Global Tasks: Tasks with <code>codebase_id: \"global\"</code> are sent to all workers</li> <li>Pending Registration: Tasks with <code>codebase_id: \"__pending__\"</code> can be claimed by any worker</li> </ol>"},{"location":"features/worker-sse/#header-based-routing","title":"Header-Based Routing","text":"<p>Workers send their registered codebases and capabilities via headers:</p> <pre><code>X-Codebases: my-project,api,backend\nX-Capabilities: opencode,build,deploy,test\n</code></pre> <p>The server uses these headers to route tasks to the appropriate workers.</p>"},{"location":"features/worker-sse/#monitoring","title":"Monitoring","text":""},{"location":"features/worker-sse/#connected-workers","title":"Connected Workers","text":"<pre><code># List connected workers\ncurl http://localhost:8000/v1/workers/connected\n\n# Output:\n# [\n#   {\"worker_id\": \"worker-123\", \"connected_at\": \"...\", \"last_heartbeat\": \"...\"},\n#   {\"worker_id\": \"worker-456\", \"connected_at\": \"...\", \"last_heartbeat\": \"...\"}\n# ]\n</code></pre>"},{"location":"features/worker-sse/#worker-status","title":"Worker Status","text":"<pre><code># Check specific worker status\ncurl http://localhost:8000/v1/workers/{worker_id}/status\n</code></pre>"},{"location":"features/worker-sse/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/worker-sse/#workers-not-receiving-tasks","title":"Workers not receiving tasks?","text":"<ol> <li> <p>Verify SSE endpoint health:    <pre><code>curl -N \"http://localhost:8000/v1/worker/tasks/stream\" \\\n  -H \"X-Codebases: test\" \\\n  -H \"X-Capabilities: opencode,build\" \\\n  -H \"worker_id: test\"\n</code></pre></p> </li> <li> <p>Check that workers are sending correct headers:</p> </li> <li><code>X-Codebases</code>: Comma-separated list of registered codebase IDs</li> <li> <p><code>X-Capabilities</code>: Comma-separated list of worker capabilities</p> </li> <li> <p>Verify worker registration:    <pre><code>curl http://localhost:8000/v1/opencode/workers\n</code></pre></p> </li> </ol>"},{"location":"features/worker-sse/#connection-drops-frequently","title":"Connection drops frequently?","text":"<p>Increase keepalive interval: <pre><code>export WORKER_SSE_KEEPALIVE=60\n</code></pre></p>"},{"location":"features/worker-sse/#tasks-not-being-pushed","title":"Tasks not being pushed?","text":"<p>Verify task creation hook is registered: <pre><code># Check logs\nkubectl logs deployment/a2a-server | grep \"worker_sse\"\n</code></pre></p>"},{"location":"features/worker-sse/#multiple-workers-claiming-same-task","title":"Multiple workers claiming same task?","text":"<p>This is expected behavior. Use the claim API to ensure atomic assignment: <pre><code>POST /v1/tasks/{task_id}/claim\n</code></pre></p>"},{"location":"features/worker-sse/#see-also","title":"See Also","text":"<ul> <li>Distributed Workers</li> <li>Agent Worker</li> <li>Task Management</li> </ul>"},{"location":"features/zapier/","title":"Zapier Integration","text":"<p>CodeTether's native Zapier integration lets you connect AI agent workflows to 5,000+ apps without writing code. Automate task creation, monitor completions, and integrate with your existing tools.</p> <p>No-Code Automation</p> <p>Create powerful AI agent workflows by connecting CodeTether to Slack, Email, Google Sheets, Notion, and thousands more\u2014all through Zapier's visual interface.</p>"},{"location":"features/zapier/#overview","title":"Overview","text":"<p>The Zapier integration provides:</p> <ul> <li>OAuth2 Authentication: Secure connection with Keycloak SSO</li> <li>Triggers: React to events like task creation and completion</li> <li>Actions: Create tasks, send messages, cancel tasks</li> <li>Searches: Find tasks by ID or status</li> </ul>"},{"location":"features/zapier/#getting-started","title":"Getting Started","text":""},{"location":"features/zapier/#1-connect-your-account","title":"1. Connect Your Account","text":"<ol> <li>In Zapier, search for \"CodeTether\"</li> <li>Click \"Connect\"</li> <li>Sign in with your CodeTether credentials (Keycloak)</li> <li>Authorize Zapier to access your account</li> </ol>"},{"location":"features/zapier/#2-create-your-first-zap","title":"2. Create Your First Zap","text":"<p>Example: Slack to AI Task</p> <ol> <li>Trigger: New message in Slack channel</li> <li>Action: Create task in CodeTether</li> <li>Result: AI agent processes the request</li> </ol>"},{"location":"features/zapier/#triggers","title":"Triggers","text":""},{"location":"features/zapier/#new-task","title":"New Task","text":"<p>Fires when a new task is created in CodeTether.</p> <p>Output Fields:</p> Field Type Description <code>task_id</code> string Unique task identifier <code>title</code> string Task title <code>status</code> string Current status (pending/running/completed/failed) <code>codebase_id</code> string Associated codebase <code>created_at</code> datetime Creation timestamp <code>agent_type</code> string Agent type (build/plan/general/explore) <p>Use Cases:</p> <ul> <li>Notify team in Slack when tasks are created</li> <li>Log all tasks to Google Sheets</li> <li>Create Jira tickets for tracking</li> </ul>"},{"location":"features/zapier/#task-completed","title":"Task Completed","text":"<p>Fires when a task completes successfully.</p> <p>Output Fields:</p> Field Type Description <code>task_id</code> string Task identifier <code>title</code> string Task title <code>result</code> string Task output/result <code>duration_seconds</code> number Execution time <code>completed_at</code> datetime Completion timestamp <p>Use Cases:</p> <ul> <li>Send completion notification via email</li> <li>Update project management tools</li> <li>Trigger follow-up workflows</li> </ul>"},{"location":"features/zapier/#task-failed","title":"Task Failed","text":"<p>Fires when a task fails.</p> <p>Output Fields:</p> Field Type Description <code>task_id</code> string Task identifier <code>error</code> string Error message <code>retry_count</code> number Number of retry attempts <code>failed_at</code> datetime Failure timestamp <p>Use Cases:</p> <ul> <li>Alert on-call engineer via PagerDuty</li> <li>Create incident in tracking system</li> <li>Retry with different parameters</li> </ul>"},{"location":"features/zapier/#actions","title":"Actions","text":""},{"location":"features/zapier/#create-task","title":"Create Task","text":"<p>Create a new AI agent task.</p> <p>Input Fields:</p> Field Required Type Description <code>title</code> Yes string Task title <code>prompt</code> Yes string Instructions for the AI agent <code>codebase_id</code> No string Target codebase (uses global if not specified) <code>agent_type</code> No string Agent type (default: build) <code>model</code> No string LLM model to use <code>priority</code> No number Task priority (higher = more urgent) <p>Example Zap:</p> <pre><code>Trigger: New email with subject containing \"AI Task\"\nAction: Create Task\n  - title: {{email_subject}}\n  - prompt: {{email_body}}\n  - agent_type: build\n</code></pre>"},{"location":"features/zapier/#send-message","title":"Send Message","text":"<p>Send a message to an existing conversation/session.</p> <p>Input Fields:</p> Field Required Type Description <code>message</code> Yes string Message content <code>conversation_id</code> No string Existing conversation to continue <code>codebase_id</code> No string Target codebase <p>Example Zap:</p> <pre><code>Trigger: New Slack message in #ai-tasks\nAction: Send Message\n  - message: {{message_text}}\n  - conversation_id: {{thread_ts}}\n</code></pre>"},{"location":"features/zapier/#cancel-task","title":"Cancel Task","text":"<p>Cancel a running or pending task.</p> <p>Input Fields:</p> Field Required Type Description <code>task_id</code> Yes string Task to cancel <p>Example Zap:</p> <pre><code>Trigger: Slack reaction added (\ud83d\uded1)\nAction: Cancel Task\n  - task_id: {{original_message_task_id}}\n</code></pre>"},{"location":"features/zapier/#searches","title":"Searches","text":""},{"location":"features/zapier/#find-task","title":"Find Task","text":"<p>Search for a task by ID or status.</p> <p>Input Fields:</p> Field Required Type Description <code>task_id</code> No string Exact task ID <code>status</code> No string Filter by status <code>codebase_id</code> No string Filter by codebase <p>Output:</p> <p>Returns matching task(s) with full details.</p> <p>Example Zap:</p> <pre><code>Trigger: Scheduled (every hour)\nSearch: Find Task\n  - status: failed\nAction: Send email with failed tasks\n</code></pre>"},{"location":"features/zapier/#popular-automations","title":"Popular Automations","text":""},{"location":"features/zapier/#slack-ai-development","title":"Slack \u2192 AI Development","text":"<pre><code>When: New message in #dev-requests\nThen: Create CodeTether task\nThen: Send Slack reply with task ID\n</code></pre>"},{"location":"features/zapier/#email-code-review","title":"Email \u2192 Code Review","text":"<pre><code>When: Email received with subject \"Review:\"\nThen: Create task with agent_type: plan\nThen: Send review results via email\n</code></pre>"},{"location":"features/zapier/#github-issue-ai-fix","title":"GitHub Issue \u2192 AI Fix","text":"<pre><code>When: GitHub issue labeled \"ai-fix\"\nThen: Create CodeTether task with issue description\nThen: Comment on issue with task link\n</code></pre>"},{"location":"features/zapier/#daily-summary","title":"Daily Summary","text":"<pre><code>When: Every day at 9am\nSearch: Find tasks completed yesterday\nThen: Send digest to Slack #team-updates\n</code></pre>"},{"location":"features/zapier/#configuration","title":"Configuration","text":""},{"location":"features/zapier/#oauth2-scopes","title":"OAuth2 Scopes","text":"<p>The Zapier app requests these scopes:</p> Scope Description <code>tasks:read</code> List and view tasks <code>tasks:write</code> Create and cancel tasks <code>messages:write</code> Send messages <code>codebases:read</code> List codebases"},{"location":"features/zapier/#rate-limits","title":"Rate Limits","text":"Tier Requests/minute Concurrent tasks Free 60 5 Pro 300 25 Enterprise Unlimited Unlimited"},{"location":"features/zapier/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/zapier/#authentication-failed","title":"Authentication Failed","text":"<ol> <li>Re-authorize: Disconnect and reconnect in Zapier</li> <li>Check credentials: Verify your CodeTether login works</li> <li>Token expired: Zapier handles refresh automatically, but try reconnecting</li> </ol>"},{"location":"features/zapier/#task-not-created","title":"Task Not Created","text":"<ol> <li>Check required fields: Ensure title and prompt are provided</li> <li>Verify codebase exists: Use valid codebase_id or omit for global</li> <li>Review Zapier logs: Check the task history for errors</li> </ol>"},{"location":"features/zapier/#trigger-not-firing","title":"Trigger Not Firing","text":"<ol> <li>Verify connection: Test the connection in Zapier</li> <li>Check filters: Review any filter conditions</li> <li>Webhook delay: Allow up to 5 minutes for events</li> </ol>"},{"location":"features/zapier/#api-reference","title":"API Reference","text":"<p>For direct API access (beyond Zapier), see:</p> <ul> <li>REST API</li> <li>JSON-RPC API</li> <li>Authentication</li> </ul>"},{"location":"features/zapier/#next-steps","title":"Next Steps","text":"<ul> <li>Getting Started - Set up CodeTether</li> <li>Agent Worker - Deploy workers for task execution</li> <li>Ralph - Autonomous development with PRDs</li> </ul>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>CodeTether Server is configured primarily through environment variables, making it easy to deploy in containers and Kubernetes.</p>"},{"location":"getting-started/configuration/#quick-reference","title":"Quick Reference","text":"<pre><code># Core Server\nexport A2A_HOST=0.0.0.0\nexport A2A_PORT=8000\nexport A2A_LOG_LEVEL=INFO\n\n# Agent Identity\nexport A2A_AGENT_NAME=\"My Agent\"\nexport A2A_AGENT_DESCRIPTION=\"Production agent server\"\n\n# Redis (for distributed workers)\nexport A2A_REDIS_URL=redis://localhost:6379\n\n# Authentication\nexport A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:secret-token-1,worker:secret-token-2\"\n\n# Keycloak OIDC\nexport KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=codetether\nexport KEYCLOAK_CLIENT_SECRET=your-secret\n\n# MCP Server\nexport MCP_HTTP_ENABLED=true\nexport MCP_HTTP_HOST=0.0.0.0\nexport MCP_HTTP_PORT=9000\n\n# OpenCode Integration\nexport OPENCODE_DB_PATH=/data/opencode.db\nexport OPENCODE_HOST=localhost\nexport OPENCODE_PORT=9777\n\n# LiveKit (for media)\nexport LIVEKIT_URL=wss://live.example.com\nexport LIVEKIT_API_KEY=your-api-key\nexport LIVEKIT_API_SECRET=your-api-secret\n\n# MinIO (for artifacts)\nexport MINIO_ENDPOINT=minio.example.com:9000\nexport MINIO_ACCESS_KEY=your-access-key\nexport MINIO_SECRET_KEY=your-secret-key\nexport MINIO_BUCKET=codetether\nexport MINIO_SECURE=true\n</code></pre>"},{"location":"getting-started/configuration/#configuration-categories","title":"Configuration Categories","text":""},{"location":"getting-started/configuration/#core-server-settings","title":"Core Server Settings","text":"Variable Default Description <code>A2A_HOST</code> <code>0.0.0.0</code> Host to bind the server to <code>A2A_PORT</code> <code>8000</code> Port for the A2A API <code>A2A_LOG_LEVEL</code> <code>INFO</code> Logging level (DEBUG, INFO, WARNING, ERROR)"},{"location":"getting-started/configuration/#agent-identity","title":"Agent Identity","text":"Variable Default Description <code>A2A_AGENT_NAME</code> <code>A2A Server</code> Name shown in agent card <code>A2A_AGENT_DESCRIPTION</code> \u2014 Description of the agent's capabilities <code>A2A_AGENT_ORG</code> <code>A2A Server</code> Organization name <code>A2A_AGENT_ORG_URL</code> GitHub URL Organization URL"},{"location":"getting-started/configuration/#redis-configuration","title":"Redis Configuration","text":"<p>Redis is required for distributed workers and task queuing.</p> Variable Default Description <code>A2A_REDIS_URL</code> <code>redis://localhost:6379</code> Redis connection URL <p>Redis URL Format</p> <pre><code>redis://[[username]:[password]@]host[:port][/database]\n</code></pre> <p>Examples: <pre><code>redis://localhost:6379\nredis://:password@redis.example.com:6379/0\nredis://user:pass@redis-cluster.example.com:6379\n</code></pre></p>"},{"location":"getting-started/configuration/#authentication","title":"Authentication","text":""},{"location":"getting-started/configuration/#token-authentication","title":"Token Authentication","text":"Variable Default Description <code>A2A_AUTH_ENABLED</code> <code>false</code> Enable token authentication <code>A2A_AUTH_TOKENS</code> \u2014 Comma-separated <code>name:token</code> pairs <p>Example: <pre><code>export A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:abc123,worker:def456,readonly:xyz789\"\n</code></pre></p>"},{"location":"getting-started/configuration/#keycloak-oidc","title":"Keycloak OIDC","text":"Variable Default Description <code>KEYCLOAK_URL</code> \u2014 Keycloak server URL <code>KEYCLOAK_REALM</code> \u2014 Keycloak realm name <code>KEYCLOAK_CLIENT_ID</code> \u2014 OIDC client ID <code>KEYCLOAK_CLIENT_SECRET</code> \u2014 OIDC client secret <code>KEYCLOAK_ADMIN_USERNAME</code> \u2014 Admin username (for user management) <code>KEYCLOAK_ADMIN_PASSWORD</code> \u2014 Admin password"},{"location":"getting-started/configuration/#mcp-server","title":"MCP Server","text":"<p>The MCP (Model Context Protocol) server provides tool integration.</p> Variable Default Description <code>MCP_HTTP_ENABLED</code> <code>true</code> Enable MCP HTTP server <code>MCP_HTTP_HOST</code> <code>0.0.0.0</code> MCP server host <code>MCP_HTTP_PORT</code> <code>9000</code> MCP server port"},{"location":"getting-started/configuration/#opencode-integration","title":"OpenCode Integration","text":"Variable Default Description <code>OPENCODE_HOST</code> <code>localhost</code> Host where OpenCode API is running <code>OPENCODE_PORT</code> <code>9777</code> OpenCode API port <code>OPENCODE_DB_PATH</code> <code>./data/opencode.db</code> SQLite database for OpenCode sessions <p>Docker Container Configuration</p> <p>When running CodeTether in Docker and connecting to OpenCode on your host:</p> <ul> <li>Docker Desktop (Mac/Windows): Use <code>OPENCODE_HOST=host.docker.internal</code></li> <li>Linux: Use <code>--add-host=host.docker.internal:host-gateway</code> and <code>OPENCODE_HOST=host.docker.internal</code></li> <li>Alternative: Use your host machine's actual IP address</li> </ul>"},{"location":"getting-started/configuration/#database","title":"Database","text":"Variable Default Description <code>DATABASE_URL</code> \u2014 PostgreSQL connection URL for durable persistence. Format: <code>postgresql://user:password@host:port/database</code>. When set, workers, codebases, tasks, and sessions survive server restarts and work across replicas. <code>A2A_DATABASE_URL</code> \u2014 Alias for <code>DATABASE_URL</code> <code>MONITOR_DB_PATH</code> <code>./data/monitor.db</code> SQLite database for monitoring data (fallback when PostgreSQL not configured) <code>SESSIONS_DB_PATH</code> \u2014 Database path for session persistence <p>PostgreSQL Connection URL Format</p> <pre><code>postgresql://[username]:[password]@host[:port]/database\n</code></pre> <p>Examples: <pre><code>postgresql://postgres:secret@localhost:5432/codetether\npostgresql://user:pass@db.example.com:5432/a2a_server\n</code></pre></p> <p>Storage Priority</p> <p>CodeTether uses a tiered storage approach:</p> <ol> <li>PostgreSQL (primary) - Durable persistence across restarts and replicas</li> <li>Redis - Fast shared state for multi-replica deployments</li> <li>In-memory - Single-instance fallback when neither is configured</li> </ol>"},{"location":"getting-started/configuration/#livekit-media","title":"LiveKit Media","text":"<p>For voice/video agent interactions.</p> Variable Default Description <code>LIVEKIT_URL</code> \u2014 LiveKit server WebSocket URL <code>LIVEKIT_API_KEY</code> \u2014 LiveKit API key <code>LIVEKIT_API_SECRET</code> \u2014 LiveKit API secret"},{"location":"getting-started/configuration/#minio-object-storage","title":"MinIO Object Storage","text":"<p>For storing large artifacts and files.</p> Variable Default Description <code>MINIO_ENDPOINT</code> \u2014 MinIO server endpoint <code>MINIO_ACCESS_KEY</code> \u2014 MinIO access key <code>MINIO_SECRET_KEY</code> \u2014 MinIO secret key <code>MINIO_BUCKET</code> <code>a2a-monitor</code> Default bucket name <code>MINIO_SECURE</code> <code>false</code> Use HTTPS for MinIO"},{"location":"getting-started/configuration/#worker-configuration","title":"Worker Configuration","text":"<p>For distributed agent workers:</p> Variable Default Description <code>A2A_SERVER_URL</code> <code>https://api.codetether.run</code> Server URL to connect to <code>A2A_WORKER_NAME</code> hostname Worker identifier <code>A2A_POLL_INTERVAL</code> <code>5</code> Task polling interval (seconds)"},{"location":"getting-started/configuration/#configuration-files","title":"Configuration Files","text":""},{"location":"getting-started/configuration/#env-file","title":"<code>.env</code> File","text":"<p>Create a <code>.env</code> file in the project root:</p> <pre><code># .env\nA2A_PORT=8000\nA2A_AGENT_NAME=Production Agent\nA2A_REDIS_URL=redis://redis:6379\nA2A_AUTH_ENABLED=true\nKEYCLOAK_URL=https://auth.example.com\nKEYCLOAK_REALM=production\nKEYCLOAK_CLIENT_ID=codetether\n</code></pre>"},{"location":"getting-started/configuration/#kubernetes-configmap","title":"Kubernetes ConfigMap","text":"<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: codetether-config\ndata:\n  A2A_HOST: \"0.0.0.0\"\n  A2A_PORT: \"8000\"\n  A2A_LOG_LEVEL: \"INFO\"\n  A2A_REDIS_URL: \"redis://redis:6379\"\n  MCP_HTTP_ENABLED: \"true\"\n  MCP_HTTP_PORT: \"9000\"\n</code></pre>"},{"location":"getting-started/configuration/#kubernetes-secret","title":"Kubernetes Secret","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: codetether-secrets\ntype: Opaque\nstringData:\n  A2A_AUTH_TOKENS: \"admin:super-secret-token\"\n  KEYCLOAK_CLIENT_SECRET: \"your-client-secret\"\n  MINIO_SECRET_KEY: \"your-minio-secret\"\n</code></pre>"},{"location":"getting-started/configuration/#validation","title":"Validation","text":"<p>CodeTether validates configuration on startup. Check the logs for any configuration issues:</p> <pre><code>codetether serve --port 8000\n# INFO: Configuration validated\n# INFO: Redis connection: OK\n# INFO: Keycloak: disabled\n# INFO: MCP Server: enabled on port 9000\n</code></pre>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 Run your first agent</li> <li>Keycloak Setup \u2014 Configure OIDC authentication</li> <li>Kubernetes Deployment \u2014 Deploy to production</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>CodeTether Server can be installed in several ways depending on your needs.</p>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10+ (for pip install)</li> <li>Docker 20.10+ (for container deployment)</li> <li>Redis 6+ (optional, for distributed workers)</li> </ul>"},{"location":"getting-started/installation/#install-via-pip-recommended","title":"Install via pip (recommended)","text":"<p>If you have a Python environment already set up, pip is the simplest option.</p> <pre><code>pip install codetether\n</code></pre> <p>Verify the installation:</p> <pre><code>codetether --version\n# 1.0.0\n</code></pre>"},{"location":"getting-started/installation/#install-from-github-pip","title":"Install from GitHub (pip)","text":"<p>If you want the latest code (or you're installing before a PyPI release is published):</p> <pre><code>pip install \"git+https://github.com/rileyseaburg/codetether.git@main\"\n</code></pre>"},{"location":"getting-started/installation/#one-line-install-shell","title":"One-line install (shell)","text":"<p>This installs CodeTether into a local virtual environment under <code>~/.codetether/venv</code> and links the CLI into <code>~/.local/bin</code>.</p> <pre><code>curl -fsSL https://raw.githubusercontent.com/rileyseaburg/codetether/main/scripts/install-codetether.sh | bash\n</code></pre>"},{"location":"getting-started/installation/#docker","title":"Docker","text":"<p>Pull the official image:</p> <pre><code>docker pull ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre> <p>Run the server:</p> <pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre> <p>With environment configuration:</p> <pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e A2A_AGENT_NAME=\"My Agent\" \\\n  -e REDIS_URL=\"redis://redis:6379\" \\\n  -e KEYCLOAK_URL=\"https://auth.example.com\" \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"getting-started/installation/#docker-compose","title":"Docker Compose","text":"<p>Create a <code>docker-compose.yml</code>:</p> <pre><code>version: '3.8'\n\nservices:\n  codetether:\n    image: ghcr.io/rileyseaburg/codetether-server:latest\n    ports:\n      - \"8000:8000\"  # A2A API\n      - \"9000:9000\"  # MCP Server\n    environment:\n      - A2A_AGENT_NAME=CodeTether Server\n      - REDIS_URL=redis://redis:6379\n      - LOG_LEVEL=INFO\n    depends_on:\n      - redis\n\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis-data:/data\n\nvolumes:\n  redis-data:\n</code></pre> <p>Start the stack:</p> <pre><code>docker-compose up -d\n</code></pre>"},{"location":"getting-started/installation/#from-source","title":"From Source","text":"<p>Clone the repository:</p> <pre><code>git clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n</code></pre> <p>Create a virtual environment:</p> <pre><code>python -m venv venv\nsource venv/bin/activate  # Linux/macOS\n# or\n.\\venv\\Scripts\\activate   # Windows\n</code></pre> <p>Install dependencies:</p> <pre><code>pip install -e .\n</code></pre> <p>Run the server:</p> <pre><code>codetether --port 8000\n</code></pre>"},{"location":"getting-started/installation/#opencode-local-fork","title":"OpenCode (Local Fork)","text":"<p>CodeTether includes a maintained fork of OpenCode in the <code>opencode/</code> directory. To build it:</p> <pre><code>cd opencode\n\n# Install dependencies\nbun install\n\n# Build the project\nbun run build\n\n# Verify installation\nopencode --version\n</code></pre> <p>For more details, see OpenCode Integration.</p>"},{"location":"getting-started/installation/#agent-worker-systemd-linux","title":"Agent Worker (systemd, Linux)","text":"<p>To execute OpenCode tasks on machines that host codebases, install the agent worker. First ensure you have built OpenCode from the local fork.</p> <pre><code>git clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n\nsudo ./agent_worker/install.sh\nsudo systemctl start a2a-agent-worker\nsudo journalctl -u a2a-agent-worker -f\n</code></pre>"},{"location":"getting-started/installation/#kubernetes-helm","title":"Kubernetes (Helm)","text":"<p>Add the Helm repository:</p> <pre><code>helm repo add codetether https://charts.codetether.run\nhelm repo update\n</code></pre> <p>Install the chart:</p> <pre><code>helm install codetether codetether/a2a-server \\\n  --namespace codetether \\\n  --create-namespace \\\n  --set ingress.enabled=true \\\n  --set ingress.hosts[0].host=codetether.example.com\n</code></pre> <p>See Kubernetes Deployment for full configuration options.</p>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Once installed, verify the server is running:</p> <pre><code># Check health endpoint\ncurl http://localhost:8000/health\n# {\"status\": \"healthy\", \"version\": \"1.0.0\"}\n\n# Check agent card (A2A discovery)\ncurl http://localhost:8000/.well-known/agent-card.json\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 Run your first agent task</li> <li>Configuration \u2014 Configure authentication, Redis, and more</li> <li>OpenCode Integration \u2014 Set up AI coding agents</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get CodeTether Server running and send your first task in 5 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10+ installed</li> <li><code>pip</code> package manager</li> </ul>"},{"location":"getting-started/quickstart/#step-1-install-codetether","title":"Step 1: Install CodeTether","text":"<pre><code>pip install codetether\n</code></pre>"},{"location":"getting-started/quickstart/#step-2-start-the-server","title":"Step 2: Start the Server","text":"<pre><code>codetether serve --port 8000\n</code></pre> <p>You should see:</p> <pre><code>INFO:     CodeTether Server starting...\nINFO:     A2A JSON-RPC endpoint: http://0.0.0.0:8000/v1/a2a (alias: /)\nINFO:     Agent Card: http://0.0.0.0:8000/.well-known/agent-card.json\nINFO:     Monitor UI: http://0.0.0.0:8000/v1/monitor/\nINFO:     Uvicorn running on http://0.0.0.0:8000\n</code></pre>"},{"location":"getting-started/quickstart/#step-3-discover-the-agent","title":"Step 3: Discover the Agent","text":"<p>Every A2A-compliant agent exposes an Agent Card at <code>/.well-known/agent-card.json</code>:</p> <pre><code>curl http://localhost:8000/.well-known/agent-card.json | jq\n</code></pre> <pre><code>{\n  \"name\": \"CodeTether Server\",\n  \"description\": \"Production A2A coordination server\",\n  \"url\": \"http://localhost:8000\",\n  \"version\": \"1.0.0\",\n  \"capabilities\": {\n    \"streaming\": true,\n    \"pushNotifications\": true,\n    \"stateTransitionHistory\": true\n  },\n  \"skills\": [\n    {\n      \"id\": \"task-coordination\",\n      \"name\": \"Task Coordination\",\n      \"description\": \"Coordinate tasks between multiple agents\"\n    }\n  ]\n}\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-send-a-task","title":"Step 4: Send a Task","text":"<p>Send your first task using the A2A JSON-RPC protocol:</p> <pre><code>curl -X POST http://localhost:8000/v1/a2a \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n        \"parts\": [{\"type\": \"text\", \"content\": \"Hello, CodeTether!\"}]\n      }\n    },\n    \"id\": \"task-001\"\n  }'\n</code></pre> <p>Response:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"result\": {\n    \"task\": {\n      \"id\": \"task-abc123\",\n      \"status\": \"completed\"\n    },\n    \"message\": {\n      \"parts\": [\n        {\"type\": \"text\", \"content\": \"Hello! I'm CodeTether Server, ready to coordinate your agents.\"}\n      ]\n    }\n  },\n  \"id\": \"task-001\"\n}\n</code></pre>"},{"location":"getting-started/quickstart/#step-5-open-the-monitor-ui","title":"Step 5: Open the Monitor UI","text":"<p>Open your browser to http://localhost:8000/v1/monitor/ to see:</p> <ul> <li>Connected agents</li> <li>Active tasks</li> <li>Real-time message streams</li> <li>System health</li> </ul>"},{"location":"getting-started/quickstart/#step-6-scale-with-distributed-workers","title":"Step 6: Scale with Distributed Workers","text":"<p>CodeTether is designed to scale. You can run Distributed Workers on any machine to execute tasks:</p> <ol> <li>Install the worker on a remote machine:     <pre><code>git clone https://github.com/rileyseaburg/codetether.git\ncd codetether &amp;&amp; sudo ./agent_worker/install.sh\n</code></pre></li> <li>Configure the worker to point to your server.</li> <li>Deploy Anywhere: Whether it's a local VM, a cloud instance, or a Kubernetes cluster, CodeTether workers can run anywhere they have outbound access to the server.</li> </ol> <p>Learn more in the Distributed Workers Guide and our Deployment Options.</p>"},{"location":"getting-started/quickstart/#using-the-python-client","title":"Using the Python Client","text":"<p>Install the client library:</p> <pre><code>pip install codetether\n</code></pre> <pre><code>from a2a_server import A2AClient\n\n# Connect to the server\nclient = A2AClient(\"http://localhost:8000\")\n\n# Send a task\nresult = client.send_task(\"Analyze this code for security issues\")\nprint(result.artifacts[0].text)\n\n# Stream responses\nfor chunk in client.send_task_streaming(\"Generate a report\"):\n    print(chunk, end=\"\", flush=True)\n</code></pre>"},{"location":"getting-started/quickstart/#using-with-opencode","title":"Using with OpenCode","text":"<p>If you have built OpenCode from the local fork (included in the <code>opencode/</code> directory), you can register codebases:</p> <pre><code># Register a codebase\ncurl -X POST http://localhost:8000/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"My awesome project\"\n  }'\n\n# Trigger an agent task\ncurl -X POST http://localhost:8000/v1/opencode/codebases/{codebase_id}/trigger \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"prompt\": \"Add unit tests for the authentication module\",\n    \"agent\": \"build\"\n  }'\n</code></pre>"},{"location":"getting-started/quickstart/#a2a-protocol-access","title":"A2A Protocol Access","text":"<p>CodeTether exposes standard A2A Protocol v0.3 endpoints:</p>"},{"location":"getting-started/quickstart/#discover-the-agent","title":"Discover the Agent","text":"<pre><code>curl https://api.codetether.run/.well-known/agent-card.json\n</code></pre>"},{"location":"getting-started/quickstart/#send-a-message-json-rpc","title":"Send a Message (JSON-RPC)","text":"<pre><code>curl -X POST https://api.codetether.run/a2a/jsonrpc \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"id\": 1,\n    \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [{\"text\": \"Hello, CodeTether!\"}]\n      }\n    }\n  }'\n</code></pre>"},{"location":"getting-started/quickstart/#use-official-a2a-client","title":"Use Official A2A Client","text":"<pre><code>from a2a.client import A2AClient\n\nclient = A2AClient(\"https://api.codetether.run\")\nresponse = await client.send_message(\"Hello from A2A client!\")\n</code></pre> <p>This makes CodeTether compatible with any A2A-compliant client or agent.</p>"},{"location":"getting-started/quickstart/#whats-next","title":"What's Next?","text":"<ul> <li> <p> Configure the Server</p> <p>Set up Redis, authentication, and more</p> <p> Configuration</p> </li> <li> <p> OpenCode Integration</p> <p>Bridge AI coding agents to your codebase</p> <p> OpenCode</p> </li> <li> <p> Deploy to Production</p> <p>Kubernetes, Helm charts, and scaling</p> <p> Deployment</p> </li> <li> <p> API Reference</p> <p>Full endpoint documentation</p> <p> API Docs</p> </li> </ul>"},{"location":"integrations/","title":"CodeTether Integration Documentation","text":"<p>Welcome to CodeTether's integration guides! This directory contains documentation for connecting CodeTether with popular automation platforms.</p>"},{"location":"integrations/#why-integrate","title":"Why Integrate?","text":"<p>CodeTether provides a powerful AI automation platform that can be integrated with: - Zapier - Create automated workflows - n8n - Build complex automation pipelines - Make (Integromat) - Connect apps and services - And more!</p>"},{"location":"integrations/#quick-start","title":"Quick Start","text":"<p>Choose your platform:</p> <ul> <li>Zapier Integration Guide</li> <li>n8n Integration Guide</li> <li>Make Integration Guide</li> </ul>"},{"location":"integrations/#key-concepts","title":"Key Concepts","text":""},{"location":"integrations/#authentication","title":"Authentication","text":"<p>CodeTether supports multiple authentication methods: - API Key - Simple Bearer token authentication (easiest) - OAuth 2.0 - For production integrations and public apps</p>"},{"location":"integrations/#webhook-vs-polling","title":"Webhook vs Polling","text":"<ul> <li>Webhooks - Recommended for real-time updates</li> <li>Polling - Alternative when webhooks aren't available</li> <li>See Async Polling Pattern for details</li> </ul>"},{"location":"integrations/#rate-limiting","title":"Rate Limiting","text":"<ul> <li>Default: 60 requests per minute</li> <li>Headers included: <code>X-RateLimit-Limit</code>, <code>X-RateLimit-Remaining</code>, <code>X-RateLimit-Reset</code></li> </ul>"},{"location":"integrations/#api-reference","title":"API Reference","text":""},{"location":"integrations/#base-url","title":"Base URL","text":"<pre><code>https://api.codetether.io/v1/automation\n</code></pre>"},{"location":"integrations/#endpoints","title":"Endpoints","text":"Endpoint Method Description <code>/tasks</code> POST Create a new task <code>/tasks/{id}</code> GET Get task status <code>/tasks</code> GET List tasks with filters"},{"location":"integrations/#supported-platforms","title":"Supported Platforms","text":""},{"location":"integrations/#zapier","title":"Zapier","text":"<ul> <li>Quick Start: Guide</li> <li>App Manifest: Manifest</li> <li>Webhooks support: \u2705</li> <li>Polling support: \u274c (Webhooks only)</li> </ul>"},{"location":"integrations/#n8n","title":"n8n","text":"<ul> <li>Quick Start: Guide</li> <li>Webhooks support: \u2705</li> <li>Polling support: \u2705</li> </ul>"},{"location":"integrations/#make","title":"Make","text":"<ul> <li>Quick Start: Guide</li> <li>Webhooks support: \u2705</li> <li>Polling support: \u2705</li> </ul>"},{"location":"integrations/#examples","title":"Examples","text":""},{"location":"integrations/#simple-task-creation","title":"Simple Task Creation","text":"<pre><code>curl -X POST https://api.codetether.io/v1/automation/tasks \\\n  -H \"Authorization: Bearer ct_your_api_key\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Analyze feedback\",\n    \"description\": \"Summarize this customer feedback...\",\n    \"agent_type\": \"general\",\n    \"model\": \"claude-sonnet\"\n  }'\n</code></pre>"},{"location":"integrations/#task-webhook-payload","title":"Task Webhook Payload","text":"<pre><code>{\n  \"event\": \"task_completed\",\n  \"task_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"status\": \"completed\",\n  \"result\": \"Summary of the analysis...\",\n  \"timestamp\": \"2025-01-19T10:35:00Z\"\n}\n</code></pre>"},{"location":"integrations/#webhook-signature-verification","title":"Webhook Signature Verification","text":"<p>For added security, configure a webhook signing secret:</p> <pre><code>export CODETETHER_WEBHOOK_SECRET=your_secret_here\n</code></pre> <p>Then verify signatures using HMAC-SHA256.</p>"},{"location":"integrations/#idempotency","title":"Idempotency","text":"<p>Prevent duplicate tasks with the <code>Idempotency-Key</code> header:</p> <pre><code>curl -X POST https://api.codetether.io/v1/automation/tasks \\\n  -H \"Authorization: Bearer ct_your_api_key\" \\\n  -H \"Idempotency-Key: &lt;uuid&gt;\" \\\n  ...\n</code></pre>"},{"location":"integrations/#getting-help","title":"Getting Help","text":"<ul> <li>Documentation: https://docs.codetether.io</li> <li>GitHub Issues: https://github.com/codetether/codetether/issues</li> <li>Community: Coming soon!</li> </ul>"},{"location":"integrations/#contributing","title":"Contributing","text":"<p>Found an issue or want to improve the docs? 1. Fork the repository 2. Edit the documentation 3. Submit a pull request</p>"},{"location":"integrations/#gap-analysis","title":"Gap Analysis","text":"<p>For details on current capabilities and planned features, see the Gap Analysis.</p>"},{"location":"integrations/async-polling-pattern/","title":"Async Polling Pattern","text":"<p>Use GET <code>/v1/automation/tasks/{task_id}</code> to poll for task status.</p>"},{"location":"integrations/async-polling-pattern/#status-values","title":"Status Values","text":"<ul> <li><code>queued</code> - Waiting to be processed</li> <li><code>running</code> - Currently executing</li> <li><code>needs_input</code> - Requires user input</li> <li><code>completed</code> - Finished successfully</li> <li><code>failed</code> - Task failed</li> <li><code>cancelled</code> - Task cancelled</li> </ul>"},{"location":"integrations/async-polling-pattern/#polling-loop","title":"Polling Loop","text":"<pre><code>while (retryCount &lt; maxRetries) {\n  const response = await fetch(`/tasks/${taskId}`);\n  const data = await response.json();\n\n  if (['completed', 'failed', 'cancelled'].includes(data.status)) {\n    return data;\n  }\n\n  await sleep(5000);\n}\n</code></pre>"},{"location":"integrations/async-polling-pattern/#platform-examples","title":"Platform Examples","text":"<p>n8n: Split in Batches \u2192 HTTP Request \u2192 Sleep \u2192 Filter (status check) \u2192 Loop</p> <p>Make: Iterator \u2192 Sleep \u2192 HTTP Request \u2192 Array Aggregator</p>"},{"location":"integrations/gap-analysis/","title":"Integration Gap Analysis","text":"<p>This document identifies gaps between CodeTether's current automation platform integration capabilities and the standards set by Zapier's \"Powered by Zapier\" platform (their embedded automation infrastructure).</p> <p>Reference Documentation Analyzed: - Zapier Workflow API - Zapier Action Runs - Zapier OAuth 2.0 Authentication - Zapier Rate Limiting - Zapier Quick Account Creation - Zapier Sponsor User Automation - Zapier AI Zap Guesser</p>"},{"location":"integrations/gap-analysis/#executive-summary","title":"Executive Summary","text":"<p>CodeTether has solid foundational infrastructure for integrations: - Webhook callbacks with retry support (3 attempts, exponential backoff) - Email notifications with reply-to continuation - Bearer token and Keycloak OIDC authentication - SSE streaming for real-time updates - REST and JSON-RPC APIs - User API keys with <code>ct_</code> prefix</p> <p>However, comparing to Zapier's \"Powered by Zapier\" platform reveals significant gaps:</p> Category CodeTether Zapier Standard Gap Severity API Simplicity Complex A2A/JSON-RPC Simple REST with OpenAPI High OAuth 2.0 Keycloak only Full OAuth 2.0 with scopes High Rate Limit Headers None <code>X-RateLimit-*</code> headers Medium Webhook Events Completion only Subscription-based events Medium Quick Account Creation None Frictionless signup flow Medium AI Workflow Suggestion None Zap Guesser API Low Sponsor/Embed Mode None Partner sponsors user costs High OpenAPI Spec None Full OpenAPI 3.1 High"},{"location":"integrations/gap-analysis/#gap-1-no-simple-rest-api-for-automation-platforms","title":"Gap 1: No Simple REST API for Automation Platforms","text":""},{"location":"integrations/gap-analysis/#current-state","title":"Current State","text":"<p>CodeTether exposes the A2A Protocol which uses JSON-RPC 2.0:</p> <pre><code># Current: Complex JSON-RPC\ncurl -X POST https://api.codetether.run/a2a/jsonrpc \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"message/send\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [{\"type\": \"text\", \"content\": \"Analyze this code\"}]\n      }\n    },\n    \"id\": \"1\"\n  }'\n</code></pre>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect","title":"What Automation Platforms Expect","text":"<p>Simple REST endpoints with intuitive payloads:</p> <pre><code># Expected: Simple REST\ncurl -X POST https://api.codetether.run/v1/tasks \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -d '{\n    \"prompt\": \"Analyze this code\",\n    \"callback_url\": \"https://hooks.zapier.com/...\",\n    \"notify_email\": \"user@example.com\"\n  }'\n</code></pre>"},{"location":"integrations/gap-analysis/#gap","title":"Gap","text":"<ul> <li>No <code>/v1/tasks</code> endpoint for simple task creation</li> <li>No simple prompt field - requires understanding A2A message structure</li> <li>Response format is A2A protocol objects, not simple JSON</li> </ul>"},{"location":"integrations/gap-analysis/#recommendation","title":"Recommendation","text":"<p>Create a simplified \"Automation API\" layer:</p> <pre><code># POST /v1/automation/tasks\n{\n    \"prompt\": \"string (required)\",\n    \"callback_url\": \"string (optional)\",\n    \"notify_email\": \"string (optional)\",\n    \"priority\": \"integer (optional, default 0)\",\n    \"metadata\": \"object (optional)\",\n    \"model\": \"string (optional, e.g. 'claude-sonnet', 'gpt-4')\"\n}\n\n# Response\n{\n    \"task_id\": \"uuid\",\n    \"run_id\": \"uuid\",\n    \"status\": \"queued\",\n    \"created_at\": \"ISO8601\",\n    \"estimated_completion\": \"ISO8601 (optional)\"\n}\n</code></pre>"},{"location":"integrations/gap-analysis/#gap-2-no-openapiswagger-specification","title":"Gap 2: No OpenAPI/Swagger Specification","text":""},{"location":"integrations/gap-analysis/#current-state_1","title":"Current State","text":"<ul> <li>API documented in markdown files</li> <li>No machine-readable spec</li> <li>No auto-generated client SDKs</li> </ul>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect_1","title":"What Automation Platforms Expect","text":"<ul> <li>OpenAPI 3.x spec at <code>/.well-known/openapi.json</code> or <code>/openapi.json</code></li> <li>Auto-discovery of endpoints, parameters, response schemas</li> <li>Zapier/n8n can auto-generate integrations from OpenAPI specs</li> </ul>"},{"location":"integrations/gap-analysis/#gap_1","title":"Gap","text":"<p>Without OpenAPI, every automation platform integration must be hand-coded.</p>"},{"location":"integrations/gap-analysis/#recommendation_1","title":"Recommendation","text":"<ol> <li>Add OpenAPI spec generation (FastAPI supports this natively)</li> <li>Expose at <code>/openapi.json</code> and <code>/.well-known/openapi.json</code></li> <li>Include authentication schemes in spec</li> </ol>"},{"location":"integrations/gap-analysis/#gap-3-limited-webhook-event-types","title":"Gap 3: Limited Webhook Event Types","text":""},{"location":"integrations/gap-analysis/#current-state_2","title":"Current State","text":"<p>Webhooks only fire on task completion:</p> <pre><code># Current webhook payload (hosted_worker.py:659-667)\npayload = {\n    'event': 'task_completed',\n    'run_id': run_id,\n    'task_id': task_id,\n    'status': status,\n    'result': result,\n    'error': error,\n    'timestamp': datetime.now(timezone.utc).isoformat(),\n}\n</code></pre>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect_2","title":"What Automation Platforms Expect","text":"<p>Multiple event types for workflow branching:</p> Event Description Use Case <code>task.created</code> Task was queued Trigger follow-up workflows <code>task.started</code> Worker claimed task Update status dashboards <code>task.progress</code> Intermediate output Stream results to user <code>task.completed</code> Task finished successfully Currently supported <code>task.failed</code> Task failed Error handling workflows <code>task.cancelled</code> Task was cancelled Cleanup workflows <code>task.needs_input</code> Agent needs user input Human-in-the-loop"},{"location":"integrations/gap-analysis/#gap_2","title":"Gap","text":"<ul> <li>Only <code>task_completed</code> event (covers both success and failure)</li> <li>No <code>task.started</code>, <code>task.progress</code>, <code>task.needs_input</code> events</li> <li>No webhook subscription management</li> </ul>"},{"location":"integrations/gap-analysis/#recommendation_2","title":"Recommendation","text":"<ol> <li>Add event type enum to webhook payloads</li> <li>Allow subscribing to specific event types</li> <li>Add webhook registration API:</li> </ol> <pre><code># POST /v1/webhooks\n{\n    \"url\": \"https://hooks.zapier.com/...\",\n    \"events\": [\"task.completed\", \"task.failed\"],\n    \"secret\": \"optional HMAC secret\"\n}\n</code></pre>"},{"location":"integrations/gap-analysis/#gap-4-no-webhook-signature-verification","title":"Gap 4: No Webhook Signature Verification","text":""},{"location":"integrations/gap-analysis/#current-state_3","title":"Current State","text":"<p>Webhooks are sent without signatures. Recipients cannot verify authenticity.</p>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect_3","title":"What Automation Platforms Expect","text":"<p>HMAC signatures for webhook verification (like Stripe, GitHub):</p> <pre><code>POST /webhook HTTP/1.1\nX-CodeTether-Signature: sha256=abc123...\nX-CodeTether-Timestamp: 1234567890\n\n{\"event\": \"task.completed\", ...}\n</code></pre>"},{"location":"integrations/gap-analysis/#gap_3","title":"Gap","text":"<ul> <li>No <code>X-CodeTether-Signature</code> header</li> <li>No timestamp for replay protection</li> <li>No webhook secret management</li> </ul>"},{"location":"integrations/gap-analysis/#recommendation_3","title":"Recommendation","text":"<ol> <li>Generate per-webhook secrets</li> <li>Sign payloads with HMAC-SHA256</li> <li>Include timestamp for replay protection</li> <li>Document verification in multiple languages</li> </ol>"},{"location":"integrations/gap-analysis/#gap-5-no-idempotency-support","title":"Gap 5: No Idempotency Support","text":""},{"location":"integrations/gap-analysis/#current-state_4","title":"Current State","text":"<p>Repeated POST requests create duplicate tasks.</p>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect_4","title":"What Automation Platforms Expect","text":"<p>Idempotency keys for safe retries:</p> <pre><code>curl -X POST https://api.codetether.run/v1/tasks \\\n  -H \"Idempotency-Key: zapier-trigger-abc123\" \\\n  -d '{\"prompt\": \"...\"}'\n</code></pre>"},{"location":"integrations/gap-analysis/#gap_4","title":"Gap","text":"<p>If Zapier retries a failed webhook, it creates duplicate tasks.</p>"},{"location":"integrations/gap-analysis/#recommendation_4","title":"Recommendation","text":"<ol> <li>Accept <code>Idempotency-Key</code> header</li> <li>Store keys with 24h TTL</li> <li>Return cached response for duplicate keys</li> </ol>"},{"location":"integrations/gap-analysis/#gap-6-no-rate-limit-headers","title":"Gap 6: No Rate Limit Headers","text":""},{"location":"integrations/gap-analysis/#current-state_5","title":"Current State","text":"<p>Rate limits exist but aren't communicated in responses.</p>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect_5","title":"What Automation Platforms Expect","text":"<p>Standard rate limit headers:</p> <pre><code>HTTP/1.1 200 OK\nX-RateLimit-Limit: 100\nX-RateLimit-Remaining: 95\nX-RateLimit-Reset: 1234567890\nRetry-After: 60  (when rate limited)\n</code></pre>"},{"location":"integrations/gap-analysis/#gap_5","title":"Gap","text":"<p>Automation platforms can't implement proper backoff without these headers.</p>"},{"location":"integrations/gap-analysis/#recommendation_5","title":"Recommendation","text":"<p>Add middleware to include rate limit headers on all responses.</p>"},{"location":"integrations/gap-analysis/#gap-7-no-integration-focused-documentation","title":"Gap 7: No Integration-Focused Documentation","text":""},{"location":"integrations/gap-analysis/#current-state_6","title":"Current State","text":"<p>Documentation is developer/operator focused: - A2A Protocol concepts - Kubernetes deployment - Keycloak configuration</p>"},{"location":"integrations/gap-analysis/#what-automation-platform-users-expect","title":"What Automation Platform Users Expect","text":"<ul> <li>Quick start for Zapier/n8n/Make</li> <li>Copy-paste webhook URLs</li> <li>Example Zaps/workflows</li> <li>Troubleshooting common issues</li> </ul>"},{"location":"integrations/gap-analysis/#gap_6","title":"Gap","text":"<p>No dedicated \"Integrations\" documentation section.</p>"},{"location":"integrations/gap-analysis/#recommendation_6","title":"Recommendation","text":"<p>Create <code>/integrations/</code> docs section with: - <code>zapier.md</code> - Step-by-step Zapier integration - <code>n8n.md</code> - n8n workflow examples - <code>make.md</code> - Make (Integromat) scenarios - <code>webhooks.md</code> - Generic webhook integration guide - <code>api-keys.md</code> - API key management for automations</p>"},{"location":"integrations/gap-analysis/#gap-8-authentication-gaps-for-automation","title":"Gap 8: Authentication Gaps for Automation","text":""},{"location":"integrations/gap-analysis/#current-state_7","title":"Current State","text":"<ul> <li>Bearer tokens via <code>A2A_AUTH_TOKENS</code> env var (shared)</li> <li>Keycloak OIDC (complex for automations)</li> <li>User API keys with <code>ct_</code> prefix (good!)</li> </ul>"},{"location":"integrations/gap-analysis/#what-automation-platforms-need","title":"What Automation Platforms Need","text":"<ul> <li>Per-integration API keys with scoped permissions</li> <li>OAuth 2.0 for Zapier/n8n native integrations</li> <li>API key in query string option (some platforms don't support headers well)</li> </ul>"},{"location":"integrations/gap-analysis/#gap_7","title":"Gap","text":"<ul> <li>No OAuth 2.0 client credentials flow</li> <li>No scoped API keys (all keys have full access)</li> <li>No query string auth option</li> </ul>"},{"location":"integrations/gap-analysis/#recommendation_7","title":"Recommendation","text":"<ol> <li>Implement OAuth 2.0 client credentials for platform integrations</li> <li>Add scope support to API keys: <code>tasks:read</code>, <code>tasks:write</code>, <code>webhooks:manage</code></li> <li>Support <code>?api_key=</code> query parameter (with appropriate warnings)</li> </ol>"},{"location":"integrations/gap-analysis/#gap-9-no-polling-endpoint-for-status","title":"Gap 9: No Polling Endpoint for Status","text":""},{"location":"integrations/gap-analysis/#current-state_8","title":"Current State","text":"<p>Status checking requires JSON-RPC:</p> <pre><code>curl -X POST https://api.codetether.run/a2a/jsonrpc \\\n  -d '{\"jsonrpc\":\"2.0\",\"method\":\"tasks/get\",\"params\":{\"id\":\"task-123\"},\"id\":\"1\"}'\n</code></pre>"},{"location":"integrations/gap-analysis/#what-automation-platforms-expect_6","title":"What Automation Platforms Expect","text":"<p>Simple GET endpoint:</p> <pre><code>curl https://api.codetether.run/v1/tasks/task-123\n</code></pre>"},{"location":"integrations/gap-analysis/#gap_8","title":"Gap","text":"<p>The REST binding exists at <code>/a2a/rest/tasks/{id}</code> but: - Not documented prominently - Returns A2A protocol format, not simple JSON</p>"},{"location":"integrations/gap-analysis/#recommendation_8","title":"Recommendation","text":"<p>Add <code>/v1/automation/tasks/{id}</code> with simple response:</p> <pre><code>{\n    \"task_id\": \"task-123\",\n    \"status\": \"completed\",\n    \"result\": \"Summary of what the agent did...\",\n    \"created_at\": \"2024-01-15T10:00:00Z\",\n    \"completed_at\": \"2024-01-15T10:05:00Z\"\n}\n</code></pre>"},{"location":"integrations/gap-analysis/#gap-10-no-powered-by-codetether-partner-model","title":"Gap 10: No \"Powered by CodeTether\" Partner Model","text":""},{"location":"integrations/gap-analysis/#what-zapier-offers","title":"What Zapier Offers","text":"<p>Zapier's \"Powered by Zapier\" allows partners to: 1. Embed Zapier UI - Pre-built workflow elements in partner's product 2. Sponsor User Automation - Partner pays for user's task usage 3. Quick Account Creation - Frictionless signup without leaving partner's app 4. Zap Guesser AI - Natural language \u2192 workflow suggestions</p> <pre><code># Zapier's Zap Guesser API\nPOST https://api.zapier.com/v2/guess\n{\n  \"description\": \"Save new leads from Facebook to Google Sheets\"\n}\n\n# Returns suggested workflow with prefilled editor URL\n{\n  \"title\": \"Save Facebook Lead Ads leads to Google Sheets\",\n  \"steps\": [...],\n  \"prefilled_url\": \"https://api.zapier.com/v1/embed/...\"\n}\n</code></pre>"},{"location":"integrations/gap-analysis/#current-state_9","title":"Current State","text":"<p>CodeTether has no equivalent partner/embed model.</p>"},{"location":"integrations/gap-analysis/#gap_9","title":"Gap","text":"<ul> <li>No embeddable UI components</li> <li>No partner billing/sponsorship model</li> <li>No \"Quick Account Creation\" flow</li> <li>No AI-powered workflow suggestions</li> </ul>"},{"location":"integrations/gap-analysis/#recommendation-future","title":"Recommendation (Future)","text":"<p>Consider building \"Powered by CodeTether\" for partners who want to embed AI agent capabilities: 1. Embeddable task creation widget 2. Partner billing API (sponsor user tasks) 3. White-label agent execution</p>"},{"location":"integrations/gap-analysis/#gap-11-no-zapier-app-in-zapier-directory","title":"Gap 11: No Zapier App in Zapier Directory","text":""},{"location":"integrations/gap-analysis/#current-state_10","title":"Current State","text":"<p>Users must configure raw HTTP webhooks to connect CodeTether to Zapier.</p>"},{"location":"integrations/gap-analysis/#what-would-significantly-improve-adoption","title":"What Would Significantly Improve Adoption","text":"<p>A native Zapier App in the Zapier App Directory with:</p> <p>Triggers: - \"New Task Completed\" - fires when an agent task finishes - \"Task Failed\" - fires on task failure - \"Task Needs Input\" - fires when agent requires human input</p> <p>Actions: - \"Create Task\" - submit a prompt to CodeTether - \"Get Task Status\" - check task progress - \"Cancel Task\" - cancel a running task</p> <p>Authentication: - OAuth 2.0 (required for public Zapier apps)</p>"},{"location":"integrations/gap-analysis/#gap_10","title":"Gap","text":"<p>No native Zapier integration - users must understand HTTP/webhooks.</p>"},{"location":"integrations/gap-analysis/#zapier-app-requirements-from-their-docs","title":"Zapier App Requirements (from their docs)","text":"<ol> <li>Must be a public integration in Zapier's App Directory</li> <li>Must support OAuth 2.0 authentication</li> <li>Must have OpenAPI spec for auto-discovery</li> <li>Must handle rate limiting with standard headers</li> </ol>"},{"location":"integrations/gap-analysis/#gap-12-no-async-action-run-pattern","title":"Gap 12: No Async Action Run Pattern","text":""},{"location":"integrations/gap-analysis/#what-zapier-implements","title":"What Zapier Implements","text":"<p>Zapier's Action Runs API uses an async pattern with polling:</p> <pre><code># 1. Create action run (returns immediately)\nPOST /v2/action-runs\n{\n  \"data\": {\n    \"action\": \"example_core:Vn7xbE60\",\n    \"authentication\": \"example_QVaAreV1\",\n    \"inputs\": {\"email\": \"me@example.com\"}\n  }\n}\n\n# Response (immediate)\n{\n  \"data\": {\n    \"type\": \"run\",\n    \"id\": \"123e4567-e89b-12d3-a456-426614174000\"\n  }\n}\n\n# 2. Poll for results\nGET /v2/action-runs/123e4567-e89b-12d3-a456-426614174000\n</code></pre>"},{"location":"integrations/gap-analysis/#current-state_11","title":"Current State","text":"<p>CodeTether supports this pattern via: - <code>POST /v1/opencode/codebases/{id}/tasks</code> (create) - <code>GET /v1/opencode/tasks/{id}</code> (poll)</p> <p>But the API is complex and not documented for this use case.</p>"},{"location":"integrations/gap-analysis/#gap_11","title":"Gap","text":"<p>The async pattern exists but: - Not documented as a simple integration pattern - Response format is complex (A2A protocol) - No simple \"run and poll\" example</p>"},{"location":"integrations/gap-analysis/#recommendation_9","title":"Recommendation","text":"<p>Document the existing async pattern prominently with simple examples.</p>"},{"location":"integrations/gap-analysis/#implementation-priority-updated-with-zapier-context","title":"Implementation Priority (Updated with Zapier Context)","text":"Gap Effort Impact Priority Gap 1: Simple REST API Medium High P0 Gap 2: OpenAPI Spec Low High P0 Gap 7: Integration Docs Low High P0 Gap 8: OAuth 2.0 (full) High Critical for Zapier P0 Gap 6: Rate Limit Headers Low Medium P1 Gap 3: Webhook Events Medium Medium P1 Gap 4: Webhook Signatures Low Medium P1 Gap 5: Idempotency Medium Medium P2 Gap 9: Simple Polling Low Medium P2 Gap 12: Async Pattern Docs Low Medium P2 Gap 11: Zapier App High Very High P3 Gap 10: Partner Embed Model Very High Strategic Future"},{"location":"integrations/gap-analysis/#quick-wins-can-ship-this-week","title":"Quick Wins (Can ship this week)","text":"<ol> <li>Enable FastAPI's built-in OpenAPI at <code>/openapi.json</code></li> <li>Add rate limit headers via middleware (Zapier expects <code>X-RateLimit-Limit</code>, <code>X-RateLimit-Remaining</code>, <code>X-RateLimit-Reset</code>, <code>Retry-After</code>)</li> <li>Document the existing REST binding (<code>/a2a/rest/tasks/{id}</code>)</li> <li>Create Zapier quick start guide with existing webhook capabilities</li> <li>Add <code>X-Request-ID</code> header to all responses for debugging</li> </ol>"},{"location":"integrations/gap-analysis/#what-zapier-requires-for-a-public-app","title":"What Zapier Requires for a Public App","text":"<p>To publish CodeTether as a Zapier App, we need:</p> Requirement Current State Action Needed OAuth 2.0 with authorization code flow Keycloak (complex) Add standard OAuth 2.0 OpenAPI 3.x specification None Enable FastAPI's built-in Rate limit headers None Add middleware Webhook triggers Partial (completion only) Add event subscriptions Idempotent actions None Add idempotency keys Error responses in JSON API format Partial Standardize error format <p>Reference: Zapier Integration Publishing Requirements</p>"},{"location":"integrations/gap-analysis/#appendix-a-current-webhook-payload","title":"Appendix A: Current Webhook Payload","text":"<pre><code>{\n    \"event\": \"task_completed\",\n    \"run_id\": \"uuid\",\n    \"task_id\": \"uuid\", \n    \"status\": \"completed|failed|cancelled\",\n    \"result\": \"Summary text or null\",\n    \"error\": \"Error message or null\",\n    \"timestamp\": \"ISO8601\"\n}\n</code></pre> <p>This payload is adequate but minimal. Consider adding: - <code>duration_seconds</code> - <code>worker_id</code> (for debugging) - <code>metadata</code> (user-provided context) - <code>artifacts</code> (list of generated files/outputs)</p>"},{"location":"integrations/gap-analysis/#appendix-b-zapier-api-examples-for-reference","title":"Appendix B: Zapier API Examples for Reference","text":""},{"location":"integrations/gap-analysis/#zapier-oauth-20-flow","title":"Zapier OAuth 2.0 Flow","text":"<pre><code># 1. Redirect user to authorize\nhttps://api.zapier.com/v2/authorize\n  ?response_type=code\n  &amp;client_id={CLIENT_ID}\n  &amp;redirect_uri={REDIRECT_URI}\n  &amp;scope=zap%20zap:write%20authentication\n  &amp;state={RANDOM_STRING}\n\n# 2. Exchange code for token\nPOST https://zapier.com/oauth/token/\n  -u {CLIENT_ID}:{CLIENT_SECRET}\n  -d \"grant_type=authorization_code&amp;code={CODE}&amp;redirect_uri={URI}\"\n\n# Response\n{\n  \"access_token\": \"jk8s9dGJK39JKD93jkd03JD\",\n  \"expires_in\": 36000,\n  \"token_type\": \"Bearer\",\n  \"scope\": \"zap zap:write authentication\",\n  \"refresh_token\": \"9D9oz2ZzaouT12LpvklQwNBf6s4vva\"\n}\n</code></pre>"},{"location":"integrations/gap-analysis/#zapier-rate-limiting","title":"Zapier Rate Limiting","text":"<ul> <li>60 requests/minute per IP</li> <li>150 requests/minute per partner</li> <li>Returns <code>429 Too Many Requests</code> with 60s cooldown</li> <li>Headers: <code>X-RateLimit-Limit</code>, <code>X-RateLimit-Remaining</code>, <code>X-RateLimit-Reset</code>, <code>Retry-After</code></li> </ul>"},{"location":"integrations/gap-analysis/#zapier-quick-account-creation","title":"Zapier Quick Account Creation","text":"<pre><code>&lt;zapier-workflow\n  sign-up-email=\"user@example.com\"\n  sign-up-first-name=\"John\"\n  sign-up-last-name=\"Doe\"\n  client-id=\"YOUR_CLIENT_ID\"\n&gt;&lt;/zapier-workflow&gt;\n</code></pre> <p>Users skip normal signup and go directly to workflow creation.</p>"},{"location":"integrations/make-quickstart/","title":"Make (Integromat) Integration Quick Start","text":"<p>Use HTTP modules and webhooks to connect CodeTether with Make.</p>"},{"location":"integrations/make-quickstart/#quick-start","title":"Quick Start","text":"<ol> <li>Create a Custom webhook module in Make</li> <li>Add an HTTP module to POST to <code>/v1/automation/tasks</code></li> <li>Use webhook URL in <code>webhook_url</code> parameter</li> <li>Process results in subsequent modules</li> </ol>"},{"location":"integrations/make-quickstart/#example","title":"Example","text":"<pre><code>Google Forms \u2192 HTTP (CodeTether) \u2192 Webhook \u2192 Google Sheets\n</code></pre>"},{"location":"integrations/make-quickstart/#authentication","title":"Authentication","text":"<p>Header: <code>Authorization: Bearer ct_your_api_key_here</code></p>"},{"location":"integrations/make-quickstart/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Check API key format (ct_*)</li> <li>Verify webhook is public</li> <li>Check scenario logs</li> </ul>"},{"location":"integrations/n8n-quickstart/","title":"n8n Integration Quick Start","text":"<p>This guide walks through connecting CodeTether to n8n for workflow automation.</p>"},{"location":"integrations/n8n-quickstart/#overview","title":"Overview","text":"<p>n8n can integrate with CodeTether using HTTP Request nodes. The integration supports creating tasks, polling for status, and receiving webhooks when tasks complete.</p>"},{"location":"integrations/n8n-quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>n8n instance (self-hosted or cloud)</li> <li>CodeTether instance (self-hosted or managed)</li> <li>CodeTether API key</li> </ul>"},{"location":"integrations/n8n-quickstart/#quick-start","title":"Quick Start","text":""},{"location":"integrations/n8n-quickstart/#option-1-webhook-based-recommended","title":"Option 1: Webhook-Based (Recommended)","text":"<p>Use webhooks for real-time updates when tasks complete.</p>"},{"location":"integrations/n8n-quickstart/#step-1-create-a-webhook-node-in-n8n","title":"Step 1: Create a Webhook Node in n8n","text":"<ol> <li>Add a new node: Webhook node</li> <li>Set path (e.g., <code>/codetether-callback</code>)</li> <li>Set method: POST</li> <li>Click \"Listen for Test Event\"</li> <li>Copy the webhook URL</li> </ol> <p>The URL will look like: <code>https://your-n8n-instance.com/webhook/codetether-callback</code></p>"},{"location":"integrations/n8n-quickstart/#step-2-create-a-task-in-codetether","title":"Step 2: Create a Task in CodeTether","text":"<p>Add an HTTP Request node before your webhook node:</p> <p>HTTP Request Node Configuration: - Method: POST - URL: <code>https://api.codetether.io/v1/automation/tasks</code> - Authentication: Generic Credential Type &gt; Header Auth - Body: JSON   <pre><code>{\n  \"title\": \"{{ $json.title }}\",\n  \"description\": \"{{ $json.description }}\",\n  \"agent_type\": \"general\",\n  \"model\": \"claude-sonnet\",\n  \"webhook_url\": \"https://your-n8n-instance.com/webhook/codetether-callback\"\n}\n</code></pre></p>"},{"location":"integrations/n8n-quickstart/#step-3-process-the-webhook-response","title":"Step 3: Process the Webhook Response","text":"<p>When CodeTether calls your webhook, you'll receive task completion data.</p>"},{"location":"integrations/n8n-quickstart/#example-workflows","title":"Example Workflows","text":""},{"location":"integrations/n8n-quickstart/#workflow-1-email-analysis","title":"Workflow 1: Email Analysis","text":"<pre><code>Gmail Trigger \u2192 Extract Body \u2192 Create CodeTether Task \u2192 Webhook \u2192 Process Result \u2192 Slack\n</code></pre>"},{"location":"integrations/n8n-quickstart/#authentication","title":"Authentication","text":"<p>Use Header Authentication with your API key starting with <code>ct_</code>:</p> <pre><code>Authorization: Bearer ct_your_api_key_here\n</code></pre>"},{"location":"integrations/n8n-quickstart/#troubleshooting","title":"Troubleshooting","text":"<ul> <li>Check API key format</li> <li>Verify webhook URL is public</li> <li>Check n8n execution logs</li> </ul>"},{"location":"integrations/zapier-app-manifest/","title":"Zapier App Manifest for CodeTether","text":"<p>Comprehensive Zapier platform app following Zapier best practices for create, search, and delete actions.</p>"},{"location":"integrations/zapier-app-manifest/#quick-start","title":"Quick Start","text":"<pre><code>npm install -g zapier-platform-cli\nzapier init codetether-app\ncd codetether-app\nzapier push\nzapier promote\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#authentication","title":"Authentication","text":"<p>Uses API key (Bearer token starting with <code>ct_</code>) for quick setup.</p> <p>Alternative: OAuth 2.0 for production integrations.</p>"},{"location":"integrations/zapier-app-manifest/#best-practices-followed","title":"Best Practices Followed","text":"<ol> <li>\u2705 Create actions return objects with individual fields</li> <li>\u2705 Search actions return sorted arrays  </li> <li>\u2705 Delete actions include Copy field for irreversible operations</li> <li>\u2705 4xx errors returned directly, 2xx fixed in API layer</li> <li>\u2705 Support for dynamic domain (self-hosted instances)</li> <li>\u2705 poll_task action for Looping by Zapier</li> </ol>"},{"location":"integrations/zapier-app-manifest/#project-structure","title":"Project Structure","text":"<pre><code>codetether-app/\n\u251c\u2500\u2500 index.js                 # Main app entry point\n\u251c\u2500\u2500 package.json             # App metadata\n\u251c\u2500\u2500 creates/\n\u2502   \u2514\u2500\u2500 create_task.js      # Create task action\n\u251c\u2500\u2500 searches/\n\u2502   \u251c\u2500\u2500 get_task_status.js    # Search for task by ID\n\u2502   \u251c\u2500\u2500 get_task_list.js      # Search for list of tasks\n\u2502   \u2514\u2500\u2500 poll_task.js         # Poll task until complete\n\u2514\u2500\u2500 deletes/\n    \u2514\u2500\u2500 cancel_task.js      # Cancel task action\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#indexjs","title":"index.js","text":"<pre><code>const getTaskStatus = require('./searches/get_task_status');\nconst getTaskList = require('./searches/get_task_list');\nconst pollTask = require('./searches/poll_task');\nconst createTask = require('./creates/create_task');\nconst cancelTask = require('./deletes/cancel_task');\n\nmodule.exports = {\n  version: require('./package.json').version,\n  platformVersion: require('zapier-platform-core').version,\n\n  authentication: {\n    type: 'session',\n    test: {\n      url: 'https://{{bundle.authData.domain}}/v1/automation',\n    },\n    fields: [\n      {\n        key: 'domain',\n        label: 'API Domain',\n        type: 'string',\n        required: false,\n        default: 'https://api.codetether.io'\n      },\n      {\n        key: 'apiKey',\n        label: 'API Key',\n        type: 'password',\n        required: true\n      }\n    ]\n  },\n\n  beforeRequest: [\n    (request, z, bundle) =&gt; {\n      request.headers.Authorization = `Bearer ${bundle.authData.apiKey}`;\n      return request;\n    }\n  ],\n\n  searches: {\n    get_task_status: getTaskStatus,\n    get_task_list: getTaskList,\n    poll_task: pollTask\n  },\n\n  creates: {\n    create_task: createTask\n  },\n\n  deletes: {\n    cancel_task: cancelTask\n  }\n};\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#createscreate_taskjs","title":"creates/create_task.js","text":"<p>Returns object with individual fields (Zapier best practice).</p> <pre><code>module.exports = {\n  key: 'create_task',\n  noun: 'Task',\n  display: {\n    label: 'Create Task',\n    description: 'Create a new AI automation task in CodeTether'\n  },\n  operation: {\n    inputFields: [\n      {\n        key: 'title',\n        label: 'Title',\n        type: 'string',\n        required: true,\n        helpText: 'Brief title (max 200 chars)',\n        placeholder: 'e.g., Analyze customer feedback'\n      },\n      {\n        key: 'description',\n        label: 'Description',\n        type: 'text',\n        required: true,\n        helpText: 'Task prompt for AI (max 10000 chars)'\n      },\n      {\n        key: 'codebase_id',\n        label: 'Codebase ID',\n        type: 'string',\n        required: false,\n        default: 'global',\n        helpText: 'For codebase parameter'\n      },\n      {\n        key: 'agent_type',\n        label: 'Agent Type',\n        type: 'string',\n        required: false,\n        choices: ['build', 'plan', 'general', 'explore'],\n        default: 'general'\n      },\n      {\n        key: 'model',\n        label: 'Model',\n        type: 'string',\n        required: false,\n        choices: ['claude-sonnet', 'gpt-4o', 'gemini-2.5-pro'],\n        default: 'claude-sonnet'\n      },\n      {\n        key: 'priority',\n        label: 'Priority',\n        type: 'integer',\n        required: false,\n        default: 0,\n        min: 0,\n        max: 100\n      },\n      {\n        key: 'webhook_url',\n        label: 'Webhook URL',\n        type: 'string',\n        required: false\n      }\n    ],\n    perform: (z, bundle) =&gt; {\n      const data = {\n        title: bundle.inputData.title,\n        description: bundle.inputData.description,\n        codebase_id: bundle.inputData.codebase_id || 'global',\n        agent_type: bundle.inputData.agent_type || 'general',\n        model: bundle.inputData.model || 'claude-sonnet',\n        priority: bundle.inputData.priority || 0\n      };\n      if (bundle.inputData.webhook_url) data.webhook_url = bundle.inputData.webhook_url;\n\n      return z.request({\n        method: 'POST',\n        url: `https://{{bundle.authData.domain}}/v1/automation/tasks`,\n        json: data\n      }).then((response) =&gt; {\n        const result = response.json;\n        return {\n          task_id: result.task_id,\n          run_id: result.run_id,\n          status: result.status,\n          title: result.title,\n          created_at: result.created_at,\n          model: result.model\n        };\n      });\n    }\n  }\n};\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#searchesget_task_statusjs","title":"searches/get_task_status.js","text":"<p>Search action returns single task object.</p> <pre><code>module.exports = {\n  key: 'get_task_status',\n  noun: 'Task Status',\n  display: {\n    label: 'Get Task Status',\n    description: 'Get current status of a specific task'\n  },\n  operation: {\n    inputFields: [\n      {\n        key: 'task_id',\n        label: 'Task ID',\n        type: 'string',\n        required: true\n      }\n    ],\n    perform: (z, bundle) =&gt; {\n      return z.request({\n        url: `https://{{bundle.authData.domain}}/v1/automation/tasks/${bundle.inputData.task_id}`\n      }).then((response) =&gt; {\n        return response.json;\n      });\n    }\n  }\n};\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#searchesget_task_listjs","title":"searches/get_task_list.js","text":"<p>Search action returns sorted array.</p> <pre><code>module.exports = {\n  key: 'get_task_list',\n  noun: 'Tasks',\n  display: {\n    label: 'List Tasks',\n    description: 'List tasks with optional filtering by status'\n  },\n  operation: {\n    inputFields: [\n      {\n        key: 'status',\n        label: 'Status Filter',\n        type: 'string',\n        required: false,\n        choices: ['queued', 'running', 'completed', 'failed']\n      },\n      {\n        key: 'limit',\n        label: 'Limit',\n        type: 'integer',\n        required: false,\n        default: 50\n      }\n    ],\n    perform: (z, bundle) =&gt; {\n      const params = {};\n      if (bundle.inputData.status) params.status = bundle.inputData.status;\n      if (bundle.inputData.limit) params.limit = bundle.inputData.limit;\n\n      return z.request({\n        url: `https://{{bundle.authData.domain}}/v1/automation/tasks`,\n        params: params\n      }).then((response) =&gt; {\n        return response.json.tasks || [];\n      });\n    }\n  }\n};\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#searchespoll_taskjs","title":"searches/poll_task.js","text":"<p>Polling search for Zapier Looping.</p> <pre><code>module.exports = {\n  key: 'poll_task',\n  noun: 'Task Poll',\n  display: {\n    label: 'Poll Task',\n    description: 'Poll task status until completion (use with Looping by Zapier)'\n  },\n  operation: {\n    inputFields: [\n      {\n        key: 'task_id',\n        label: 'Task ID',\n        type: 'string',\n        required: true\n      }\n    ],\n    perform: (z, bundle) =&gt; {\n      return z.request({\n        url: `https://{{bundle.authData.domain}}/v1/automation/tasks/${bundle.inputData.task_id}`\n      }).then((response) =&gt; {\n        const task = response.json;\n        const isComplete = ['completed', 'failed', 'cancelled'].includes(task.status);\n        return isComplete ? [task] : [];\n      });\n    }\n  }\n};\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#deletescancel_taskjs","title":"deletes/cancel_task.js","text":"<p>Delete action with Copy field for irreversible operations.</p> <pre><code>module.exports = {\n  key: 'cancel_task',\n  noun: 'Task',\n  display: {\n    label: 'Cancel Task',\n    description: 'Cancel a queued or running task'\n  },\n  operation: {\n    inputFields: [\n      {\n        key: 'task_id',\n        label: 'Task ID',\n        type: 'string',\n        required: true\n      },\n      {\n        key: 'confirm',\n        label: 'Confirm',\n        type: 'string',\n        required: true,\n        choices: ['yes', 'no'],\n        dynamic: 'confirm_value'\n      }\n    ],\n    perform: (z, bundle) =&gt; {\n      if (bundle.inputData.confirm !== 'yes') {\n        throw new z.errors.HaltedError('Please type \"yes\" to confirm cancellation');\n      }\n\n      return z.request({\n        method: 'DELETE',\n        url: `https://{{bundle.authData.domain}}/v1/automation/tasks/${bundle.inputData.task_id}`,\n        headers: { 'X-Copy': 'Cancel is irreversible' }\n      }).then(() =&gt; {\n        return { task_id: bundle.inputData.task_id, status: 'cancelled' };\n      });\n    }\n  }\n};\n</code></pre>"},{"location":"integrations/zapier-app-manifest/#deploy","title":"Deploy","text":"<pre><code>zapier push\nzapier promote\nzapier submit\n</code></pre>"},{"location":"integrations/zapier-quickstart/","title":"Zapier Integration Quick Start","text":"<p>This guide walks through connecting CodeTether to Zapier for workflow automation.</p>"},{"location":"integrations/zapier-quickstart/#overview","title":"Overview","text":"<p>CodeTether provides a simple REST API that Zapier can call to create and monitor AI-powered tasks. The integration uses webhooks for real-time updates when tasks complete.</p>"},{"location":"integrations/zapier-quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>A CodeTether instance (self-hosted or managed)</li> <li>API key from CodeTether</li> <li>Zapier account</li> </ul>"},{"location":"integrations/zapier-quickstart/#authentication","title":"Authentication","text":"<p>CodeTether supports two authentication methods for Zapier:</p> <ol> <li>API Key (Recommended for quick setup)</li> <li>OAuth 2.0 (For production integrations)</li> </ol>"},{"location":"integrations/zapier-quickstart/#api-key-authentication","title":"API Key Authentication","text":"<p>Your API key starts with <code>ct_</code> and can be found in your CodeTether dashboard under Settings &gt; API Keys.</p> <p>Example Header: <pre><code>Authorization: Bearer ct_abc123...\n</code></pre></p>"},{"location":"integrations/zapier-quickstart/#oauth-20-authentication","title":"OAuth 2.0 Authentication","text":"<p>For production use, Zapier supports OAuth 2.0 with the CodeTether authorization server:</p> <ul> <li>Authorization Endpoint: <code>https://api.codetether.io/oauth/authorize</code></li> <li>Token Endpoint: <code>https://api.codetether.io/oauth/token</code></li> <li>Scopes: <code>tasks:read</code>, <code>tasks:write</code>, <code>automation:read</code>, <code>automation:write</code></li> </ul>"},{"location":"integrations/zapier-quickstart/#quick-start-create-a-zap","title":"Quick Start: Create a Zap","text":""},{"location":"integrations/zapier-quickstart/#step-1-create-a-task-with-webhook","title":"Step 1: Create a Task with Webhook","text":"<p>Use Zapier's \"Webhooks by Zapier\" or make a direct HTTP POST to CodeTether:</p> <p>POST <code>/v1/automation/tasks</code></p> <p>Headers: <pre><code>Authorization: Bearer ct_your_api_key_here\nContent-Type: application/json\n</code></pre></p> <p>Body: <pre><code>{\n  \"title\": \"Analyze customer feedback\",\n  \"description\": \"Analyze the following customer feedback and summarize key points: {{feedback_text}}\",\n  \"agent_type\": \"general\",\n  \"model\": \"claude-sonnet\",\n  \"webhook_url\": \"https://hooks.zapier.com/hooks/catch/123/abc/\",\n  \"priority\": 0\n}\n</code></pre></p> <p>Response: <pre><code>{\n  \"task_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"run_id\": \"660e8400-e29b-41d4-a716-446655440001\",\n  \"status\": \"queued\",\n  \"title\": \"Analyze customer feedback\",\n  \"description\": \"Analyze the following customer feedback...\",\n  \"created_at\": \"2025-01-19T10:30:00Z\",\n  \"model\": \"claude-sonnet\"\n}\n</code></pre></p>"},{"location":"integrations/zapier-quickstart/#step-2-set-up-a-webhook-catcher-in-zapier","title":"Step 2: Set Up a Webhook Catcher in Zapier","text":"<ol> <li>Create a new Zap</li> <li>Select Webhooks by Zapier as the trigger</li> <li>Choose Catch Hook</li> <li>Copy the webhook URL provided by Zapier</li> <li>Use this URL as the <code>webhook_url</code> when creating tasks</li> </ol>"},{"location":"integrations/zapier-quickstart/#step-3-process-the-webhook-response","title":"Step 3: Process the Webhook Response","text":"<p>When your task completes, CodeTether will send a POST request to your webhook:</p> <p>Webhook Payload: <pre><code>{\n  \"event\": \"task_completed\",\n  \"run_id\": \"660e8400-e29b-41d4-a716-446655440001\",\n  \"task_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n  \"status\": \"completed\",\n  \"result\": \"The feedback mentions three key areas: pricing concerns, feature requests for reporting, and positive sentiment about customer support.\",\n  \"result\": null,\n  \"timestamp\": \"2025-01-19T10:35:00Z\"\n}\n</code></pre></p>"},{"location":"integrations/zapier-quickstart/#available-webhook-events","title":"Available Webhook Events","text":"<p>CodeTether sends webhook notifications for these events:</p> <ul> <li>task_started: Task execution has begun</li> <li>task_progress: Task is making progress (optional)</li> <li>task_completed: Task finished successfully</li> <li>task_failed: Task encountered an error</li> <li>task_needs_input: Task requires additional information</li> </ul>"},{"location":"integrations/zapier-quickstart/#rate-limiting","title":"Rate Limiting","text":"<p>CodeTether enforces rate limits: - Default: 60 requests per minute - Headers: Each response includes rate limit info:   - <code>X-RateLimit-Limit</code>: Your current limit   - <code>X-RateLimit-Remaining</code>: Requests remaining   - <code>X-RateLimit-Reset</code>: Unix timestamp when limit resets</p>"},{"location":"integrations/zapier-quickstart/#idempotency","title":"Idempotency","text":"<p>To prevent duplicate tasks on retries, include an <code>Idempotency-Key</code> header:</p> <pre><code>Idempotency-Key: uuid-v4\n</code></pre> <p>Subsequent requests with the same key will return the original task ID.</p>"},{"location":"integrations/zapier-quickstart/#webhook-signature-verification-optional","title":"Webhook Signature Verification (Optional)","text":"<p>For added security, configure a webhook signing secret in CodeTether:</p> <ol> <li>Set <code>CODETETHER_WEBHOOK_SECRET</code> environment variable</li> <li>CodeTether will include <code>X-CodeTether-Signature</code> header on webhooks</li> <li>Verify signatures in Zapier using HMAC-SHA256:</li> </ol> <p>Zapier Code by Zapier: <pre><code>const crypto = require('crypto');\nconst payload = JSON.stringify(bundle.rawRequest.json);\nconst signature = bundle.rawRequest.headers['x-codetether-signature'];\nconst secret = 'your_webhook_secret';\n\nconst expected = 'sha256=' + crypto\n  .createHmac('sha256', secret)\n  .update(payload)\n  .digest('hex');\n\nif (signature !== expected) {\n  throw new Error('Invalid webhook signature');\n}\n</code></pre></p>"},{"location":"integrations/zapier-quickstart/#example-zaps","title":"Example Zaps","text":""},{"location":"integrations/zapier-quickstart/#zap-1-email-analysis","title":"Zap 1: Email Analysis","text":"<ol> <li>Trigger: New email in Gmail</li> <li>Action: CodeTether - Create Task (Analyze sentiment, extract topics)</li> <li>Trigger: Webhook catch (CodeTether callback)</li> <li>Action: Add to Google Sheet with analysis results</li> </ol>"},{"location":"integrations/zapier-quickstart/#zap-2-customer-support-triage","title":"Zap 2: Customer Support Triage","text":"<ol> <li>Trigger: New form submission (Typeform/JotForm)</li> <li>Action: CodeTether - Create Task (Categorize issue, suggest response)</li> <li>Trigger: Webhook catch</li> <li>Action: Create Slack message in appropriate channel</li> </ol>"},{"location":"integrations/zapier-quickstart/#zap-3-document-summarization","title":"Zap 3: Document Summarization","text":"<ol> <li>Trigger: New file in Google Drive</li> <li>Action: Extract file contents</li> <li>Action: CodeTether - Create Task (Summarize document)</li> <li>Trigger: Webhook catch</li> <li>Action: Update Notion database with summary</li> </ol>"},{"location":"integrations/zapier-quickstart/#api-reference","title":"API Reference","text":""},{"location":"integrations/zapier-quickstart/#create-task","title":"Create Task","text":"<pre><code>POST /v1/automation/tasks\n</code></pre>"},{"location":"integrations/zapier-quickstart/#get-task-status","title":"Get Task Status","text":"<pre><code>GET /v1/automation/tasks/{task_id}\n</code></pre>"},{"location":"integrations/zapier-quickstart/#list-tasks","title":"List Tasks","text":"<pre><code>GET /v1/automation/tasks?status=completed&amp;limit=50\n</code></pre>"},{"location":"integrations/zapier-quickstart/#troubleshooting","title":"Troubleshooting","text":""},{"location":"integrations/zapier-quickstart/#task-not-starting","title":"Task Not Starting","text":"<ul> <li>Check API key is valid</li> <li>Verify webhook URL format</li> <li>Check rate limit headers in response</li> </ul>"},{"location":"integrations/zapier-quickstart/#webhook-not-received","title":"Webhook Not Received","text":"<ul> <li>Verify webhook URL is publicly accessible</li> <li>Check Zapier webhook history</li> <li>Ensure task completed (check status via GET /tasks/{id})</li> </ul>"},{"location":"integrations/zapier-quickstart/#signatures-failing","title":"Signatures Failing","text":"<ul> <li>Verify <code>CODETETHER_WEBHOOK_SECRET</code> is set</li> <li>Ensure you're using the raw JSON payload, not parsed</li> <li>Check character encoding (must be UTF-8)</li> </ul>"},{"location":"integrations/zapier-quickstart/#support","title":"Support","text":"<ul> <li>Documentation: https://docs.codetether.io</li> <li>API Status: https://status.codetether.io</li> <li>Issues: https://github.com/codetether/codetether/issues</li> </ul>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>CodeTether command-line interface.</p>"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#serve","title":"serve","text":"<p>Start the server:</p> <pre><code>codetether serve --port 8000\n</code></pre> <p><code>serve</code> is a friendly alias for starting a single server instance.</p>"},{"location":"reference/cli/#run","title":"run","text":"<p>Explicit form of starting a single server:</p> <pre><code>codetether run --port 8000\n</code></pre>"},{"location":"reference/cli/#codetether-worker","title":"codetether-worker","text":"<p>Start a worker:</p> <pre><code>codetether-worker --server https://example.com --name worker-1 --codebase /path/to/repo\n</code></pre>"},{"location":"reference/cli/#version","title":"version","text":"<p>Show version:</p> <pre><code>codetether --version\n</code></pre>"},{"location":"reference/environment-variables/","title":"Environment Variables","text":"<p>Complete reference of all CodeTether environment variables.</p> <p>See Configuration for detailed documentation.</p>"},{"location":"reference/environment-variables/#core","title":"Core","text":"Variable Default Description <code>A2A_HOST</code> <code>0.0.0.0</code> Server host <code>A2A_PORT</code> <code>8000</code> Server port <code>A2A_LOG_LEVEL</code> <code>INFO</code> Log level"},{"location":"reference/environment-variables/#database-storage","title":"Database &amp; Storage","text":"Variable Default Description <code>DATABASE_URL</code> \u2014 PostgreSQL connection URL for durable persistence. Format: <code>postgresql://user:password@host:port/database</code>. When set, workers, codebases, tasks, and sessions survive server restarts and work across replicas. <code>A2A_DATABASE_URL</code> \u2014 Alias for <code>DATABASE_URL</code> <code>A2A_REDIS_URL</code> <code>redis://localhost:6379</code> Redis URL (shared state for multi-replica deployments; used by task queues and OpenCode worker/session sync) <code>OPENCODE_DB_PATH</code> <code>./data/opencode.db</code> SQLite database path for OpenCode codebases/tasks registry (fallback when PostgreSQL not configured)"},{"location":"reference/environment-variables/#authentication","title":"Authentication","text":"Variable Default Description <code>A2A_AUTH_ENABLED</code> <code>false</code> Enable auth <code>A2A_AUTH_TOKENS</code> \u2014 Token list <code>KEYCLOAK_URL</code> \u2014 Keycloak URL <code>KEYCLOAK_REALM</code> \u2014 Realm <code>KEYCLOAK_CLIENT_ID</code> \u2014 Client ID <code>KEYCLOAK_CLIENT_SECRET</code> \u2014 Client secret"},{"location":"reference/environment-variables/#mcp","title":"MCP","text":"Variable Default Description <code>MCP_HTTP_ENABLED</code> <code>true</code> Enable MCP <code>MCP_HTTP_PORT</code> <code>9000</code> MCP port"},{"location":"reference/environment-variables/#opencode-integration","title":"OpenCode Integration","text":"Variable Default Description <code>OPENCODE_HOST</code> <code>localhost</code> Host where OpenCode API runs (use <code>host.docker.internal</code> in Docker) <code>OPENCODE_PORT</code> <code>9777</code> OpenCode API port"},{"location":"reference/environment-variables/#worker-sse-configuration","title":"Worker SSE Configuration","text":"Variable Default Description <code>WORKER_SSE_ENABLED</code> <code>true</code> Enable SSE task stream endpoint <code>WORKER_SSE_KEEPALIVE</code> <code>30</code> Keepalive interval in seconds <code>WORKER_SSE_TIMEOUT</code> <code>300</code> Worker idle timeout in seconds"},{"location":"reference/environment-variables/#agent-worker-remote-workers","title":"Agent Worker (Remote Workers)","text":"Variable Default Description <code>A2A_SERVER_URL</code> \u2014 CodeTether server URL (required) <code>A2A_WORKER_NAME</code> hostname Worker identifier <code>A2A_POLL_INTERVAL</code> <code>5</code> Task polling interval in seconds (fallback for SSE) <code>A2A_OPENCODE_STORAGE_PATH</code> auto-detect Override OpenCode storage directory <code>A2A_SESSION_MESSAGE_SYNC_MAX_SESSIONS</code> <code>3</code> Recent sessions to sync messages for <code>A2A_SESSION_MESSAGE_SYNC_MAX_MESSAGES</code> <code>100</code> Recent messages per session to sync"},{"location":"reference/environment-variables/#agent-discovery-v122","title":"Agent Discovery (v1.2.2+)","text":"Variable Default Description <code>A2A_AGENT_NAME</code> worker name Agent routing role for <code>send_to_agent</code> <code>A2A_AGENT_DESCRIPTION</code> auto-generated Human-readable agent description <code>A2A_AGENT_URL</code> server URL URL where agent can be reached <code>A2A_AGENT_DISCOVERY_MAX_AGE</code> <code>120</code> TTL in seconds for stale agent filtering (server-side) <p>Role vs Name</p> <p>The <code>A2A_AGENT_NAME</code> sets the routing role (e.g., <code>code-reviewer</code>). The full discovery name is auto-generated as <code>role:hostname:worker_id</code> to ensure uniqueness across multiple workers with the same role.</p>"},{"location":"reference/errors/","title":"Error Codes","text":"<p>CodeTether error codes and troubleshooting.</p>"},{"location":"reference/errors/#http-status-codes","title":"HTTP Status Codes","text":"Code Description 400 Bad request 401 Unauthorized 403 Forbidden 404 Not found 500 Server error 503 Service unavailable"},{"location":"reference/errors/#json-rpc-errors","title":"JSON-RPC Errors","text":"Code Description -32700 Parse error -32600 Invalid request -32601 Method not found -32602 Invalid params -32603 Internal error"},{"location":"reference/troubleshooting/","title":"Troubleshooting","text":"<p>This guide covers common issues you may encounter when running CodeTether Server and how to resolve them.</p>"},{"location":"reference/troubleshooting/#ssltls-certificate-errors","title":"SSL/TLS Certificate Errors","text":""},{"location":"reference/troubleshooting/#unable-to-verify-the-first-certificate","title":"\"Unable to verify the first certificate\"","text":"<p>This error occurs when connecting to the A2A server via SSE (Server-Sent Events) and the server uses a self-signed certificate or a certificate from an untrusted Certificate Authority.</p> <p>Error message:</p> <pre><code>a2a-server SSE error: unable to verify the first certificate\n</code></pre> <p>Causes:</p> <ul> <li>Self-signed certificate on the server</li> <li>Certificate signed by an internal/private CA</li> <li>Missing intermediate certificates in the certificate chain</li> <li>Expired or invalid certificate</li> </ul>"},{"location":"reference/troubleshooting/#solutions","title":"Solutions","text":""},{"location":"reference/troubleshooting/#option-1-developmenttesting-only-disable-certificate-verification","title":"Option 1: Development/Testing Only - Disable Certificate Verification","text":"<p>Security Risk</p> <p>This disables all certificate verification and should never be used in production environments.</p> <p>Set the environment variable before starting your MCP client:</p> <pre><code>export NODE_TLS_REJECT_UNAUTHORIZED=0\n</code></pre> <p>For MCP configuration files (e.g., VS Code, Cline, Claude Desktop):</p> <pre><code>{\n  \"mcpServers\": {\n    \"a2a-server\": {\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"@anthropic/a2a-mcp-client\"],\n      \"env\": {\n        \"NODE_TLS_REJECT_UNAUTHORIZED\": \"0\",\n        \"A2A_SERVER_URL\": \"https://your-server:8080\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"reference/troubleshooting/#option-2-trust-the-server-certificate-recommended-for-internal-cas","title":"Option 2: Trust the Server Certificate (Recommended for Internal CAs)","text":"<p>If your server uses a self-signed certificate or internal CA, add it to your system's trusted certificates.</p> <p>Step 1: Export the certificate</p> <pre><code>openssl s_client -connect your-server:443 -showcerts &lt;/dev/null 2&gt;/dev/null \\\n  | openssl x509 -outform PEM &gt; server.crt\n</code></pre> <p>Step 2: Add to trusted certificates</p> Linux (Debian/Ubuntu)Linux (RHEL/CentOS)macOSWindows <pre><code>sudo cp server.crt /usr/local/share/ca-certificates/\nsudo update-ca-certificates\n</code></pre> <pre><code>sudo cp server.crt /etc/pki/ca-trust/source/anchors/\nsudo update-ca-trust\n</code></pre> <pre><code>sudo security add-trusted-cert -d -r trustRoot \\\n  -k /Library/Keychains/System.keychain server.crt\n</code></pre> <pre><code>Import-Certificate -FilePath server.crt -CertStoreLocation Cert:\\LocalMachine\\Root\n</code></pre> <p>Step 3: For Node.js applications</p> <p>You can also specify the certificate directly:</p> <pre><code>export NODE_EXTRA_CA_CERTS=/path/to/server.crt\n</code></pre> <p>Or in MCP configuration:</p> <pre><code>{\n  \"mcpServers\": {\n    \"a2a-server\": {\n      \"command\": \"npx\",\n      \"args\": [\"-y\", \"@anthropic/a2a-mcp-client\"],\n      \"env\": {\n        \"NODE_EXTRA_CA_CERTS\": \"/path/to/server.crt\",\n        \"A2A_SERVER_URL\": \"https://your-server:8080\"\n      }\n    }\n  }\n}\n</code></pre>"},{"location":"reference/troubleshooting/#option-3-use-a-valid-certificate-recommended-for-production","title":"Option 3: Use a Valid Certificate (Recommended for Production)","text":"<p>For production deployments, use a certificate from a trusted Certificate Authority:</p> <ul> <li>Let's Encrypt: Free, automated certificates via certbot</li> <li>Commercial CAs: DigiCert, Comodo, GlobalSign, etc.</li> </ul> <p>See the Production Checklist for TLS configuration guidance.</p>"},{"location":"reference/troubleshooting/#option-4-fix-certificate-chain-issues","title":"Option 4: Fix Certificate Chain Issues","text":"<p>If you have a valid certificate but are missing intermediate certificates:</p> <pre><code># Check the certificate chain\nopenssl s_client -connect your-server:443 -showcerts\n\n# Combine certificates in correct order\ncat your-cert.crt intermediate.crt root.crt &gt; fullchain.crt\n</code></pre> <p>Ensure your server is configured to serve the full certificate chain.</p>"},{"location":"reference/troubleshooting/#connection-errors","title":"Connection Errors","text":""},{"location":"reference/troubleshooting/#connection-refused","title":"\"Connection refused\"","text":"<p>Causes:</p> <ul> <li>Server is not running</li> <li>Wrong port number</li> <li>Firewall blocking the connection</li> </ul> <p>Solutions:</p> <ol> <li> <p>Verify the server is running:    <pre><code>curl -v http://localhost:8080/health\n</code></pre></p> </li> <li> <p>Check the correct port in your configuration:    <pre><code>grep -i port .env\n</code></pre></p> </li> <li> <p>Check firewall rules:    <pre><code>sudo ufw status  # Ubuntu\nsudo firewall-cmd --list-all  # RHEL/CentOS\n</code></pre></p> </li> </ol>"},{"location":"reference/troubleshooting/#connection-timeout","title":"\"Connection timeout\"","text":"<p>Causes:</p> <ul> <li>Network connectivity issues</li> <li>Server overloaded</li> <li>DNS resolution problems</li> </ul> <p>Solutions:</p> <ol> <li> <p>Test basic connectivity:    <pre><code>ping your-server\ntelnet your-server 8080\n</code></pre></p> </li> <li> <p>Check DNS resolution:    <pre><code>nslookup your-server\n</code></pre></p> </li> <li> <p>Check server health and load</p> </li> </ol>"},{"location":"reference/troubleshooting/#authentication-errors","title":"Authentication Errors","text":""},{"location":"reference/troubleshooting/#401-unauthorized","title":"\"401 Unauthorized\"","text":"<p>Causes:</p> <ul> <li>Missing or invalid API token</li> <li>Expired token</li> <li>Incorrect authentication configuration</li> </ul> <p>Solutions:</p> <ol> <li> <p>Verify your API token is set:    <pre><code>echo $A2A_API_KEY\n</code></pre></p> </li> <li> <p>Check token validity in the server logs</p> </li> <li> <p>Generate a new token if needed (see API Tokens)</p> </li> </ol>"},{"location":"reference/troubleshooting/#403-forbidden","title":"\"403 Forbidden\"","text":"<p>Causes:</p> <ul> <li>Token lacks required permissions</li> <li>Resource access denied by policy</li> </ul> <p>Solutions:</p> <ol> <li>Check the required permissions for the endpoint</li> <li>Verify your token's scope and permissions</li> <li>Contact your administrator for access</li> </ol>"},{"location":"reference/troubleshooting/#sse-streaming-issues","title":"SSE Streaming Issues","text":""},{"location":"reference/troubleshooting/#events-not-received","title":"Events not received","text":"<p>Causes:</p> <ul> <li>Proxy/load balancer buffering responses</li> <li>Connection timeout settings too low</li> <li>Network interruptions</li> </ul> <p>Solutions:</p> <ol> <li> <p>Disable proxy buffering:    <pre><code># Nginx configuration\nproxy_buffering off;\nproxy_cache off;\nproxy_set_header Connection '';\nproxy_http_version 1.1;\nchunked_transfer_encoding off;\n</code></pre></p> </li> <li> <p>Increase timeout settings:    <pre><code>proxy_read_timeout 86400s;\nproxy_send_timeout 86400s;\n</code></pre></p> </li> <li> <p>For AWS ALB, enable streaming:    <pre><code>idle_timeout: 4000\n</code></pre></p> </li> </ol>"},{"location":"reference/troubleshooting/#worker-sse-task-distribution-issues","title":"Worker SSE Task Distribution Issues","text":""},{"location":"reference/troubleshooting/#workers-not-receiving-tasks-via-sse","title":"Workers not receiving tasks via SSE","text":"<p>Causes:</p> <ul> <li>Missing or incorrect <code>X-Codebases</code> header</li> <li>Missing or incorrect <code>X-Capabilities</code> header</li> <li>Worker not listening for <code>task_available</code> event type</li> <li>Codebase ID mismatch</li> </ul> <p>Solutions:</p> <ol> <li> <p>Verify headers are sent correctly when connecting to SSE:    <pre><code>curl -N \"http://localhost:8000/v1/worker/tasks/stream\" \\\n  -H \"X-Codebases: my-project,api\" \\\n  -H \"X-Capabilities: opencode,build,deploy,test\" \\\n  -H \"Accept: text/event-stream\"\n</code></pre></p> </li> <li> <p>Ensure worker listens for the correct event type (<code>task_available</code>):    <pre><code># Correct event types to handle\nif event_type in ('task', 'task_available', 'task_assigned'):\n    process_task(data)\n</code></pre></p> </li> <li> <p>Check worker registration and codebase IDs match:    <pre><code>curl http://localhost:8000/v1/opencode/workers\ncurl http://localhost:8000/v1/opencode/codebases\n</code></pre></p> </li> </ol>"},{"location":"reference/troubleshooting/#global-tasks-not-being-received","title":"Global tasks not being received","text":"<p>Causes:</p> <ul> <li>Worker doesn't have a global codebase registered</li> <li>Task filtering logic not handling <code>codebase_id: \"global\"</code></li> </ul> <p>Solutions:</p> <ol> <li>Ensure worker has a global codebase registered</li> <li>Update filtering to accept global tasks:    <pre><code># Accept tasks with codebase_id == 'global'\nif codebase_id in registered_codebases or codebase_id == 'global':\n    process_task(task)\n</code></pre></li> </ol>"},{"location":"reference/troubleshooting/#sse-connection-drops-frequently","title":"SSE connection drops frequently","text":"<p>Causes:</p> <ul> <li>Server heartbeat timeout</li> <li>Network instability</li> <li>Load balancer idle timeout</li> </ul> <p>Solutions:</p> <ol> <li>Check heartbeat is being received (every 30s by default)</li> <li>Implement exponential backoff reconnection:    <pre><code>reconnect_delay = min(2 ** retry_count, 60)  # Max 60s\n</code></pre></li> <li>Increase load balancer idle timeout</li> </ol>"},{"location":"reference/troubleshooting/#worker-logs-show-unknown-sse-event-type","title":"Worker logs show \"Unknown SSE event type\"","text":"<p>This is usually informational. The worker should handle these event types:</p> Event Type Description <code>task_available</code> New task available <code>task</code> Full task object <code>task_assigned</code> Task assigned to worker <code>connected</code> Connection confirmed <code>keepalive</code> Heartbeat signal"},{"location":"reference/troubleshooting/#getting-help","title":"Getting Help","text":"<p>If you're still experiencing issues:</p> <ol> <li>Check the server logs for detailed error messages</li> <li>Search existing issues on GitHub</li> <li>Open a new issue with:</li> <li>Error message and stack trace</li> <li>Server version (<code>codetether --version</code>)</li> <li>Environment details (OS, Node.js version)</li> <li>Steps to reproduce</li> </ol>"}]}