{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"CodeTether Server","text":"<p>Turn AI Agents Into Production Systems.</p> <p>CodeTether Server is a production-ready implementation of the A2A (Agent-to-Agent) Protocol, the open standard from the Linux Foundation that enables AI agents to communicate, collaborate, and solve complex problems together.</p> <ul> <li> <p> Get Started in 5 Minutes</p> <p>Install CodeTether and run your first multi-agent workflow</p> <p> Quick Start</p> </li> <li> <p> Full A2A Protocol Support</p> <p>Complete implementation of the A2A specification with extensions</p> <p> A2A Protocol</p> </li> <li> <p> Deploy Anywhere</p> <p>Docker, Kubernetes, or bare metal with Helm charts included</p> <p> Deployment</p> </li> <li> <p> OpenCode Integration</p> <p>Bridge AI coding agents to your codebase with session management</p> <p> OpenCode</p> </li> </ul>"},{"location":"#what-is-codetether","title":"What is CodeTether?","text":"<p>CodeTether Server provides the infrastructure layer for running AI agents in production:</p> <ul> <li>A2A Protocol Native \u2014 Full implementation of the A2A specification for agent-to-agent communication</li> <li>Distributed Workers \u2014 Run agents across multiple machines with automatic task routing</li> <li>Real-time Streaming \u2014 SSE-based live output streaming for long-running agent tasks</li> <li>Session Management \u2014 Resume conversations, sync across devices, maintain context</li> <li>Enterprise Security \u2014 Keycloak OIDC, API tokens, audit logging</li> <li>OpenCode Bridge \u2014 Native integration with OpenCode AI coding agents</li> </ul>"},{"location":"#a2a-protocol-implementation","title":"A2A Protocol Implementation","text":"<p>CodeTether implements the complete A2A Protocol specification:</p> A2A Feature CodeTether Support Reference Agent Discovery \u2705 <code>/.well-known/agent-card.json</code> Spec \u00a75 JSON-RPC 2.0 \u2705 Full support Spec \u00a76 Task Management \u2705 Create, cancel, status Spec \u00a77 Streaming (SSE) \u2705 Real-time artifacts Spec \u00a78 Push Notifications \u2705 Webhook callbacks Topics Multi-turn Conversations \u2705 Session continuity Topics <p>Plus CodeTether extensions:</p> <ul> <li>Distributed Task Queue \u2014 Redis-backed task distribution across workers</li> <li>OpenCode Integration \u2014 AI coding agent bridge with codebase registration</li> <li>Monitor UI \u2014 Web dashboard for real-time agent observation</li> <li>MCP Tools \u2014 Model Context Protocol tool server</li> </ul>"},{"location":"#quick-example","title":"Quick Example","text":"<pre><code># Install\npip install codetether\n\n# Run server\ncodetether serve --port 8000\n\n# In another terminal, send a task\ncurl -X POST http://localhost:8000/v1/a2a \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"tasks/send\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [{\"text\": \"Analyze this codebase\"}]\n      }\n    },\n    \"id\": \"1\"\n  }'\n</code></pre>"},{"location":"#architecture-overview","title":"Architecture Overview","text":"<pre><code>graph TB\n    subgraph Clients\n        UI[Web Dashboard]\n        CLI[CLI / SDK]\n        Agent[External Agents]\n    end\n\n    subgraph CodeTether Server\n        API[FastAPI Server]\n        A2A[A2A Protocol Handler]\n        MCP[MCP Tool Server]\n        Monitor[Monitor API]\n    end\n\n    subgraph Infrastructure\n        Redis[(Redis Broker)]\n        DB[(SQLite/Postgres)]\n        Keycloak[Keycloak Auth]\n    end\n\n    subgraph Workers\n        W1[Worker 1]\n        W2[Worker 2]\n        OC[OpenCode Bridge]\n    end\n\n    UI --&gt; API\n    CLI --&gt; API\n    Agent --&gt; A2A\n\n    API --&gt; A2A\n    API --&gt; MCP\n    API --&gt; Monitor\n\n    A2A --&gt; Redis\n    Monitor --&gt; DB\n    API --&gt; Keycloak\n\n    Redis --&gt; W1\n    Redis --&gt; W2\n    Redis --&gt; OC</code></pre>"},{"location":"#next-steps","title":"Next Steps","text":"<ul> <li> <p> Installation</p> <p> Install Guide</p> </li> <li> <p> Configuration</p> <p> Config Reference</p> </li> <li> <p> API Reference</p> <p> API Docs</p> </li> <li> <p> Source Code</p> <p> GitHub</p> </li> </ul>"},{"location":"api/jsonrpc/","title":"JSON-RPC Methods","text":"<p>CodeTether implements the A2A Protocol JSON-RPC methods.</p>"},{"location":"api/jsonrpc/#endpoint","title":"Endpoint","text":"<pre><code>POST /v1/a2a\nContent-Type: application/json\n</code></pre>"},{"location":"api/jsonrpc/#methods","title":"Methods","text":""},{"location":"api/jsonrpc/#taskssend","title":"tasks/send","text":"<p>Send a task to the agent.</p>"},{"location":"api/jsonrpc/#taskssendsubscribe","title":"tasks/sendSubscribe","text":"<p>Send and subscribe to streaming updates.</p>"},{"location":"api/jsonrpc/#tasksget","title":"tasks/get","text":"<p>Get task status.</p>"},{"location":"api/jsonrpc/#taskscancel","title":"tasks/cancel","text":"<p>Cancel a running task.</p> <p>See A2A Protocol Specification for full details.</p>"},{"location":"api/opencode/","title":"OpenCode API","text":"<p>The OpenCode API provides integration with AI coding agents. It manages codebases, sessions, tasks, and real-time agent interactions.</p> <p>Base URL</p> <p>All OpenCode endpoints are prefixed with <code>/v1/opencode</code> <pre><code>https://codetether.example.com/v1/opencode/...\n</code></pre></p>"},{"location":"api/opencode/#status","title":"Status","text":""},{"location":"api/opencode/#check-opencode-status","title":"Check OpenCode Status","text":"<p>Check if the OpenCode bridge is available and initialized. Includes local runtime session information.</p> <pre><code>GET /v1/opencode/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"available\": true,\n  \"message\": \"OpenCode integration ready\",\n  \"opencode_binary\": \"/usr/local/bin/opencode\",\n  \"registered_codebases\": 3,\n  \"auto_start\": true,\n  \"runtime\": {\n    \"available\": true,\n    \"storage_path\": \"/home/user/.local/share/opencode/storage\",\n    \"projects\": 3,\n    \"sessions\": 247\n  }\n}\n</code></pre> Field Type Description <code>available</code> boolean Whether OpenCode bridge is initialized <code>message</code> string Human-readable status message <code>opencode_binary</code> string Path to OpenCode executable <code>registered_codebases</code> integer Number of registered codebases <code>auto_start</code> boolean Whether agents auto-start on trigger <code>runtime</code> object Local runtime session information (if available) <code>runtime.available</code> boolean Whether local OpenCode storage is detected <code>runtime.storage_path</code> string Path to OpenCode storage directory <code>runtime.projects</code> integer Number of local projects <code>runtime.sessions</code> integer Total number of local sessions"},{"location":"api/opencode/#models","title":"Models","text":""},{"location":"api/opencode/#list-available-models","title":"List Available Models","text":"<p>Get a list of AI models available for agent tasks.</p> <pre><code>GET /v1/opencode/models\n</code></pre> <p>Response</p> <pre><code>[\n  {\n    \"id\": \"anthropic/claude-sonnet-4-20250514\",\n    \"name\": \"Claude Sonnet 4\",\n    \"provider\": \"Anthropic\"\n  },\n  {\n    \"id\": \"openai/gpt-4o\",\n    \"name\": \"GPT-4o\",\n    \"provider\": \"OpenAI\"\n  },\n  {\n    \"id\": \"google/gemini-2.0-flash\",\n    \"name\": \"Gemini 2.0 Flash\",\n    \"provider\": \"Google\"\n  }\n]\n</code></pre> <p>Available Providers</p> <ul> <li>Anthropic: Claude Opus, Sonnet, Haiku models</li> <li>OpenAI: GPT-4o, o1, o3-mini models</li> <li>Google: Gemini 2.0/2.5 models</li> <li>DeepSeek: DeepSeek Chat, Reasoner</li> <li>xAI: Grok 2, Grok 3</li> <li>Azure AI Foundry: Custom Azure-hosted models</li> </ul>"},{"location":"api/opencode/#codebases","title":"Codebases","text":""},{"location":"api/opencode/#list-codebases","title":"List Codebases","text":"<p>Get all registered codebases.</p> <pre><code>GET /v1/opencode/codebases\n</code></pre> <p>Response</p> <pre><code>[\n  {\n    \"id\": \"cb_abc123\",\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"Main application codebase\",\n    \"worker_id\": \"worker-1\",\n    \"created_at\": \"2025-12-10T10:00:00Z\"\n  }\n]\n</code></pre>"},{"location":"api/opencode/#register-codebase","title":"Register Codebase","text":"<p>Register a new codebase for agent work.</p> <pre><code>POST /v1/opencode/codebases\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"name\": \"my-project\",\n  \"path\": \"/home/user/projects/my-project\",\n  \"description\": \"Main application codebase\",\n  \"agent_config\": {\n    \"default_model\": \"anthropic/claude-sonnet-4-20250514\",\n    \"auto_approve\": false\n  },\n  \"worker_id\": \"worker-1\"\n}\n</code></pre> Field Type Required Description <code>name</code> string \u2705 Display name for the codebase <code>path</code> string \u2705 Absolute path to the codebase directory <code>description</code> string \u274c Description of the codebase <code>agent_config</code> object \u274c Agent configuration overrides <code>worker_id</code> string \u274c Associate with specific worker <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"codebase\": {\n    \"id\": \"cb_abc123\",\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"Main application codebase\",\n    \"created_at\": \"2025-12-10T10:00:00Z\"\n  }\n}\n</code></pre>"},{"location":"api/opencode/#get-codebase","title":"Get Codebase","text":"<p>Get details of a specific codebase.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"id\": \"cb_abc123\",\n  \"name\": \"my-project\",\n  \"path\": \"/home/user/projects/my-project\",\n  \"description\": \"Main application codebase\",\n  \"worker_id\": \"worker-1\",\n  \"agent_config\": {\n    \"default_model\": \"anthropic/claude-sonnet-4-20250514\"\n  },\n  \"created_at\": \"2025-12-10T10:00:00Z\",\n  \"last_activity\": \"2025-12-10T15:30:00Z\"\n}\n</code></pre>"},{"location":"api/opencode/#delete-codebase","title":"Delete Codebase","text":"<p>Unregister a codebase.</p> <pre><code>DELETE /v1/opencode/codebases/{codebase_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Codebase cb_abc123 deleted\"\n}\n</code></pre>"},{"location":"api/opencode/#agent-actions","title":"Agent Actions","text":""},{"location":"api/opencode/#trigger-agent","title":"Trigger Agent","text":"<p>Start an AI agent on a codebase with a prompt.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/trigger\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"prompt\": \"Add comprehensive unit tests for the authentication module\",\n  \"agent\": \"build\",\n  \"model\": \"anthropic/claude-sonnet-4-20250514\",\n  \"files\": [\"src/auth/login.py\", \"src/auth/oauth.py\"],\n  \"metadata\": {\n    \"priority\": \"high\",\n    \"ticket\": \"JIRA-123\"\n  }\n}\n</code></pre> Field Type Required Description <code>prompt</code> string \u2705 The task instruction for the agent <code>agent</code> string \u274c Agent type: <code>build</code>, <code>plan</code>, <code>explore</code>, <code>general</code> (default: <code>build</code>) <code>model</code> string \u274c Model to use (default: codebase config or Claude Sonnet) <code>files</code> array \u274c Specific files to focus on <code>metadata</code> object \u274c Custom metadata to attach to the task <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"session_id\": \"sess_xyz789\",\n  \"task_id\": \"task_abc123\",\n  \"status\": \"running\",\n  \"message\": \"Agent started on codebase my-project\"\n}\n</code></pre>"},{"location":"api/opencode/#send-message","title":"Send Message","text":"<p>Send a follow-up message to a running agent session.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/message\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"message\": \"Also add integration tests for the OAuth flow\",\n  \"agent\": \"build\"\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Message sent to agent\"\n}\n</code></pre>"},{"location":"api/opencode/#interrupt-agent","title":"Interrupt Agent","text":"<p>Send an interrupt signal to pause the agent.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/interrupt\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Interrupt signal sent\"\n}\n</code></pre>"},{"location":"api/opencode/#stop-agent","title":"Stop Agent","text":"<p>Stop the running agent completely.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/stop\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Agent stopped\"\n}\n</code></pre>"},{"location":"api/opencode/#get-agent-status","title":"Get Agent Status","text":"<p>Check the current status of an agent on a codebase.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"codebase_id\": \"cb_abc123\",\n  \"status\": \"running\",\n  \"session_id\": \"sess_xyz789\",\n  \"current_task\": \"Adding unit tests\",\n  \"started_at\": \"2025-12-10T15:30:00Z\",\n  \"model\": \"anthropic/claude-sonnet-4-20250514\"\n}\n</code></pre>"},{"location":"api/opencode/#sessions","title":"Sessions","text":""},{"location":"api/opencode/#list-sessions","title":"List Sessions","text":"<p>Get session history for a codebase.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/sessions\n</code></pre> <p>Query Parameters</p> Parameter Type Description <code>limit</code> integer Maximum sessions to return (default: 50) <code>offset</code> integer Pagination offset <p>Response</p> <pre><code>{\n  \"sessions\": [\n    {\n      \"id\": \"sess_xyz789\",\n      \"codebase_id\": \"cb_abc123\",\n      \"started_at\": \"2025-12-10T15:30:00Z\",\n      \"ended_at\": \"2025-12-10T16:45:00Z\",\n      \"status\": \"completed\",\n      \"model\": \"anthropic/claude-sonnet-4-20250514\",\n      \"prompt\": \"Add unit tests for authentication\",\n      \"messages_count\": 24\n    }\n  ],\n  \"total\": 15,\n  \"limit\": 50,\n  \"offset\": 0\n}\n</code></pre>"},{"location":"api/opencode/#sync-sessions","title":"Sync Sessions","text":"<p>Sync sessions from OpenCode to the server database.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/sessions/sync\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"synced\": 5,\n  \"message\": \"Synced 5 sessions from OpenCode\"\n}\n</code></pre>"},{"location":"api/opencode/#get-session-messages","title":"Get Session Messages","text":"<p>Get all messages from a specific session.</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/messages?session_id={session_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"messages\": [\n    {\n      \"id\": \"msg_001\",\n      \"role\": \"user\",\n      \"content\": \"Add unit tests for authentication\",\n      \"timestamp\": \"2025-12-10T15:30:00Z\"\n    },\n    {\n      \"id\": \"msg_002\",\n      \"role\": \"assistant\",\n      \"content\": \"I'll analyze the authentication module and create comprehensive tests...\",\n      \"timestamp\": \"2025-12-10T15:30:05Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/opencode/#tasks","title":"Tasks","text":""},{"location":"api/opencode/#create-task","title":"Create Task","text":"<p>Create a queued task for an agent to pick up.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/tasks\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"title\": \"Add unit tests\",\n  \"prompt\": \"Add comprehensive unit tests for the authentication module\",\n  \"agent_type\": \"build\",\n  \"priority\": 1,\n  \"metadata\": {\n    \"ticket\": \"JIRA-123\"\n  }\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"task\": {\n    \"id\": \"task_abc123\",\n    \"codebase_id\": \"cb_abc123\",\n    \"title\": \"Add unit tests\",\n    \"status\": \"pending\",\n    \"priority\": 1,\n    \"created_at\": \"2025-12-10T15:30:00Z\"\n  }\n}\n</code></pre>"},{"location":"api/opencode/#list-tasks","title":"List Tasks","text":"<p>Get all tasks, optionally filtered.</p> <pre><code>GET /v1/opencode/tasks\nGET /v1/opencode/codebases/{codebase_id}/tasks\n</code></pre> <p>Query Parameters</p> Parameter Type Description <code>status</code> string Filter by status: <code>pending</code>, <code>running</code>, <code>completed</code>, <code>failed</code> <code>limit</code> integer Maximum tasks to return <p>Response</p> <pre><code>{\n  \"tasks\": [\n    {\n      \"id\": \"task_abc123\",\n      \"codebase_id\": \"cb_abc123\",\n      \"title\": \"Add unit tests\",\n      \"status\": \"completed\",\n      \"created_at\": \"2025-12-10T15:30:00Z\",\n      \"completed_at\": \"2025-12-10T16:45:00Z\"\n    }\n  ]\n}\n</code></pre>"},{"location":"api/opencode/#get-task","title":"Get Task","text":"<p>Get details of a specific task.</p> <pre><code>GET /v1/opencode/tasks/{task_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"id\": \"task_abc123\",\n  \"codebase_id\": \"cb_abc123\",\n  \"title\": \"Add unit tests\",\n  \"prompt\": \"Add comprehensive unit tests...\",\n  \"agent_type\": \"build\",\n  \"status\": \"running\",\n  \"priority\": 1,\n  \"session_id\": \"sess_xyz789\",\n  \"created_at\": \"2025-12-10T15:30:00Z\",\n  \"started_at\": \"2025-12-10T15:30:05Z\"\n}\n</code></pre>"},{"location":"api/opencode/#cancel-task","title":"Cancel Task","text":"<p>Cancel a pending or running task.</p> <pre><code>POST /v1/opencode/tasks/{task_id}/cancel\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Task cancelled\"\n}\n</code></pre>"},{"location":"api/opencode/#real-time-events","title":"Real-time Events","text":""},{"location":"api/opencode/#stream-agent-events","title":"Stream Agent Events","text":"<p>Subscribe to real-time events from an agent session via Server-Sent Events (SSE).</p> <pre><code>GET /v1/opencode/codebases/{codebase_id}/events\nAccept: text/event-stream\n</code></pre> <p>Event Types</p> <pre><code>event: status\ndata: {\"status\": \"running\", \"message\": \"Agent started\"}\n\nevent: output\ndata: {\"type\": \"text\", \"content\": \"Analyzing codebase structure...\"}\n\nevent: tool_use\ndata: {\"tool\": \"read_file\", \"args\": {\"path\": \"src/auth/login.py\"}}\n\nevent: file_change\ndata: {\"action\": \"create\", \"path\": \"tests/test_auth.py\"}\n\nevent: complete\ndata: {\"status\": \"completed\", \"summary\": \"Added 15 unit tests\"}\n\nevent: error\ndata: {\"error\": \"Model rate limit exceeded\", \"code\": \"RATE_LIMITED\"}\n</code></pre> <p>Example Client (JavaScript)</p> <pre><code>const events = new EventSource('/v1/opencode/codebases/cb_abc123/events');\n\nevents.addEventListener('output', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(data.content);\n});\n\nevents.addEventListener('complete', (e) =&gt; {\n  console.log('Agent completed!');\n  events.close();\n});\n\nevents.addEventListener('error', (e) =&gt; {\n  console.error('Stream error:', e);\n});\n</code></pre>"},{"location":"api/opencode/#runtime-sessions","title":"Runtime Sessions","text":"<p>The Runtime API provides immediate access to OpenCode sessions stored locally on the system. Unlike the codebase-based session APIs which require registration, these endpoints read directly from the OpenCode storage directory (<code>~/.local/share/opencode/storage/</code>).</p> <p>Zero Configuration</p> <p>When OpenCode is detected on a system, users can immediately browse and resume their existing sessions without registering codebases first.</p>"},{"location":"api/opencode/#check-runtime-status","title":"Check Runtime Status","text":"<p>Check if OpenCode runtime storage is available on the local system.</p> <pre><code>GET /v1/opencode/runtime/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"available\": true,\n  \"message\": \"OpenCode runtime detected\",\n  \"storage_path\": \"/home/user/.local/share/opencode/storage\",\n  \"projects\": 3,\n  \"sessions\": 247\n}\n</code></pre> Field Type Description <code>available</code> boolean Whether local OpenCode storage is detected <code>message</code> string Human-readable status <code>storage_path</code> string Path to OpenCode storage directory <code>projects</code> integer Number of projects found <code>sessions</code> integer Total number of sessions across all projects"},{"location":"api/opencode/#list-runtime-projects","title":"List Runtime Projects","text":"<p>Get all OpenCode projects detected on the local system.</p> <pre><code>GET /v1/opencode/runtime/projects\n</code></pre> <p>Response</p> <pre><code>{\n  \"projects\": [\n    {\n      \"id\": \"2e35f00d-abc123\",\n      \"worktree\": \"/home/user/my-project\",\n      \"vcs\": \"git\",\n      \"vcs_dir\": \"/home/user/my-project/.git\",\n      \"created_at\": 1733859600,\n      \"updated_at\": 1733918400,\n      \"session_count\": 45\n    },\n    {\n      \"id\": \"global\",\n      \"worktree\": \"/\",\n      \"vcs\": null,\n      \"vcs_dir\": null,\n      \"created_at\": 1733800000,\n      \"updated_at\": 1733910000,\n      \"session_count\": 5\n    }\n  ]\n}\n</code></pre> Field Type Description <code>id</code> string Unique project identifier (git commit hash or \"global\") <code>worktree</code> string Path to the project directory <code>vcs</code> string Version control system (e.g., \"git\") <code>vcs_dir</code> string Path to VCS directory <code>created_at</code> number Unix timestamp when project was first seen <code>updated_at</code> number Unix timestamp of last activity <code>session_count</code> integer Number of sessions for this project"},{"location":"api/opencode/#list-runtime-sessions","title":"List Runtime Sessions","text":"<p>Get all sessions with pagination, optionally filtered by project.</p> <pre><code>GET /v1/opencode/runtime/sessions\nGET /v1/opencode/runtime/sessions?project_id={project_id}\nGET /v1/opencode/runtime/sessions?limit=20&amp;offset=0\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>project_id</code> string - Filter sessions by project ID <code>limit</code> integer 50 Maximum sessions to return <code>offset</code> integer 0 Pagination offset <p>Response</p> <pre><code>{\n  \"sessions\": [\n    {\n      \"id\": \"sess_abc123\",\n      \"project_id\": \"2e35f00d-abc123\",\n      \"directory\": \"/home/user/my-project\",\n      \"title\": \"Implementing OAuth2 authentication flow\",\n      \"version\": \"1.0.0\",\n      \"created_at\": 1733859600,\n      \"updated_at\": 1733918400,\n      \"summary\": {\n        \"total_messages\": 24,\n        \"model\": \"claude-sonnet-4-20250514\"\n      }\n    }\n  ],\n  \"total\": 247,\n  \"limit\": 50,\n  \"offset\": 0\n}\n</code></pre> Field Type Description <code>id</code> string Unique session identifier <code>project_id</code> string Associated project ID <code>directory</code> string Working directory for the session <code>title</code> string Session title/description <code>version</code> string OpenCode version used <code>created_at</code> number Unix timestamp when session started <code>updated_at</code> number Unix timestamp of last activity <code>summary</code> object Session statistics"},{"location":"api/opencode/#get-runtime-session","title":"Get Runtime Session","text":"<p>Get details for a specific session by ID.</p> <pre><code>GET /v1/opencode/runtime/sessions/{session_id}\n</code></pre> <p>Response</p> <pre><code>{\n  \"session\": {\n    \"id\": \"sess_abc123\",\n    \"project_id\": \"2e35f00d-abc123\",\n    \"directory\": \"/home/user/my-project\",\n    \"title\": \"Implementing OAuth2 authentication flow\",\n    \"version\": \"1.0.0\",\n    \"created_at\": 1733859600,\n    \"updated_at\": 1733918400,\n    \"summary\": {\n      \"total_messages\": 24,\n      \"model\": \"claude-sonnet-4-20250514\"\n    }\n  }\n}\n</code></pre>"},{"location":"api/opencode/#get-session-messages_1","title":"Get Session Messages","text":"<p>Get the conversation history for a session.</p> <pre><code>GET /v1/opencode/runtime/sessions/{session_id}/messages\nGET /v1/opencode/runtime/sessions/{session_id}/messages?limit=20&amp;offset=0\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>limit</code> integer 50 Maximum messages to return <code>offset</code> integer 0 Pagination offset <p>Response</p> <pre><code>{\n  \"messages\": [\n    {\n      \"id\": \"msg_001\",\n      \"session_id\": \"sess_abc123\",\n      \"role\": \"user\",\n      \"created_at\": 1733859600,\n      \"model\": null,\n      \"cost\": null,\n      \"tokens\": null,\n      \"tool_calls\": []\n    },\n    {\n      \"id\": \"msg_002\",\n      \"session_id\": \"sess_abc123\",\n      \"role\": \"assistant\",\n      \"created_at\": 1733859605,\n      \"model\": \"claude-sonnet-4-20250514\",\n      \"cost\": 0.0015,\n      \"tokens\": {\"input\": 150, \"output\": 423},\n      \"tool_calls\": [\"read_file\", \"write_file\"]\n    }\n  ],\n  \"total\": 24,\n  \"limit\": 50,\n  \"offset\": 0,\n  \"session_id\": \"sess_abc123\"\n}\n</code></pre>"},{"location":"api/opencode/#get-session-parts","title":"Get Session Parts","text":"<p>Get message parts (content chunks) for a session.</p> <pre><code>GET /v1/opencode/runtime/sessions/{session_id}/parts\nGET /v1/opencode/runtime/sessions/{session_id}/parts?message_id={message_id}\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>message_id</code> string - Filter parts by specific message <code>limit</code> integer 100 Maximum parts to return <p>Response</p> <pre><code>{\n  \"parts\": [\n    {\n      \"id\": \"part_001\",\n      \"message_id\": \"msg_001\",\n      \"type\": \"text\",\n      \"content\": \"Please implement OAuth2 authentication...\",\n      \"created_at\": 1733859600\n    },\n    {\n      \"id\": \"part_002\",\n      \"message_id\": \"msg_002\",\n      \"type\": \"tool_use\",\n      \"tool_name\": \"read_file\",\n      \"arguments\": {\"path\": \"src/auth/oauth.py\"},\n      \"created_at\": 1733859605\n    }\n  ],\n  \"session_id\": \"sess_abc123\",\n  \"message_id\": null\n}\n</code></pre>"},{"location":"api/opencode/#database-api","title":"Database API","text":"<p>The Database API provides access to PostgreSQL-persisted data for workers, codebases, and sessions. These endpoints return data that survives server restarts and works across multiple replicas.</p> <p>PostgreSQL Required</p> <p>These endpoints require <code>DATABASE_URL</code> to be configured. Without PostgreSQL, they return empty results.</p>"},{"location":"api/opencode/#database-status","title":"Database Status","text":"<p>Check PostgreSQL connection status and statistics.</p> <pre><code>GET /v1/opencode/database/status\n</code></pre> <p>Response</p> <pre><code>{\n  \"available\": true,\n  \"message\": \"PostgreSQL connected\",\n  \"stats\": {\n    \"workers\": 3,\n    \"codebases\": 12,\n    \"tasks\": 45,\n    \"sessions\": 156\n  },\n  \"pool_size\": 10,\n  \"pool_idle\": 8\n}\n</code></pre> Field Type Description <code>available</code> boolean Whether PostgreSQL is connected <code>message</code> string Connection status message <code>stats.workers</code> integer Total registered workers <code>stats.codebases</code> integer Total registered codebases <code>stats.tasks</code> integer Total tasks in database <code>stats.sessions</code> integer Total sessions synced <code>pool_size</code> integer Connection pool size <code>pool_idle</code> integer Idle connections available"},{"location":"api/opencode/#list-all-sessions-database","title":"List All Sessions (Database)","text":"<p>Get all sessions across all codebases from PostgreSQL.</p> <pre><code>GET /v1/opencode/database/sessions\nGET /v1/opencode/database/sessions?limit=50&amp;offset=0\n</code></pre> <p>Query Parameters</p> Parameter Type Default Description <code>limit</code> integer 100 Maximum sessions to return <code>offset</code> integer 0 Pagination offset <p>Response</p> <pre><code>{\n  \"sessions\": [\n    {\n      \"id\": \"sess_xyz789\",\n      \"codebase_id\": \"cb_abc123\",\n      \"codebase_name\": \"my-project\",\n      \"codebase_path\": \"/home/user/my-project\",\n      \"title\": \"Implementing OAuth2 authentication\",\n      \"created_at\": \"2025-12-10T15:00:00Z\",\n      \"updated_at\": \"2025-12-10T16:30:00Z\",\n      \"summary\": {\n        \"total_messages\": 24,\n        \"model\": \"claude-sonnet-4-20250514\"\n      }\n    }\n  ],\n  \"total\": 156,\n  \"limit\": 100,\n  \"offset\": 0,\n  \"source\": \"postgresql\"\n}\n</code></pre>"},{"location":"api/opencode/#list-all-codebases-database","title":"List All Codebases (Database)","text":"<p>Get all registered codebases from PostgreSQL.</p> <pre><code>GET /v1/opencode/database/codebases\n</code></pre> <p>Response</p> <pre><code>{\n  \"codebases\": [\n    {\n      \"id\": \"cb_abc123\",\n      \"name\": \"my-project\",\n      \"path\": \"/home/user/my-project\",\n      \"description\": \"Main application\",\n      \"worker_id\": \"worker-1\",\n      \"status\": \"idle\",\n      \"created_at\": \"2025-12-10T10:00:00Z\",\n      \"updated_at\": \"2025-12-10T15:30:00Z\"\n    }\n  ],\n  \"total\": 12,\n  \"source\": \"postgresql\"\n}\n</code></pre>"},{"location":"api/opencode/#list-all-workers-database","title":"List All Workers (Database)","text":"<p>Get all registered workers from PostgreSQL.</p> <pre><code>GET /v1/opencode/database/workers\n</code></pre> <p>Response</p> <pre><code>{\n  \"workers\": [\n    {\n      \"worker_id\": \"abc123\",\n      \"name\": \"dev-vm-worker\",\n      \"hostname\": \"dev-vm.internal\",\n      \"capabilities\": [\"opencode\", \"build\", \"deploy\", \"test\"],\n      \"status\": \"active\",\n      \"registered_at\": \"2025-12-10T09:00:00Z\",\n      \"last_seen\": \"2025-12-10T15:30:00Z\"\n    }\n  ],\n  \"total\": 3,\n  \"source\": \"postgresql\"\n}\n</code></pre>"},{"location":"api/opencode/#workers","title":"Workers","text":"<p>The Worker API enables Agent Workers to connect, register codebases, and execute tasks.</p>"},{"location":"api/opencode/#register-worker","title":"Register Worker","text":"<p>Register a worker with the server.</p> <pre><code>POST /v1/opencode/workers/register\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"name\": \"dev-vm-worker\",\n  \"capabilities\": [\"opencode\", \"build\", \"deploy\", \"test\"],\n  \"hostname\": \"dev-vm.internal\"\n}\n</code></pre> Field Type Required Description <code>worker_id</code> string \u2705 Unique worker identifier <code>name</code> string \u2705 Human-readable worker name <code>capabilities</code> array \u274c List of worker capabilities <code>hostname</code> string \u274c Machine hostname <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"worker_id\": \"abc123\",\n  \"message\": \"Worker registered\"\n}\n</code></pre>"},{"location":"api/opencode/#unregister-worker","title":"Unregister Worker","text":"<p>Unregister a worker from the server.</p> <pre><code>POST /v1/opencode/workers/{worker_id}/unregister\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"message\": \"Worker unregistered\"\n}\n</code></pre>"},{"location":"api/opencode/#stream-task-output","title":"Stream Task Output","text":"<p>Stream real-time output from a task execution.</p> <pre><code>POST /v1/opencode/tasks/{task_id}/output\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"output\": \"Analyzing codebase structure...\",\n  \"timestamp\": \"2025-12-10T15:30:05Z\"\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true\n}\n</code></pre>"},{"location":"api/opencode/#update-task-status","title":"Update Task Status","text":"<p>Update the status of a task (used by workers).</p> <pre><code>PUT /v1/opencode/tasks/{task_id}/status\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"status\": \"completed\",\n  \"worker_id\": \"abc123\",\n  \"result\": \"Added 15 unit tests to the authentication module\"\n}\n</code></pre> Field Type Required Description <code>status</code> string \u2705 New status: <code>running</code>, <code>completed</code>, <code>failed</code> <code>worker_id</code> string \u2705 Worker identifier <code>result</code> string \u274c Task result (for completed) <code>error</code> string \u274c Error message (for failed) <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"task_id\": \"task_abc123\",\n  \"status\": \"completed\"\n}\n</code></pre>"},{"location":"api/opencode/#sync-sessions_1","title":"Sync Sessions","text":"<p>Sync OpenCode sessions from a worker to the server.</p> <pre><code>POST /v1/opencode/codebases/{codebase_id}/sessions/sync\nContent-Type: application/json\n</code></pre> <p>Request Body</p> <pre><code>{\n  \"worker_id\": \"abc123\",\n  \"sessions\": [\n    {\n      \"id\": \"sess_xyz789\",\n      \"title\": \"Implementing OAuth2 flow\",\n      \"project_id\": \"2e35f00d\",\n      \"created_at\": \"2025-12-10T15:00:00Z\",\n      \"updated_at\": \"2025-12-10T16:30:00Z\",\n      \"summary\": {\n        \"total_messages\": 24,\n        \"model\": \"claude-sonnet-4-20250514\"\n      }\n    }\n  ]\n}\n</code></pre> <p>Response</p> <pre><code>{\n  \"success\": true,\n  \"synced\": 5,\n  \"message\": \"Synced 5 sessions\"\n}\n</code></pre>"},{"location":"api/opencode/#error-responses","title":"Error Responses","text":"<p>All endpoints return errors in a consistent format:</p> <pre><code>{\n  \"detail\": \"Codebase not found\"\n}\n</code></pre> Status Code Description <code>400</code> Bad request - invalid parameters <code>404</code> Resource not found <code>409</code> Conflict - e.g., agent already running <code>503</code> OpenCode bridge not available"},{"location":"api/opencode/#examples","title":"Examples","text":""},{"location":"api/opencode/#complete-workflow","title":"Complete Workflow","text":"<pre><code># 1. Check status\ncurl https://codetether.run/v1/opencode/status\n\n# 2. Register a codebase\ncurl -X POST https://codetether.run/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-app\",\n    \"path\": \"/home/user/my-app\",\n    \"description\": \"My application\"\n  }'\n\n# 3. List available models\ncurl https://codetether.run/v1/opencode/models\n\n# 4. Trigger an agent\ncurl -X POST https://codetether.run/v1/opencode/codebases/cb_abc123/trigger \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"prompt\": \"Refactor the database module to use async/await\",\n    \"agent\": \"build\",\n    \"model\": \"anthropic/claude-sonnet-4-20250514\"\n  }'\n\n# 5. Watch events (in another terminal)\ncurl -N https://codetether.run/v1/opencode/codebases/cb_abc123/events\n\n# 6. Send follow-up message\ncurl -X POST https://codetether.run/v1/opencode/codebases/cb_abc123/message \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"message\": \"Also add type hints\"}'\n\n# 7. Stop the agent\ncurl -X POST https://codetether.run/v1/opencode/codebases/cb_abc123/stop\n</code></pre>"},{"location":"api/overview/","title":"API Overview","text":"<p>CodeTether Server exposes multiple API endpoints for different purposes.</p>"},{"location":"api/overview/#endpoint-summary","title":"Endpoint Summary","text":"Endpoint Port Protocol Description <code>/v1/a2a</code> 8000 JSON-RPC 2.0 A2A Protocol - agent-to-agent communication <code>/v1/opencode/*</code> 8000 REST OpenCode integration - codebase &amp; session management <code>/v1/monitor/*</code> 8000 REST Monitoring - agents, messages, stats <code>/v1/auth/*</code> 8000 REST Authentication - tokens, sessions <code>/mcp/*</code> 9000 JSON-RPC MCP Protocol - tool integration <code>/.well-known/agent-card.json</code> 8000 REST A2A agent discovery <code>/health</code> 8000 REST Health check"},{"location":"api/overview/#base-urls","title":"Base URLs","text":"<pre><code># A2A Protocol (JSON-RPC)\nPOST https://codetether.example.com/v1/a2a\n\n# REST APIs\nGET/POST https://codetether.example.com/v1/opencode/...\nGET/POST https://codetether.example.com/v1/monitor/...\n\n# MCP Protocol\nPOST https://codetether.example.com:9000/mcp\n</code></pre>"},{"location":"api/overview/#authentication","title":"Authentication","text":""},{"location":"api/overview/#bearer-token","title":"Bearer Token","text":"<pre><code>curl -X POST https://codetether.example.com/v1/a2a \\\n  -H \"Authorization: Bearer your-api-token\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"jsonrpc\": \"2.0\", ...}'\n</code></pre>"},{"location":"api/overview/#keycloak-oidc","title":"Keycloak OIDC","text":"<p>If Keycloak is configured, obtain a token first:</p> <pre><code># Get access token\nTOKEN=$(curl -s -X POST \"https://auth.example.com/realms/myrealm/protocol/openid-connect/token\" \\\n  -d \"client_id=codetether\" \\\n  -d \"client_secret=your-secret\" \\\n  -d \"grant_type=client_credentials\" | jq -r '.access_token')\n\n# Use token\ncurl -X POST https://codetether.example.com/v1/a2a \\\n  -H \"Authorization: Bearer $TOKEN\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"jsonrpc\": \"2.0\", ...}'\n</code></pre>"},{"location":"api/overview/#common-response-codes","title":"Common Response Codes","text":"Code Description <code>200</code> Success <code>400</code> Bad request - invalid parameters <code>401</code> Unauthorized - missing or invalid token <code>403</code> Forbidden - insufficient permissions <code>404</code> Not found - resource doesn't exist <code>500</code> Server error <code>503</code> Service unavailable - dependency not ready"},{"location":"api/overview/#api-sections","title":"API Sections","text":"<ul> <li> <p> JSON-RPC Methods</p> <p>A2A Protocol JSON-RPC methods for agent communication</p> <p> JSON-RPC Reference</p> </li> <li> <p> REST Endpoints</p> <p>REST API for monitoring, health, and management</p> <p> REST Reference</p> </li> <li> <p> OpenCode API</p> <p>Codebase registration, sessions, and AI coding agents</p> <p> OpenCode Reference</p> </li> <li> <p> SSE Events</p> <p>Server-Sent Events for real-time streaming</p> <p> SSE Reference</p> </li> </ul>"},{"location":"api/rest/","title":"REST Endpoints","text":"<p>CodeTether exposes REST APIs for management and monitoring.</p>"},{"location":"api/rest/#monitor-api","title":"Monitor API","text":"Method Endpoint Description GET /v1/monitor/agents List agents GET /v1/monitor/messages Get messages GET /v1/monitor/stats Get statistics GET /v1/monitor/workers List connected workers"},{"location":"api/rest/#opencode-api","title":"OpenCode API","text":"Method Endpoint Description GET /v1/opencode/status Check OpenCode status (includes runtime info) GET /v1/opencode/codebases List registered codebases POST /v1/opencode/codebases Register a codebase GET /v1/opencode/models List available AI models GET /v1/opencode/tasks List all tasks POST /v1/opencode/codebases/{id}/tasks Create a task for a codebase GET /v1/opencode/tasks/{id} Get task details PUT /v1/opencode/tasks/{id}/status Update task status POST /v1/opencode/tasks/{id}/output Stream task output POST /v1/opencode/tasks/{id}/cancel Cancel a task"},{"location":"api/rest/#worker-api","title":"Worker API","text":"<p>Endpoints used by Agent Workers.</p> Method Endpoint Description POST /v1/opencode/workers/register Register a worker POST /v1/opencode/workers/{id}/unregister Unregister a worker POST /v1/opencode/codebases/{id}/sessions/sync Sync sessions from worker"},{"location":"api/rest/#opencode-runtime-api","title":"OpenCode Runtime API","text":"<p>Direct access to local OpenCode sessions without codebase registration.</p> Method Endpoint Description GET /v1/opencode/runtime/status Check if OpenCode is installed locally GET /v1/opencode/runtime/projects List all local projects GET /v1/opencode/runtime/sessions List all sessions (paginated) GET /v1/opencode/runtime/sessions/{id} Get session details GET /v1/opencode/runtime/sessions/{id}/messages Get session messages GET /v1/opencode/runtime/sessions/{id}/parts Get message content parts"},{"location":"api/rest/#health","title":"Health","text":"Method Endpoint Description GET /health Health check <p>See also: OpenCode API | Agent Worker</p>"},{"location":"api/sse/","title":"SSE Events","text":"<p>CodeTether uses Server-Sent Events for real-time streaming.</p>"},{"location":"api/sse/#connecting","title":"Connecting","text":"<pre><code>const events = new EventSource('/v1/opencode/codebases/{id}/events');\n</code></pre>"},{"location":"api/sse/#event-types","title":"Event Types","text":"Event Description <code>output</code> Agent text output <code>tool_use</code> Tool invocation <code>file_change</code> File modifications <code>status</code> Status change <code>complete</code> Task completed <code>error</code> Error occurred"},{"location":"api/sse/#example","title":"Example","text":"<pre><code>events.addEventListener('output', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(data.content);\n});\n</code></pre>"},{"location":"auth/keycloak/","title":"Keycloak Setup","text":"<p>Integrate CodeTether with Keycloak for enterprise SSO.</p>"},{"location":"auth/keycloak/#prerequisites","title":"Prerequisites","text":"<ul> <li>Keycloak server</li> <li>Admin access to create clients</li> </ul>"},{"location":"auth/keycloak/#configuration","title":"Configuration","text":""},{"location":"auth/keycloak/#option-a-use-the-keycloak-ui","title":"Option A: Use the Keycloak UI","text":"<ol> <li>Create a client in Keycloak</li> <li>Set environment variables:</li> </ol> <pre><code>export KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=codetether\nexport KEYCLOAK_CLIENT_SECRET=your-secret\n</code></pre> <ol> <li>Restart CodeTether</li> </ol>"},{"location":"auth/keycloak/#option-b-createupdate-the-client-via-cli-recommended","title":"Option B: Create/update the client via CLI (recommended)","text":"<p>This repo includes a helper script that uses the Keycloak Admin CLI (<code>kcadm.sh</code>) to upsert an OIDC client with:</p> <ul> <li>Authorization Code flow enabled (works with browser session + PKCE)</li> <li>Direct Access Grants enabled (used by <code>/v1/auth/login</code> password flow)</li> <li>Redirect URIs for the local session test script</li> </ul>"},{"location":"auth/keycloak/#run-it","title":"Run it","text":"<p>Set the required environment variables and run:</p> <pre><code>make keycloak-client\n</code></pre>"},{"location":"auth/keycloak/#required-environment-variables","title":"Required environment variables","text":"<pre><code>export KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=a2a-monitor\n\n# Keycloak admin creds (used only for provisioning)\nexport KEYCLOAK_ADMIN_USERNAME=admin\nexport KEYCLOAK_ADMIN_PASSWORD=your-admin-password\n</code></pre>"},{"location":"auth/keycloak/#optional-knobs","title":"Optional knobs","text":"<pre><code># Defaults are suitable for scripts/test_api_keycloak_session.py\nexport KEYCLOAK_REDIRECT_URIS=\"http://127.0.0.1:8765/*,http://localhost:8765/*\"\nexport KEYCLOAK_WEB_ORIGINS=\"http://127.0.0.1:8765,http://localhost:8765\"\n\n# Set to true if you want a public client (no client secret)\nexport KEYCLOAK_PUBLIC_CLIENT=false\n</code></pre> <p>After the script runs, it prints <code>KEYCLOAK_CLIENT_SECRET=...</code> (for confidential clients). Copy that into your environment / <code>.env</code> / Helm values.</p> <p>See Configuration for all options.</p>"},{"location":"auth/overview/","title":"Authentication","text":"<p>CodeTether supports multiple authentication methods.</p>"},{"location":"auth/overview/#options","title":"Options","text":"<ol> <li>API Tokens - Simple bearer token authentication</li> <li>Keycloak OIDC - Enterprise SSO integration</li> </ol>"},{"location":"auth/overview/#quick-setup","title":"Quick Setup","text":""},{"location":"auth/overview/#api-tokens","title":"API Tokens","text":"<pre><code>export A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:your-secret-token\"\n</code></pre>"},{"location":"auth/overview/#keycloak","title":"Keycloak","text":"<pre><code>export KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=codetether\n</code></pre> <p>See Keycloak Setup for full configuration.</p>"},{"location":"auth/tokens/","title":"API Tokens","text":"<p>Simple bearer token authentication for CodeTether.</p>"},{"location":"auth/tokens/#setup","title":"Setup","text":"<pre><code>export A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:token1,worker:token2\"\n</code></pre>"},{"location":"auth/tokens/#usage","title":"Usage","text":"<pre><code>curl -H \"Authorization: Bearer token1\" \\\n  https://codetether.example.com/v1/a2a\n</code></pre>"},{"location":"auth/tokens/#multiple-tokens","title":"Multiple Tokens","text":"<p>Define multiple named tokens:</p> <pre><code>A2A_AUTH_TOKENS=\"admin:super-secret,readonly:read-only-token,worker:worker-token\"\n</code></pre>"},{"location":"concepts/a2a-protocol/","title":"A2A Protocol","text":"<p>CodeTether Server is a production implementation of the A2A (Agent-to-Agent) Protocol, an open standard from the Linux Foundation.</p>"},{"location":"concepts/a2a-protocol/#what-is-a2a","title":"What is A2A?","text":"<p>The Agent-to-Agent Protocol defines how AI agents communicate, collaborate, and solve problems together. It provides:</p> <ul> <li>Standardized discovery via Agent Cards</li> <li>Task-based communication with JSON-RPC 2.0</li> <li>Real-time streaming via Server-Sent Events</li> <li>Multi-turn conversations with session state</li> </ul>"},{"location":"concepts/a2a-protocol/#specification-compliance","title":"Specification Compliance","text":"<p>CodeTether implements the complete A2A Protocol specification:</p> Section Feature Status \u00a75 Agent Discovery (Agent Card) \u2705 Full \u00a76 Protocol Data Objects \u2705 Full \u00a77 JSON-RPC Methods \u2705 Full \u00a78 Streaming (SSE) \u2705 Full \u00a79 Common Workflows \u2705 Full"},{"location":"concepts/a2a-protocol/#agent-card","title":"Agent Card","text":"<p>Every CodeTether server exposes an Agent Card at <code>/.well-known/agent-card.json</code>:</p> <pre><code>curl https://codetether.run/.well-known/agent-card.json\n</code></pre> <pre><code>{\n  \"name\": \"CodeTether Server\",\n  \"description\": \"Production A2A coordination server\",\n  \"url\": \"https://codetether.run\",\n  \"version\": \"1.0.0\",\n  \"provider\": {\n    \"organization\": \"CodeTether\",\n    \"url\": \"https://codetether.run\"\n  },\n  \"capabilities\": {\n    \"streaming\": true,\n    \"pushNotifications\": true,\n    \"stateTransitionHistory\": true\n  },\n  \"skills\": [\n    {\n      \"id\": \"task-coordination\",\n      \"name\": \"Task Coordination\",\n      \"description\": \"Coordinate tasks between multiple agents\"\n    },\n    {\n      \"id\": \"code-assistance\",\n      \"name\": \"Code Assistance\",\n      \"description\": \"AI-powered coding assistance via OpenCode\"\n    }\n  ],\n  \"authentication\": {\n    \"schemes\": [\"bearer\"]\n  }\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#json-rpc-methods","title":"JSON-RPC Methods","text":"<p>CodeTether supports all standard A2A methods:</p>"},{"location":"concepts/a2a-protocol/#taskssend","title":"tasks/send","text":"<p>Send a task to the agent.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/send\",\n  \"params\": {\n    \"id\": \"task-123\",\n    \"message\": {\n      \"role\": \"user\",\n      \"parts\": [{\"text\": \"Analyze this code\"}]\n    }\n  },\n  \"id\": \"1\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#taskssendsubscribe","title":"tasks/sendSubscribe","text":"<p>Send a task and subscribe to streaming updates.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/sendSubscribe\",\n  \"params\": {\n    \"message\": {\n      \"role\": \"user\",\n      \"parts\": [{\"text\": \"Generate a report\"}]\n    }\n  },\n  \"id\": \"1\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#tasksget","title":"tasks/get","text":"<p>Get the current state of a task.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/get\",\n  \"params\": {\n    \"id\": \"task-123\"\n  },\n  \"id\": \"2\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#taskscancel","title":"tasks/cancel","text":"<p>Cancel a running task.</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/cancel\",\n  \"params\": {\n    \"id\": \"task-123\"\n  },\n  \"id\": \"3\"\n}\n</code></pre>"},{"location":"concepts/a2a-protocol/#learn-more","title":"Learn More","text":"<ul> <li>A2A Protocol Specification</li> <li>A2A Key Concepts</li> <li>A2A and MCP</li> </ul>"},{"location":"concepts/architecture/","title":"Architecture","text":"<p>CodeTether Server is designed as a modular, scalable system for running AI agents in production.</p>"},{"location":"concepts/architecture/#high-level-architecture","title":"High-Level Architecture","text":"<pre><code>graph TB\n    subgraph Clients\n        Web[Web Dashboard]\n        CLI[CLI / SDK]\n        Agents[External Agents]\n    end\n\n    subgraph \"CodeTether Server\"\n        API[FastAPI Server&lt;br/&gt;Port 8000]\n        A2A[A2A Protocol&lt;br/&gt;Handler]\n        Monitor[Monitor API]\n        OpenCode[OpenCode Bridge]\n        MCP[MCP Server&lt;br/&gt;Port 9000]\n    end\n\n    subgraph Infrastructure\n        Redis[(Redis&lt;br/&gt;Message Broker)]\n        DB[(SQLite/Postgres&lt;br/&gt;Persistence)]\n        Auth[Keycloak&lt;br/&gt;Authentication]\n    end\n\n    subgraph Workers\n        W1[Worker 1&lt;br/&gt;+ OpenCode]\n        W2[Worker 2&lt;br/&gt;+ OpenCode]\n        W3[Worker N&lt;br/&gt;+ OpenCode]\n    end\n\n    Web --&gt; API\n    CLI --&gt; API\n    Agents --&gt; A2A\n\n    API --&gt; A2A\n    API --&gt; Monitor\n    API --&gt; OpenCode\n    API --&gt; MCP\n\n    A2A --&gt; Redis\n    Monitor --&gt; DB\n    OpenCode --&gt; DB\n    API --&gt; Auth\n\n    Redis --&gt; W1\n    Redis --&gt; W2\n    Redis --&gt; W3</code></pre>"},{"location":"concepts/architecture/#components","title":"Components","text":""},{"location":"concepts/architecture/#fastapi-server-port-8000","title":"FastAPI Server (Port 8000)","text":"<p>The main HTTP server handling:</p> <ul> <li>A2A Protocol (<code>/v1/a2a</code>) - JSON-RPC 2.0 agent communication</li> <li>REST APIs (<code>/v1/monitor/*</code>, <code>/v1/opencode/*</code>) - Management and monitoring</li> <li>Agent Card (<code>/.well-known/agent-card.json</code>) - A2A discovery</li> <li>Health Check (<code>/health</code>) - Liveness/readiness probes</li> </ul>"},{"location":"concepts/architecture/#mcp-server-port-9000","title":"MCP Server (Port 9000)","text":"<p>Model Context Protocol server for tool integration:</p> <ul> <li>Expose CodeTether capabilities as MCP tools</li> <li>Allow external agents to use CodeTether tools</li> <li>Bridge between A2A and MCP protocols</li> </ul>"},{"location":"concepts/architecture/#message-broker-redis","title":"Message Broker (Redis)","text":"<p>Handles distributed communication:</p> <ul> <li>Task Queue - Distribute tasks to workers</li> <li>Pub/Sub - Real-time event distribution</li> <li>Session State - Shared state across instances</li> </ul>"},{"location":"concepts/architecture/#opencode-bridge","title":"OpenCode Bridge","text":"<p>Integrates AI coding agents:</p> <ul> <li>Register and manage codebases</li> <li>Trigger and control OpenCode agents</li> <li>Stream real-time agent output</li> <li>Manage session history</li> </ul>"},{"location":"concepts/architecture/#monitor-api","title":"Monitor API","text":"<p>Observability and management:</p> <ul> <li>Agent status and health</li> <li>Message history</li> <li>Real-time SSE streams</li> <li>Statistics and metrics</li> </ul>"},{"location":"concepts/architecture/#data-flow","title":"Data Flow","text":""},{"location":"concepts/architecture/#task-execution-flow","title":"Task Execution Flow","text":"<pre><code>sequenceDiagram\n    participant C as Client\n    participant S as CodeTether Server\n    participant R as Redis\n    participant W as Worker\n    participant O as OpenCode\n\n    C-&gt;&gt;S: POST /v1/a2a (tasks/send)\n    S-&gt;&gt;R: Publish task\n    R-&gt;&gt;W: Task notification\n    W-&gt;&gt;O: Start agent\n    O-&gt;&gt;W: Stream output\n    W-&gt;&gt;R: Publish updates\n    R-&gt;&gt;S: Update notification\n    S-&gt;&gt;C: SSE events\n    O-&gt;&gt;W: Complete\n    W-&gt;&gt;R: Task complete\n    R-&gt;&gt;S: Complete notification\n    S-&gt;&gt;C: Final result</code></pre>"},{"location":"concepts/architecture/#real-time-streaming-flow","title":"Real-time Streaming Flow","text":"<pre><code>sequenceDiagram\n    participant C as Client\n    participant S as Server\n    participant O as OpenCode\n\n    C-&gt;&gt;S: GET /v1/opencode/codebases/{id}/events\n    Note over C,S: SSE Connection Established\n    O-&gt;&gt;S: Output chunk\n    S-&gt;&gt;C: event: output\n    O-&gt;&gt;S: Tool use\n    S-&gt;&gt;C: event: tool_use\n    O-&gt;&gt;S: File change\n    S-&gt;&gt;C: event: file_change\n    O-&gt;&gt;S: Complete\n    S-&gt;&gt;C: event: complete</code></pre>"},{"location":"concepts/architecture/#deployment-models","title":"Deployment Models","text":""},{"location":"concepts/architecture/#single-instance","title":"Single Instance","text":"<p>Simplest deployment - everything in one process:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502     CodeTether Server        \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 API     \u2502 \u2502 OpenCode  \u2502  \u2502\n\u2502  \u2502 Server  \u2502 \u2502 Bridge    \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510 \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502\n\u2502  \u2502 MCP     \u2502 \u2502 SQLite    \u2502  \u2502\n\u2502  \u2502 Server  \u2502 \u2502 DB        \u2502  \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#distributed-with-workers","title":"Distributed with Workers","text":"<p>Scale horizontally with dedicated workers:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510     \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 CodeTether API   \u2502     \u2502 CodeTether API   \u2502\n\u2502 (Instance 1)    \u2502     \u2502 (Instance 2)    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518     \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         \u2502                       \u2502\n         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n              \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n              \u2502   Redis     \u2502\n              \u2502   Cluster   \u2502\n              \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                     \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502                \u2502                \u2502\n\u250c\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2510       \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510      \u250c\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2510\n\u2502Worker \u2502       \u2502 Worker  \u2502      \u2502 Worker  \u2502\n\u2502   1   \u2502       \u2502    2    \u2502      \u2502    N    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518       \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518      \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#kubernetes","title":"Kubernetes","text":"<p>Full production deployment:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                  Kubernetes                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502              Ingress                     \u2502    \u2502\n\u2502  \u2502   codetether.run \u2192 API Service           \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 API Pod 1    \u2502  \u2502 API Pod 2    \u2502 \u2190 HPA      \u2502\n\u2502  \u2502 (Deployment) \u2502  \u2502 (Deployment) \u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502 Worker Pod 1 \u2502  \u2502 Worker Pod 2 \u2502 \u2190 HPA      \u2502\n\u2502  \u2502 (StatefulSet)\u2502  \u2502 (StatefulSet)\u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2502                                                  \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510            \u2502\n\u2502  \u2502    Redis     \u2502  \u2502   Postgres   \u2502            \u2502\n\u2502  \u2502 (StatefulSet)\u2502  \u2502 (StatefulSet)\u2502            \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518            \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"concepts/architecture/#security-model","title":"Security Model","text":""},{"location":"concepts/architecture/#authentication-layers","title":"Authentication Layers","text":"<ol> <li>Ingress - TLS termination, rate limiting</li> <li>API Gateway - Token validation, OIDC</li> <li>Service - Role-based access control</li> <li>Data - Encryption at rest</li> </ol>"},{"location":"concepts/architecture/#network-security","title":"Network Security","text":"<ul> <li>Internal services communicate via ClusterIP</li> <li>External access only through Ingress</li> <li>Redis protected by NetworkPolicy</li> <li>Secrets managed via Kubernetes Secrets or Vault</li> </ul>"},{"location":"concepts/architecture/#next-steps","title":"Next Steps","text":"<ul> <li>Installation</li> <li>Kubernetes Deployment</li> <li>Distributed Workers</li> </ul>"},{"location":"concepts/message-broker/","title":"Message Broker","text":"<p>CodeTether uses Redis as a message broker for distributed agent communication and task queuing.</p>"},{"location":"concepts/message-broker/#overview","title":"Overview","text":"<p>The message broker enables:</p> <ul> <li>Task Distribution - Route tasks to appropriate workers</li> <li>Pub/Sub Messaging - Real-time event distribution</li> <li>State Synchronization - Share state across instances</li> </ul>"},{"location":"concepts/message-broker/#configuration","title":"Configuration","text":"<pre><code>export A2A_REDIS_URL=redis://localhost:6379\n</code></pre>"},{"location":"concepts/message-broker/#redis-requirements","title":"Redis Requirements","text":"<ul> <li>Redis 6.0 or later</li> <li>Recommended: Redis Cluster for high availability</li> </ul>"},{"location":"concepts/message-broker/#message-channels","title":"Message Channels","text":"Channel Purpose <code>a2a:tasks</code> Task queue <code>a2a:events</code> Real-time events <code>a2a:agents</code> Agent status updates"},{"location":"concepts/message-broker/#next-steps","title":"Next Steps","text":"<ul> <li>Architecture</li> <li>Distributed Workers</li> </ul>"},{"location":"concepts/task-management/","title":"Task Management","text":"<p>CodeTether provides comprehensive task management for AI agent workflows.</p>"},{"location":"concepts/task-management/#task-lifecycle","title":"Task Lifecycle","text":"<pre><code>stateDiagram-v2\n    [*] --&gt; Pending: Create\n    Pending --&gt; Running: Assigned\n    Running --&gt; Completed: Success\n    Running --&gt; Failed: Error\n    Pending --&gt; Cancelled: Cancel\n    Running --&gt; Cancelled: Cancel\n    Completed --&gt; [*]\n    Failed --&gt; [*]\n    Cancelled --&gt; [*]</code></pre>"},{"location":"concepts/task-management/#task-states","title":"Task States","text":"State Description <code>pending</code> Task created, waiting for worker <code>running</code> Worker is executing the task <code>completed</code> Task finished successfully <code>failed</code> Task encountered an error <code>cancelled</code> Task was cancelled"},{"location":"concepts/task-management/#creating-tasks","title":"Creating Tasks","text":""},{"location":"concepts/task-management/#via-a2a-protocol","title":"Via A2A Protocol","text":"<pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"tasks/send\",\n  \"params\": {\n    \"message\": {\n      \"role\": \"user\",\n      \"parts\": [{\"text\": \"Analyze this codebase\"}]\n    }\n  },\n  \"id\": \"1\"\n}\n</code></pre>"},{"location":"concepts/task-management/#via-opencode-api","title":"Via OpenCode API","text":"<pre><code>curl -X POST /v1/opencode/codebases/{id}/tasks \\\n  -d '{\"title\": \"Add tests\", \"prompt\": \"Add unit tests\"}'\n</code></pre>"},{"location":"concepts/task-management/#task-priority","title":"Task Priority","text":"<p>Tasks can be prioritized (higher number = higher priority):</p> <pre><code>{\n  \"title\": \"Urgent fix\",\n  \"prompt\": \"Fix the authentication bug\",\n  \"priority\": 10\n}\n</code></pre>"},{"location":"concepts/task-management/#next-steps","title":"Next Steps","text":"<ul> <li>API Reference</li> <li>Distributed Workers</li> </ul>"},{"location":"deployment/docker/","title":"Docker Deployment","text":"<p>Deploy CodeTether Server using Docker.</p>"},{"location":"deployment/docker/#quick-start","title":"Quick Start","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#connecting-to-host-opencode","title":"Connecting to Host OpenCode","text":"<p>When running CodeTether in Docker and you want to connect to OpenCode running on your host machine:</p>"},{"location":"deployment/docker/#docker-desktop-macwindows","title":"Docker Desktop (Mac/Windows)","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e OPENCODE_HOST=host.docker.internal \\\n  -e OPENCODE_PORT=9777 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#linux","title":"Linux","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  --add-host=host.docker.internal:host-gateway \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e OPENCODE_HOST=host.docker.internal \\\n  -e OPENCODE_PORT=9777 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#using-host-ip","title":"Using Host IP","text":"<pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e OPENCODE_HOST=192.168.1.100 \\\n  -e OPENCODE_PORT=9777 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"deployment/docker/#docker-compose","title":"Docker Compose","text":"<pre><code>version: '3.8'\nservices:\n  codetether:\n    image: ghcr.io/rileyseaburg/codetether-server:latest\n    ports:\n      - \"8000:8000\"\n      - \"9000:9000\"\n    environment:\n      - A2A_REDIS_URL=redis://redis:6379\n      - OPENCODE_HOST=host.docker.internal\n      - OPENCODE_PORT=9777\n    extra_hosts:\n      - \"host.docker.internal:host-gateway\"  # For Linux\n    depends_on:\n      - redis\n  redis:\n    image: redis:7-alpine\n</code></pre> <p>See Installation for more options.</p>"},{"location":"deployment/helm/","title":"Helm Charts","text":"<p>CodeTether provides official Helm charts for Kubernetes deployment.</p>"},{"location":"deployment/helm/#installation","title":"Installation","text":"<pre><code>helm repo add codetether https://charts.codetether.run\nhelm install codetether codetether/a2a-server\n</code></pre>"},{"location":"deployment/helm/#configuration","title":"Configuration","text":"<p>See <code>values.yaml</code> for all configuration options.</p>"},{"location":"deployment/helm/#postgresql-configuration","title":"PostgreSQL Configuration","text":"<p>For durable persistence across restarts and replicas, configure an external PostgreSQL database:</p> <pre><code># values.yaml\nexternalPostgresql:\n  enabled: true\n  url: \"postgresql://postgres:password@db.example.com:5432/codetether\"\n</code></pre> <p>Or use a Kubernetes secret:</p> <pre><code>externalPostgresql:\n  enabled: true\n  existingSecret: \"codetether-db-secret\"\n  secretKey: \"DATABASE_URL\"\n</code></pre>"},{"location":"deployment/helm/#redis-configuration","title":"Redis Configuration","text":"<pre><code>redis:\n  enabled: true  # Deploy Redis alongside the server\n  # Or use external Redis:\n  # url: \"redis://:password@redis.example.com:6379\"\n</code></pre>"},{"location":"deployment/helm/#upgrading","title":"Upgrading","text":"<pre><code>helm upgrade codetether codetether/a2a-server\n</code></pre>"},{"location":"deployment/helm/#values-reference","title":"Values Reference","text":"Key Default Description <code>externalPostgresql.enabled</code> <code>false</code> Enable external PostgreSQL <code>externalPostgresql.url</code> \u2014 PostgreSQL connection URL <code>externalPostgresql.existingSecret</code> \u2014 Use existing secret for DATABASE_URL <code>redis.enabled</code> <code>true</code> Deploy Redis <code>redis.url</code> \u2014 External Redis URL <code>blueGreen.enabled</code> <code>false</code> Enable blue-green deployment <code>replicaCount</code> <code>1</code> Number of replicas"},{"location":"deployment/kubernetes/","title":"Kubernetes Deployment","text":"<p>Deploy CodeTether Server on Kubernetes using Helm.</p>"},{"location":"deployment/kubernetes/#quick-start","title":"Quick Start","text":"<pre><code>helm repo add codetether https://charts.codetether.run\nhelm install codetether codetether/a2a-server \\\n  --namespace codetether \\\n  --create-namespace\n</code></pre>"},{"location":"deployment/kubernetes/#values","title":"Values","text":"<pre><code>replicaCount: 2\n\ningress:\n  enabled: true\n  hosts:\n    - host: codetether.example.com\n      paths:\n        - path: /\n          pathType: Prefix\n\nredis:\n  enabled: true\n</code></pre> <p>See Helm Charts for full configuration.</p>"},{"location":"deployment/production/","title":"Production Checklist","text":"<p>Before deploying CodeTether to production:</p>"},{"location":"deployment/production/#security","title":"Security","text":"<ul> <li> Enable authentication (Keycloak or API tokens)</li> <li> Configure TLS certificates</li> <li> Set secure Redis password</li> <li> Set secure PostgreSQL password</li> <li> Review network policies</li> </ul>"},{"location":"deployment/production/#reliability","title":"Reliability","text":"<ul> <li> Configure health checks</li> <li> Set up monitoring/alerting</li> <li> Configure backups for PostgreSQL and Redis</li> <li> Test failover scenarios</li> <li> Configure PostgreSQL for durable persistence (<code>DATABASE_URL</code>)</li> </ul>"},{"location":"deployment/production/#performance","title":"Performance","text":"<ul> <li> Configure resource limits</li> <li> Enable horizontal pod autoscaling</li> <li> Configure Redis persistence</li> <li> Configure PostgreSQL connection pooling</li> <li> Review connection pooling</li> </ul>"},{"location":"deployment/production/#operations","title":"Operations","text":"<ul> <li> Set up logging aggregation</li> <li> Configure log retention</li> <li> Document runbooks</li> <li> Test disaster recovery</li> </ul>"},{"location":"features/agent-messaging/","title":"Agent Messaging","text":"<p>CodeTether enables agents to communicate and collaborate using the A2A Protocol.</p>"},{"location":"features/agent-messaging/#overview","title":"Overview","text":"<p>Agents can:</p> <ul> <li>Discover other agents via Agent Cards</li> <li>Send tasks to other agents</li> <li>Receive results via streaming or polling</li> <li>Collaborate on complex workflows</li> </ul> <p>See A2A Protocol for details.</p>"},{"location":"features/agent-worker/","title":"Agent Worker","text":"<p>The Agent Worker is a standalone daemon that runs on machines with codebases, connecting to a CodeTether server to receive and execute AI agent tasks. It enables distributed, autonomous code execution across your infrastructure.</p> <p>Zero-Touch Automation</p> <p>Once configured, the Agent Worker autonomously pulls tasks from the server, executes them using OpenCode, and reports results\u2014all without human intervention.</p>"},{"location":"features/agent-worker/#overview","title":"Overview","text":"<p>The Agent Worker provides:</p> <ul> <li>Remote Task Execution: Run AI agents on machines where codebases live</li> <li>Codebase Registration: Automatically register local codebases with the server</li> <li>Session Sync: Report OpenCode session history to the central server</li> <li>Output Streaming: Real-time task output streaming to the server</li> <li>Graceful Lifecycle: Proper shutdown handling and resource cleanup</li> <li>Systemd Integration: Run as a production-grade Linux service</li> </ul> <pre><code>sequenceDiagram\n    participant Server as CodeTether Server\n    participant Worker as Agent Worker\n    participant OpenCode as OpenCode CLI\n    participant Codebase as Local Codebase\n\n    Worker-&gt;&gt;Server: Register worker\n    Worker-&gt;&gt;Server: Register codebases\n\n    loop Poll Interval\n        Worker-&gt;&gt;Server: Get pending tasks\n        Server--&gt;&gt;Worker: Task list\n        Worker-&gt;&gt;OpenCode: Execute task\n        OpenCode-&gt;&gt;Codebase: Read/modify files\n        Worker-&gt;&gt;Server: Stream output\n        Worker-&gt;&gt;Server: Report completion\n    end\n\n    loop Session Sync\n        Worker-&gt;&gt;Server: Sync OpenCode sessions\n    end</code></pre>"},{"location":"features/agent-worker/#architecture","title":"Architecture","text":"<p>The Agent Worker acts as a bridge between the CodeTether server and local codebases:</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    Remote Machine                            \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502              Agent Worker Daemon                     \u2502    \u2502\n\u2502  \u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u2502    \u2502\n\u2502  \u2502  \u2502   Poller    \u2502  \u2502  Executor    \u2502  \u2502  Reporter  \u2502  \u2502    \u2502\n\u2502  \u2502  \u2502  (tasks)    \u2502  \u2502  (opencode)  \u2502  \u2502  (output)  \u2502  \u2502    \u2502\n\u2502  \u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2502    \u2502\n\u2502  \u2502         \u2502                \u2502                \u2502         \u2502    \u2502\n\u2502  \u2502         \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518         \u2502    \u2502\n\u2502  \u2502                          \u2502                          \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                             \u2502                               \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510    \u2502\n\u2502  \u2502   /home/user/project-a   \u2502   /home/user/project-b   \u2502    \u2502\n\u2502  \u2502        Codebase 1        \u2502        Codebase 2        \u2502    \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2502\n\u2502                             \u2502                               \u2502\n\u2502                             \u25bc                               \u2502\n\u2502                     OpenCode Binary                         \u2502\n\u2502                    ~/.local/bin/opencode                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                              \u2502\n                              \u2502 HTTPS\n                              \u25bc\n                    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n                    \u2502 CodeTether API  \u2502\n                    \u2502 api.codetether  \u2502\n                    \u2502      .run       \u2502\n                    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"features/agent-worker/#components","title":"Components","text":"Component Purpose Poller Fetches pending tasks from the server at configurable intervals Executor Runs OpenCode agents on local codebases Reporter Streams task output and syncs session history Lifecycle Manager Handles worker registration, signals, and cleanup"},{"location":"features/agent-worker/#installation","title":"Installation","text":""},{"location":"features/agent-worker/#quick-install-linux","title":"Quick Install (Linux)","text":"<pre><code># Clone repository (if not already)\ngit clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n\n# Run installer as root\nsudo ./agent_worker/install.sh\n</code></pre> <p>The installer:</p> <ol> <li>Creates a dedicated <code>a2a-worker</code> system user</li> <li>Installs the worker script to <code>/opt/a2a-worker/</code></li> <li>Creates a Python virtual environment with dependencies</li> <li>Installs the systemd service unit</li> <li>Creates configuration directory at <code>/etc/a2a-worker/</code></li> </ol>"},{"location":"features/agent-worker/#manual-installation","title":"Manual Installation","text":"<pre><code># Create directories\nsudo mkdir -p /opt/a2a-worker /etc/a2a-worker\n\n# Copy worker script\nsudo cp agent_worker/worker.py /opt/a2a-worker/\nsudo chmod +x /opt/a2a-worker/worker.py\n\n# Create virtual environment\nsudo python3 -m venv /opt/a2a-worker/venv\nsudo /opt/a2a-worker/venv/bin/pip install aiohttp\n\n# Copy configuration\nsudo cp agent_worker/config.example.json /etc/a2a-worker/config.json\nsudo chmod 600 /etc/a2a-worker/config.json\n\n# Install systemd service\nsudo cp agent_worker/systemd/a2a-agent-worker.service /etc/systemd/system/\nsudo systemctl daemon-reload\n</code></pre>"},{"location":"features/agent-worker/#requirements","title":"Requirements","text":"<ul> <li>Python 3.8+ with <code>asyncio</code> and <code>aiohttp</code></li> <li>OpenCode installed and accessible</li> <li>Network access to the CodeTether server</li> <li>Read/write access to configured codebases</li> </ul>"},{"location":"features/agent-worker/#configuration","title":"Configuration","text":""},{"location":"features/agent-worker/#configuration-file","title":"Configuration File","text":"<p>The worker reads configuration from <code>/etc/a2a-worker/config.json</code>:</p> <pre><code>{\n    \"server_url\": \"https://api.codetether.run\",\n    \"worker_name\": \"dev-vm-worker\",\n    \"poll_interval\": 5,\n    \"opencode_bin\": null,\n    \"codebases\": [\n        {\n            \"name\": \"my-project\",\n            \"path\": \"/home/user/my-project\",\n            \"description\": \"Main application repository\"\n        },\n        {\n            \"name\": \"backend-api\",\n            \"path\": \"/home/user/backend-api\",\n            \"description\": \"Backend microservices\"\n        }\n    ],\n    \"capabilities\": [\n        \"opencode\",\n        \"build\",\n        \"deploy\",\n        \"test\"\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#configuration-options","title":"Configuration Options","text":"Option Type Default Description <code>server_url</code> string \u2014 Required. CodeTether server URL <code>worker_name</code> string hostname Human-readable name for the worker <code>poll_interval</code> integer <code>5</code> Seconds between task polls <code>opencode_bin</code> string auto-detect Path to OpenCode binary <code>opencode_storage_path</code> string auto-detect Override OpenCode storage directory (contains <code>project/</code>, <code>session/</code>, <code>message/</code>, <code>part/</code>) <code>codebases</code> array <code>[]</code> List of codebases to register <code>codebases[].name</code> string directory name Display name for the codebase <code>codebases[].path</code> string \u2014 Required. Absolute path to codebase <code>codebases[].description</code> string <code>\"\"</code> Description of the codebase <code>session_message_sync_max_sessions</code> integer <code>3</code> How many most recent sessions (per codebase) to also sync messages for (UI detail panel) <code>session_message_sync_max_messages</code> integer <code>100</code> How many most recent messages (per session) to sync <code>capabilities</code> array <code>[\"opencode\", \"build\", \"deploy\"]</code> Worker capabilities to advertise"},{"location":"features/agent-worker/#environment-variables","title":"Environment Variables","text":"<p>Environment variables can override configuration:</p> <pre><code># /etc/a2a-worker/env\nA2A_SERVER_URL=https://api.codetether.run\nA2A_WORKER_NAME=production-worker-1\nA2A_POLL_INTERVAL=10\n\n# If the worker runs as a service user (e.g. /opt/a2a-worker) but OpenCode sessions\n# live under a different user's home, point the worker at that storage:\n# A2A_OPENCODE_STORAGE_PATH=/home/riley/.local/share/opencode/storage\n\n# Optional tuning for how much session detail gets synced:\n# A2A_SESSION_MESSAGE_SYNC_MAX_SESSIONS=3\n# A2A_SESSION_MESSAGE_SYNC_MAX_MESSAGES=100\n</code></pre> Variable Description <code>A2A_SERVER_URL</code> CodeTether server URL <code>A2A_WORKER_NAME</code> Worker identifier <code>A2A_POLL_INTERVAL</code> Poll interval in seconds <code>A2A_OPENCODE_STORAGE_PATH</code> Override OpenCode storage path (useful under systemd service accounts) <code>A2A_SESSION_MESSAGE_SYNC_MAX_SESSIONS</code> Number of recent sessions to sync messages for <code>A2A_SESSION_MESSAGE_SYNC_MAX_MESSAGES</code> Number of recent messages to sync per session <p>Precedence (what wins)</p> <p>Worker settings follow this precedence order:</p> <ol> <li>CLI flags (e.g. <code>--server</code>, <code>--name</code>, <code>--poll-interval</code>)</li> <li>Environment variables (e.g. <code>A2A_SERVER_URL</code>)</li> <li>Config file (<code>/etc/a2a-worker/config.json</code>)</li> <li>Built-in defaults</li> </ol> <p>If you're running under systemd, the unit file often sets <code>A2A_SERVER_URL</code> directly. To override without editing the unit, put overrides in <code>/etc/a2a-worker/env</code> (the unit loads it via <code>EnvironmentFile</code>).</p>"},{"location":"features/agent-worker/#running-the-worker","title":"Running the Worker","text":""},{"location":"features/agent-worker/#systemd-service-recommended","title":"Systemd Service (Recommended)","text":"<pre><code># Start the service\nsudo systemctl start a2a-agent-worker\n\n# Enable on boot\nsudo systemctl enable a2a-agent-worker\n\n# Check status\nsudo systemctl status a2a-agent-worker\n\n# View logs\nsudo journalctl -u a2a-agent-worker -f\n</code></pre>"},{"location":"features/agent-worker/#manual-execution","title":"Manual Execution","text":"<p>For debugging or testing:</p> <pre><code># Basic usage\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --name my-worker\n\n# With config file\npython3 agent_worker/worker.py --config /etc/a2a-worker/config.json\n\n# With inline codebase\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --codebase my-project:/home/user/my-project \\\n    --codebase other-project:/home/user/other-project\n\n# Custom poll interval\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --poll-interval 10\n</code></pre>"},{"location":"features/agent-worker/#command-line-options","title":"Command-Line Options","text":"Flag Short Description <code>--server</code> <code>-s</code> Server URL <code>--name</code> <code>-n</code> Worker name <code>--config</code> <code>-c</code> Path to config file <code>--codebase</code> <code>-b</code> Codebase to register (format: <code>name:path</code> or just <code>path</code>) <code>--poll-interval</code> <code>-i</code> Poll interval in seconds <code>--opencode</code> \u2014 Path to OpenCode binary <code>--opencode-storage-path</code> \u2014 Override OpenCode storage directory <code>--session-message-sync-max-sessions</code> \u2014 Recent sessions per codebase to sync messages for <code>--session-message-sync-max-messages</code> \u2014 Recent messages per session to sync"},{"location":"features/agent-worker/#how-it-works","title":"How It Works","text":""},{"location":"features/agent-worker/#1-worker-registration","title":"1. Worker Registration","text":"<p>On startup, the worker registers itself with the server:</p> <pre><code>POST /v1/opencode/workers/register\n{\n    \"worker_id\": \"abc123\",\n    \"name\": \"dev-vm-worker\",\n    \"capabilities\": [\"opencode\", \"build\", \"deploy\"],\n    \"hostname\": \"dev-vm.internal\"\n}\n</code></pre>"},{"location":"features/agent-worker/#2-codebase-registration","title":"2. Codebase Registration","text":"<p>Each configured codebase is registered:</p> <pre><code>POST /v1/opencode/codebases\n{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/my-project\",\n    \"description\": \"Main application\",\n    \"worker_id\": \"abc123\"\n}\n</code></pre> <p>Worker Affinity</p> <p>Tasks for a codebase are routed only to the worker that registered it. This ensures tasks execute where the code actually lives.</p>"},{"location":"features/agent-worker/#3-task-polling","title":"3. Task Polling","text":"<p>The worker polls for pending tasks:</p> <pre><code>GET /v1/opencode/tasks?status=pending&amp;worker_id=abc123\n</code></pre> <p>Only tasks assigned to this worker's codebases are returned.</p>"},{"location":"features/agent-worker/#4-task-execution","title":"4. Task Execution","text":"<p>When a task is received:</p> <ol> <li>Claim: Worker marks task as <code>running</code></li> <li>Execute: Runs OpenCode with the task prompt</li> <li>Stream: Output is streamed to the server in real-time</li> <li>Report: Final status (<code>completed</code> or <code>failed</code>) is reported</li> </ol> <pre><code># Equivalent OpenCode command\nopencode run --agent build --format json \"Add unit tests for auth module\"\n</code></pre>"},{"location":"features/agent-worker/#5-session-sync","title":"5. Session Sync","text":"<p>Every ~60 seconds, the worker syncs OpenCode session history:</p> <pre><code>POST /v1/opencode/codebases/{id}/sessions/sync\n{\n    \"worker_id\": \"abc123\",\n    \"sessions\": [\n        {\n            \"id\": \"sess_xyz\",\n            \"title\": \"Added unit tests\",\n            \"created\": \"2025-12-10T15:00:00Z\",\n            \"updated\": \"2025-12-10T15:05:00Z\",\n            \"messageCount\": 12\n        }\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#task-workflow","title":"Task Workflow","text":""},{"location":"features/agent-worker/#creating-a-task","title":"Creating a Task","text":"<p>Tasks can be created via the API:</p> <pre><code>curl -X POST https://api.codetether.run/v1/opencode/codebases/cb_abc/tasks \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Add authentication\",\n    \"prompt\": \"Implement JWT authentication for the API endpoints\",\n    \"agent_type\": \"build\",\n    \"metadata\": {\n        \"model\": \"anthropic/claude-sonnet-4-20250514\"\n    }\n}'\n</code></pre>"},{"location":"features/agent-worker/#task-lifecycle","title":"Task Lifecycle","text":"<pre><code>pending \u2192 running \u2192 completed\n              \u2193\n            failed\n</code></pre> Status Description <code>pending</code> Waiting for a worker to pick up <code>running</code> Currently being executed <code>completed</code> Successfully finished <code>failed</code> Execution error occurred"},{"location":"features/agent-worker/#resuming-sessions","title":"Resuming Sessions","text":"<p>Tasks can resume existing OpenCode sessions:</p> <pre><code>{\n    \"title\": \"Continue refactoring\",\n    \"prompt\": \"Continue the database refactoring from where we left off\",\n    \"metadata\": {\n        \"resume_session_id\": \"sess_xyz789\"\n    }\n}\n</code></pre>"},{"location":"features/agent-worker/#security","title":"Security","text":""},{"location":"features/agent-worker/#systemd-hardening","title":"Systemd Hardening","text":"<p>The provided service unit includes security hardening:</p> <pre><code>[Service]\n# Run as dedicated user\nUser=a2a-worker\nGroup=a2a-worker\n\n# Security restrictions\nNoNewPrivileges=true\nProtectSystem=full\nProtectHome=read-only\nReadWritePaths=/home /opt/a2a-worker\nPrivateTmp=true\n\n# Resource limits\nMemoryMax=2G\nCPUQuota=200%\n</code></pre>"},{"location":"features/agent-worker/#file-permissions","title":"File Permissions","text":"<pre><code># Configuration is readable only by root/worker\nsudo chmod 600 /etc/a2a-worker/config.json\nsudo chown a2a-worker:a2a-worker /etc/a2a-worker/config.json\n</code></pre>"},{"location":"features/agent-worker/#network-security","title":"Network Security","text":"<ul> <li>Use HTTPS for all server communication</li> <li>Consider VPN or private network for internal deployments</li> <li>Use authentication tokens when available</li> </ul>"},{"location":"features/agent-worker/#monitoring","title":"Monitoring","text":""},{"location":"features/agent-worker/#logs","title":"Logs","text":"<pre><code># Live logs\nsudo journalctl -u a2a-agent-worker -f\n\n# Recent logs\nsudo journalctl -u a2a-agent-worker -n 100\n\n# Since last boot\nsudo journalctl -u a2a-agent-worker -b\n</code></pre>"},{"location":"features/agent-worker/#health-checks","title":"Health Checks","text":"<pre><code># Service status\nsudo systemctl status a2a-agent-worker\n\n# Process check\npgrep -f \"worker.py\" &amp;&amp; echo \"Running\" || echo \"Not running\"\n</code></pre>"},{"location":"features/agent-worker/#server-side-monitoring","title":"Server-Side Monitoring","text":"<p>Check worker status from the server:</p> <pre><code>curl https://api.codetether.run/v1/monitor/workers\n</code></pre> <pre><code>{\n    \"workers\": [\n        {\n            \"id\": \"abc123\",\n            \"name\": \"dev-vm-worker\",\n            \"status\": \"active\",\n            \"last_heartbeat\": \"2025-12-10T15:30:00Z\",\n            \"codebases\": 2,\n            \"tasks_completed\": 42\n        }\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/agent-worker/#uiapi-says-no-workers-available","title":"UI/API says \u201cNo workers available\u201d","text":"<p>This error happens when you try to register a codebase by path (from the UI or API) but the server currently has zero registered workers.</p> <p>Fix checklist:</p> <ol> <li> <p>Start the worker on the machine that has the codebase path</p> <ul> <li><code>sudo systemctl start a2a-agent-worker</code></li> <li><code>sudo systemctl status a2a-agent-worker</code></li> </ul> </li> <li> <p>Make sure the worker points at the same server URL your UI/API is using</p> <ul> <li>Inspect what systemd is passing:</li> <li><code>sudo systemctl cat a2a-agent-worker | grep A2A_SERVER_URL</code></li> <li>If needed, override via <code>/etc/a2a-worker/env</code>:</li> <li><code>A2A_SERVER_URL=https://api.codetether.run</code></li> <li>Then restart:</li> <li><code>sudo systemctl restart a2a-agent-worker</code></li> </ul> </li> <li> <p>Verify the server sees at least one worker</p> <ul> <li><code>curl https://api.codetether.run/v1/opencode/workers</code></li> </ul> </li> </ol> <p>If <code>/v1/opencode/workers</code> returns an empty list, the server will reject path-based registration requests.</p>"},{"location":"features/agent-worker/#worker-is-running-but-v1opencodeworkers-or-v1opencodecodebases-is-empty","title":"Worker is running, but <code>/v1/opencode/workers</code> or <code>/v1/opencode/codebases</code> is empty","text":"<p>If the worker logs show successful registration (e.g. <code>Worker registered successfully</code> / <code>Registered codebase ...</code>) but the API still reports zero workers/codebases, this is almost always one of these:</p> <ol> <li>You\u2019re behind a load balancer / multiple API replicas without shared state</li> <li>The API pod/container restarted and lost in-memory state</li> <li>The OpenCode registry database is not persisted (no volume / wrong <code>OPENCODE_DB_PATH</code>)</li> </ol> <p>Fix checklist:</p> <ul> <li> <p>Enable Redis-backed OpenCode state on the server (recommended for Kubernetes and any multi-replica deployment):</p> <ul> <li>Set <code>A2A_REDIS_URL</code> on the server (not the worker), e.g.:<ul> <li><code>A2A_REDIS_URL=redis://redis:6379</code></li> </ul> </li> <li>This lets workers/codebases/sessions be visible consistently across API replicas.</li> </ul> </li> <li> <p>Persist the OpenCode DB if you rely on SQLite:</p> <ul> <li>Set <code>OPENCODE_DB_PATH</code> to a path on a persistent volume (e.g. <code>/data/opencode.db</code>).</li> </ul> </li> <li> <p>Force a fresh re-registration:</p> <ul> <li>Restart the worker: <code>sudo systemctl restart a2a-agent-worker</code></li> <li>Then re-check:<ul> <li><code>curl https://api.codetether.run/v1/opencode/workers</code></li> <li><code>curl https://api.codetether.run/v1/opencode/codebases</code></li> </ul> </li> </ul> </li> </ul> <p>If the lists \u201cflap\u201d (sometimes empty, sometimes populated), it\u2019s a strong signal that your load balancer is routing reads/writes to different replicas without a shared backing store.</p>"},{"location":"features/agent-worker/#registration-task-stuck-in-pending","title":"Registration task stuck in \u201cpending\u201d","text":"<p>When you register a codebase from the UI without providing a <code>worker_id</code>, the server creates a special registration task with:</p> <ul> <li><code>agent_type = \"register_codebase\"</code></li> <li><code>codebase_id = \"__pending__\"</code></li> </ul> <p>Any worker can claim these tasks, validate the path exists locally, and then confirm registration.</p> <p>How to debug:</p> <ol> <li> <p>Check pending tasks:</p> <ul> <li><code>curl https://api.codetether.run/v1/opencode/tasks?status=pending</code></li> </ul> </li> <li> <p>Watch worker logs for the claim:</p> <ul> <li><code>sudo journalctl -u a2a-agent-worker -f</code></li> <li>You should see something like: <code>Handling registration task ...</code></li> </ul> </li> <li> <p>Ensure the worker user can read the path:</p> <ul> <li><code>sudo -u a2a-worker ls -la /path/to/your/codebase</code></li> </ul> </li> </ol> <p>If the task remains pending and the worker never logs that it handled it, confirm the worker is polling and is connected to the correct server.</p>"},{"location":"features/agent-worker/#worker-not-starting","title":"Worker Not Starting","text":"<pre><code># Check logs\nsudo journalctl -u a2a-agent-worker -n 50\n\n# Common issues:\n# - Python environment not created\n# - aiohttp not installed\n# - Config file missing or invalid\n</code></pre>"},{"location":"features/agent-worker/#cannot-connect-to-server","title":"Cannot Connect to Server","text":"<pre><code># Test connectivity\ncurl -I https://api.codetether.run/v1/opencode/status\n\n# Check DNS resolution\nnslookup api.codetether.run\n\n# Check firewall\nsudo iptables -L -n | grep 443\n</code></pre>"},{"location":"features/agent-worker/#opencode-not-found","title":"OpenCode Not Found","text":"<pre><code># Check OpenCode location\nwhich opencode\nls -la ~/.local/bin/opencode\n\n# Verify it works\nopencode --version\n\n# Set explicit path in config\n{\n    \"opencode_bin\": \"/home/user/.local/bin/opencode\"\n}\n</code></pre>"},{"location":"features/agent-worker/#codebase-not-registering","title":"Codebase Not Registering","text":"<pre><code># Verify path exists\nls -la /home/user/my-project\n\n# Check worker user has access\nsudo -u a2a-worker ls /home/user/my-project\n\n# Add worker to user's group\nsudo usermod -a -G $USER a2a-worker\n</code></pre>"},{"location":"features/agent-worker/#tasks-not-executing","title":"Tasks Not Executing","text":"<pre><code># Check task queue on server\ncurl https://api.codetether.run/v1/opencode/tasks?status=pending\n\n# Verify codebase is registered with worker_id\ncurl https://api.codetether.run/v1/opencode/codebases\n\n# Check worker is polling (in logs)\nsudo journalctl -u a2a-agent-worker | grep \"poll\"\n</code></pre>"},{"location":"features/agent-worker/#advanced-configuration","title":"Advanced Configuration","text":""},{"location":"features/agent-worker/#multiple-workers","title":"Multiple Workers","text":"<p>Run multiple workers for different codebase sets:</p> <pre><code># Worker 1 - Production codebases\npython3 worker.py --name prod-worker --config /etc/a2a-worker/prod.json\n\n# Worker 2 - Development codebases\npython3 worker.py --name dev-worker --config /etc/a2a-worker/dev.json\n</code></pre>"},{"location":"features/agent-worker/#custom-capabilities","title":"Custom Capabilities","text":"<p>Advertise specific capabilities:</p> <pre><code>{\n    \"capabilities\": [\n        \"opencode\",\n        \"python\",\n        \"typescript\",\n        \"docker\",\n        \"kubernetes\"\n    ]\n}\n</code></pre>"},{"location":"features/agent-worker/#opencode-model-selection","title":"OpenCode Model Selection","text":"<p>Tasks can specify which model to use:</p> <pre><code>{\n    \"prompt\": \"Refactor the database module\",\n    \"metadata\": {\n        \"model\": \"anthropic/claude-sonnet-4-20250514\"\n    }\n}\n</code></pre> <p>Supported models:</p> <ul> <li><code>anthropic/claude-sonnet-4-20250514</code></li> <li><code>anthropic/claude-opus-4-20250514</code></li> <li><code>openai/gpt-4o</code></li> <li><code>google/gemini-2.0-flash</code></li> <li>And many more (see Models API)</li> </ul>"},{"location":"features/agent-worker/#file-reference","title":"File Reference","text":""},{"location":"features/agent-worker/#workerpy","title":"worker.py","text":"<p>Location: <code>/opt/a2a-worker/worker.py</code> (installed) or <code>agent_worker/worker.py</code> (source)</p> <p>Main worker script containing:</p> <ul> <li><code>WorkerConfig</code> - Configuration dataclass</li> <li><code>LocalCodebase</code> - Registered codebase dataclass</li> <li><code>AgentWorker</code> - Main worker class</li> <li>Task polling, execution, and reporting logic</li> <li>OpenCode session discovery and sync</li> </ul>"},{"location":"features/agent-worker/#configexamplejson","title":"config.example.json","text":"<p>Location: <code>agent_worker/config.example.json</code></p> <p>Example configuration file to copy and customize.</p>"},{"location":"features/agent-worker/#installsh","title":"install.sh","text":"<p>Location: <code>agent_worker/install.sh</code></p> <p>Installation script that sets up the worker as a systemd service.</p>"},{"location":"features/agent-worker/#a2a-agent-workerservice","title":"a2a-agent-worker.service","text":"<p>Location: <code>agent_worker/systemd/a2a-agent-worker.service</code></p> <p>Systemd service unit with security hardening and resource limits.</p>"},{"location":"features/agent-worker/#next-steps","title":"Next Steps","text":"<ul> <li>OpenCode Integration - Learn about OpenCode features</li> <li>Distributed Workers - Scale workers horizontally</li> <li>OpenCode API - Full API reference</li> <li>Production Deployment - Production checklist</li> </ul>"},{"location":"features/distributed-workers/","title":"Distributed Workers","text":"<p>CodeTether supports distributed workers, allowing you to scale AI agent execution across multiple machines.</p>"},{"location":"features/distributed-workers/#overview","title":"Overview","text":"<p>Workers are separate processes that:</p> <ul> <li>Connect to the CodeTether server</li> <li>Poll for assigned tasks</li> <li>Execute tasks using local OpenCode installation</li> <li>Report results back to the server</li> <li>Sync session history to the central server</li> </ul> <p>Agent Worker Documentation</p> <p>For complete installation and configuration details, see the Agent Worker guide.</p>"},{"location":"features/distributed-workers/#quick-start","title":"Quick Start","text":""},{"location":"features/distributed-workers/#1-install-worker","title":"1. Install Worker","text":"<pre><code># Clone repository\ngit clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n\n# Run installer as root\nsudo ./agent_worker/install.sh\n</code></pre>"},{"location":"features/distributed-workers/#2-configure-worker","title":"2. Configure Worker","text":"<p>Edit <code>/etc/a2a-worker/config.json</code>:</p> <pre><code>{\n  \"server_url\": \"https://api.codetether.run\",\n  \"worker_name\": \"worker-1\",\n  \"poll_interval\": 5,\n  \"codebases\": [\n    {\n      \"name\": \"my-project\",\n      \"path\": \"/home/user/my-project\",\n      \"description\": \"Main application\"\n    }\n  ],\n  \"capabilities\": [\"opencode\", \"build\", \"deploy\", \"test\"]\n}\n</code></pre>"},{"location":"features/distributed-workers/#3-start-worker","title":"3. Start Worker","text":"<pre><code>sudo systemctl start a2a-agent-worker\nsudo systemctl enable a2a-agent-worker\n</code></pre>"},{"location":"features/distributed-workers/#4-verify-the-worker-is-registered","title":"4. Verify the Worker is Registered","text":"<p>Once started, the server should show at least one registered worker:</p> <pre><code>curl https://api.codetether.run/v1/opencode/workers\n</code></pre> <p>On the worker machine, you can also confirm it is polling:</p> <pre><code>sudo systemctl status a2a-agent-worker\nsudo journalctl -u a2a-agent-worker -n 100 --no-pager\n</code></pre> <p>If you see \u201cNo workers available\u201d</p> <p>That message is returned when the server has no registered workers at the moment a codebase registration-by-path request is made.</p> <p>Make sure the worker service is running on the machine that can access the path, and that <code>A2A_SERVER_URL</code> points at the same server your UI/API is using.</p>"},{"location":"features/distributed-workers/#worker-architecture","title":"Worker Architecture","text":"<pre><code>graph LR\n    S[CodeTether Server] --&gt; PG[(PostgreSQL)]\n    S --&gt; R[(Redis)]\n    R --&gt; W1[Worker 1]\n    R --&gt; W2[Worker 2]\n    R --&gt; W3[Worker N]\n\n    W1 --&gt; OC1[OpenCode]\n    W2 --&gt; OC2[OpenCode]\n    W3 --&gt; OC3[OpenCode]</code></pre> <p>Durable Persistence with PostgreSQL</p> <p>When <code>DATABASE_URL</code> is configured, workers, codebases, and sessions persist across server restarts and work correctly with multiple replicas. Without PostgreSQL, data is stored in Redis (shared) or in-memory (single instance only).</p>"},{"location":"features/distributed-workers/#configuration-options","title":"Configuration Options","text":"Option Default Description <code>server_url</code> \u2014 CodeTether server URL (required) <code>worker_name</code> hostname Unique worker identifier <code>poll_interval</code> 5 Seconds between task polls <code>codebases</code> [] Array of codebase objects to register <code>opencode_bin</code> auto-detect Path to OpenCode binary <code>capabilities</code> [\"opencode\", \"build\", \"deploy\"] Advertised capabilities"},{"location":"features/distributed-workers/#environment-variables","title":"Environment Variables","text":"<pre><code>export A2A_SERVER_URL=https://api.codetether.run\nexport A2A_WORKER_NAME=worker-1\nexport A2A_POLL_INTERVAL=5\n</code></pre>"},{"location":"features/distributed-workers/#systemd-service","title":"Systemd Service","text":"<p>The installer creates <code>/etc/systemd/system/a2a-agent-worker.service</code>:</p> <pre><code>[Unit]\nDescription=A2A Agent Worker - OpenCode task executor\nAfter=network-online.target\n\n[Service]\nType=simple\nUser=a2a-worker\nExecStart=/opt/a2a-worker/venv/bin/python /opt/a2a-worker/worker.py --config /etc/a2a-worker/config.json\nRestart=always\nRestartSec=10\n\n# Security hardening\nNoNewPrivileges=true\nProtectSystem=full\nProtectHome=read-only\nReadWritePaths=/home /opt/a2a-worker\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <p>Manage the service:</p> <pre><code>sudo systemctl start a2a-agent-worker\nsudo systemctl stop a2a-agent-worker\nsudo systemctl status a2a-agent-worker\nsudo journalctl -u a2a-agent-worker -f\n</code></pre>"},{"location":"features/distributed-workers/#codebase-registration","title":"Codebase Registration","text":"<p>Register codebases with worker affinity:</p> <pre><code>curl -X POST https://api.codetether.run/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/my-project\",\n    \"description\": \"Main application\",\n    \"worker_id\": \"worker-1\"\n  }'\n</code></pre> <p>Tasks for this codebase will only be assigned to <code>worker-1</code>.</p> <p>Worker Affinity</p> <p>When a codebase is registered with a <code>worker_id</code>, only that worker will receive tasks for it. This ensures tasks execute where the code actually lives.</p>"},{"location":"features/distributed-workers/#scaling","title":"Scaling","text":""},{"location":"features/distributed-workers/#horizontal-scaling","title":"Horizontal Scaling","text":"<p>Add more workers to handle more concurrent tasks:</p> <pre><code># Worker 1 - Production\npython3 worker.py --name prod-worker-1 --config /etc/a2a-worker/prod.json\n\n# Worker 2 - Production\npython3 worker.py --name prod-worker-2 --config /etc/a2a-worker/prod.json\n\n# Worker 3 - Development\npython3 worker.py --name dev-worker --config /etc/a2a-worker/dev.json\n</code></pre>"},{"location":"features/distributed-workers/#command-line-usage","title":"Command Line Usage","text":"<pre><code># Basic usage\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --name my-worker\n\n# With inline codebases\npython3 agent_worker/worker.py \\\n    --server https://api.codetether.run \\\n    --codebase my-project:/home/user/my-project \\\n    --codebase api:/home/user/api\n</code></pre>"},{"location":"features/distributed-workers/#kubernetes-deployment","title":"Kubernetes Deployment","text":"<pre><code>apiVersion: apps/v1\nkind: StatefulSet\nmetadata:\n  name: codetether-worker\nspec:\n  replicas: 3\n  selector:\n    matchLabels:\n      app: codetether-worker\n  template:\n    spec:\n      containers:\n      - name: worker\n        image: registry.quantum-forge.net/library/a2a-worker:latest\n        env:\n        - name: A2A_SERVER_URL\n          value: \"http://a2a-server:8000\"\n        - name: A2A_WORKER_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        volumeMounts:\n        - name: codebases\n          mountPath: /codebases\n      volumes:\n      - name: codebases\n        persistentVolumeClaim:\n          claimName: codebases-pvc\n</code></pre>"},{"location":"features/distributed-workers/#monitoring","title":"Monitoring","text":"<p>Check worker status:</p> <pre><code>curl https://api.codetether.run/v1/monitor/workers\n</code></pre> <pre><code>{\n  \"workers\": [\n    {\n      \"id\": \"worker-1\",\n      \"name\": \"dev-vm-worker\",\n      \"status\": \"active\",\n      \"last_heartbeat\": \"2025-12-10T15:30:00Z\",\n      \"codebases\": 3,\n      \"tasks_completed\": 42\n    }\n  ]\n}\n</code></pre>"},{"location":"features/distributed-workers/#logs","title":"Logs","text":"<pre><code># View worker logs\nsudo journalctl -u a2a-agent-worker -f\n\n# Recent logs\nsudo journalctl -u a2a-agent-worker -n 100\n</code></pre>"},{"location":"features/distributed-workers/#session-sync","title":"Session Sync","text":"<p>Workers automatically sync OpenCode session history to the server every ~60 seconds. This enables:</p> <ul> <li>Centralized session visibility</li> <li>Session resumption from the web UI</li> <li>Historical task tracking</li> </ul> <p>The sync includes:</p> <ul> <li>Session metadata (title, timestamps)</li> <li>Message summaries</li> <li>Tool usage statistics</li> </ul>"},{"location":"features/distributed-workers/#next-steps","title":"Next Steps","text":"<ul> <li>Agent Worker - Complete installation and configuration guide</li> <li>Architecture - System architecture overview</li> <li>Kubernetes Deployment - Production k8s deployment</li> <li>OpenCode API - Full API reference</li> </ul>"},{"location":"features/mcp-tools/","title":"MCP Tools","text":"<p>CodeTether includes an MCP (Model Context Protocol) server for tool integration.</p>"},{"location":"features/mcp-tools/#overview","title":"Overview","text":"<p>The MCP server (port 9000) exposes CodeTether capabilities as tools that AI models can use.</p>"},{"location":"features/mcp-tools/#configuration","title":"Configuration","text":"<pre><code>export MCP_HTTP_ENABLED=true\nexport MCP_HTTP_PORT=9000\n</code></pre>"},{"location":"features/mcp-tools/#available-tools","title":"Available Tools","text":"<ul> <li>Task management</li> <li>Agent discovery</li> <li>Codebase operations</li> <li>Session management</li> </ul> <p>See the MCP documentation for integration details.</p>"},{"location":"features/monitor-ui/","title":"Monitor UI","text":"<p>CodeTether includes a web-based monitoring dashboard.</p>"},{"location":"features/monitor-ui/#access","title":"Access","text":"<p>Open in your browser:</p> <pre><code>http://localhost:8000/monitor\n</code></pre>"},{"location":"features/monitor-ui/#features","title":"Features","text":"<ul> <li>Agent Status - View connected agents</li> <li>Live Messages - Real-time message stream</li> <li>Task Queue - Pending and running tasks</li> <li>Statistics - Usage metrics</li> </ul>"},{"location":"features/monitor-ui/#authentication","title":"Authentication","text":"<p>When Keycloak is enabled, the dashboard requires authentication.</p>"},{"location":"features/opencode/","title":"OpenCode Integration","text":"<p>CodeTether Server integrates with OpenCode, enabling AI coding agents to work on your codebase with full session management, task queuing, and real-time streaming.</p>"},{"location":"features/opencode/#overview","title":"Overview","text":"<p>The OpenCode Bridge connects CodeTether to the OpenCode CLI, allowing you to:</p> <ul> <li>Register codebases for agents to work on</li> <li>Trigger AI agents with natural language prompts</li> <li>Stream real-time output as agents work</li> <li>Manage sessions with history and resumption</li> <li>Queue tasks for distributed workers</li> </ul> <pre><code>graph LR\n    UI[Web Dashboard] --&gt; API[CodeTether API]\n    API --&gt; Bridge[OpenCode Bridge]\n    Bridge --&gt; OC[OpenCode CLI]\n    OC --&gt; LLM[AI Model]\n    OC --&gt; FS[File System]</code></pre>"},{"location":"features/opencode/#prerequisites","title":"Prerequisites","text":"<ol> <li> <p>OpenCode installed on the machine running CodeTether or workers</p> <pre><code># Install OpenCode\ncurl -fsSL https://opencode.ai/install.sh | bash\n\n# Verify installation\nopencode --version\n</code></pre> </li> <li> <p>AI API keys configured in OpenCode</p> <pre><code># Configure your preferred model provider\nexport ANTHROPIC_API_KEY=sk-ant-...\n# or\nexport OPENAI_API_KEY=sk-...\n</code></pre> </li> </ol>"},{"location":"features/opencode/#quick-start","title":"Quick Start","text":""},{"location":"features/opencode/#1-start-codetether-with-opencode","title":"1. Start CodeTether with OpenCode","text":"<pre><code>codetether serve --port 8000\n</code></pre> <p>Check that OpenCode is detected:</p> <pre><code>curl http://localhost:8000/v1/opencode/status\n</code></pre> <pre><code>{\n  \"available\": true,\n  \"opencode_binary\": \"/usr/local/bin/opencode\",\n  \"registered_codebases\": 0\n}\n</code></pre>"},{"location":"features/opencode/#2-register-a-codebase","title":"2. Register a Codebase","text":"<pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"My awesome project\"\n  }'\n</code></pre>"},{"location":"features/opencode/#3-trigger-an-agent","title":"3. Trigger an Agent","text":"<pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases/{id}/trigger \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"prompt\": \"Add comprehensive error handling to the API routes\",\n    \"agent\": \"build\",\n    \"model\": \"anthropic/claude-sonnet-4-20250514\"\n  }'\n</code></pre>"},{"location":"features/opencode/#4-watch-real-time-output","title":"4. Watch Real-time Output","text":"<pre><code>curl -N http://localhost:8000/v1/opencode/codebases/{id}/events\n</code></pre>"},{"location":"features/opencode/#agent-types","title":"Agent Types","text":"Agent Description Use Case <code>build</code> Implementation agent Writing code, fixing bugs, adding features <code>plan</code> Planning agent Architecture, design, breaking down tasks <code>explore</code> Exploration agent Understanding codebase, answering questions <code>general</code> General purpose Flexible, multi-purpose tasks"},{"location":"features/opencode/#available-models","title":"Available Models","text":"<p>CodeTether supports multiple AI model providers:</p> <pre><code>curl http://localhost:8000/v1/opencode/models\n</code></pre> <p>Anthropic - <code>anthropic/claude-opus-4</code> - Most capable - <code>anthropic/claude-sonnet-4-20250514</code> - Best balance (recommended) - <code>anthropic/claude-3-5-haiku-20241022</code> - Fast and affordable</p> <p>OpenAI - <code>openai/gpt-4o</code> - GPT-4 Omni - <code>openai/o1</code> - Reasoning model - <code>openai/o3-mini</code> - Latest mini model</p> <p>Google - <code>google/gemini-2.0-flash</code> - Fast - <code>google/gemini-2.5-pro</code> - Most capable</p> <p>Others - <code>deepseek/deepseek-chat</code> - DeepSeek - <code>xai/grok-2</code> - xAI Grok</p>"},{"location":"features/opencode/#session-management","title":"Session Management","text":""},{"location":"features/opencode/#view-sessions","title":"View Sessions","text":"<pre><code>curl http://localhost:8000/v1/opencode/codebases/{id}/sessions\n</code></pre>"},{"location":"features/opencode/#resume-a-session","title":"Resume a Session","text":"<p>Sessions are automatically resumed when you trigger an agent on a codebase that has an active session.</p>"},{"location":"features/opencode/#sync-sessions-from-opencode","title":"Sync Sessions from OpenCode","text":"<p>If you've used OpenCode directly (outside CodeTether), sync the sessions:</p> <pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases/{id}/sessions/sync\n</code></pre>"},{"location":"features/opencode/#task-queue","title":"Task Queue","text":"<p>For distributed setups, create tasks that workers pick up:</p>"},{"location":"features/opencode/#create-a-task","title":"Create a Task","text":"<pre><code>curl -X POST http://localhost:8000/v1/opencode/codebases/{id}/tasks \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"title\": \"Add unit tests\",\n    \"prompt\": \"Add unit tests for the authentication module\",\n    \"agent_type\": \"build\",\n    \"priority\": 1\n  }'\n</code></pre>"},{"location":"features/opencode/#list-pending-tasks","title":"List Pending Tasks","text":"<pre><code>curl http://localhost:8000/v1/opencode/tasks?status=pending\n</code></pre>"},{"location":"features/opencode/#real-time-streaming","title":"Real-time Streaming","text":"<p>Subscribe to agent events via SSE:</p> <pre><code>const events = new EventSource('/v1/opencode/codebases/{id}/events');\n\nevents.addEventListener('output', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  process.stdout.write(data.content);\n});\n\nevents.addEventListener('tool_use', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(`\\n\ud83d\udd27 Using tool: ${data.tool}`);\n});\n\nevents.addEventListener('file_change', (e) =&gt; {\n  const data = JSON.parse(e.data);\n  console.log(`\\n\ud83d\udcc1 ${data.action}: ${data.path}`);\n});\n\nevents.addEventListener('complete', () =&gt; {\n  console.log('\\n\u2705 Agent completed!');\n  events.close();\n});\n</code></pre>"},{"location":"features/opencode/#configuration","title":"Configuration","text":""},{"location":"features/opencode/#environment-variables","title":"Environment Variables","text":"Variable Default Description <code>OPENCODE_HOST</code> <code>localhost</code> Host where OpenCode API is running <code>OPENCODE_PORT</code> <code>9777</code> OpenCode API port <code>OPENCODE_DB_PATH</code> <code>./data/opencode.db</code> SQLite database for sessions <code>OPENCODE_AUTO_START</code> <code>true</code> Auto-start agents on trigger <p>!!! tip \\\"Docker Container Configuration\\\"\\n    When running CodeTether in Docker and connecting to OpenCode on your host:\\n    \\n    <code>bash\\n    # Docker Desktop (Mac/Windows)\\n    docker run -e OPENCODE_HOST=host.docker.internal ...\\n    \\n    # Linux\\n    docker run --add-host=host.docker.internal:host-gateway \\\\\\n      -e OPENCODE_HOST=host.docker.internal ...\\n</code></p>"},{"location":"features/opencode/#codebase-configuration","title":"Codebase Configuration","text":"<p>Each codebase can have custom agent config:</p> <pre><code>{\n  \"name\": \"my-project\",\n  \"path\": \"/path/to/project\",\n  \"agent_config\": {\n    \"default_model\": \"anthropic/claude-sonnet-4-20250514\",\n    \"auto_approve\": false,\n    \"max_iterations\": 50,\n    \"working_directory\": \"/path/to/project\"\n  }\n}\n</code></pre>"},{"location":"features/opencode/#distributed-workers","title":"Distributed Workers","text":"<p>For scaling, run OpenCode agents on dedicated worker machines:</p>"},{"location":"features/opencode/#on-worker-machine","title":"On Worker Machine","text":"<pre><code># Install CodeTether (includes the worker CLI)\npip install codetether\n\n# Run the worker (manual mode)\n# Note: you can pass --codebase multiple times. Format: name:path (or just a path).\ncodetether-worker \\\n  --server https://codetether.example.com \\\n  --name worker-1 \\\n  --codebase app1:/projects/app1 \\\n  --codebase app2:/projects/app2\n</code></pre>"},{"location":"features/opencode/#register-worker-codebases","title":"Register Worker Codebases","text":"<pre><code>curl -X POST https://codetether.example.com/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"app1\",\n    \"path\": \"/projects/app1\",\n    \"worker_id\": \"worker-1\"\n  }'\n</code></pre> <p>Tasks for <code>app1</code> will be routed to <code>worker-1</code>.</p>"},{"location":"features/opencode/#troubleshooting","title":"Troubleshooting","text":""},{"location":"features/opencode/#opencode-not-available","title":"OpenCode Not Available","text":"<pre><code>{\"available\": false, \"message\": \"OpenCode bridge not available\"}\n</code></pre> <p>Solutions: 1. Ensure OpenCode is installed: <code>which opencode</code> 2. Check PATH includes OpenCode: <code>export PATH=$PATH:/usr/local/bin</code> 3. Verify OpenCode works: <code>opencode --version</code></p>"},{"location":"features/opencode/#no-models-returned","title":"No Models Returned","text":"<p>The <code>/v1/opencode/models</code> endpoint returns a static list. If empty: 1. Check server logs for errors 2. Verify the server started correctly</p>"},{"location":"features/opencode/#session-not-found","title":"Session Not Found","text":"<pre><code>{\"detail\": \"Session not found\"}\n</code></pre> <p>Solutions: 1. Sync sessions: <code>POST /v1/opencode/codebases/{id}/sessions/sync</code> 2. Check the OpenCode database exists at <code>OPENCODE_DB_PATH</code></p>"},{"location":"features/opencode/#api-reference","title":"API Reference","text":"<p>See the full OpenCode API Reference for all endpoints.</p>"},{"location":"features/sessions/","title":"Session Management","text":"<p>CodeTether provides comprehensive session management for AI agent conversations.</p>"},{"location":"features/sessions/#features","title":"Features","text":"<ul> <li>Session History - View past conversations</li> <li>Session Resumption - Continue where you left off</li> <li>Cross-device Sync - Access sessions from anywhere</li> </ul>"},{"location":"features/sessions/#api","title":"API","text":"<pre><code># List sessions\nGET /v1/opencode/codebases/{id}/sessions\n\n# Sync from OpenCode\nPOST /v1/opencode/codebases/{id}/sessions/sync\n</code></pre> <p>See OpenCode API for details.</p>"},{"location":"features/streaming/","title":"Real-time Streaming","text":"<p>CodeTether provides real-time streaming of agent output via Server-Sent Events (SSE).</p>"},{"location":"features/streaming/#connecting","title":"Connecting","text":"<pre><code>const events = new EventSource('/v1/opencode/codebases/{id}/events');\n\nevents.onmessage = (e) =&gt; {\n  console.log(JSON.parse(e.data));\n};\n</code></pre>"},{"location":"features/streaming/#event-types","title":"Event Types","text":"<ul> <li><code>output</code> - Agent text output</li> <li><code>tool_use</code> - Tool invocation</li> <li><code>file_change</code> - File modifications</li> <li><code>complete</code> - Task completed</li> <li><code>error</code> - Error occurred</li> </ul> <p>See SSE Events for details.</p>"},{"location":"getting-started/configuration/","title":"Configuration","text":"<p>CodeTether Server is configured primarily through environment variables, making it easy to deploy in containers and Kubernetes.</p>"},{"location":"getting-started/configuration/#quick-reference","title":"Quick Reference","text":"<pre><code># Core Server\nexport A2A_HOST=0.0.0.0\nexport A2A_PORT=8000\nexport A2A_LOG_LEVEL=INFO\n\n# Agent Identity\nexport A2A_AGENT_NAME=\"My Agent\"\nexport A2A_AGENT_DESCRIPTION=\"Production agent server\"\n\n# Redis (for distributed workers)\nexport A2A_REDIS_URL=redis://localhost:6379\n\n# Authentication\nexport A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:secret-token-1,worker:secret-token-2\"\n\n# Keycloak OIDC\nexport KEYCLOAK_URL=https://auth.example.com\nexport KEYCLOAK_REALM=myrealm\nexport KEYCLOAK_CLIENT_ID=codetether\nexport KEYCLOAK_CLIENT_SECRET=your-secret\n\n# MCP Server\nexport MCP_HTTP_ENABLED=true\nexport MCP_HTTP_HOST=0.0.0.0\nexport MCP_HTTP_PORT=9000\n\n# OpenCode Integration\nexport OPENCODE_DB_PATH=/data/opencode.db\nexport OPENCODE_HOST=localhost\nexport OPENCODE_PORT=9777\n\n# LiveKit (for media)\nexport LIVEKIT_URL=wss://live.example.com\nexport LIVEKIT_API_KEY=your-api-key\nexport LIVEKIT_API_SECRET=your-api-secret\n\n# MinIO (for artifacts)\nexport MINIO_ENDPOINT=minio.example.com:9000\nexport MINIO_ACCESS_KEY=your-access-key\nexport MINIO_SECRET_KEY=your-secret-key\nexport MINIO_BUCKET=codetether\nexport MINIO_SECURE=true\n</code></pre>"},{"location":"getting-started/configuration/#configuration-categories","title":"Configuration Categories","text":""},{"location":"getting-started/configuration/#core-server-settings","title":"Core Server Settings","text":"Variable Default Description <code>A2A_HOST</code> <code>0.0.0.0</code> Host to bind the server to <code>A2A_PORT</code> <code>8000</code> Port for the A2A API <code>A2A_LOG_LEVEL</code> <code>INFO</code> Logging level (DEBUG, INFO, WARNING, ERROR)"},{"location":"getting-started/configuration/#agent-identity","title":"Agent Identity","text":"Variable Default Description <code>A2A_AGENT_NAME</code> <code>A2A Server</code> Name shown in agent card <code>A2A_AGENT_DESCRIPTION</code> \u2014 Description of the agent's capabilities <code>A2A_AGENT_ORG</code> <code>A2A Server</code> Organization name <code>A2A_AGENT_ORG_URL</code> GitHub URL Organization URL"},{"location":"getting-started/configuration/#redis-configuration","title":"Redis Configuration","text":"<p>Redis is required for distributed workers and task queuing.</p> Variable Default Description <code>A2A_REDIS_URL</code> <code>redis://localhost:6379</code> Redis connection URL <p>Redis URL Format</p> <pre><code>redis://[[username]:[password]@]host[:port][/database]\n</code></pre> <p>Examples: <pre><code>redis://localhost:6379\nredis://:password@redis.example.com:6379/0\nredis://user:pass@redis-cluster.example.com:6379\n</code></pre></p>"},{"location":"getting-started/configuration/#authentication","title":"Authentication","text":""},{"location":"getting-started/configuration/#token-authentication","title":"Token Authentication","text":"Variable Default Description <code>A2A_AUTH_ENABLED</code> <code>false</code> Enable token authentication <code>A2A_AUTH_TOKENS</code> \u2014 Comma-separated <code>name:token</code> pairs <p>Example: <pre><code>export A2A_AUTH_ENABLED=true\nexport A2A_AUTH_TOKENS=\"admin:abc123,worker:def456,readonly:xyz789\"\n</code></pre></p>"},{"location":"getting-started/configuration/#keycloak-oidc","title":"Keycloak OIDC","text":"Variable Default Description <code>KEYCLOAK_URL</code> \u2014 Keycloak server URL <code>KEYCLOAK_REALM</code> \u2014 Keycloak realm name <code>KEYCLOAK_CLIENT_ID</code> \u2014 OIDC client ID <code>KEYCLOAK_CLIENT_SECRET</code> \u2014 OIDC client secret <code>KEYCLOAK_ADMIN_USERNAME</code> \u2014 Admin username (for user management) <code>KEYCLOAK_ADMIN_PASSWORD</code> \u2014 Admin password"},{"location":"getting-started/configuration/#mcp-server","title":"MCP Server","text":"<p>The MCP (Model Context Protocol) server provides tool integration.</p> Variable Default Description <code>MCP_HTTP_ENABLED</code> <code>true</code> Enable MCP HTTP server <code>MCP_HTTP_HOST</code> <code>0.0.0.0</code> MCP server host <code>MCP_HTTP_PORT</code> <code>9000</code> MCP server port"},{"location":"getting-started/configuration/#opencode-integration","title":"OpenCode Integration","text":"Variable Default Description <code>OPENCODE_HOST</code> <code>localhost</code> Host where OpenCode API is running <code>OPENCODE_PORT</code> <code>9777</code> OpenCode API port <code>OPENCODE_DB_PATH</code> <code>./data/opencode.db</code> SQLite database for OpenCode sessions <p>Docker Container Configuration</p> <p>When running CodeTether in Docker and connecting to OpenCode on your host:</p> <ul> <li>Docker Desktop (Mac/Windows): Use <code>OPENCODE_HOST=host.docker.internal</code></li> <li>Linux: Use <code>--add-host=host.docker.internal:host-gateway</code> and <code>OPENCODE_HOST=host.docker.internal</code></li> <li>Alternative: Use your host machine's actual IP address</li> </ul>"},{"location":"getting-started/configuration/#database","title":"Database","text":"Variable Default Description <code>DATABASE_URL</code> \u2014 PostgreSQL connection URL for durable persistence. Format: <code>postgresql://user:password@host:port/database</code>. When set, workers, codebases, tasks, and sessions survive server restarts and work across replicas. <code>A2A_DATABASE_URL</code> \u2014 Alias for <code>DATABASE_URL</code> <code>MONITOR_DB_PATH</code> <code>./data/monitor.db</code> SQLite database for monitoring data (fallback when PostgreSQL not configured) <code>SESSIONS_DB_PATH</code> \u2014 Database path for session persistence <p>PostgreSQL Connection URL Format</p> <pre><code>postgresql://[username]:[password]@host[:port]/database\n</code></pre> <p>Examples: <pre><code>postgresql://postgres:secret@localhost:5432/codetether\npostgresql://user:pass@db.example.com:5432/a2a_server\n</code></pre></p> <p>Storage Priority</p> <p>CodeTether uses a tiered storage approach:</p> <ol> <li>PostgreSQL (primary) - Durable persistence across restarts and replicas</li> <li>Redis - Fast shared state for multi-replica deployments</li> <li>In-memory - Single-instance fallback when neither is configured</li> </ol>"},{"location":"getting-started/configuration/#livekit-media","title":"LiveKit Media","text":"<p>For voice/video agent interactions.</p> Variable Default Description <code>LIVEKIT_URL</code> \u2014 LiveKit server WebSocket URL <code>LIVEKIT_API_KEY</code> \u2014 LiveKit API key <code>LIVEKIT_API_SECRET</code> \u2014 LiveKit API secret"},{"location":"getting-started/configuration/#minio-object-storage","title":"MinIO Object Storage","text":"<p>For storing large artifacts and files.</p> Variable Default Description <code>MINIO_ENDPOINT</code> \u2014 MinIO server endpoint <code>MINIO_ACCESS_KEY</code> \u2014 MinIO access key <code>MINIO_SECRET_KEY</code> \u2014 MinIO secret key <code>MINIO_BUCKET</code> <code>a2a-monitor</code> Default bucket name <code>MINIO_SECURE</code> <code>false</code> Use HTTPS for MinIO"},{"location":"getting-started/configuration/#worker-configuration","title":"Worker Configuration","text":"<p>For distributed agent workers:</p> Variable Default Description <code>A2A_SERVER_URL</code> <code>https://api.codetether.run</code> Server URL to connect to <code>A2A_WORKER_NAME</code> hostname Worker identifier <code>A2A_POLL_INTERVAL</code> <code>5</code> Task polling interval (seconds)"},{"location":"getting-started/configuration/#configuration-files","title":"Configuration Files","text":""},{"location":"getting-started/configuration/#env-file","title":"<code>.env</code> File","text":"<p>Create a <code>.env</code> file in the project root:</p> <pre><code># .env\nA2A_PORT=8000\nA2A_AGENT_NAME=Production Agent\nA2A_REDIS_URL=redis://redis:6379\nA2A_AUTH_ENABLED=true\nKEYCLOAK_URL=https://auth.example.com\nKEYCLOAK_REALM=production\nKEYCLOAK_CLIENT_ID=codetether\n</code></pre>"},{"location":"getting-started/configuration/#kubernetes-configmap","title":"Kubernetes ConfigMap","text":"<pre><code>apiVersion: v1\nkind: ConfigMap\nmetadata:\n  name: codetether-config\ndata:\n  A2A_HOST: \"0.0.0.0\"\n  A2A_PORT: \"8000\"\n  A2A_LOG_LEVEL: \"INFO\"\n  A2A_REDIS_URL: \"redis://redis:6379\"\n  MCP_HTTP_ENABLED: \"true\"\n  MCP_HTTP_PORT: \"9000\"\n</code></pre>"},{"location":"getting-started/configuration/#kubernetes-secret","title":"Kubernetes Secret","text":"<pre><code>apiVersion: v1\nkind: Secret\nmetadata:\n  name: codetether-secrets\ntype: Opaque\nstringData:\n  A2A_AUTH_TOKENS: \"admin:super-secret-token\"\n  KEYCLOAK_CLIENT_SECRET: \"your-client-secret\"\n  MINIO_SECRET_KEY: \"your-minio-secret\"\n</code></pre>"},{"location":"getting-started/configuration/#validation","title":"Validation","text":"<p>CodeTether validates configuration on startup. Check the logs for any configuration issues:</p> <pre><code>codetether serve --port 8000\n# INFO: Configuration validated\n# INFO: Redis connection: OK\n# INFO: Keycloak: disabled\n# INFO: MCP Server: enabled on port 9000\n</code></pre>"},{"location":"getting-started/configuration/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 Run your first agent</li> <li>Keycloak Setup \u2014 Configure OIDC authentication</li> <li>Kubernetes Deployment \u2014 Deploy to production</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>CodeTether Server can be installed in several ways depending on your needs.</p>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.10+ (for pip install)</li> <li>Docker 20.10+ (for container deployment)</li> <li>Redis 6+ (optional, for distributed workers)</li> </ul>"},{"location":"getting-started/installation/#install-via-pip-recommended","title":"Install via pip (recommended)","text":"<p>If you have a Python environment already set up, pip is the simplest option.</p> <pre><code>pip install codetether\n</code></pre> <p>Verify the installation:</p> <pre><code>codetether --version\n# 1.0.0\n</code></pre>"},{"location":"getting-started/installation/#install-from-github-pip","title":"Install from GitHub (pip)","text":"<p>If you want the latest code (or you're installing before a PyPI release is published):</p> <pre><code>pip install \"git+https://github.com/rileyseaburg/codetether.git@main\"\n</code></pre>"},{"location":"getting-started/installation/#one-line-install-shell","title":"One-line install (shell)","text":"<p>This installs CodeTether into a local virtual environment under <code>~/.codetether/venv</code> and links the CLI into <code>~/.local/bin</code>.</p> <pre><code>curl -fsSL https://raw.githubusercontent.com/rileyseaburg/codetether/main/scripts/install-codetether.sh | bash\n</code></pre>"},{"location":"getting-started/installation/#docker","title":"Docker","text":"<p>Pull the official image:</p> <pre><code>docker pull ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre> <p>Run the server:</p> <pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre> <p>With environment configuration:</p> <pre><code>docker run -d \\\n  --name codetether \\\n  -p 8000:8000 \\\n  -p 9000:9000 \\\n  -e A2A_AGENT_NAME=\"My Agent\" \\\n  -e REDIS_URL=\"redis://redis:6379\" \\\n  -e KEYCLOAK_URL=\"https://auth.example.com\" \\\n  ghcr.io/rileyseaburg/codetether-server:latest\n</code></pre>"},{"location":"getting-started/installation/#docker-compose","title":"Docker Compose","text":"<p>Create a <code>docker-compose.yml</code>:</p> <pre><code>version: '3.8'\n\nservices:\n  codetether:\n    image: ghcr.io/rileyseaburg/codetether-server:latest\n    ports:\n      - \"8000:8000\"  # A2A API\n      - \"9000:9000\"  # MCP Server\n    environment:\n      - A2A_AGENT_NAME=CodeTether Server\n      - REDIS_URL=redis://redis:6379\n      - LOG_LEVEL=INFO\n    depends_on:\n      - redis\n\n  redis:\n    image: redis:7-alpine\n    ports:\n      - \"6379:6379\"\n    volumes:\n      - redis-data:/data\n\nvolumes:\n  redis-data:\n</code></pre> <p>Start the stack:</p> <pre><code>docker-compose up -d\n</code></pre>"},{"location":"getting-started/installation/#from-source","title":"From Source","text":"<p>Clone the repository:</p> <pre><code>git clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n</code></pre> <p>Create a virtual environment:</p> <pre><code>python -m venv venv\nsource venv/bin/activate  # Linux/macOS\n# or\n.\\venv\\Scripts\\activate   # Windows\n</code></pre> <p>Install dependencies:</p> <pre><code>pip install -e .\n</code></pre> <p>Run the server:</p> <pre><code>codetether --port 8000\n</code></pre>"},{"location":"getting-started/installation/#agent-worker-systemd-linux","title":"Agent Worker (systemd, Linux)","text":"<p>To execute OpenCode tasks on machines that host codebases, install the agent worker.</p> <pre><code>git clone https://github.com/rileyseaburg/codetether.git\ncd codetether\n\nsudo ./agent_worker/install.sh\nsudo systemctl start a2a-agent-worker\nsudo journalctl -u a2a-agent-worker -f\n</code></pre>"},{"location":"getting-started/installation/#kubernetes-helm","title":"Kubernetes (Helm)","text":"<p>Add the Helm repository:</p> <pre><code>helm repo add codetether https://charts.codetether.run\nhelm repo update\n</code></pre> <p>Install the chart:</p> <pre><code>helm install codetether codetether/a2a-server \\\n  --namespace codetether \\\n  --create-namespace \\\n  --set ingress.enabled=true \\\n  --set ingress.hosts[0].host=codetether.example.com\n</code></pre> <p>See Kubernetes Deployment for full configuration options.</p>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<p>Once installed, verify the server is running:</p> <pre><code># Check health endpoint\ncurl http://localhost:8000/health\n# {\"status\": \"healthy\", \"version\": \"1.0.0\"}\n\n# Check agent card (A2A discovery)\ncurl http://localhost:8000/.well-known/agent-card.json\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start \u2014 Run your first agent task</li> <li>Configuration \u2014 Configure authentication, Redis, and more</li> <li>OpenCode Integration \u2014 Set up AI coding agents</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get CodeTether Server running and send your first task in 5 minutes.</p>"},{"location":"getting-started/quickstart/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.10+ installed</li> <li><code>pip</code> package manager</li> </ul>"},{"location":"getting-started/quickstart/#step-1-install-codetether","title":"Step 1: Install CodeTether","text":"<pre><code>pip install codetether\n</code></pre>"},{"location":"getting-started/quickstart/#step-2-start-the-server","title":"Step 2: Start the Server","text":"<pre><code>codetether serve --port 8000\n</code></pre> <p>You should see:</p> <pre><code>INFO:     CodeTether Server starting...\nINFO:     A2A Protocol endpoint: http://0.0.0.0:8000/v1/a2a\nINFO:     Agent Card: http://0.0.0.0:8000/.well-known/agent-card.json\nINFO:     Monitor UI: http://0.0.0.0:8000/monitor\nINFO:     Uvicorn running on http://0.0.0.0:8000\n</code></pre>"},{"location":"getting-started/quickstart/#step-3-discover-the-agent","title":"Step 3: Discover the Agent","text":"<p>Every A2A-compliant agent exposes an Agent Card at <code>/.well-known/agent-card.json</code>:</p> <pre><code>curl http://localhost:8000/.well-known/agent-card.json | jq\n</code></pre> <pre><code>{\n  \"name\": \"CodeTether Server\",\n  \"description\": \"Production A2A coordination server\",\n  \"url\": \"http://localhost:8000\",\n  \"version\": \"1.0.0\",\n  \"capabilities\": {\n    \"streaming\": true,\n    \"pushNotifications\": true,\n    \"stateTransitionHistory\": true\n  },\n  \"skills\": [\n    {\n      \"id\": \"task-coordination\",\n      \"name\": \"Task Coordination\",\n      \"description\": \"Coordinate tasks between multiple agents\"\n    }\n  ]\n}\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-send-a-task","title":"Step 4: Send a Task","text":"<p>Send your first task using the A2A JSON-RPC protocol:</p> <pre><code>curl -X POST http://localhost:8000/v1/a2a \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"jsonrpc\": \"2.0\",\n    \"method\": \"tasks/send\",\n    \"params\": {\n      \"message\": {\n        \"role\": \"user\",\n        \"parts\": [{\"text\": \"Hello, CodeTether!\"}]\n      }\n    },\n    \"id\": \"task-001\"\n  }'\n</code></pre> <p>Response:</p> <pre><code>{\n  \"jsonrpc\": \"2.0\",\n  \"result\": {\n    \"id\": \"task-abc123\",\n    \"status\": {\n      \"state\": \"completed\"\n    },\n    \"artifacts\": [\n      {\n        \"parts\": [{\"text\": \"Hello! I'm CodeTether Server, ready to coordinate your agents.\"}]\n      }\n    ]\n  },\n  \"id\": \"task-001\"\n}\n</code></pre>"},{"location":"getting-started/quickstart/#step-5-open-the-monitor-ui","title":"Step 5: Open the Monitor UI","text":"<p>Open your browser to http://localhost:8000/monitor to see:</p> <ul> <li>Connected agents</li> <li>Active tasks</li> <li>Real-time message streams</li> <li>System health</li> </ul>"},{"location":"getting-started/quickstart/#using-the-python-client","title":"Using the Python Client","text":"<p>Install the client library:</p> <pre><code>pip install codetether\n</code></pre> <pre><code>from a2a_server import A2AClient\n\n# Connect to the server\nclient = A2AClient(\"http://localhost:8000\")\n\n# Send a task\nresult = client.send_task(\"Analyze this code for security issues\")\nprint(result.artifacts[0].text)\n\n# Stream responses\nfor chunk in client.send_task_streaming(\"Generate a report\"):\n    print(chunk, end=\"\", flush=True)\n</code></pre>"},{"location":"getting-started/quickstart/#using-with-opencode","title":"Using with OpenCode","text":"<p>If you have OpenCode installed, you can register codebases:</p> <pre><code># Register a codebase\ncurl -X POST http://localhost:8000/v1/opencode/codebases \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"name\": \"my-project\",\n    \"path\": \"/home/user/projects/my-project\",\n    \"description\": \"My awesome project\"\n  }'\n\n# Trigger an agent task\ncurl -X POST http://localhost:8000/v1/opencode/codebases/{codebase_id}/trigger \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"prompt\": \"Add unit tests for the authentication module\",\n    \"agent\": \"build\"\n  }'\n</code></pre>"},{"location":"getting-started/quickstart/#whats-next","title":"What's Next?","text":"<ul> <li> <p> Configure the Server</p> <p>Set up Redis, authentication, and more</p> <p> Configuration</p> </li> <li> <p> OpenCode Integration</p> <p>Bridge AI coding agents to your codebase</p> <p> OpenCode</p> </li> <li> <p> Deploy to Production</p> <p>Kubernetes, Helm charts, and scaling</p> <p> Deployment</p> </li> <li> <p> API Reference</p> <p>Full endpoint documentation</p> <p> API Docs</p> </li> </ul>"},{"location":"reference/cli/","title":"CLI Reference","text":"<p>CodeTether command-line interface.</p>"},{"location":"reference/cli/#commands","title":"Commands","text":""},{"location":"reference/cli/#serve","title":"serve","text":"<p>Start the server:</p> <pre><code>codetether serve --port 8000\n</code></pre> <p><code>serve</code> is a friendly alias for starting a single server instance.</p>"},{"location":"reference/cli/#run","title":"run","text":"<p>Explicit form of starting a single server:</p> <pre><code>codetether run --port 8000\n</code></pre>"},{"location":"reference/cli/#codetether-worker","title":"codetether-worker","text":"<p>Start a worker:</p> <pre><code>codetether-worker --server https://example.com --name worker-1 --codebase /path/to/repo\n</code></pre>"},{"location":"reference/cli/#version","title":"version","text":"<p>Show version:</p> <pre><code>codetether --version\n</code></pre>"},{"location":"reference/environment-variables/","title":"Environment Variables","text":"<p>Complete reference of all CodeTether environment variables.</p> <p>See Configuration for detailed documentation.</p>"},{"location":"reference/environment-variables/#core","title":"Core","text":"Variable Default Description <code>A2A_HOST</code> <code>0.0.0.0</code> Server host <code>A2A_PORT</code> <code>8000</code> Server port <code>A2A_LOG_LEVEL</code> <code>INFO</code> Log level"},{"location":"reference/environment-variables/#database-storage","title":"Database &amp; Storage","text":"Variable Default Description <code>DATABASE_URL</code> \u2014 PostgreSQL connection URL for durable persistence. Format: <code>postgresql://user:password@host:port/database</code>. When set, workers, codebases, tasks, and sessions survive server restarts and work across replicas. <code>A2A_DATABASE_URL</code> \u2014 Alias for <code>DATABASE_URL</code> <code>A2A_REDIS_URL</code> <code>redis://localhost:6379</code> Redis URL (shared state for multi-replica deployments; used by task queues and OpenCode worker/session sync) <code>OPENCODE_DB_PATH</code> <code>./data/opencode.db</code> SQLite database path for OpenCode codebases/tasks registry (fallback when PostgreSQL not configured)"},{"location":"reference/environment-variables/#authentication","title":"Authentication","text":"Variable Default Description <code>A2A_AUTH_ENABLED</code> <code>false</code> Enable auth <code>A2A_AUTH_TOKENS</code> \u2014 Token list <code>KEYCLOAK_URL</code> \u2014 Keycloak URL <code>KEYCLOAK_REALM</code> \u2014 Realm <code>KEYCLOAK_CLIENT_ID</code> \u2014 Client ID <code>KEYCLOAK_CLIENT_SECRET</code> \u2014 Client secret"},{"location":"reference/environment-variables/#mcp","title":"MCP","text":"Variable Default Description <code>MCP_HTTP_ENABLED</code> <code>true</code> Enable MCP <code>MCP_HTTP_PORT</code> <code>9000</code> MCP port"},{"location":"reference/environment-variables/#opencode-integration","title":"OpenCode Integration","text":"Variable Default Description <code>OPENCODE_HOST</code> <code>localhost</code> Host where OpenCode API runs (use <code>host.docker.internal</code> in Docker) <code>OPENCODE_PORT</code> <code>9777</code> OpenCode API port"},{"location":"reference/errors/","title":"Error Codes","text":"<p>CodeTether error codes and troubleshooting.</p>"},{"location":"reference/errors/#http-status-codes","title":"HTTP Status Codes","text":"Code Description 400 Bad request 401 Unauthorized 403 Forbidden 404 Not found 500 Server error 503 Service unavailable"},{"location":"reference/errors/#json-rpc-errors","title":"JSON-RPC Errors","text":"Code Description -32700 Parse error -32600 Invalid request -32601 Method not found -32602 Invalid params -32603 Internal error"}]}