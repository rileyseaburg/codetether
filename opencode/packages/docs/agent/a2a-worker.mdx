---
title: "A2A Worker Mode"
description: "Connect to the CodeTether platform as an A2A worker"
---

## Overview

A2A (Agent-to-Agent) is a protocol for communication between AI agents. CodeTether Agent is built natively for A2A, running as a **worker** that connects to the CodeTether platform.

```
┌─────────────────────────────────────────────────────────┐
│                   CodeTether Platform                    │
│                  api.codetether.run                      │
│  ┌─────────┐  ┌─────────┐  ┌─────────┐                 │
│  │  Task   │  │  Task   │  │  Task   │                 │
│  │  Queue  │  │ Router  │  │ Results │                 │
│  └────┬────┘  └────┬────┘  └────┬────┘                 │
└───────┼────────────┼────────────┼───────────────────────┘
        │            │            │
        │     SSE Stream          │
        ▼                         ▲
┌───────────────────────────────────────────────────────┐
│                 codetether (worker)                    │
│   1. Claim task                                        │
│   2. Execute with AI + tools                           │
│   3. Submit result                                     │
└───────────────────────────────────────────────────────┘
```

## How It Works

1. **Connect**: Worker establishes SSE connection to the platform
2. **Claim**: Worker claims tasks from the queue
3. **Execute**: Worker runs the task using AI providers and local tools
4. **Report**: Worker streams updates and submits final results

## Quick Start

```bash
# Connect to the platform
codetether --server https://api.codetether.run

# With authentication
codetether --server https://api.codetether.run --token $WORKER_TOKEN

# With custom name
codetether --server https://api.codetether.run --name "dev-laptop"
```

## Configuration Options

| Option | Environment Variable | Description |
|--------|---------------------|-------------|
| `--server` | `CODETETHER_SERVER` | A2A server URL |
| `--token` | `CODETETHER_TOKEN` | Authentication token |
| `--name` | `CODETETHER_WORKER_NAME` | Worker identifier |
| `--auto-approve` | - | Task approval policy |

### Auto-Approve Policies

| Policy | Description |
|--------|-------------|
| `safe` (default) | Auto-approve read-only operations |
| `all` | Auto-approve all operations |
| `none` | Require approval for everything |

```bash
codetether --server https://api.codetether.run --auto-approve all
```

## Task Lifecycle

### Task States

```
submitted → working → completed
                   ↘  failed
                   ↘  cancelled
```

| State | Description |
|-------|-------------|
| `submitted` | Task is in queue |
| `working` | Worker is processing |
| `completed` | Successfully finished |
| `failed` | Error occurred |
| `cancelled` | User cancelled |

### Example Task Flow

```json
// 1. Task submitted
{
  "id": "task-123",
  "state": "submitted",
  "message": {
    "role": "user",
    "content": "Implement a binary search function"
  }
}

// 2. Worker claims and starts
{
  "id": "task-123",
  "state": "working",
  "status": "Analyzing codebase..."
}

// 3. Worker streams updates
{
  "id": "task-123",
  "state": "working",
  "status": "Writing implementation..."
}

// 4. Task completed
{
  "id": "task-123",
  "state": "completed",
  "artifacts": [
    {
      "type": "code",
      "path": "src/search.rs",
      "content": "..."
    }
  ]
}
```

## AgentCard

When running as a server, the agent exposes its capabilities:

```bash
curl http://localhost:4096/.well-known/agent.json
```

```json
{
  "name": "CodeTether Agent",
  "description": "A2A-native AI coding agent",
  "url": "http://localhost:4096",
  "version": "0.1.0",
  "skills": [
    {
      "id": "code-generation",
      "name": "Code Generation",
      "description": "Generate code from natural language"
    },
    {
      "id": "code-review",
      "name": "Code Review",
      "description": "Review code for issues and improvements"
    },
    {
      "id": "debugging",
      "name": "Debugging",
      "description": "Find and fix bugs"
    },
    {
      "id": "refactoring",
      "name": "Refactoring",
      "description": "Improve code structure"
    }
  ],
  "providers": ["openai", "anthropic", "google"]
}
```

## Running as an A2A Server

In addition to worker mode, you can run as an A2A server:

```bash
codetether serve --port 4096
```

This allows other agents or clients to submit tasks to your agent.

### API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/.well-known/agent.json` | GET | Agent capabilities |
| `/` | POST | JSON-RPC endpoint |
| `/health` | GET | Health check |

### JSON-RPC Methods

| Method | Description |
|--------|-------------|
| `message/send` | Submit a new task |
| `message/stream` | Submit with streaming response |
| `tasks/get` | Get task status |
| `tasks/cancel` | Cancel a task |

## Error Handling

### Reconnection

The worker automatically reconnects on disconnection:

```
2026-02-02T12:00:00Z  WARN a2a: Connection lost, reconnecting...
2026-02-02T12:00:05Z  INFO a2a: Reconnected to server
```

### Task Failures

Failed tasks are reported back to the platform:

```json
{
  "id": "task-123",
  "state": "failed",
  "error": {
    "code": "TOOL_ERROR",
    "message": "Command exited with code 1"
  }
}
```

## Monitoring

### Logs

```bash
codetether --server https://api.codetether.run --print-logs --log-level DEBUG
```

### Metrics

When running as a server, metrics are available at `/metrics` (Prometheus format).

## Security

### Authentication

Workers authenticate using tokens:

```bash
codetether --server https://api.codetether.run --token $WORKER_TOKEN
```

### TLS

All connections use TLS. For self-signed certificates:

```bash
export VAULT_SKIP_VERIFY=true  # Not recommended for production
```

### Network

Workers only need outbound HTTPS access to:
- A2A server (`api.codetether.run`)
- HashiCorp Vault
- AI provider APIs

## Next Steps

<CardGroup cols={2}>
  <Card title="AI Providers" icon="robot" href="/ai-tools/overview">
    Configure multiple AI providers.
  </Card>
  <Card title="SDK Reference" icon="code" href="/development">
    Programmatic access to CodeTether.
  </Card>
</CardGroup>
